---
title: "radiation_plot_calcs"
output: html_document
date: "2024-09-13"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(lterdatasampler)
library(dplyr)
library(ggplot2)
library(readr)
library(readxl)
library(lubridate)
library(plotly)
library(openxlsx)
library(plotly)
library(rstatix)
library(htmlwidgets)
library(RColorBrewer)
library(patchwork)
library(hms)
library(ggpubr)
#package for scientific notation of numbers
library(scales)
#package for accumulation sums 
library(purrr)
library(patchwork)

setwd("/Volumes/wcnr-network/Research/Kampf/Private/field_data")
```

```{r}
#to display the colors
display.brewer.pal(n = 8, name = "Dark2")

#to get the hex number of the colors
brewer.pal(n = 8, name = "Dark2")
```

```{r}
#setting a color-blind friendly custom palette for gb/db/ubn- using RColorBrewer
##blue is unburned, orange is dead burned, green is green burned
three_custom_colors <- c("#D95F02","#1B7837", adjustcolor("#2166AC", alpha = 0.7))

## orange is burned, blue is unburned
two_custom_colors <- c("#D95F02", adjustcolor("#2166AC", alpha = 0.7))
```

# Transitional Data

## Calling in Data

```{r}
transb_energytree_table <- read_csv("nsf/drone_imagery/trans_b_energytree_table.csv") %>%
  mutate(zone = "transitional") %>%
  rename(burn_status = burn_statu) %>%
  #adding a tree_id column
  mutate(tree_id = row_number()) %>%
  #selecting columns I want
  select(tree_id, zone, burn_status, lat, long)

#this is the csv that has tree diameters for albedo plots on it, use this to choose an average circumference
albedoplots_treechar_alldata <- read_csv("nsf/albedo/albedoplots_treechar_alldata.csv")

#this is the csv that has camera snow depths and if tree wells appeared or not from 105E_transb_snowcamera
transb_snowcamera_data <- read_csv("nsf/camera_snowdepths/2024_105E_transb_snowdepths.csv") %>%
  rename(snowcam_max_depth_cm = "maximum_depth(cm)") %>%
  mutate(date = as.Date(date))

transb_wx_15min <- read_csv("nsf/trans_burned/trans_burned_wx_15min_r.csv") %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")), datetime = force_tz(datetime, tz = 'MST'))

#seperating by burned/unburned
##burned
avg_dt_transb_treeLW_burned <- read_csv("nsf/105E_trans_burned/day_avg_filtered_treeLWout_data_bub.csv") %>%
  filter(zone == "transitional", phase == "day", burn_status == "burned") %>%
  rename(b_tree_LWout_MJd = tree_LWout_MJperd, b_treetemp_C = temp, b_tree_LWout_wperm2 = tree_LWout_wperm2)

##unburned
avg_dt_transb_treeLW_unburned <- read_csv("nsf/105E_trans_burned/day_avg_filtered_treeLWout_data_bub.csv") %>%
  filter(zone == "transitional", phase == "day", burn_status == "unburned") %>%
  rename(ub_tree_LWout_MJd = tree_LWout_MJperd, ub_treetemp_C = temp, ub_tree_LWout_wperm2 = tree_LWout_wperm2)


#seperating by tree burn status - gb/db/ub - this dataframe includes all burn status types
avg_dt_transb_treeLW_allstatuses <- read_csv("nsf/105E_trans_burned/day_avg_filtered_treeLWout_data_gbdbub.csv")

##green burned dataframe
avg_dt_transb_treeLW_gb <- avg_dt_transb_treeLW_allstatuses %>%
  #filtering out only the correct burned status, daytime data, & transitional zone
  filter(zone == "transitional", phase == "day", burn_status == "green burn") %>%
  rename(gb_tree_LWout_MJd = tree_LWout_MJperd, gb_treetemp_C = temp_C, gb_tree_LWout_wperm2 = tree_LWout_wperm2, gb_tree_LWout_Jperd = tree_LWout_Jperd) %>%
  #removing double ID first column that appeared for some reason?
  select(-1)

##dead burned dataframe
avg_dt_transb_treeLW_db <- avg_dt_transb_treeLW_allstatuses %>%
  #filtering out only the correct burned status, daytime data, & transitional zone
  filter(zone == "transitional", phase == "day", burn_status == "dead burn") %>%
  rename(db_tree_LWout_MJd = tree_LWout_MJperd, db_treetemp_C = temp_C, db_tree_LWout_wperm2 = tree_LWout_wperm2, db_tree_LWout_Jperd = tree_LWout_Jperd) %>%
  #removing double ID first column that appeared for some reason?
  select(-1)

##unburned dataframe
avg_dt_transb_treeLW_ub <- avg_dt_transb_treeLW_allstatuses %>%
  #filtering out only the correct burned status, daytime data, & transitional zone
  filter(zone == "transitional", phase == "day", burn_status == "unburned") %>%
  rename(ub_tree_LWout_MJd = tree_LWout_MJperd, ub_treetemp_C = temp_C, ub_tree_LWout_wperm2 = tree_LWout_wperm2, ub_tree_LWout_Jperd = tree_LWout_Jperd) %>%
  #removing double ID first column that appeared for some reason?
  select(-1)
```

## Filtering Data

```{r}
filtered_transb_rad_wx <- transb_wx_15min %>%
  filter(datetime >= as.POSIXct("2024-02-02 00:00:00") & datetime <= as.POSIXct("2024-05-25 00:00:00")) %>%
   # Adding in date, time, and phase columns
  mutate(
    date = as.Date(datetime),
    time = format(datetime, "%H:%M:%S"),
    time_hms = hms::as_hms(time),  # Convert to hms object for phase calculation
    phase = case_when(
      time_hms >= hms::as_hms("08:00:00") & time_hms < hms::as_hms("17:00:00") ~ "day",
      time_hms < hms::as_hms("08:00:00") | time_hms >= hms::as_hms("17:00:00") ~ "night",
      TRUE ~ NA_character_)) %>%
      select(datetime, date, time, phase, SnowDepth_m, AirTC_Avg, SWin_Avg, SWout_Avg, SWalbedo_Avg, LWin_Avg, LWout_Avg, SWnet_Avg, LWnet_Avg, NR_Avg)
```

## Data Wrangling

Creating a daily average wx station dataframe, then converting to MJ/day

```{r}
#calculations for radiation conversions from W/m2 to MJ/day
## create a daily average dataframe
avg_dt_transb_rad_wx<- filtered_transb_rad_wx %>%
  group_by(date, phase) %>%
  summarize(across(everything(), mean, na.rm = TRUE)) %>%
  select(-c(datetime, time)) %>%
  group_by(date, phase) %>%
  # Convert mean radiation to MJ/day - assuming constent for m2 value
  mutate(SWin_MJd = (SWin_Avg/ 1e6) * 86400, SWout_MJd = (SWout_Avg/ 1e6) * 86400, LWin_MJd = (LWin_Avg/ 1e6) * 86400, LWout_MJd = (LWout_Avg/ 1e6) * 86400, SWnet_MJd = (SWnet_Avg / 1e6) * 86400, LWnet_MJd = (LWnet_Avg/ 1e6) * 86400, NR_MJd = (NR_Avg / 1e6) * 86400) %>%
  rename(SWin_wperm2 = SWin_Avg, SWout_wperm2 = SWout_Avg, SWnet_wperm2 = SWnet_Avg, LWin_wperm2 = LWin_Avg, LWout_wperm2 = LWout_Avg, LWnet_wperm2 = LWnet_Avg, NR_wperm2 = NR_Avg) %>%
  mutate(zone = "transitional", burn_status = "burned") %>%
  #filtering out only daytime values
  filter(phase == "day") %>%
  #reordering so the like values are next to each other
  select(date, phase, zone, burn_status, SnowDepth_m, AirTC_Avg, SWin_wperm2, SWin_MJd, SWout_wperm2, SWout_MJd, SWnet_wperm2, SWnet_MJd, SWalbedo_Avg, LWin_wperm2, LWin_MJd, LWout_wperm2, LWout_MJd, LWnet_wperm2, LWnet_MJd, NR_wperm2, NR_MJd) %>%
  #setting decimal number
   mutate(across(SnowDepth_m:last_col(), ~ round(., 4)))
```

```{r}
#filtering snow depth camera data
##transitional
filtered_transb_snowcamera_data <- transb_snowcamera_data %>%
  filter(date >= as.POSIXct("2024-02-02") & date <= as.POSIXct("2024-05-24")) %>%
  mutate(snowcam_max_depth_m = snowcam_max_depth_cm/100) %>%
  select(date, snowcam_max_depth_cm, snowcam_max_depth_m, conditions, treewell_developed) %>%
  mutate(treewell_developed = case_when(
    treewell_developed == "no snow" ~ "no",
    treewell_developed == "maybe" ~ "yes",
    TRUE ~ treewell_developed  # Keeps everything else the same
  ))

#creating a dataframe to use for plots that only has the days that treewells developed.
transb_treewell_dates <- filtered_transb_snowcamera_data %>%
  filter(treewell_developed == "yes") %>%
  #adding tree_LWout_data to the dataframe so that I can plot with the same y-axis
  inner_join(results_transb_comb_treeLWout) %>%
  select(date, snowcam_max_depth_m, conditions, treewell_developed, total_max_tree_LWout_MJd, total_min_tree_LWout_MJd, total_mean_tree_LWout_MJd)

##persistent
filtered_persb_snowcamera_data <- persb_snowcamera_data %>%
  filter(date >= as.POSIXct("2024-02-02") & date <= as.POSIXct("2024-05-24")) %>%
  mutate(snowcam_max_depth_m = snowcam_max_depth_cm/100) %>%
  select(date, snowcam_max_depth_cm, snowcam_max_depth_m, conditions, treewell_developement) %>%
  rename(treewell_developed = treewell_developement)
```

Combining data into one dataframe by burn_status

```{r}
##* I think I want to use this one, not the gb/db/ub, since there is such a small difference between the gb & db LWout values from trees
#by burned/unburned status
transb_comb_radtree <- avg_dt_transb_rad_wx %>%
  mutate(burn_status = "burned") %>%
  full_join(avg_dt_transb_treeLW_burned) %>%
  #recalculating NetRad, as I am not sure the calculations here are correct that are pulled from the weather station
  mutate(NR_MJd_wxs = (SWin_MJd - SWout_MJd) + (LWin_MJd - LWout_MJd)) %>%
  select(-datetime)
#answer is slightly different than weather-station calculated RN, use this value instead!
```

```{r}
#by gb/db/ub status
transb_comb_radtree_gb <- avg_dt_transb_rad_wx %>%
  mutate(burn_status = "green burn") %>%
  full_join(avg_dt_transb_treeLW_gb)

transb_comb_radtree_db <- avg_dt_transb_rad_wx %>%
  mutate(burn_status = "dead burn") %>%
  full_join(avg_dt_transb_treeLW_db)

#won't have data to work with for unburned plots comparison as I don't have drone imagery for this area yet
transb_comb_radtree_ub <- avg_dt_transb_rad_wx %>%
  mutate(burn_status = "unburned") %>%
  full_join(avg_dt_transb_treeLW_ub)
```

```{r}
#getting tree circumfirence max and min for all transitional albedo plots - this will help me ID what average circumference to use

##transitional
transb_treecircm_data <- albedoplots_treechar_alldata %>%
  #filtering for only transitional burned zone plots
  filter(PlotID %in% c("TLHM", "TLLM")) %>%
  select(PlotID, TreeNum, Species, DBH_cm, PreFire_Status) %>%
  mutate(DBH_m = DBH_cm / 100,
         circ_m = DBH_m * pi) %>%
  summarize(DBH_m_min = min(DBH_m),
    DBH_m_max = max(DBH_m),
    DBH_m_mean = mean(DBH_m),
    circ_m_min = min(circ_m),
    circ_m_max = max(circ_m),
    circ_m_mean = mean(circ_m)
  )

##persistent
persb_treecircm_data <- albedoplots_treechar_alldata %>%
  #filtering for only transitional burned zone plots
  filter(PlotID %in% c("PLHM", "PLLM")) %>%
  select(PlotID, TreeNum, Species, DBH_cm, PreFire_Status) %>%
  mutate(DBH_m = DBH_cm / 100,
         circ_m = DBH_m * pi) %>%
  summarize(DBH_m_min = min(DBH_m),
    DBH_m_max = max(DBH_m),
    DBH_m_mean = mean(DBH_m),
    circ_m_min = min(circ_m),
    circ_m_max = max(circ_m),
    circ_m_mean = mean(circ_m)
  )
```

```{r}
#setting values based on the min, max and mean circumference of the albedo plots - these will be used in later calculations
##transitional
t_min_circ_m <- 0.1979
t_max_circ_m <- 0.6158
t_mean_circ_m <- 0.4042

##persistent
p_min_circ_m <- 0.18845
p_max_circ_m <- 0.8954
p_mean_circ_m <- 0.4576

#setting constant for total plot area
##the same for both zones
total_plot_area_m2 = 35*35
```

Creating a dataframe to add in net tree LWout including all trees in plot area

```{r}
#there are 219 total burned trees in the transitional burned plot area
transb_comb_treeLWout <- avg_dt_transb_treeLW_burned %>%
  #adding in snow camera depths and treewell development
  inner_join(filtered_transb_snowcamera_data) %>%
  select(-c(datetime, zone, burn_status)) %>%
  crossing(transb_energytree_table) %>%
  select(-c(lat, long)) %>%
  mutate(min_circ_m = t_min_circ_m, max_circ_m = t_max_circ_m, mean_circ_m = t_mean_circ_m) %>%
  select(date, phase, zone, burn_status, tree_id, b_treetemp_C, b_tree_LWout_wperm2, b_tree_LWout_MJd, min_circ_m, max_circ_m, mean_circ_m, everything()) %>%
  mutate(min_area_m2 = min_circ_m * snowcam_max_depth_m, max_area_m2 = max_circ_m * snowcam_max_depth_m, mean_area_m2 = mean_circ_m * snowcam_max_depth_m)

#persistent
persb_comb_treeLWout <- avg_dt_persb_treeLW_burned %>%
  #adding in snow camera depths and treewell development
  inner_join(filtered_persb_snowcamera_data) %>%
  select(-c(datetime, zone, burn_status)) %>%
  crossing(persb_energytree_table) %>%
  select(-c(lat, long)) %>%
  mutate(min_circ_m = p_min_circ_m, max_circ_m = p_max_circ_m, mean_circ_m = p_mean_circ_m) %>%
  select(date, phase, zone, burn_status, tree_id, b_treetemp_C, b_tree_LWout_wperm2, b_tree_LWout_MJd, min_circ_m, max_circ_m, mean_circ_m, everything()) %>%
  mutate(min_area_m2 = min_circ_m * snowcam_max_depth_m, max_area_m2 = max_circ_m * snowcam_max_depth_m, mean_area_m2 = mean_circ_m * snowcam_max_depth_m)
```

```{r}
#starting a new dataframe to continue the work above
new_transb_comb_treeLWout <- transb_comb_treeLWout %>%
  #next step is to create a NEW tree_LWout_MJd that is multiplied by the area and olf MJ/day values in the dataframe.
  #calculating min MJ/day
  mutate(min_tree_LWout_MJd = (b_tree_LWout_wperm2*min_area_m2) * (86400/1e6)) %>%
  #calculating max MJ/day
  mutate(max_tree_LWout_MJd = (b_tree_LWout_wperm2*max_area_m2) * (86400/1e6)) %>%
  #calculating meam MJ/day
  mutate(mean_tree_LWout_MJd = (b_tree_LWout_wperm2*mean_area_m2) * (86400/1e6))

#results dataframe
results_transb_comb_treeLWout <- new_transb_comb_treeLWout %>%
  select(date, phase, zone, burn_status, tree_id, b_treetemp_C, b_tree_LWout_wperm2, min_tree_LWout_MJd, max_tree_LWout_MJd, mean_tree_LWout_MJd, min_circ_m, max_circ_m, mean_circ_m, min_area_m2, max_area_m2, mean_area_m2) %>%
  group_by(date, phase, zone) %>%
  summarize(total_min_tree_LWout_MJd = sum(min_tree_LWout_MJd), total_max_tree_LWout_MJd = sum(max_tree_LWout_MJd), total_mean_tree_LWout_MJd = sum(mean_tree_LWout_MJd), total_min_area_m2 = sum(min_area_m2), total_max_area_m2 = sum(max_area_m2), total_mean_area_m2 = sum(mean_area_m2))
```

```{r}
#calculating weather station total area based on tree-impacted area 
#mean dataframe
mean_dt_transb_radtree_comb<- avg_dt_transb_rad_wx %>%
  inner_join(results_transb_comb_treeLWout) %>%
  #creating a net radiation weather station parameter
  mutate(NR_MJd = SWin_MJd - SWout_MJd + LWin_MJd - LWout_MJd) %>%
  select(date, phase, zone, burn_status, SnowDepth_m, SWin_MJd, SWout_MJd, SWnet_MJd, SWalbedo_Avg, LWin_MJd, LWout_MJd, LWnet_MJd, NR_MJd, total_mean_tree_LWout_MJd, total_mean_area_m2) %>%
  rename(total_mean_tree_area_m2 = total_mean_area_m2) %>%
  #calculating the area of the weather station region's impacts 
  mutate(total_mean_wx_area_m2 = 1125-total_mean_tree_area_m2) %>%
  #calculating the net outgoing rad for the weather station data and removing the m2 unit by multiplying by the area that this weather station data is applied to
  mutate(mean_wx_NRin_MJd = (SWin_MJd + LWin_MJd) * total_mean_wx_area_m2, mean_wx_NRout_MJd = (SWout_MJd + LWout_MJd) * total_mean_wx_area_m2, mean_wx_netSW_MJd = (SWin_MJd - SWout_MJd) * total_mean_wx_area_m2, mean_wx_netLW_MJd = (LWin_MJd - LWout_MJd) * total_mean_wx_area_m2) %>%
  #calcuating the total net mean radiation for LWout (tree + weather station data, and SW)
mutate(total_mean_netLW_wtree_MJd = mean_wx_netLW_MJd + total_mean_tree_LWout_MJd, total_mean_netLW_wotree_MJd = mean_wx_netLW_MJd, total_mean_net_rad_wtree_MJd = ((SWin_MJd * total_mean_wx_area_m2)-(SWout_MJd * total_mean_wx_area_m2)) + ((LWin_MJd*total_mean_wx_area_m2)-(LWout_MJd*total_mean_wx_area_m2)) + total_mean_tree_LWout_MJd) %>%
  #making a new NetRad column without the addition of the treeLWout, to compare
  mutate(total_mean_net_rad_wotree = ((SWin_MJd * total_mean_wx_area_m2)-(SWout_MJd * total_mean_wx_area_m2)) + ((LWin_MJd*total_mean_wx_area_m2)-(LWout_MJd*total_mean_wx_area_m2)))
  
mean_dt_transb_radtree_comb <- mean_dt_transb_radtree_comb %>%
  rename(wx_NR_MJdm2 = NR_MJd)

#creating a new dataframe with snow depths and treewell development, as well as tree_LWout so that I can put points on snowdepths instead of total treeLWout line in plots
filtered_transb_treewell_data <- filtered_transb_snowcamera_data %>%
  inner_join(mean_dt_transb_radtree_comb) %>%
  select(date, phase, zone, burn_status, conditions, snowcam_max_depth_cm, snowcam_max_depth_m, treewell_developed, total_mean_tree_LWout_MJd) %>%
  filter(treewell_developed == "yes")
```

```{r}
#creating a dataframe that gives me the fraction of the total net LW that the treeLWis
frac_trans_mean_treeLWout_data <- mean_dt_transb_radtree_comb %>%
  select(date, phase, zone, burn_status, total_mean_netLW_wtree_MJd, total_mean_tree_LWout_MJd) %>%
  mutate(fraction_treeLWout_oftotal_netLW = total_mean_tree_LWout_MJd/total_mean_netLW_wtree_MJd) %>%
  mutate(perc_treeLWout_oftotal_netLW = fraction_treeLWout_oftotal_netLW*100)

#only use the remainder of this code if I want to group by month to get a monthly average... 
%>%
  #getting a monthly average fraction
  mutate(month = month(date)) %>%
  group_by(month) %>%
  summarize(monthly_frac_treeLWout = mean(fraction_treeLWout_oftotal_netLW)) %>%
  mutate(monthly_perc_treeLWout = monthly_frac_treeLWout*100) 
```

```{r}
#saving fraction dataframe
write_csv(frac_trans_mean_treeLWout_data, "nsf/105E_trans_burned/frac_trans_mean_treeLWout_data.csv")
```

Equations used above for NetSW, NetLW, NetIncoming and NetOutgoing:

-   NetSW = SWin - SWout

-   NetLW = LWin - LWout

-   NetIncoming = SWin + LWin

-   NetOutgoing = SWout + LWout + LWout_tree

-   TotalNetRad = (SWin -SWout) + (LWin - LWout) + LWout_tree)

Min & Max dataframes

```{r}

#min dataframe
min_dt_transb_radtree_comb <- avg_dt_transb_rad_wx %>%
  inner_join(results_transb_comb_treeLWout) %>%
  #creating a net radiation weather station parameter
  mutate(NR_MJd = SWin_MJd - SWout_MJd + LWin_MJd - LWout_MJd) %>%
  select(date, phase, zone, burn_status, SnowDepth_m, SWin_MJd, SWout_MJd, SWnet_MJd, SWalbedo_Avg, LWin_MJd, LWout_MJd, LWnet_MJd, NR_MJd, total_min_tree_LWout_MJd, total_min_area_m2) %>%
  rename(total_min_tree_area_m2 = total_min_area_m2) %>%
  #calculating the area of the weather station region's impacts 
  mutate(total_min_wx_area_m2 = 1125-total_min_tree_area_m2) %>%
  #calculating the net outgoing rad for the weather station data and removing the m2 unit by multiplying by the area that this weather station data is applied to
  mutate(min_wx_NRin_MJd = (SWin_MJd + LWin_MJd) * total_min_wx_area_m2, min_wx_NRout_MJd = (SWout_MJd + LWout_MJd) * total_min_wx_area_m2, min_wx_netSW_MJd = (SWin_MJd - SWout_MJd) * total_min_wx_area_m2, min_wx_netLW_MJd = (LWin_MJd - LWout_MJd) * total_min_wx_area_m2) %>%
  #calcuating the total net mean radiation for LWout (tree + weather station data, and SW)
  mutate(total_min_netLW_MJd = min_wx_netLW_MJd + total_min_tree_LWout_MJd, total_min_net_rad = ((SWin_MJd * total_min_wx_area_m2)-(SWout_MJd * total_min_wx_area_m2)) + ((LWin_MJd*total_min_wx_area_m2)-((LWout_MJd*total_min_wx_area_m2))+total_min_tree_LWout_MJd))
  
min_dt_transb_radtree_comb <- min_dt_transb_radtree_comb %>%
  rename(wx_NR_MJdm2 = NR_MJd)

#max dataframe
max_dt_transb_radtree_comb <- avg_dt_transb_rad_wx %>%
  inner_join(results_transb_comb_treeLWout) %>%
  #creating a net radiation weather station parameter
  mutate(NR_MJd = SWin_MJd - SWout_MJd + LWin_MJd - LWout_MJd) %>%
  select(date, phase, zone, burn_status, SnowDepth_m, SWin_MJd, SWout_MJd, SWnet_MJd, SWalbedo_Avg, LWin_MJd, LWout_MJd, LWnet_MJd, NR_MJd, total_max_tree_LWout_MJd, total_max_area_m2) %>%
  rename(total_max_tree_area_m2 = total_max_area_m2) %>%
  #calculating the area of the weather station region's impacts 
  mutate(total_max_wx_area_m2 = 1125-total_max_tree_area_m2) %>%
  #calculating the net outgoing rad for the weather station data and removing the m2 unit by multiplying by the area that this weather station data is applied to
  mutate(max_wx_NRin_MJd = (SWin_MJd + LWin_MJd) * total_max_wx_area_m2, max_wx_NRout_MJd = (SWout_MJd + LWout_MJd) * total_max_wx_area_m2, max_wx_netSW_MJd = (SWin_MJd - SWout_MJd) * total_max_wx_area_m2, max_wx_netLW_MJd = (LWin_MJd - LWout_MJd) * total_max_wx_area_m2) %>%
  #calcuating the total net mean radiation for LWout (tree + weather station data, and SW)
  mutate(total_max_netLW_MJd = max_wx_netLW_MJd + total_max_tree_LWout_MJd, total_max_net_rad = ((SWin_MJd * total_max_wx_area_m2)-(SWout_MJd * total_max_wx_area_m2)) + ((LWin_MJd*total_max_wx_area_m2)-((LWout_MJd*total_max_wx_area_m2))+total_max_tree_LWout_MJd))
  
max_dt_transb_radtree_comb <- max_dt_transb_radtree_comb %>%
  rename(wx_NR_MJdm2 = NR_MJd)
```

## Calcs - adding in all trees to LWout data

```{r}
#dataframes seperates by burn_status

gb_transb_energytree_table <- transb_energytree_table %>%
  filter(burn_status == "gb")
#155 gb trees

db_transb_energy_treetabl <- transb_energytree_table %>%
  filter(burn_status == "db")
#64 db trees
```

## Plotting

```{r}
color_values_MJd <- c(
  "SWin_MJd" = "#D95F02",
  "SWout_MJd" = "#E6AB02",
  "LWout_MJd" = "#66A61E",
  "LWin_MJd" = "#2e5e39",
  "gb_tree_LWout_MJd" = "#7570B3",
  "db_tree_LWout_MJd" = "#2166AC")
# will need to include an unburned color later on if I include unburned data in these plot comparisons!

color_values_wperm2 <- c(
  "SWin_wperm2" = "#D95F02",
  "SWout_wperm2" = "#E6AB02",
  "LWout_wperm2" = "#66A61E",
  "LWin_wperm2" = "#2e5e39",
  "gb_tree_LWout_MJd" = "#7570B3",
  "db_tree_LWout_MJd" = "#2166AC")

# Define line types
line_types <- c(
  "Weather Station" = "solid",
  "Tree Temperature Sensors" = "dashed"
)

#changing labels of values in plots for the legend
color_labels <- c(
  "SWin_Avg" = "Shortwave In (Avg)",
  "SWout_Avg" = "Shortwave Out (Avg)",
  "LWin_Avg" = "Longwave In (Avg)",
  "LWout_Avg" = "Longwave Out (Avg)",
  "tree_LWout_avg_wperm2" = "Tree LW Out (Avg)"  # New label for the specific line
)
```

```{r}
#MJ/day plot
gb_combined_day_rad_wx_plot_MJd <- ggplot(data = transb_comb_radtree_gb) + 
  geom_line(aes(x = date, y = SWin_MJd, color = "SWin_MJd", linetype = "Weather Station"), linewidth = 0.6, alpha = 0.9) +
  geom_line(aes(x = date, y = SWout_MJd, color = "SWout_MJd", linetype = "Weather Station"), linewidth = 0.6, alpha = 0.8) +
  geom_line(aes(x = date, y = LWin_MJd, color = "LWin_MJd", linetype = "Weather Station"), linewidth = 0.7, alpha = 0.9) +
  geom_line(aes(x = date, y = LWout_MJd, color = "LWout_MJd", linetype = "Weather Station"), linewidth = 0.7) +
  geom_line(aes(x = date, y = gb_tree_LWout_MJd, color = "gb_tree_LWout_MJd", linetype = "Tree Temperature Sensors")) +
  facet_wrap(~ zone + burn_status, scales = "free_y", dir = "h") +  # Facet by zone and phase
  labs(
    #title = "Transitional Unburned",
    x = "Date",
    y = "Radiation components (MJ/day)",
    color = "Variable", 
    linetype = "Data Source"
    ) +
  theme_bw() +  # Use a minimal theme for a clean look
  scale_color_manual(values = color_values_MJd, labels = color_labels) + 
  scale_linetype_manual(values = line_types)

gb_combined_day_rad_wx_plot_MJd
```

```{r}
#W/m2 plot
gb_combined_day_rad_wx_plot_Wperm2 <- ggplot(data = transb_comb_radtree_gb) + 
  geom_line(aes(x = date, y = SWin_wperm2, color = "SWin_wperm2", linetype = "Weather Station"), linewidth = 0.6, alpha = 0.9) +
  geom_line(aes(x = date, y = SWout_wperm2, color = "SWout_wperm2", linetype = "Weather Station"), linewidth = 0.6, alpha = 0.8) +
  geom_line(aes(x = date, y = LWin_wperm2, color = "LWin_wperm2", linetype = "Weather Station"), linewidth = 0.7, alpha = 0.9) +
  geom_line(aes(x = date, y = LWout_wperm2, color = "LWout_wperm2", linetype = "Weather Station"), linewidth = 0.7) +
  geom_line(aes(x = date, y = gb_tree_LWout_wperm2, color = "gb_tree_LWout_wperm2", linetype = "Tree Temperature Sensors")) +
  facet_wrap(~ zone + burn_status, scales = "free_y", dir = "h") +  # Facet by zone and phase
  labs(
    #title = "Transitional Unburned",
    x = "Date",
    y = "Radiation components (W/m2)",
    color = "Variable", 
    linetype = "Data Source"
    ) +
  theme_bw() +  # Use a minimal theme for a clean look
  scale_color_manual(values = color_values_wperm2, labels = color_labels) +
  scale_linetype_manual(values = line_types)

combined_day_rad_wx_plot_Wperm2
```

\*\* interpretation of difference of MJperday and Wperm2 plots - the Wperm2 plot is showing second-timeframe data, not daily data, which means that the tree temps will be more equal in value to what the weather station is showing. The MJperday plot is showing a daily value for all the variables - once I add all the individual tree values together, perhaps the line for tree_LWout will increase a bit above zero?

Net Radiation Plots - by burn_status

-   the following graph is not really helpful yet, since I have not included all the tree_LWout values in the total net radiation value, that's why the tree_LWout values are plotted as higher than net rad from weather station

-   Need to finish calculations, then this plot can be used!

```{r}
#green burn net radiaiton from WX station and tree RLout
gb_netrad_plot <- ggplot() + 
  geom_col(data = transb_comb_radtree_gb, aes(x = date, y = NR_MJd, fill = "Net Radiation"), position = "stack") +  # Add fill aesthetic to legend
  geom_line(data = transb_comb_radtree_gb, aes(x = date, y = gb_tree_LWout_MJd, color = "Green burned LWout")) +
  geom_line(data = transb_comb_radtree_db, aes(x = date, y = db_tree_LWout_MJd, color = "Dead burned LWout")) +
  facet_wrap(~zone) +
  labs(
    x = "Date",
    y = "Radiation Component (MJ/day)") +
    scale_fill_manual(name = "Weather Station Data", values = "#2166AC") +
  scale_color_manual(
    name = "Tree Temp Sensor Data", 
    values = c("Green burned LWout" = "#1B7837",
               "Dead burned LWout" = "#D95F02")) +
  theme_bw()

gb_netrad_plot
```

```{r}
## only need this plot if I am seperating the net radiation plots by burned status, but the above plot now has the GB and DB data on it
#dead burn net radiaiton from WX station and tree RLout
db_netrad_plot <- ggplot(data = transb_comb_radtree_db) + 
  geom_col(aes(x = date, y = NR_MJd, fill = "Net Radiation (MJ/d)"), position = "stack") +  # Add fill aesthetic to legend
  geom_line(aes(x = date, y = db_tree_LWout_MJd, color = "Dead burned LWout (MJ/d)")) +
  facet_wrap(~zone + burn_status) +
  labs(
    x = "Date",
    y = "Radiation Component (MJ/day)") +
    scale_fill_manual(name = "Weather Station Data", values = "#2166AC") +                         # Custom fill color
  scale_color_manual(name = "Tree Temp Sensor Data", values = "#D95F02") +
  theme_bw()

db_netrad_plot
```

Looking at Tree LWout Burn Status Differences

```{r}
tree_LWout_data <- ggplot() +
  geom_line(data = avg_dt_transb_treeLW_gb, aes(x = date, y = tree_LWout_MJd), color = "green") +
    geom_line(data = avg_dt_transb_treeLW_db, aes(x = date, y = tree_LWout_MJd), color = "red") +
    geom_line(data = avg_dt_transb_treeLW_ub, aes(x = date, y = tree_LWout_MJd), color = "blue")

tree_LWout_data
```

## New Net Rad Plots - from 2024.09.18

```{r}
#use final_dt_transb_radtree_comb_data for plotting only Net Radiation values

##mean values for tree LWout data
mean_NR_plot <- ggplot() + 
  geom_line(data = mean_dt_transb_radtree_comb, aes(x = date, y = total_mean_netLW_MJd, color = "Net Longwave Radiation of total plot area")) +  
  geom_line(data = mean_dt_transb_radtree_comb, aes(x = date, y = total_mean_tree_LWout_MJd, color = "Total burned trees LWout")) +
  geom_point(data = transb_treewell_dates, aes(x = date, y = mean_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  
  facet_wrap(~zone + burn_status) +
  
  labs(
    title = "Mean Values",
    x = "Date",
    y = "Radiation Component (MJ/day)"
  ) +
  scale_color_manual(name = "Radiation Data", 
                     values = c("Net Longwave Radiation of total plot area" = "#2166AC",
                                "Total burned trees LWout" = "#D95F02"),
                     labels = c("Net Longwave Radiation of total plot area",
                                "Total burned trees LWout")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()

mean_NR_plot

min_NR_plot <- ggplot() + 
  geom_line(data = final_dt_transb_radtree_comb_data, aes(x = date, y = total_min_NRl_MJd, color = "Net Longwave Radiation of total plot area")) +  
  geom_line(data = final_dt_transb_radtree_comb_data, aes(x = date, y = total_min_tree_LWout_MJd, color = "Total burned trees LWout")) +
  geom_point(data = transb_treewell_dates, aes(x = date, y = total_min_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  
  facet_wrap(~zone + burn_status) +
  
  labs(
    title = "Minimum Values",
    x = "Date",
    y = "Radiation Component (MJ/day)"
  ) +
  scale_color_manual(name = "Radiation Data", 
                     values = c("Net Longwave Radiation of total plot area" = "#2166AC",
                                "Total burned trees LWout" = "#D95F02"),
                     labels = c("Net Longwave Radiation of total plot area",
                                "Total burned trees LWout")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()

min_NR_plot

max_NR_plot <- ggplot() + 
  geom_line(data = final_dt_transb_radtree_comb_data, aes(x = date, y = total_max_NRl_MJd, color = "Net Longwave Radiation of total plot area")) +  
  geom_line(data = final_dt_transb_radtree_comb_data, aes(x = date, y = total_max_tree_LWout_MJd, color = "Total burned trees LWout")) +
  geom_point(data = transb_treewell_dates, aes(x = date, y = total_max_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  
  facet_wrap(~zone + burn_status) +
  
  labs(
    title = "Max Values",
    x = "Date",
    y = "Radiation Component (MJ/day)"
  ) +
  scale_color_manual(name = "Radiation Data", 
                     values = c("Net Longwave Radiation of total plot area" = "#2166AC",
                                "Total burned trees LWout" = "#D95F02"),
                     labels = c("Net Longwave Radiation of total plot area",
                                "Total burned trees LWout")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()


max_NR_plot
```

Arranging plots into one png

```{r}
combined_NR_plots <- ggarrange(min_NR_plot, max_NR_plot, mean_NR_plot, nrow = 1, ncol = 3, common.legend = TRUE, legend = "right")

combined_NR_plots
```

Plots above seem to have very large values for total RN, which is likely because I've multiplied that value by the area of the plot... maybe I don't need to multiply the weather station area?

Below plot is the version with a line instead of a dot to denote when treewells developed

```{r}
max_NR_plot <- ggplot() + 
  geom_line(data = final_dt_transb_radtree_comb_data, aes(x = date, y = total_max_NRl_MJd, color = "Net Longwave Radiation of total plot area")) +  
  geom_line(data = final_dt_transb_radtree_comb_data, aes(x = date, y = total_max_tree_LWout_MJd, color = "Total burned trees LWout")) +
  geom_segment(data = transb_treewell_dates, aes(x = date, xend = date, y = -Inf, yend = Inf), color = "black", linetype = "solid", alpha = 0.4) +
  facet_wrap(~zone + burn_status) +
  labs(
    title = "Mean Values",
    x = "Date",
    y = "Radiation Component (MJ/day)") +
  scale_color_manual(name = "Radiation Data", 
                     values = c("Net Longwave Radiation of total plot area" = "#2166AC",
                                "Total burned trees LWout" = "#D95F02")) +
  theme_bw()


max_NR_plot
```

Newest Plots - as of EOD 2024.09.18

### Mean Radiation Data Plots - Bar versions

```{r}
#using individual dataframes for mean, min and max values
##netLW with tree LWout included
depth_factor <- 7500

t_mean_NetLW_wtree_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = mean_dt_transb_radtree_comb, aes(x = date, y = total_mean_netLW_wtree_MJd), fill = "#1B7837", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = mean_dt_transb_radtree_comb, aes(x = date, y = total_mean_tree_LWout_MJd, color = "Total burned trees LWout (MJ/d)")) +
   # Line plot for snow cam max depth on a secondary y-axis
  geom_line(data = filtered_transb_snowcamera_data, aes(x = date, y = snowcam_max_depth_m * depth_factor, 
             color = "Daily max snow depth (m)"), linewidth = 0.6) + 
  # Point plot for treewell development dates
  geom_point(data = filtered_transb_treewell_data, aes(x = date, y = snowcam_max_depth_m * depth_factor, 
             shape = "Dates that treewells developed"), 
             color = "darkgoldenrod3", fill = "darkgoldenrod3", size = 1.5) + 
  facet_wrap(~zone + burn_status) +
  labs(
    title = "Mean Values with treeLW out",
    #x = "Date",
    y = "Net LW Rad (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout (MJ/d)" = "#D95F02","Daily max snow depth (m)" = "grey30")) +
  scale_shape_manual(values = c("Dates that treewells developed" = 21)) +
  guides(color = guide_legend(title = NULL),  # Remove title for color legend
         shape = guide_legend(title = NULL)) +  # Remove title for shape legend
  scale_y_continuous(
    sec.axis = sec_axis(~./depth_factor, name = "Snow Depth (m)")  # Adjusting for the secondary axis
  ) +
  theme_bw() + 
  theme(
    plot.title = element_text(size = 15),      # Title size
    axis.title.x = element_text(size = 13),                   # X-axis title size
    axis.title.y = element_text(size = 13),                   # Y-axis title size
    axis.text = element_text(size = 11),                      # Axis text size
    legend.text = element_text(size = 12),                    # Legend text size
    legend.title = element_text(size = 12),                   # Legend title size
    strip.text = element_text(size = 12))


t_mean_NetLW_wtree_plot
```

```{r}
#using individual dataframes for mean, min and max values
##netLW with tree LWout included
t_mean_NetLW_wotree_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = mean_dt_transb_radtree_comb, aes(x = date, y = total_mean_netLW_wotree_MJd), fill = "#1B7837", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = mean_dt_transb_radtree_comb, aes(x = date, y = total_mean_tree_LWout_MJd, color = "Total burned trees LWout (MJ/d)")) +
  # Line plot for snow cam max depth on a secondary y-axis
  geom_line(data = filtered_transb_snowcamera_data, aes(x = date, y = snowcam_max_depth_m * depth_factor, 
             color = "Daily max snow depth (m)"), linewidth = 0.6) + 
 # Point plot for treewell development dates
  geom_point(data = filtered_transb_treewell_data, aes(x = date, y = snowcam_max_depth_m * depth_factor, 
             shape = "Dates that treewells developed"), 
             color = "darkgoldenrod3", fill = "darkgoldenrod3", size = 1.5) + 
  facet_wrap(~zone + burn_status) +
  labs(
    title = "Mean Values w/o treeLW out",
    #x = "Date",
    y = "Net LW Rad (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout (MJ/d)" = "#D95F02", "Daily max snow depth (m)" = "grey30")) +
  scale_shape_manual(values = c("Dates that treewells developed" = 21)) +
  guides(color = guide_legend(title = NULL),  # Remove title for color legend
         shape = guide_legend(title = NULL)) +  # Remove title for shape legend
  scale_y_continuous(
    sec.axis = sec_axis(~./depth_factor, name = "Snow Depth (m)")  # Adjusting for the secondary axis
  ) +
  theme_bw() + 
  theme(
    plot.title = element_text(size = 15),      # Title size
    axis.title.x = element_text(size = 13),                   # X-axis title size
    axis.title.y = element_text(size = 13),                   # Y-axis title size
    axis.text = element_text(size = 11),                      # Axis text size
    legend.text = element_text(size = 12),                    # Legend text size
    legend.title = element_text(size = 12),                   # Legend title size
    strip.text = element_text(size = 12))

t_mean_NetLW_wotree_plot
```

```{r}
#combining NetLW dataframes w/ and w/o treeLWout included in bars
t_mean_NetLW_comb <- ggarrange(t_mean_NetLW_wtree_plot, t_mean_NetLW_wotree_plot, nrow = 1, ncol = 2, common.legend = TRUE, legend = "right")

t_mean_NetLW_comb
```

```{r}
#mean net SW plot
library(ggplot2)
library(scales)

# Adjust the secondary variable (e.g., multiply by a factor to fit the primary scale)
# Here I'm assuming snowcam_max_depth_m needs to be multiplied to fit the primary scale
# You may need to adjust this factor based on your data's actual range.
depth_factor <- 7500  # Example factor; adjust as necessary

t_mean_NetSW_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = mean_dt_transb_radtree_comb, aes(x = date, y = mean_wx_netSW_MJd), 
           fill = "#2166AC", position = "stack", alpha = 0.7) +
  # Line plot for Total burned trees LWout
  geom_line(data = mean_dt_transb_radtree_comb, aes(x = date, y = total_mean_tree_LWout_MJd, color = "Total burned trees LWout (MJ/d)"), linewidth = 0.6) +
  # Line plot for snow cam max depth on a secondary y-axis
  geom_line(data = filtered_transb_snowcamera_data, aes(x = date, y = snowcam_max_depth_m * depth_factor, 
             color = "Daily max snow depth (m)"), linewidth = 0.6) + 
  # Point plot for treewell development dates
  geom_point(data = filtered_transb_treewell_data, aes(x = date, y = snowcam_max_depth_m * depth_factor, 
             shape = "Dates that treewells developed"), 
             color = "darkgoldenrod3", fill = "darkgoldenrod3", size = 1.5) + 
  facet_wrap(~zone + burn_status) +
  labs(
    #x = "Date",
    y = "Net SW Rad (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(values = c("Total burned trees LWout (MJ/d)" = "#D95F02", "Daily max snow depth (m)" = "grey30")) +
  scale_shape_manual(values = c("Dates that treewells developed" = 21)) +
  guides(color = guide_legend(title = NULL),  # Remove title for color legend
         shape = guide_legend(title = NULL)) +  # Remove title for shape legend
  scale_y_continuous(
    sec.axis = sec_axis(~./depth_factor, name = "Snow Depth (m)")  # Adjusting for the secondary axis
  ) +
  theme_bw() + 
  theme(
    plot.title = element_text(size = 15),      # Title size
    axis.title.x = element_text(size = 13),                   # X-axis title size
    axis.title.y = element_text(size = 13),                   # Y-axis title size
    axis.text = element_text(size = 11),                      # Axis text size
    legend.text = element_text(size = 12),                    # Legend text size
    legend.title = element_text(size = 12),                   # Legend title size
    strip.text = element_text(size = 12))

t_mean_NetSW_plot
```

```{r}
t_mean_NetRad_wtree_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = mean_dt_transb_radtree_comb, aes(x = date, y = total_mean_net_rad_wtree_MJd), fill = "#666666", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = mean_dt_transb_radtree_comb, aes(x = date, y = total_mean_tree_LWout_MJd, color = "Total burned trees LWout (MJ/d)")) +
  # Line plot for snow cam max depth on a secondary y-axis
  geom_line(data = filtered_transb_snowcamera_data, aes(x = date, y = snowcam_max_depth_m * depth_factor, 
             color = "Daily max snow depth (m)"), linewidth = 0.6) + 
  # Point plot for treewell development dates
  geom_point(data = filtered_transb_treewell_data, aes(x = date, y = snowcam_max_depth_m * depth_factor, 
             shape = "Dates that treewells developed"), 
             color = "darkgoldenrod3", fill = "darkgoldenrod3", size = 1.5) + 
  facet_wrap(~zone + burn_status) +
  labs(
    title = "Mean Data Values with Tree LWout",
    x = "Date",
    y = "Total Net Radiation (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout (MJ/d)" = "#D95F02", "Daily max snow depth (m)" = "grey30")) +
  scale_shape_manual(values = c("Dates that treewells developed" = 21)) +
  guides(color = guide_legend(title = NULL),  # Remove title for color legend
         shape = guide_legend(title = NULL)) +  # Remove title for shape legend
  scale_y_continuous(
    sec.axis = sec_axis(~./depth_factor, name = "Snow Depth (m)")  # Adjusting for the secondary axis
  ) +
  theme_bw() + 
  theme(
    plot.title = element_text(size = 15),      # Title size
    axis.title.x = element_text(size = 13),                   # X-axis title size
    axis.title.y = element_text(size = 13),                   # Y-axis title size
    axis.text = element_text(size = 11),                      # Axis text size
    legend.text = element_text(size = 12),                    # Legend text size
    legend.title = element_text(size = 12),                   # Legend title size
    strip.text = element_text(size = 12))

t_mean_NetRad_wtree_plot
```

```{r}
#this is the total net rad without the treeLWout variable included in the value
t_mean_NetRad_wotree_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = mean_dt_transb_radtree_comb, aes(x = date, y = total_mean_net_rad_wotree), fill = "#666666", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = mean_dt_transb_radtree_comb, aes(x = date, y = total_mean_tree_LWout_MJd, color = "Total burned trees LWout (MJ/d)")) +
  # Line plot for snow cam max depth on a secondary y-axis
  geom_line(data = filtered_transb_snowcamera_data, aes(x = date, y = snowcam_max_depth_m * depth_factor, 
             color = "Daily max snow depth (m)"), linewidth = 0.6) + 
  # Point plot for treewell development dates
  geom_point(data = filtered_transb_treewell_data, aes(x = date, y = snowcam_max_depth_m * depth_factor, 
             shape = "Dates that treewells developed"), 
             color = "darkgoldenrod3", fill = "darkgoldenrod3", size = 1.5) + 
  facet_wrap(~zone + burn_status) +
  labs(
    title = "Mean Data Values w/o Tree LWout",
    x = "Date",
    y = "Total Net Radiation (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout (MJ/d)" = "#D95F02", "Daily max snow depth (m)" = "grey30")) +
  scale_shape_manual(values = c("Dates that treewells developed" = 21)) +
  guides(color = guide_legend(title = NULL),  # Remove title for color legend
         shape = guide_legend(title = NULL)) +  # Remove title for shape legend
  scale_y_continuous(
    sec.axis = sec_axis(~./depth_factor, name = "Snow Depth (m)")  # Adjusting for the secondary axis
  ) +
  theme_bw() + 
  theme(
    plot.title = element_text(size = 15),      # Title size
    axis.title.x = element_text(size = 13),                   # X-axis title size
    axis.title.y = element_text(size = 13),                   # Y-axis title size
    axis.text = element_text(size = 11),                      # Axis text size
    legend.text = element_text(size = 12),                    # Legend text size
    legend.title = element_text(size = 12),                   # Legend title size
    strip.text = element_text(size = 12))

t_mean_NetRad_wotree_plot
```

```{r}
#combining total NetRad plots - with and without treeLWout included in bars
t_mean_NetRad_comb <- ggarrange(t_mean_NetRad_wtree_plot, t_mean_NetRad_wotree_plot, nrow = 1, ncol = 2, common.legend = TRUE, legend = "right")

t_mean_NetRad_comb
```

```{r}
#combining and saving NetSW, NetLW and NetRad plots
t_combined_mean_NR_plots <- ggarrange(t_mean_NetSW_plot, t_mean_NetLW_wotree_plot, t_mean_NetRad_wotree_plot, nrow = 3, ncol = 1, common.legend = TRUE, legend = "right") %>%
  annotate_figure(combined_NR_plots, top = text_grob("Mean Data Values", 
               color = "black", size = 14))

t_combined_mean_NR_plots
```

I don't think I'll need the following plots, but not sure yet

```{r}
#total net Incoming radiation
mean_NetIn_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = mean_dt_transb_radtree_comb, aes(x = date, y = mean_wx_NRin_MJd, fill = "Total Net Incoming Radiation of plot area"), position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = mean_dt_transb_radtree_comb, aes(x = date, y = total_mean_tree_LWout_MJd, color = "Total burned trees LWout")) +
  # Point plot for treewell development dates
  geom_point(data = transb_treewell_dates, aes(x = date, y = total_mean_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  facet_wrap(~zone + burn_status) +
  labs(
    title = "Mean Values",
    x = "Date",
    y = "Radiation Component (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout" = "#D95F02"),
                     labels = c("Total burned trees LWout")) +
  scale_fill_manual(name = "Radiation Data", 
                     values = c("Total Net Incoming Radiation of plot area" = "#2166AC"),
                     labels = c("Total Net Incoming Radiation of plot area")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()

mean_NetIn_plot
```

```{r}
#total net Incoming radiation
mean_NetOut_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = mean_dt_transb_radtree_comb, aes(x = date, y = mean_wx_NRout_MJd, fill = "Total Net Outgoing Radiation of plot area"), position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = mean_dt_transb_radtree_comb, aes(x = date, y = total_mean_tree_LWout_MJd, color = "Total burned trees LWout")) +
  # Point plot for treewell development dates
  geom_point(data = transb_treewell_dates, aes(x = date, y = total_mean_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  facet_wrap(~zone + burn_status) +
  labs(
    title = "Mean Values",
    x = "Date",
    y = "Radiation Component (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout" = "#D95F02"),
                     labels = c("Total burned trees LWout")) +
  scale_fill_manual(name = "Radiation Data", 
                     values = c("Total Net Outgoing Radiation of plot area" = "#1B7837"),
                     labels = c("Total Net Outgoing Radiation of plot area")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()

mean_NetOut_plot
```

```{r}
#arranging mean plots and exporting

mean_combined_plots <- ggarrange()
```

### Min Radiation Data Plots - Bar versions

```{r}
min_NetLW_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = min_dt_transb_radtree_comb, aes(x = date, y = total_min_netLW_MJd), fill = "#1B7837", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = min_dt_transb_radtree_comb, aes(x = date, y = total_min_tree_LWout_MJd, color = "Total burned trees LWout")) +
  
  # Point plot for treewell development dates
  geom_point(data = transb_treewell_dates, aes(x = date, y = total_min_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  facet_wrap(~zone + burn_status) +
  labs(
    #title = "Mean Values",
    x = "Date",
    y = "Net LW Rad (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout" = "#D95F02"),
                     labels = c("Total burned trees LWout")) +
  #scale_fill_manual(name = "Radiation Data", 
                     #values = c("Net Longwave Radiation of total plot area" = "#1B7837"),
                    # labels = c("Net Longwave Radiation of total plot area")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()


min_NetLW_plot
```

```{r}
#min net SW plot
min_NetSW_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = min_dt_transb_radtree_comb, aes(x = date, y = min_wx_netSW_MJd), fill = "#2166AC", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = min_dt_transb_radtree_comb, aes(x = date, y = total_min_tree_LWout_MJd, color = "Total burned trees LWout")) +
  # Point plot for treewell development dates
  geom_point(data = transb_treewell_dates, aes(x = date, y = total_min_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  facet_wrap(~zone + burn_status) +
  labs(
    #title = "Mean Values",
    x = "Date",
    y = "Net SW Rad (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout" = "#D95F02"),
                     labels = c("Total burned trees LWout")) +
  #scale_fill_manual(name = "Radiation Data", 
                     #values = c("Net Shortwave Radiation of total plot area" = "#2166AC"),
                     #labels = c("Net Shortwave Radiation of total plot area")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()

min_NetSW_plot
```

```{r}
min_NetRad_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = min_dt_transb_radtree_comb, aes(x = date, y = total_min_net_rad), fill = "#666666", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = min_dt_transb_radtree_comb, aes(x = date, y = total_min_tree_LWout_MJd, color = "Total burned trees LWout")) +
  # Point plot for treewell development dates
  geom_point(data = transb_treewell_dates, aes(x = date, y = total_min_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  facet_wrap(~zone + burn_status) +
  labs(
    #title = "Mean Data Values",
    x = "Date",
    y = "Total Net Radiation (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout" = "#D95F02"),
                     labels = c("Total burned trees LWout")) +
  #scale_fill_manual(name = "Radiation Data", 
                     #values = c("Total Net Radiation of plot area" = "#666666"),
                     #labels = c("Total Net Radiation of plot area")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()

min_NetRad_plot
```

```{r}
#combining and saving NetSW, NetLW and NetRad plots
combined_min_NR_plots <- ggarrange(min_NetSW_plot, min_NetLW_plot, min_NetRad_plot, nrow = 3, ncol = 1, common.legend = TRUE, legend = "right") %>%
  annotate_figure(combined_NR_plots, top = text_grob("Minimum Data Values", 
               color = "black", size = 14))

combined_min_NR_plots
```

### Max Radiation Data Plots - Bar versions

```{r}
t_max_NetLW_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = max_dt_transb_radtree_comb, aes(x = date, y = total_max_netLW_MJd), fill = "#1B7837", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = max_dt_transb_radtree_comb, aes(x = date, y = total_max_tree_LWout_MJd, color = "Total burned trees LWout")) +
  
  # Point plot for treewell development dates
  geom_point(data = transb_treewell_dates, aes(x = date, y = total_max_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  facet_wrap(~zone + burn_status) +
  labs(
    #title = "Mean Values",
    #x = "Date",
    y = "Net LW Rad (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout" = "#D95F02"),
                     labels = c("Total burned trees LWout")) +
  #scale_fill_manual(name = "Radiation Data", 
                     #values = c("Net Longwave Radiation of total plot area" = "#1B7837"),
                    # labels = c("Net Longwave Radiation of total plot area")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()


t_max_NetLW_plot
```

```{r}
#max net SW plot
t_max_NetSW_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = max_dt_transb_radtree_comb, aes(x = date, y = max_wx_netSW_MJd), fill = "#2166AC", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = max_dt_transb_radtree_comb, aes(x = date, y = total_max_tree_LWout_MJd, color = "Total burned trees LWout")) +
  # Point plot for treewell development dates
  geom_point(data = transb_treewell_dates, aes(x = date, y = total_max_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  facet_wrap(~zone + burn_status) +
  labs(
    #title = "Mean Values",
    x = "Date",
    y = "Net SW Rad (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout" = "#D95F02"),
                     labels = c("Total burned trees LWout")) +
  #scale_fill_manual(name = "Radiation Data", 
                     #values = c("Net Shortwave Radiation of total plot area" = "#2166AC"),
                     #labels = c("Net Shortwave Radiation of total plot area")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()

t_min_NetSW_plot
```

```{r}
max_NetRad_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = max_dt_transb_radtree_comb, aes(x = date, y = total_max_net_rad), fill = "#666666", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = max_dt_transb_radtree_comb, aes(x = date, y = total_max_tree_LWout_MJd, color = "Total burned trees LWout")) +
  # Point plot for treewell development dates
  geom_point(data = transb_treewell_dates, aes(x = date, y = total_max_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  facet_wrap(~zone + burn_status) +
  labs(
    #title = "Mean Data Values",
    x = "Date",
    y = "Total Net Radiation (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout" = "#D95F02"),
                     labels = c("Total burned trees LWout")) +
  #scale_fill_manual(name = "Radiation Data", 
                     #values = c("Total Net Radiation of plot area" = "#666666"),
                     #labels = c("Total Net Radiation of plot area")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()

min_NetRad_plot
```

```{r}
#combining and saving NetSW, NetLW and NetRad plots
combined_max_NR_plots <- ggarrange(max_NetSW_plot, max_NetLW_plot, max_NetRad_plot, nrow = 3, ncol = 1, common.legend = TRUE, legend = "right") %>%
  annotate_figure(combined_NR_plots, top = text_grob("Maximum Data Values", 
               color = "black", size = 14))

combined_max_NR_plots
```

\*\* next steps - need to pull in persistent data and do the same data wrangling for that data, then plot

# Persistent Data

## Calling in Data

```{r}
persb_energytree_table <- read_csv("nsf/drone_imagery/pers_b_energy_tree_table.csv") %>%
  mutate(zone = "persistent") %>%
  rename(burn_status = burn_statu) %>%
  #adding a tree_id column
  mutate(tree_id = row_number()) %>%
  #selecting columns I want
  select(tree_id, zone, burn_status, lat, long)

#this is the csv that has tree diameters for albedo plots on it, use this to choose an average circumference
albedoplots_treechar_alldata <- read_csv("nsf/albedo/albedoplots_treechar_alldata.csv")

#this is the csv that has camera snow depths and if tree wells appeared or not from 105E_transb_snowcamera
persb_snowcamera_data <- read_csv("nsf/camera_snowdepths/2024_persb_lp_highmort_east_snowdepths.csv") %>%
  rename(snowcam_max_depth_cm = "max_depth_cm") %>%
  mutate(date = as.Date(date))

persb_wx_hourly <- read_csv("nsf/pers_burned/pers_burned_wx_hourly_r.csv") %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")), datetime = force_tz(datetime, tz = 'MST'))
```

```{r}

#seperating by burned/unburned
##burned
avg_dt_persb_treeLW_burned <- read_csv("nsf/105E_trans_burned/day_avg_filtered_treeLWout_data_bub.csv") %>%
  filter(zone == "persistent", phase == "day", burn_status == "burned") %>%
  rename(b_tree_LWout_MJd = tree_LWout_MJperd, b_treetemp_C = temp, b_tree_LWout_wperm2 = tree_LWout_wperm2)

##unburned
avg_dt_persb_treeLW_unburned <- read_csv("nsf/105E_trans_burned/day_avg_filtered_treeLWout_data_bub.csv") %>%
  filter(zone == "persistent", phase == "day", burn_status == "unburned") %>%
  rename(ub_tree_LWout_MJd = tree_LWout_MJperd, ub_treetemp_C = temp, ub_tree_LWout_wperm2 = tree_LWout_wperm2)

#seperating by tree burn status - gb/db/ub - this dataframe includes all burn status types
avg_dt_persb_treeLW_allstatuses <- read_csv("nsf/105E_trans_burned/day_avg_filtered_treeLWout_data_gbdbub.csv")

##green burned dataframe
avg_dt_persb_treeLW_gb <- avg_dt_transb_treeLW_allstatuses %>%
  #filtering out only the correct burned status, daytime data, & transitional zone
  filter(zone == "persistent", phase == "day", burn_status == "green burn") %>%
  rename(gb_tree_LWout_MJd = tree_LWout_MJperd, gb_treetemp_C = temp_C, gb_tree_LWout_wperm2 = tree_LWout_wperm2, gb_tree_LWout_Jperd = tree_LWout_Jperd) %>%
  #removing double ID first column that appeared for some reason?
  select(-1)

##dead burned dataframe
avg_dt_persb_treeLW_db <- avg_dt_transb_treeLW_allstatuses %>%
  #filtering out only the correct burned status, daytime data, & transitional zone
  filter(zone == "persistent", phase == "day", burn_status == "dead burn") %>%
  rename(db_tree_LWout_MJd = tree_LWout_MJperd, db_treetemp_C = temp_C, db_tree_LWout_wperm2 = tree_LWout_wperm2, db_tree_LWout_Jperd = tree_LWout_Jperd) %>%
  #removing double ID first column that appeared for some reason?
  select(-1)

##unburned dataframe
avg_dt_persb_treeLW_ub <- avg_dt_transb_treeLW_allstatuses %>%
  #filtering out only the correct burned status, daytime data, & transitional zone
  filter(zone == "persistent", phase == "day", burn_status == "unburned") %>%
  rename(ub_tree_LWout_MJd = tree_LWout_MJperd, ub_treetemp_C = temp_C, ub_tree_LWout_wperm2 = tree_LWout_wperm2, ub_tree_LWout_Jperd = tree_LWout_Jperd) %>%
  #removing double ID first column that appeared for some reason?
  select(-1)
```

Filtering Wx Persistent Data

```{r}
filtered_persb_rad_wx <- persb_wx_hourly %>%
  filter(datetime >= as.POSIXct("2024-02-02 00:00:00") & datetime <= as.POSIXct("2024-05-25 00:00:00")) %>%
   # Adding in date, time, and phase columns
  mutate(
    date = as.Date(datetime),
    time = format(datetime, "%H:%M:%S"),
    time_hms = hms::as_hms(time),  # Convert to hms object for phase calculation
    phase = case_when(
      time_hms >= hms::as_hms("08:00:00") & time_hms < hms::as_hms("17:00:00") ~ "day",
      time_hms < hms::as_hms("08:00:00") | time_hms >= hms::as_hms("17:00:00") ~ "night",
      TRUE ~ NA_character_)) %>%
      select(datetime, date, time, phase, SnowDepth_m, AirTC_Avg, SWin_Avg, SWout_Avg, SWalbedo_Avg, LWin_Avg, LWout_Avg, SWnet_Avg, LWnet_Avg, NR_Avg)
```

Data Wrangling

```{r}
#calculations for radiation conversions from W/m2 to MJ/day
## create a daily average dataframe
avg_dt_persb_rad_wx<- filtered_persb_rad_wx %>%
  group_by(date, phase) %>%
  summarize(across(everything(), mean, na.rm = TRUE)) %>%
  select(-c(datetime, time)) %>%
  group_by(date, phase) %>%
  # Convert mean radiation to MJ/day - assuming constent for m2 value
  mutate(SWin_MJd = (SWin_Avg/ 1e6) * 86400, SWout_MJd = (SWout_Avg/ 1e6) * 86400, LWin_MJd = (LWin_Avg/ 1e6) * 86400, LWout_MJd = (LWout_Avg/ 1e6) * 86400, SWnet_MJd = (SWnet_Avg / 1e6) * 86400, LWnet_MJd = (LWnet_Avg/ 1e6) * 86400, NR_MJd = (NR_Avg / 1e6) * 86400) %>%
  rename(SWin_wperm2 = SWin_Avg, SWout_wperm2 = SWout_Avg, SWnet_wperm2 = SWnet_Avg, LWin_wperm2 = LWin_Avg, LWout_wperm2 = LWout_Avg, LWnet_wperm2 = LWnet_Avg, NR_wperm2 = NR_Avg) %>%
  mutate(zone = "persistent", burn_status = "burned") %>%
  #filtering out only daytime values
  filter(phase == "day") %>%
  #reordering so the like values are next to each other
  select(date, phase, zone, burn_status, SnowDepth_m, AirTC_Avg, SWin_wperm2, SWin_MJd, SWout_wperm2, SWout_MJd, SWnet_wperm2, SWnet_MJd, SWalbedo_Avg, LWin_wperm2, LWin_MJd, LWout_wperm2, LWout_MJd, LWnet_wperm2, LWnet_MJd, NR_wperm2, NR_MJd) %>%
  #setting decimal number
   mutate(across(SnowDepth_m:last_col(), ~ round(., 4)))
```

```{r}
##* I think I want to use this one, not the gb/db/ub, since there is such a small difference between the gb & db LWout values from trees
#by burned/unburned status
persb_comb_radtree <- avg_dt_persb_rad_wx %>%
  mutate(burn_status = "burned") %>%
  full_join(avg_dt_persb_treeLW_burned) %>%
  #recalculating NetRad, as I am not sure the calculations here are correct that are pulled from the weather station
  mutate(NR_MJd_wxs = (SWin_MJd - SWout_MJd) + (LWin_MJd - LWout_MJd)) %>%
  select(-datetime)
#answer is slightly different than weather-station calculated RN, use this value instead!

```

```{r}
#starting a new dataframe to continue the work above
new_persb_comb_treeLWout <- persb_comb_treeLWout %>%
  #next step is to create a NEW tree_LWout_MJd that is multiplied by the area and olf MJ/day values in the dataframe.
  #calculating min MJ/day
  mutate(min_tree_LWout_MJd = (b_tree_LWout_wperm2*min_area_m2) * (86400/1e6)) %>%
  #calculating max MJ/day
  mutate(max_tree_LWout_MJd = (b_tree_LWout_wperm2*max_area_m2) * (86400/1e6)) %>%
  #calculating meam MJ/day
  mutate(mean_tree_LWout_MJd = (b_tree_LWout_wperm2*mean_area_m2) * (86400/1e6))

#results dataframe
results_persb_comb_treeLWout <- new_persb_comb_treeLWout %>%
  select(date, phase, zone, burn_status, tree_id, b_treetemp_C, b_tree_LWout_wperm2, min_tree_LWout_MJd, max_tree_LWout_MJd, mean_tree_LWout_MJd, min_circ_m, max_circ_m, mean_circ_m, min_area_m2, max_area_m2, mean_area_m2) %>%
  group_by(date, phase, zone) %>%
  summarize(total_min_tree_LWout_MJd = sum(min_tree_LWout_MJd), total_max_tree_LWout_MJd = sum(max_tree_LWout_MJd), total_mean_tree_LWout_MJd = sum(mean_tree_LWout_MJd), total_min_area_m2 = sum(min_area_m2), total_max_area_m2 = sum(max_area_m2), total_mean_area_m2 = sum(mean_area_m2))
```

```{r}
#creating a dataframe to use for plots that only has the days that treewells developed.
persb_treewell_dates <- filtered_persb_snowcamera_data %>%
  filter(treewell_developed == "yes") %>%
  #adding tree_LWout_data to the dataframe so that I can plot with the same y-axis
  inner_join(results_persb_comb_treeLWout) %>%
  select(date, snowcam_max_depth_m, conditions, treewell_developed, total_max_tree_LWout_MJd, total_min_tree_LWout_MJd, total_mean_tree_LWout_MJd)
```

Calculating the mean dataframes

```{r}
#calculating weather station total area based on tree-impacted area 
#mean dataframe
mean_dt_persb_radtree_comb<- avg_dt_persb_rad_wx %>%
  inner_join(results_persb_comb_treeLWout) %>%
  #creating a net radiation weather station parameter
  mutate(NR_MJd = SWin_MJd - SWout_MJd + LWin_MJd - LWout_MJd) %>%
  select(date, phase, zone, burn_status, SnowDepth_m, SWin_MJd, SWout_MJd, SWnet_MJd, SWalbedo_Avg, LWin_MJd, LWout_MJd, LWnet_MJd, NR_MJd, total_mean_tree_LWout_MJd, total_mean_area_m2) %>%
  rename(total_mean_tree_area_m2 = total_mean_area_m2) %>%
  #calculating the area of the weather station region's impacts 
  mutate(total_mean_wx_area_m2 = 1125-total_mean_tree_area_m2) %>%
  #calculating the net outgoing rad for the weather station data and removing the m2 unit by multiplying by the area that this weather station data is applied to
  mutate(mean_wx_NRin_MJd = (SWin_MJd + LWin_MJd) * total_mean_wx_area_m2, mean_wx_NRout_MJd = (SWout_MJd + LWout_MJd) * total_mean_wx_area_m2, mean_wx_netSW_MJd = (SWin_MJd - SWout_MJd) * total_mean_wx_area_m2, mean_wx_netLW_MJd = (LWin_MJd - LWout_MJd) * total_mean_wx_area_m2) %>%
  #calcuating the total net mean radiation for LWout (tree + weather station data, and SW)
  mutate(total_mean_netLW_wtree_MJd = mean_wx_netLW_MJd + total_mean_tree_LWout_MJd, total_mean_netLW_wotree_MJd = mean_wx_netLW_MJd, total_mean_net_rad_wtree_MJd = ((SWin_MJd * total_mean_wx_area_m2)-(SWout_MJd * total_mean_wx_area_m2)) + ((LWin_MJd*total_mean_wx_area_m2)-(LWout_MJd*total_mean_wx_area_m2)) + total_mean_tree_LWout_MJd) %>%
  #making a new NetRad column without the addition of the treeLWout, to compare
  mutate(total_mean_net_rad_wotree_MJd = ((SWin_MJd * total_mean_wx_area_m2)-(SWout_MJd * total_mean_wx_area_m2)) + ((LWin_MJd*total_mean_wx_area_m2)-(LWout_MJd*total_mean_wx_area_m2)))
  
mean_dt_persb_radtree_comb <- mean_dt_persb_radtree_comb %>%
  rename(wx_NR_MJdm2 = NR_MJd)
```

```{r}
#creating a new dataframe with snow depths and treewell development, as well as tree_LWout so that I can put points on snowdepths instead of total treeLWout line in plots
filtered_persb_treewell_data <- filtered_persb_snowcamera_data %>%
  inner_join(mean_dt_persb_radtree_comb) %>%
  select(date, phase, zone, burn_status, conditions, snowcam_max_depth_cm, snowcam_max_depth_m, treewell_developed, total_mean_tree_LWout_MJd) %>%
  filter(treewell_developed == "yes")
```

## Plotting Mean Data

```{r}
#setting persistent depth factor to assign a secondary y-axis for snow depths - this factor needs to be different for the persistent and transitional snow zones because they have different snow depths
p_depth_factor <- 6000
```

```{r}
#mean NetLW- persisent - with treeLWout included in net LW bars
p_mean_NetLW_wtree_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = mean_dt_persb_radtree_comb, aes(x = date, y = total_mean_netLW_wtree_MJd), fill = "#1B7837", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = mean_dt_persb_radtree_comb, aes(x = date, y = total_mean_tree_LWout_MJd, color = "Total burned trees LWout (MJ/d)")) +
   # Line plot for snow cam max depth on a secondary y-axis
  geom_line(data = filtered_persb_snowcamera_data, aes(x = date, y = snowcam_max_depth_m * p_depth_factor, 
             color = "Daily max snow depth (m)"), linewidth = 0.6) + 
  # Point plot for treewell development dates
  geom_point(data = filtered_persb_treewell_data, aes(x = date, y = snowcam_max_depth_m * p_depth_factor, 
             shape = "Dates that treewells developed"), 
             color = "darkgoldenrod3", fill = "darkgoldenrod3", size = 1.5) + 
  facet_wrap(~zone + burn_status) +
  labs(
    title = "Mean Values with tree LWout",
    #x = "Date",
    y = "Net LW Rad (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout (MJ/d)" = "#D95F02", "Daily max snow depth (m)" = "grey30")) +
  scale_shape_manual(values = c("Dates that treewells developed" = 21)) +
  guides(color = guide_legend(title = NULL),  # Remove title for color legend
         shape = guide_legend(title = NULL)) +  # Remove title for shape legend
  scale_y_continuous(
    sec.axis = sec_axis(~./depth_factor, name = "Snow Depth (m)")  # Adjusting for the secondary axis
  ) +
  theme_bw() + 
  theme(
    plot.title = element_text(size = 15),      # Title size
    axis.title.x = element_text(size = 13),                   # X-axis title size
    axis.title.y = element_text(size = 13),                   # Y-axis title size
    axis.text = element_text(size = 11),                      # Axis text size
    legend.text = element_text(size = 12),                    # Legend text size
    legend.title = element_text(size = 12),                   # Legend title size
    strip.text = element_text(size = 12))


p_mean_NetLW_wtree_plot
```

```{r}
#mean NetLW- persisent - without treeLWout included in net LW bars
p_mean_NetLW_wotree_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = mean_dt_persb_radtree_comb, aes(x = date, y = total_mean_netLW_wotree_MJd), fill = "#1B7837", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = mean_dt_persb_radtree_comb, aes(x = date, y = total_mean_tree_LWout_MJd, color = "Total burned trees LWout (MJ/d)")) +
   # Line plot for snow cam max depth on a secondary y-axis
  geom_line(data = filtered_persb_snowcamera_data, aes(x = date, y = snowcam_max_depth_m * p_depth_factor, 
             color = "Daily max snow depth (m)"), linewidth = 0.6) + 
  # Point plot for treewell development dates
  geom_point(data = filtered_persb_treewell_data, aes(x = date, y = snowcam_max_depth_m * p_depth_factor, 
             shape = "Dates that treewells developed"), 
             color = "darkgoldenrod3", fill = "darkgoldenrod3", size = 1.5) + 
  facet_wrap(~zone + burn_status) +
  labs(
    title = "Mean Values w/o tree LWout",
   # x = "Date",
    y = "Net LW Rad (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout (MJ/d)" = "#D95F02", "Daily max snow depth (m)" = "grey30")) +
  scale_shape_manual(values = c("Dates that treewells developed" = 21)) +
  guides(color = guide_legend(title = NULL),  # Remove title for color legend
         shape = guide_legend(title = NULL)) +  # Remove title for shape legend
  scale_y_continuous(
    sec.axis = sec_axis(~./depth_factor, name = "Snow Depth (m)")  # Adjusting for the secondary axis
  ) +
  theme_bw() + 
  theme(
    plot.title = element_text(size = 15),      # Title size
    axis.title.x = element_text(size = 13),                   # X-axis title size
    axis.title.y = element_text(size = 13),                   # Y-axis title size
    axis.text = element_text(size = 11),                      # Axis text size
    legend.text = element_text(size = 12),                    # Legend text size
    legend.title = element_text(size = 12),                   # Legend title size
    strip.text = element_text(size = 12))


p_mean_NetLW_wotree_plot
```

```{r}
#combining NetLW dataframes w/ and w/o treeLWout included in bars
p_mean_NetLW_comb <- ggarrange(p_mean_NetLW_wtree_plot, p_mean_NetLW_wotree_plot, nrow = 1, ncol = 2, common.legend = TRUE, legend = "right")

p_mean_NetLW_comb
```

```{r}
#mean net SW plot
p_mean_NetSW_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = mean_dt_persb_radtree_comb, aes(x = date, y = mean_wx_netSW_MJd), fill = "#2166AC", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = mean_dt_persb_radtree_comb, aes(x = date, y = total_mean_tree_LWout_MJd, color = "Total burned trees LWout (MJ/d)")) +
   # Line plot for snow cam max depth on a secondary y-axis
  geom_line(data = filtered_persb_snowcamera_data, aes(x = date, y = snowcam_max_depth_m * p_depth_factor, 
             color = "Daily max snow depth (m)"), linewidth = 0.6) + 
  # Point plot for treewell development dates
  geom_point(data = filtered_persb_treewell_data, aes(x = date, y = snowcam_max_depth_m * p_depth_factor, 
             shape = "Dates that treewells developed"), 
             color = "darkgoldenrod3", fill = "darkgoldenrod3", size = 1.5) + 
  facet_wrap(~zone + burn_status) +
  labs(
    #title = "Mean Values",
    #x = "Date",
    y = "Net SW Rad (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout (MJ/d)" = "#D95F02", "Daily max snow depth (m)" = "grey30")) +
  scale_shape_manual(values = c("Dates that treewells developed" = 21)) +
  guides(color = guide_legend(title = NULL),  # Remove title for color legend
         shape = guide_legend(title = NULL)) +  # Remove title for shape legend
  scale_y_continuous(
    sec.axis = sec_axis(~./depth_factor, name = "Snow Depth (m)")  # Adjusting for the secondary axis
  ) +
  theme_bw() +
  theme(
    plot.title = element_text(size = 15),      # Title size
    axis.title.x = element_text(size = 13),                   # X-axis title size
    axis.title.y = element_text(size = 13),                   # Y-axis title size
    axis.text = element_text(size = 11),                      # Axis text size
    legend.text = element_text(size = 12),                    # Legend text size
    legend.title = element_text(size = 12),                   # Legend title size
    strip.text = element_text(size = 12))

p_mean_NetSW_plot
```

```{r}
#this is the total net rad without the treeLWout variable included in the value
p_mean_NetRad_wtree_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = mean_dt_persb_radtree_comb, aes(x = date, y = total_mean_net_rad_wtree_MJd), fill = "#666666", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = mean_dt_persb_radtree_comb, aes(x = date, y = total_mean_tree_LWout_MJd, color = "Total burned trees LWout (MJ/d)")) +
   # Line plot for snow cam max depth on a secondary y-axis
  geom_line(data = filtered_persb_snowcamera_data, aes(x = date, y = snowcam_max_depth_m * p_depth_factor, 
             color = "Daily max snow depth (m)"), linewidth = 0.6) + 
  # Point plot for treewell development dates
  geom_point(data = filtered_persb_treewell_data, aes(x = date, y = snowcam_max_depth_m * p_depth_factor, 
             shape = "Dates that treewells developed"), 
             color = "darkgoldenrod3", fill = "darkgoldenrod3", size = 1.5) + 
  facet_wrap(~zone + burn_status) +
  labs(
    title = "Mean Data Values with Tree LWout",
    x = "Date",
    y = "Total Net Radiation (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout (MJ/d)" = "#D95F02", "Daily max snow depth (m)" = "grey30")) +
  scale_shape_manual(values = c("Dates that treewells developed" = 21)) +
  guides(color = guide_legend(title = NULL),  # Remove title for color legend
         shape = guide_legend(title = NULL)) +  # Remove title for shape legend
  scale_y_continuous(
    sec.axis = sec_axis(~./depth_factor, name = "Snow Depth (m)")  # Adjusting for the secondary axis
  ) +
  theme_bw() + 
  theme(
    plot.title = element_text(size = 15),      # Title size
    axis.title.x = element_text(size = 13),                   # X-axis title size
    axis.title.y = element_text(size = 13),                   # Y-axis title size
    axis.text = element_text(size = 11),                      # Axis text size
    legend.text = element_text(size = 12),                    # Legend text size
    legend.title = element_text(size = 12),                   # Legend title size
    strip.text = element_text(size = 12))

p_mean_NetRad_wtree_plot
```

```{r}
#this is the total net rad without the treeLWout variable included in the value
p_mean_NetRad_wotree_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = mean_dt_persb_radtree_comb, aes(x = date, y = total_mean_net_rad_wotree_MJd), fill = "#666666", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = mean_dt_persb_radtree_comb, aes(x = date, y = total_mean_tree_LWout_MJd, color = "Total burned trees LWout (MJ/d)")) +
   # Line plot for snow cam max depth on a secondary y-axis
  geom_line(data = filtered_persb_snowcamera_data, aes(x = date, y = snowcam_max_depth_m * p_depth_factor, 
             color = "Daily max snow depth (m)"), linewidth = 0.6) + 
  # Point plot for treewell development dates
  geom_point(data = filtered_persb_treewell_data, aes(x = date, y = snowcam_max_depth_m * p_depth_factor, 
             shape = "Dates that treewells developed"), 
             color = "darkgoldenrod3", fill = "darkgoldenrod3", size = 1.5) + 
  facet_wrap(~zone + burn_status) +
  labs(
    title = "Mean Data Values without Tree LWout",
    x = "Date",
    y = "Total Net Radiation (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout (MJ/d)" = "#D95F02", "Daily max snow depth (m)" = "grey30")) +
  scale_shape_manual(values = c("Dates that treewells developed" = 21)) +
  guides(color = guide_legend(title = NULL),  # Remove title for color legend
         shape = guide_legend(title = NULL)) +  # Remove title for shape legend
  scale_y_continuous(
    sec.axis = sec_axis(~./depth_factor, name = "Snow Depth (m)")  # Adjusting for the secondary axis
  ) +
  theme_bw() +
  theme(
    plot.title = element_text(size = 15),      # Title size
    axis.title.x = element_text(size = 13),                   # X-axis title size
    axis.title.y = element_text(size = 13),                   # Y-axis title size
    axis.text = element_text(size = 11),                      # Axis text size
    legend.text = element_text(size = 12),                    # Legend text size
    legend.title = element_text(size = 12),                   # Legend title size
    strip.text = element_text(size = 12))

p_mean_NetRad_wotree_plot
```

```{r}
#combining total NetRad plots - with and without treeLWout included in bars
p_mean_NetRad_comb <- ggarrange(p_mean_NetRad_wtree_plot, p_mean_NetRad_wotree_plot, nrow = 1, ncol = 2, common.legend = TRUE, legend = "right")
```

```{r}
#combining and saving NetSW, NetLW and NetRad plots
p_combined_mean_NR_plots <- ggarrange(p_mean_NetSW_plot, p_mean_NetLW_wotree_plot, p_mean_NetRad_wotree_plot, nrow = 3, ncol = 1, common.legend = TRUE, legend = "right") %>%
  annotate_figure(combined_NR_plots, top = text_grob("Mean Data Values", 
               color = "black", size = 14))

p_combined_mean_NR_plots
```

# Accumulation Datasets

These datasets are using the daily mean values for the radiation components and accumulating them by day to get an accumulation dataset that can be plotted to see if the patterns make sense

## Data Wrangling

```{r}
#transitional data wrangling
## have to use base r for some reason, as tidyverse syntax wasn't working
mean_dt_transb_radtree_comb$accu_treeLWout_MJd <- Reduce(`+`, mean_dt_transb_radtree_comb$total_mean_tree_LWout_MJd, accumulate = TRUE)

mean_dt_transb_radtree_comb$accu_netSW_MJd <- Reduce(`+`, mean_dt_transb_radtree_comb$mean_wx_netSW_MJd, accumulate = TRUE)

mean_dt_transb_radtree_comb$accu_netLW_wtree_MJd <- Reduce(`+`, mean_dt_transb_radtree_comb$total_mean_netLW_wtree_MJd, accumulate = TRUE)

mean_dt_transb_radtree_comb$accu_netLW_wotree_MJd <- Reduce(`+`, mean_dt_transb_radtree_comb$total_mean_netLW_wotree_MJd, accumulate = TRUE)

mean_dt_transb_radtree_comb$accu_netRad_wtree_MJd <- Reduce(`+`, mean_dt_transb_radtree_comb$total_mean_net_rad_wtree_MJd, accumulate = TRUE)

mean_dt_transb_radtree_comb$accu_netRad_wotree_MJd <- Reduce(`+`, mean_dt_transb_radtree_comb$total_mean_net_rad_wotree, accumulate = TRUE)

#adding accumulation snowdepth to mean_dt dataframes
mean_dt_transb_radtree_comb$accu_max_snowdepth_cm <- Reduce(`+`, accu_transb_treewell_dates$snowcam_max_depth_cm, accumulate = TRUE) 

#making a meteres snowdepth column from the above data
mean_dt_transb_radtree_comb <- mean_dt_transb_radtree_comb %>%
  mutate(accu_max_snowdepth_m = accu_max_snowdepth_cm/100)

#adding in non-cumulative snow depths
mean_dt_transb_radtree_comb <- mean_dt_transb_radtree_comb %>%
  inner_join(accu_transb_treewell_dates)
```

```{r}
# persistent
mean_dt_persb_radtree_comb$accu_treeLWout_MJd <- Reduce(`+`, mean_dt_persb_radtree_comb$total_mean_tree_LWout_MJd, accumulate = TRUE)

mean_dt_persb_radtree_comb$accu_netSW_MJd <- Reduce(`+`, mean_dt_persb_radtree_comb$mean_wx_netSW_MJd, accumulate = TRUE)

mean_dt_persb_radtree_comb$accu_netLW_wtree_MJd <- Reduce(`+`, mean_dt_persb_radtree_comb$total_mean_netLW_wtree_MJd, accumulate = TRUE)

mean_dt_persb_radtree_comb$accu_netLW_wotree_MJd <- Reduce(`+`, mean_dt_persb_radtree_comb$total_mean_netLW_wotree_MJd, accumulate = TRUE)

mean_dt_persb_radtree_comb$accu_netRad_wtree_MJd <- Reduce(`+`, mean_dt_persb_radtree_comb$total_mean_net_rad_wtree_MJd, accumulate = TRUE)

mean_dt_persb_radtree_comb$accu_netRad_wotree_MJd <- Reduce(`+`, mean_dt_persb_radtree_comb$total_mean_net_rad_wotree_MJd, accumulate = TRUE)

#adding accumulation snowdepth to mean_dt dataframes
mean_dt_persb_radtree_comb$accu_max_snowdepth_cm <- Reduce(`+`, accu_persb_treewell_dates$snowcam_max_depth_cm, accumulate = TRUE) 

#making a meteres snowdepth column from the above data
mean_dt_persb_radtree_comb <- mean_dt_persb_radtree_comb %>%
  mutate(accu_max_snowdepth_m = accu_max_snowdepth_cm/100)

#adding in non-cumulative snowdepths
mean_dt_persb_radtree_comb <- mean_dt_persb_radtree_comb %>%
  inner_join(accu_persb_treewell_dates)
```

```{r}
#making an accumulation dataframe with both snow zones on it, so I can simply facet wrap by that for the plots

accum_mean_data_bothzones <- rbind(mean_dt_transb_radtree_comb, mean_dt_persb_radtree_comb) %>%
  select(date, phase, zone, burn_status, accu_netSW_MJd, accu_netLW_wtree_MJd, accu_netLW_wotree_MJd, accu_netRad_wtree_MJd, accu_netRad_wotree_MJd, accu_treeLWout_MJd, accu_max_snowdepth_cm, accu_max_snowdepth_m, snowcam_max_depth_cm, conditions, treewell_developement) %>%
  mutate(snowcam_max_depth_m = snowcam_max_depth_cm/100)
```

```{r}
#making a full dataset with both zone's treewell data
accu_transb_treewell_dates <- transb_snowcamera_data %>%
  filter(date >= as.Date("2024-02-02") & date <= as.Date("2024-05-24")) %>%
  rename(burn_status = mortality, treewell_developement = treewell_developed) %>%
  select(date, zone, burn_status, snowcam_max_depth_cm, conditions, treewell_developement)

accu_persb_treewell_dates <- persb_snowcamera_data %>%
  filter(date >= as.Date("2024-02-02") & date <= as.Date("2024-05-24")) %>%
  select(date, zone, burn_status, snowcam_max_depth_cm, conditions, treewell_developement)
  

full_treewell_data <- rbind(accu_persb_treewell_dates, accu_transb_treewell_dates)

#binding to accumulation dataframe, then I'll refilter out only yes dates, the use this dataframe to plot treewell points on accumulation plot
accu_treewell_data <- accum_mean_data_bothzones %>%
  inner_join(full_treewell_data) %>%
  mutate(treewell_developement = case_when(
    treewell_developement == "maybe" ~ "yes",
    treewell_developement == "no snow" ~ "no",
    TRUE ~ treewell_developement  # Keep all other values unchanged
  )) %>%
  filter(treewell_developement == "yes")
```

Accumulation Plotting

-   Don't use the following 2 plots,use the ones with snow instead!

```{r}

#plot with out net Rad including treeLWout data
mean_NR_acc_wotree_plot <- ggplot(data = accum_mean_data_bothzones) +
  geom_line(aes(x = date, y = accu_treeLWout_MJd, color = "Tree LWout", linetype = "Tree LWout"), linewidth = 0.8) +
  geom_line(aes(x = date, y = accu_netLW_wotree_MJd, color = "Net LW", linetype = "Net LW"), linewidth = 0.8) +
  geom_line(aes(x = date, y = accu_netSW_MJd, color = "Net SW", linetype = "Net SW"), linewidth = 0.8) + 
  geom_line(aes(x = date, y = accu_netRad_wotree_MJd, color = "Total Net Radiation", linetype = "Total Net Radiation"), linewidth = 0.8) +
  geom_point(data = accu_treewell_data, aes(x = date, y = accu_treeLWout_MJd, 
             shape = "Dates that treewells developed"), 
             color = "black", fill = "black", size = 1.5) +
  facet_wrap(~zone + burn_status) +
  labs(
    title = "Without Tree LWout in Net Rad",
    x = "Date",
    y = "Cumulative Radiation Component (MJ/d)"
  ) +
   scale_color_manual(
   values = c("Tree LWout" = "#D95F02", 
               "Net LW" = "#1B7837", 
               "Net SW" = "#2166AC", 
               "Total Net Radiation" = "black")) +
  scale_linetype_manual(
    values = c("Tree LWout" = "solid", 
               "Net LW" = "solid", 
               "Net SW" = "solid", "Total Net Radiation" = "dashed")
  ) +
  scale_shape_manual(
    values = c("Dates that treewells developed" = 16)  # Set shape for points
  ) +
  scale_y_continuous(labels = scales::label_number(accuracy = 1)) + 
  guides(
    color = guide_legend(title = NULL),  # Remove the legend title for color
    linetype = guide_legend(title = NULL),  # Remove the legend title for linetype
    shape = guide_legend(title = NULL)  # Remove the legend title for shape
  ) +
  theme_bw()

print(mean_NR_acc_wotree_plot)
```

```{r}
#plot WITH net Rad including treeLWout data
mean_NR_acc_wtree_plot <- ggplot(data = accum_mean_data_bothzones) +
  geom_line(aes(x = date, y = accu_treeLWout_MJd, color = "Tree LWout", linetype = "Tree LWout"), linewidth = 0.8) +
  geom_line(aes(x = date, y = accu_netLW_wotree_MJd, color = "Net LW", linetype = "Net LW"), linewidth = 0.8) +
  geom_line(aes(x = date, y = accu_netSW_MJd, color = "Net SW", linetype = "Net SW"), linewidth = 0.8) + 
  geom_line(aes(x = date, y = accu_netRad_wtree_MJd, color = "Total Net Radiation", linetype = "Total Net Radiation"), linewidth = 0.8) +
  geom_point(data = accu_treewell_data, aes(x = date, y = accu_treeLWout_MJd, 
             shape = "Dates that treewells developed"), 
             color = "black", fill = "black", size = 1.5) +
  facet_wrap(~zone + burn_status) +
  labs(
    title = "With Tree LWout in Net Rad",
    x = "Date",
    y = "Radiation Component (MJ/d)"
  ) +
  scale_color_manual(
   values = c("Tree LWout" = "#D95F02", 
               "Net LW" = "#1B7837", 
               "Net SW" = "#2166AC", 
               "Total Net Radiation" = "black")) +
  scale_linetype_manual(
    values = c("Tree LWout" = "solid", 
               "Net LW" = "solid", 
               "Net SW" = "solid", "Total Net Radiation" = "dashed")
  ) +
  scale_shape_manual(
    values = c("Dates that treewells developed" = 16)  # Set shape for points
  ) +
  scale_y_continuous(labels = scales::label_number(accuracy = 1)) + 
  guides(
    color = guide_legend(title = NULL),  # Remove the legend title for color
    linetype = guide_legend(title = NULL),  # Remove the legend title for linetype
    shape = guide_legend(title = NULL)  # Remove the legend title for shape
  ) +
  theme_bw()

print(mean_NR_acc_wtree_plot)
```

```{r}
accum_comb_NR_wandwotree <- ggarrange(mean_NR_acc_wtree_plot, mean_NR_acc_wotree_plot, nrow = 1, ncol = 2, common.legend = TRUE, legend = "right")

accum_comb_NR_wandwotree
```

Accumulation Plots with Secondary Y-axis for snow depth data

-   Use these plots!

```{r}
accu_snowdepth_factor <- 200000
```

```{r}
#plotting net rad with out including treeLWout data
mean_NR_acc_wotree_plot <- ggplot(data = accum_mean_data_bothzones) +
  # Line plot for snow cam max depth on a secondary y-axis
   geom_line(aes(x = date, y = snowcam_max_depth_m * accu_snowdepth_factor, 
                color = "Daily Max Snow Depth", linetype = "Daily Max Snow Depth"), linewidth = 0.8) + 
  geom_line(aes(x = date, y = accu_treeLWout_MJd, color = "Tree LWout", linetype = "Tree LWout"), linewidth = 0.8) +
  geom_line(aes(x = date, y = accu_netLW_wotree_MJd, color = "Net LW", linetype = "Net LW"), linewidth = 0.8) +
  geom_line(aes(x = date, y = accu_netSW_MJd, color = "Net SW", linetype = "Net SW"), linewidth = 0.8) + 
  geom_line(aes(x = date, y = accu_netRad_wotree_MJd, color = "Total Net Radiation", linetype = "Total Net Radiation"), linewidth = 0.8) +
  geom_point(data = accu_treewell_data, aes(x = date, y = accu_treeLWout_MJd, 
                                           shape = "Dates that treewells developed"), 
             color = "black", fill = "black", size = 1.5) +
  # Line plot for snow cam max depth on a secondary y-axis
  facet_wrap(~zone + burn_status) +
  labs(
    title = "Without Tree LWout in Net Rad",
    x = "Date",
    y = "Cumulative Radiation Component (MJ/d)"
  ) +
  scale_color_manual(
    values = c("Tree LWout" = "#D95F02", 
               "Net LW" = "#1B7837", 
               "Net SW" = "#2166AC", 
               "Total Net Radiation" = "black",
               "Daily Max Snow Depth" = "#666666")) +
  scale_linetype_manual(
    values = c("Tree LWout" = "solid", 
               "Net LW" = "solid", 
               "Net SW" = "solid", 
               "Total Net Radiation" = "dashed", 
               "Daily Max Snow Depth" = "solid")
  ) +
  scale_shape_manual(
    values = c("Dates that treewells developed" = 16)  # Set shape for points
  ) +
  scale_y_continuous(labels = scales::label_number(accuracy = 1)) + 
  guides(
    color = guide_legend(title = NULL, 
                         override.aes = list(linetype = c("solid","solid", "solid", "dashed", "solid"))),  # Combine color and linetype
    linetype = "none",  # Remove the separate linetype legend
    shape = guide_legend(title = NULL)  # Remove the legend title for shape
  ) +
  scale_y_continuous( labels = scales::label_number(accuracy = 1),  # Prevent scientific notation
    sec.axis = sec_axis(~./accu_snowdepth_factor, name = "Snow Depth (m)")  # Adjusting for the secondary axis
  ) +
  theme_bw() +
  theme(
    plot.title = element_text(size = 15),      # Title size
    axis.title.x = element_text(size = 13),                   # X-axis title size
    axis.title.y = element_text(size = 13),                   # Y-axis title size
    axis.text = element_text(size = 11),                      # Axis text size
    legend.text = element_text(size = 12),                    # Legend text size
    legend.title = element_text(size = 12),                   # Legend title size
    strip.text = element_text(size = 12))                     # Facet text size (if facet_wrap is used)

print(mean_NR_acc_wotree_plot)

```

```{r}
#plotting net rad WITH including treeLWout data
mean_NR_acc_wotree_plot <- ggplot(data = accum_mean_data_bothzones) +
  # Line plot for snow cam max depth on a secondary y-axis
  geom_line(aes(x = date, y = snowcam_max_depth_m * accu_snowdepth_factor, 
                color = "Daily Max Snow Depth", linetype = "Daily Max Snow Depth"), linewidth = 0.8) + 
  geom_line(aes(x = date, y = accu_treeLWout_MJd, color = "Tree LWout", linetype = "Tree LWout"), linewidth = 0.8) +
  geom_line(aes(x = date, y = accu_netLW_wotree_MJd, color = "Net LW", linetype = "Net LW"), linewidth = 0.8) +
  geom_line(aes(x = date, y = accu_netSW_MJd, color = "Net SW", linetype = "Net SW"), linewidth = 0.8) + 
  geom_line(aes(x = date, y = accu_netRad_wtree_MJd, color = "Total Net Radiation", linetype = "Total Net Radiation"), linewidth = 0.8) +
  geom_point(data = accu_treewell_data, aes(x = date, y = accu_treeLWout_MJd, 
                                           shape = "Dates that treewells developed"), 
             color = "black", fill = "black", size = 1.5) +
  facet_wrap(~zone + burn_status) +
  labs(
    title = "With Tree LWout in Net Rad",
    x = "Date",
    y = "Cumulative Radiation Component (MJ/d)"
  ) +
  scale_color_manual(
    values = c("Tree LWout" = "#D95F02", 
               "Net LW" = "#1B7837", 
               "Net SW" = "#2166AC", 
               "Total Net Radiation" = "black",
               "Daily Max Snow Depth" = "#666666")) +
  scale_linetype_manual(
    values = c("Tree LWout" = "solid", 
               "Net LW" = "solid", 
               "Net SW" = "solid", 
               "Total Net Radiation" = "dashed", 
               "Daily Max Snow Depth" = "solid")
  ) +
  scale_shape_manual(
    values = c("Dates that treewells developed" = 16)  # Set shape for points
  ) +
  scale_y_continuous(labels = scales::label_number(accuracy = 1)) + 
  guides(
    color = guide_legend(title = NULL, 
                         override.aes = list(linetype = c("solid", "solid", "solid","dashed", "solid"))),  # Combine color and linetype
    linetype = "none",  # Remove the separate linetype legend
    shape = guide_legend(title = NULL)  # Remove the legend title for shape
  ) +
  scale_y_continuous( labels = scales::label_number(accuracy = 1),  # Prevent scientific notation
    sec.axis = sec_axis(~./accu_snowdepth_factor, name = "Snow Depth (m)")  # Adjusting for the secondary axis
  ) +
  theme_bw() +
  theme(
    plot.title = element_text(size = 15),      # Title size
    axis.title.x = element_text(size = 13),                   # X-axis title size
    axis.title.y = element_text(size = 13),                   # Y-axis title size
    axis.text = element_text(size = 11),                      # Axis text size
    legend.text = element_text(size = 12),                    # Legend text size
    legend.title = element_text(size = 12),                   # Legend title size
    strip.text = element_text(size = 12))   

print(mean_NR_acc_wotree_plot)

```

\*\* net LW is negative because there is less incoming LW radiation toward the earth & surface objects than there is outgoing LW radiation form the earths surface & objects, therefor the net LW radiation is negative. **Snow or Ice Surfaces** can be highly reflective and also radiate longwave energy efficiently, which can result in negative NetLW values. LWnet being negative is a reflective of surface energy loss (heat going back out - in this case, into the snow).

Cumulative Single Radiation Plots

-   Not sure I want to use these? They are pretty busy

```{r}
#persistent
single_persb_comb_NR_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = mean_dt_persb_radtree_comb, 
           aes(x = date, y = mean_wx_netSW_MJd, fill = "Net Shortwave Radiation"), position = "stack") +
  geom_col(data = mean_dt_persb_radtree_comb, 
           aes(x = date, y = total_mean_netLW_wotree_MJd, fill = "Net Longwave Radiation without Trees"), position = "stack") + 
  geom_col(data = mean_dt_persb_radtree_comb, 
           aes(x = date, y = total_mean_net_rad_wotree_MJd, fill = "Net Radiation without Trees"), position = "stack") + 
  geom_line(data = mean_dt_persb_radtree_comb, 
            aes(x = date, y = total_mean_tree_LWout_MJd, color = "Total burned trees LWout"), linewidth = 0.8) +
   # Line plot for snow cam max depth on a secondary y-axis
  geom_line(data = filtered_persb_snowcamera_data, 
            aes(x = date, y = snowcam_max_depth_m * p_depth_factor, color = "Daily max snow depth"), 
            linewidth = 0.8, linetype = 2) + 
  # Point plot for treewell development dates
  geom_point(data = filtered_persb_treewell_data, 
             aes(x = date, y = snowcam_max_depth_m * p_depth_factor, shape = "Dates that treewells developed"), 
             color = "red", fill = "red", size = 1.5) + 
  facet_wrap(~zone + burn_status) +
  labs(
    title = "Mean Data Values without Tree LWout",
    x = "Date",
    y = "Daily Cumulative Net Radiation (MJ/d)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout" = "#1B7837", 
                                "Daily max snow depth" = "#2166AC")) +
  scale_fill_manual(name = "Radiation Data", 
                    values = c("Net Shortwave Radiation" = "#E6AB02", 
                               "Net Longwave Radiation without Trees" = "#D95F02", 
                               "Net Radiation without Trees" = "black")) +
  scale_shape_manual(values = c("Dates that treewells developed" = 21)) +
  guides(color = guide_legend(title = NULL),  # Remove title for color legend
         shape = guide_legend(title = NULL),  # Remove title for shape legend
         fill = guide_legend(title = NULL)) +  # Remove title for fill legend
  scale_y_continuous(
    sec.axis = sec_axis(~./depth_factor, name = "Snow Depth (m)")  # Adjusting for the secondary axis
  ) +
  theme_bw()



single_persb_comb_NR_plot
```

```{r}
#transitional
single_transb_comb_NR_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = mean_dt_transb_radtree_comb, 
           aes(x = date, y = mean_wx_netSW_MJd, fill = "Net Shortwave Radiation"), position = "stack", alpha = 0.8) +
  geom_col(data = mean_dt_transb_radtree_comb, 
           aes(x = date, y = total_mean_netLW_wotree_MJd, fill = "Net Longwave Radiation without Trees"), position = "stack", alpha = 0.8) + 
  geom_col(data = mean_dt_transb_radtree_comb, 
           aes(x = date, y = total_mean_net_rad_wotree, fill = "Net Radiation without Trees"), position = "stack", alpha = 0.8) + 
  geom_line(data = mean_dt_transb_radtree_comb, 
            aes(x = date, y = total_mean_tree_LWout_MJd, color = "Total burned trees LWout"), linewidth = 0.8) +
   # Line plot for snow cam max depth on a secondary y-axis
  geom_line(data = filtered_transb_snowcamera_data, 
            aes(x = date, y = snowcam_max_depth_m * p_depth_factor, color = "Daily max snow depth"), 
            linewidth = 0.8, linetype = 2) + 
  # Point plot for treewell development dates
  geom_point(data = filtered_transb_treewell_data, 
             aes(x = date, y = snowcam_max_depth_m * p_depth_factor, shape = "Dates that treewells developed"), 
             color = "red", fill = "red", size = 1.5) + 
  facet_wrap(~zone + burn_status) +
  labs(
    #title = "Mean Data Values without Tree LWout",
    x = "Date",
    y = "Daily Cumulative Net Radiation (MJ/d)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout" = "#1B7837", 
                                "Daily max snow depth" = "#2166AC")) +
   scale_fill_manual(name = "Radiation Data", 
                    values = c("Net Shortwave Radiation" = "#E6AB02", 
                               "Net Longwave Radiation without Trees" = "#D95F02", 
                               "Net Radiation without Trees" = "black")) +
  scale_shape_manual(values = c("Dates that treewells developed" = 21)) +
  guides(color = guide_legend(title = NULL),  # Remove title for color legend
         shape = guide_legend(title = NULL),  # Remove title for shape legend
         fill = guide_legend(title = NULL)) +  # Remove title for fill legend
  scale_y_continuous(
    sec.axis = sec_axis(~./depth_factor, name = "Snow Depth (m)")  # Adjusting for the secondary axis
  ) +
  theme_bw()

single_transb_comb_NR_plot
```

```{r}
#combining total NetRad plots - with and without treeLWout included in bars
single_mean_NetRad_comb <- ggarrange(single_persb_comb_NR_plot, single_transb_comb_NR_plot, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")

single_mean_NetRad_comb
```

# Air TreeLWout Plots

```{r}
#creating filtered dataframes that have day and phase for weather station air temp data

##transitional
airT_dt_transb <- filtered_transb_rad_wx %>%
  filter(phase == "day") %>%
  group_by(date) %>%
  summarize(mean_airT_C = mean(AirTC_Avg, na.rm = TRUE), max_wxs_snowdepth_m = max(SnowDepth_m))

treeair_transb_comp <- avg_dt_transb_treeLW_burned %>%
  inner_join(airT_dt_transb)

#this is for the treewell development dates on the tree temp/air plot
transb_air_treewell <- full_treewell_data %>%
  filter(zone == "transitional") %>%
  mutate(treewell_developement = case_when(
    treewell_developement == "maybe" ~ "yes",
    treewell_developement == "no snow" ~ "no",
    TRUE ~ treewell_developement  # Keep all other values unchanged
  )) %>%
  inner_join(treeair_transb_comp) %>%
  filter(treewell_developement == "yes")

##persistent
airT_dt_persb <- filtered_persb_rad_wx %>%
  filter(phase == "day") %>%
  group_by(date) %>%
  summarize(mean_airT_C = mean(AirTC_Avg, na.rm = TRUE), max_wxs_snowdepth_m = max(SnowDepth_m))

treeair_persb_comp <- avg_dt_persb_treeLW_burned %>%
  inner_join(airT_dt_persb)

#this is for the treewell development dates on the tree temp/air plot
persb_air_treewell <- full_treewell_data %>%
  filter(zone == "persistent") %>%
  mutate(treewell_developement = case_when(
    treewell_developement == "maybe" ~ "yes",
    treewell_developement == "no snow" ~ "no",
    TRUE ~ treewell_developement  # Keep all other values unchanged
  )) %>%
  inner_join(treeair_persb_comp) %>%
  filter(treewell_developement == "yes")
```

```{r}
#combining all the dataframes to just facet wrap from one  
## for temp lines
all_treeair_comp <- rbind(treeair_transb_comp, treeair_persb_comp)

# for treewell date points
all_air_treewell <- rbind(persb_air_treewell, transb_air_treewell)
```

Plotting

```{r}
treeair_comb_plot <- ggplot() +
  geom_line(data = all_treeair_comp, 
            aes(x = date, y = b_treetemp_C, color = "Tree Temp")) + # Add color inside aes
  geom_line(data = all_treeair_comp, 
            aes(x = date, y = mean_airT_C, color = "Air Temp")) + # Use a different y variable for Air Temp
  geom_point(data = all_air_treewell, 
             aes(x = date, y = b_treetemp_C, shape = "Dates that treewells developed"), 
             color = "black", fill = "black", size = 1.5) +
  scale_color_manual(values = c("Tree Temp" = "#D95F02", "Air Temp" = "#2166AC")) +  # Manually set line colors
  facet_wrap(~zone + burn_status) +
  labs(
    #title = "Mean Data Values without Tree LWout",
    x = "Date",
    y = "Average Daytime Temp (C)"
  ) +
  scale_shape_manual(values = c("Dates that treewells developed" = 19)) + 
  guides(color = guide_legend(title = NULL), 
         shape = guide_legend(title = NULL), 
         fill = guide_legend(title = NULL)) + 
  theme_bw() + 
   theme(
    plot.title = element_text(size = 15),      # Title size
    axis.title.x = element_text(size = 13),                   # X-axis title size
    axis.title.y = element_text(size = 13),                   # Y-axis title size
    axis.text = element_text(size = 11),                      # Axis text size
    legend.text = element_text(size = 12),                    # Legend text size
    legend.title = element_text(size = 12),                   # Legend title size
    strip.text = element_text(size = 12))   
  

treeair_comb_plot
```

```{r}
#adding radiation to the above plots
p_mean_NetRad_wotree_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = mean_dt_persb_radtree_comb, aes(x = date, y = total_mean_net_rad_wotree_MJd), fill = "#666666", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = mean_dt_persb_radtree_comb, aes(x = date, y = total_mean_tree_LWout_MJd, color = "Total burned trees LWout (MJ/d)")) +
   # Line plot for snow cam max depth on a secondary y-axis
  geom_line(data = filtered_persb_snowcamera_data, aes(x = date, y = snowcam_max_depth_m * p_depth_factor, 
             color = "Daily max snow depth (m)"), linewidth = 0.6) + 
  # Point plot for treewell development dates
  geom_point(data = filtered_persb_treewell_data, aes(x = date, y = snowcam_max_depth_m * p_depth_factor, 
             shape = "Dates that treewells developed"), 
             color = "darkgoldenrod3", fill = "darkgoldenrod3", size = 1.5) + 
  facet_wrap(~zone + burn_status) +
  labs(
    title = "Mean Data Values without Tree LWout",
    x = "Date",
    y = "Total Net Radiation (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout (MJ/d)" = "#D95F02", "Daily max snow depth (m)" = "grey30")) +
  scale_shape_manual(values = c("Dates that treewells developed" = 21)) +
  guides(color = guide_legend(title = NULL),  # Remove title for color legend
         shape = guide_legend(title = NULL)) +  # Remove title for shape legend
  scale_y_continuous(
    sec.axis = sec_axis(~./depth_factor, name = "Snow Depth (m)")  # Adjusting for the secondary axis
  ) +
  theme_bw()

p_mean_NetRad_wotree_plot
```

Air and Tree Temp Comparisons

```{r}
#create a dataframe for both zones Total Net Radiations
mean_dt_transb_radtree_comb<- mean_dt_transb_radtree_comb %>%
  rename(total_mean_net_rad_wotree_MJd = total_mean_net_rad_wotree)

mean_NR_comb_data <- rbind(mean_dt_persb_radtree_comb,mean_dt_transb_radtree_comb)
```

```{r}
#depth factor for air temps 
temp_depthfactor <- 200
```

```{r}
#persistent plot with net radiation, air and tree temps and treewells 
p_airtreetemp_NR_plot <- ggplot() +
  # Primary axis for radiation components, mapping fill to aesthetic for legend inclusion
  geom_col(data = mean_dt_persb_radtree_comb, 
           aes(x = date, y = total_mean_net_rad_wotree_MJd, fill = "Total Net Radiation"), 
           position = "stack", alpha = 0.6) +
  
  # Secondary axis for temperature
  geom_line(data = treeair_persb_comp, 
            aes(x = date, y = b_treetemp_C*temp_depthfactor, color = "Tree Temp"), linewidth = 0.8) + 
  geom_line(data = treeair_persb_comp, 
            aes(x = date, y = mean_airT_C*temp_depthfactor, color = "Air Temp"), linewidth = 0.8) + 
  
  # Points for treewell development dates
  geom_point(data = persb_air_treewell, 
             aes(x = date, y = b_treetemp_C*temp_depthfactor, shape = "Dates that treewells developed"), 
             color = "black", fill = "black", size = 1.5) +
  
  # Manually set line colors for temperature and fill color for net radiation
  scale_color_manual(values = c("Tree Temp" = "#D95F02", "Air Temp" = "#2166AC")) +
  scale_fill_manual(values = c("Total Net Radiation" = "#666666")) +  # Include fill for geom_col
  
  # Primary axis labels and facet
  facet_wrap(~zone + burn_status) +
  labs(
    x = "Date",
    y = "Radiation (MJ/day)"
  ) +
  
  # Set up the secondary axis for temperature, adjust the transformation if needed
  scale_y_continuous(
    name = "Radiation (MJ/day)", 
    sec.axis = sec_axis(~ ./temp_depthfactor, name = "Average Daytime Temp (C)")
  ) +
  
  # Manually set the shape for treewell points
  scale_shape_manual(values = c("Dates that treewells developed" = 19)) + 
  
  # Legends without additional titles
  guides(color = guide_legend(title = NULL), 
         shape = guide_legend(title = NULL), 
         fill = guide_legend(title = NULL)) + 
  
  # Theme
  theme_bw()

# Print the plot
p_airtreetemp_NR_plot

```

```{r}
#transitional plot with net radiation, air and tree temps and treewells 
t_airtreetemp_NR_plot <- ggplot() +
  # Primary axis for radiation components, mapping fill to aesthetic for legend inclusion
  geom_col(data = mean_dt_transb_radtree_comb, 
           aes(x = date, y = total_mean_net_rad_wotree_MJd, fill = "Total Net Radiation"), 
           position = "stack", alpha = 0.6) +
  
  # Secondary axis for temperature
  geom_line(data = treeair_transb_comp, 
            aes(x = date, y = b_treetemp_C*temp_depthfactor, color = "Tree Temp"), linewidth = 0.8) + 
  geom_line(data = treeair_transb_comp, 
            aes(x = date, y = mean_airT_C*temp_depthfactor, color = "Air Temp"), linewidth = 0.8) + 
  
  # Points for treewell development dates
  geom_point(data = transb_air_treewell, 
             aes(x = date, y = b_treetemp_C*temp_depthfactor, shape = "Dates that treewells developed"), 
             color = "black", fill = "black", size = 1.5) +
  
  # Manually set line colors for temperature and fill color for net radiation
  scale_color_manual(values = c("Tree Temp" = "#D95F02", "Air Temp" = "#2166AC")) +
  scale_fill_manual(values = c("Total Net Radiation" = "#666666")) +  # Include fill for geom_col
  
  # Primary axis labels and facet
  facet_wrap(~zone + burn_status) +
  labs(
    x = "Date",
    y = "Radiation (MJ/day)"
  ) +
  
  # Set up the secondary axis for temperature, adjust the transformation if needed
  scale_y_continuous(
    name = "Radiation (MJ/day)", 
    sec.axis = sec_axis(~ ./temp_depthfactor, name = "Average Daytime Temp (C)")
  ) +
  
  # Manually set the shape for treewell points
  scale_shape_manual(values = c("Dates that treewells developed" = 19)) + 
  
  # Legends without additional titles
  guides(color = guide_legend(title = NULL), 
         shape = guide_legend(title = NULL), 
         fill = guide_legend(title = NULL)) + 
  
  # Theme
  theme_bw()

# Print the plot
t_airtreetemp_NR_plot
```

```{r}
treeairtemp_comb <- ggarrange(p_airtreetemp_NR_plot, t_airtreetemp_NR_plot, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")

treeairtemp_comb
```

Air/Tree temp plots without NR

```{r}
p_mean_airtreewell <- ggplot() +
  geom_line(data = treeair_persb_comp, 
            aes(x = date, y = b_treetemp_C, color = "Tree Temp")) + # Add color inside aes
  geom_line(data = treeair_persb_comp, 
            aes(x = date, y = mean_airT_C, color = "Air Temp")) + # Use a different y variable for Air Temp
  geom_point(data = persb_air_treewell, 
             aes(x = date, y = b_treetemp_C, shape = "Dates that treewells developed"), 
             color = "black", fill = "black", size = 1.5) +
  scale_color_manual(values = c("Tree Temp" = "#D95F02", "Air Temp" = "#2166AC")) +  # Manually set line colors
  facet_wrap(~zone + burn_status) +
  labs(
    #title = "Mean Data Values without Tree LWout",
    x = "Date",
    y = "Average Daytime Temp (C)"
  ) +
  scale_shape_manual(values = c("Dates that treewells developed" = 19)) + 
  guides(color = guide_legend(title = NULL), 
         shape = guide_legend(title = NULL), 
         fill = guide_legend(title = NULL)) + 
  theme_bw()

p_mean_airtreewell
```

```{r}

#combining plots using patchwork to get x-axis to match
persb_NR_airtree_plot <- p_mean_NetRad_wotree_plot / p_mean_airtreewell + 
                         plot_layout(nrow = 2) & theme(axis.title.x = element_blank())

persb_NR_airtree_plot


persb_NR_airtree_plot
```

Doing the same thing as above, but for transitional zone

```{r}
t_mean_airtreewell <- ggplot() +
  geom_line(data = treeair_transb_comp, 
            aes(x = date, y = b_treetemp_C, color = "Tree Temp")) + # Add color inside aes
  geom_line(data = treeair_transb_comp, 
            aes(x = date, y = mean_airT_C, color = "Air Temp")) + # Use a different y variable for Air Temp
  geom_point(data = transb_air_treewell, 
             aes(x = date, y = b_treetemp_C, shape = "Dates that treewells developed"), 
             color = "black", fill = "black", size = 1.5) +
  scale_color_manual(values = c("Tree Temp" = "#D95F02", "Air Temp" = "#2166AC")) +  # Manually set line colors
  facet_wrap(~zone + burn_status) +
  labs(
    #title = "Mean Data Values without Tree LWout",
    x = "Date",
    y = "Average Daytime Temp (C)"
  ) +
  scale_shape_manual(values = c("Dates that treewells developed" = 19)) + 
  guides(color = guide_legend(title = NULL), 
         shape = guide_legend(title = NULL), 
         fill = guide_legend(title = NULL)) + 
  theme_bw()

t_mean_airtreewell
```

```{r}
#combining plots using patchwork to get x-axis to match
transb_NR_airtree_plot <- t_mean_NetRad_wotree_plot / t_mean_airtreewell + 
                         plot_layout(nrow = 2) & theme(axis.title.x = element_blank())

transb_NR_airtree_plot
```
