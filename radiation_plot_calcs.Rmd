---
title: "radiation_plot_calcs"
output: html_document
date: "2024-09-13"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(lterdatasampler)
library(dplyr)
library(ggplot2)
library(readr)
library(readxl)
library(lubridate)
library(plotly)
library(openxlsx)
library(plotly)
library(rstatix)
library(htmlwidgets)
library(RColorBrewer)
library(patchwork)
library(hms)
library(ggpubr)
#package for scientific notation of numbers
library(scales)

setwd("/Volumes/wcnr-network/Research/Kampf/Private/field_data")
```

```{r}
#to display the colors
display.brewer.pal(n = 8, name = "Dark2")

#to get the hex number of the colors
brewer.pal(n = 8, name = "Dark2")
```

```{r}
#setting a color-blind friendly custom palette for gb/db/ubn- using RColorBrewer
##blue is unburned, orange is dead burned, green is green burned
three_custom_colors <- c("#D95F02","#1B7837", adjustcolor("#2166AC", alpha = 0.7))

## orange is burned, blue is unburned
two_custom_colors <- c("#D95F02", adjustcolor("#2166AC", alpha = 0.7))
```

# Transitional Data

## Calling in Data

```{r}
transb_energytree_table <- read_csv("nsf/drone_imagery/trans_b_energytree_table.csv") %>%
  mutate(zone = "transitional") %>%
  rename(burn_status = burn_statu) %>%
  #adding a tree_id column
  mutate(tree_id = row_number()) %>%
  #selecting columns I want
  select(tree_id, zone, burn_status, lat, long)

#this is the csv that has tree diameters for albedo plots on it, use this to choose an average circumference
albedoplots_treechar_alldata <- read_csv("nsf/albedo/albedoplots_treechar_alldata.csv")

#this is the csv that has camera snow depths and if tree wells appeared or not from 105E_transb_snowcamera
transb_snowcamera_data <- read_csv("nsf/camera_snowdepths/2024_105E_transb_snowdepths.csv") %>%
  rename(snowcam_max_depth_cm = "maximum_depth(cm)") %>%
  mutate(date = as.Date(date))

transb_wx_15min <- read_csv("nsf/trans_burned/trans_burned_wx_15min_r.csv") %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")), datetime = force_tz(datetime, tz = 'MST'))

#seperating by burned/unburned
##burned
avg_dt_transb_treeLW_burned <- read_csv("nsf/105E_trans_burned/day_avg_filtered_treeLWout_data_bub.csv") %>%
  filter(zone == "transitional", phase == "day", burn_status == "burned") %>%
  rename(b_tree_LWout_MJd = tree_LWout_MJperd, b_treetemp_C = temp, b_tree_LWout_wperm2 = tree_LWout_wperm2)

##unburned
avg_dt_transb_treeLW_unburned <- read_csv("nsf/105E_trans_burned/day_avg_filtered_treeLWout_data_bub.csv") %>%
  filter(zone == "transitional", phase == "day", burn_status == "unburned") %>%
  rename(ub_tree_LWout_MJd = tree_LWout_MJperd, ub_treetemp_C = temp, ub_tree_LWout_wperm2 = tree_LWout_wperm2)


#seperating by tree burn status - gb/db/ub - this dataframe includes all burn status types
avg_dt_transb_treeLW_allstatuses <- read_csv("nsf/105E_trans_burned/day_avg_filtered_treeLWout_data_gbdbub.csv")

##green burned dataframe
avg_dt_transb_treeLW_gb <- avg_dt_transb_treeLW_allstatuses %>%
  #filtering out only the correct burned status, daytime data, & transitional zone
  filter(zone == "transitional", phase == "day", burn_status == "green burn") %>%
  rename(gb_tree_LWout_MJd = tree_LWout_MJperd, gb_treetemp_C = temp_C, gb_tree_LWout_wperm2 = tree_LWout_wperm2, gb_tree_LWout_Jperd = tree_LWout_Jperd) %>%
  #removing double ID first column that appeared for some reason?
  select(-1)

##dead burned dataframe
avg_dt_transb_treeLW_db <- avg_dt_transb_treeLW_allstatuses %>%
  #filtering out only the correct burned status, daytime data, & transitional zone
  filter(zone == "transitional", phase == "day", burn_status == "dead burn") %>%
  rename(db_tree_LWout_MJd = tree_LWout_MJperd, db_treetemp_C = temp_C, db_tree_LWout_wperm2 = tree_LWout_wperm2, db_tree_LWout_Jperd = tree_LWout_Jperd) %>%
  #removing double ID first column that appeared for some reason?
  select(-1)

##unburned dataframe
avg_dt_transb_treeLW_ub <- avg_dt_transb_treeLW_allstatuses %>%
  #filtering out only the correct burned status, daytime data, & transitional zone
  filter(zone == "transitional", phase == "day", burn_status == "unburned") %>%
  rename(ub_tree_LWout_MJd = tree_LWout_MJperd, ub_treetemp_C = temp_C, ub_tree_LWout_wperm2 = tree_LWout_wperm2, ub_tree_LWout_Jperd = tree_LWout_Jperd) %>%
  #removing double ID first column that appeared for some reason?
  select(-1)
```

## Filtering Data

```{r}
filtered_transb_rad_wx <- transb_wx_15min %>%
  filter(datetime >= as.POSIXct("2024-02-02 00:00:00") & datetime <= as.POSIXct("2024-05-25 00:00:00")) %>%
   # Adding in date, time, and phase columns
  mutate(
    date = as.Date(datetime),
    time = format(datetime, "%H:%M:%S"),
    time_hms = hms::as_hms(time),  # Convert to hms object for phase calculation
    phase = case_when(
      time_hms >= hms::as_hms("08:00:00") & time_hms < hms::as_hms("17:00:00") ~ "day",
      time_hms < hms::as_hms("08:00:00") | time_hms >= hms::as_hms("17:00:00") ~ "night",
      TRUE ~ NA_character_)) %>%
      select(datetime, date, time, phase, SnowDepth_m, AirTC_Avg, SWin_Avg, SWout_Avg, SWalbedo_Avg, LWin_Avg, LWout_Avg, SWnet_Avg, LWnet_Avg, NR_Avg)
```

## Data Wrangling

Creating a daily average wx station dataframe, then converting to MJ/day

```{r}
#calculations for radiation conversions from W/m2 to MJ/day
## create a daily average dataframe
avg_dt_transb_rad_wx<- filtered_transb_rad_wx %>%
  group_by(date, phase) %>%
  summarize(across(everything(), mean, na.rm = TRUE)) %>%
  select(-c(datetime, time)) %>%
  group_by(date, phase) %>%
  # Convert mean radiation to MJ/day - assuming constent for m2 value
  mutate(SWin_MJd = (SWin_Avg/ 1e6) * 86400, SWout_MJd = (SWout_Avg/ 1e6) * 86400, LWin_MJd = (LWin_Avg/ 1e6) * 86400, LWout_MJd = (LWout_Avg/ 1e6) * 86400, SWnet_MJd = (SWnet_Avg / 1e6) * 86400, LWnet_MJd = (LWnet_Avg/ 1e6) * 86400, NR_MJd = (NR_Avg / 1e6) * 86400) %>%
  rename(SWin_wperm2 = SWin_Avg, SWout_wperm2 = SWout_Avg, SWnet_wperm2 = SWnet_Avg, LWin_wperm2 = LWin_Avg, LWout_wperm2 = LWout_Avg, LWnet_wperm2 = LWnet_Avg, NR_wperm2 = NR_Avg) %>%
  mutate(zone = "transitional", burn_status = "burned") %>%
  #filtering out only daytime values
  filter(phase == "day") %>%
  #reordering so the like values are next to each other
  select(date, phase, zone, burn_status, SnowDepth_m, AirTC_Avg, SWin_wperm2, SWin_MJd, SWout_wperm2, SWout_MJd, SWnet_wperm2, SWnet_MJd, SWalbedo_Avg, LWin_wperm2, LWin_MJd, LWout_wperm2, LWout_MJd, LWnet_wperm2, LWnet_MJd, NR_wperm2, NR_MJd) %>%
  #setting decimal number
   mutate(across(SnowDepth_m:last_col(), ~ round(., 4)))
```

```{r}
#filtering snow depth camera data
##transitional
filtered_transb_snowcamera_data <- transb_snowcamera_data %>%
  filter(date >= as.POSIXct("2024-02-02") & date <= as.POSIXct("2024-05-24")) %>%
  mutate(snowcam_max_depth_m = snowcam_max_depth_cm/100) %>%
  select(date, snowcam_max_depth_cm, snowcam_max_depth_m, conditions, treewell_developed) %>%
  mutate(treewell_developed = case_when(
    treewell_developed == "no snow" ~ "no",
    treewell_developed == "maybe" ~ "yes",
    TRUE ~ treewell_developed  # Keeps everything else the same
  ))

#creating a dataframe to use for plots that only has the days that treewells developed.
transb_treewell_dates <- filtered_transb_snowcamera_data %>%
  filter(treewell_developed == "yes") %>%
  #adding tree_LWout_data to the dataframe so that I can plot with the same y-axis
  inner_join(results_transb_comb_treeLWout) %>%
  select(date, treewell_developed, total_max_tree_LWout_MJd, total_min_tree_LWout_MJd, total_mean_tree_LWout_MJd)

##persistent
filtered_persb_snowcamera_data <- persb_snowcamera_data %>%
  filter(date >= as.POSIXct("2024-02-02") & date <= as.POSIXct("2024-05-24")) %>%
  mutate(snowcam_max_depth_m = snowcam_max_depth_cm/100) %>%
  select(date, snowcam_max_depth_cm, snowcam_max_depth_m, conditions, treewell_developed) %>%
  mutate(treewell_developed = case_when(
    treewell_developed == "no snow" ~ "no",
    treewell_developed == "maybe" ~ "yes",
    TRUE ~ treewell_developed  # Keeps everything else the same
  ))

#creating a dataframe to use for plots that only has the days that treewells developed.
persb_treewell_dates <- filtered_persb_snowcamera_data %>%
  filter(treewell_developed == "yes") %>%
  #adding tree_LWout_data to the dataframe so that I can plot with the same y-axis
  inner_join(results_persb_comb_treeLWout) %>%
  select(date, treewell_developed, total_max_tree_LWout_MJd, total_min_tree_LWout_MJd, total_mean_tree_LWout_MJd)
```

Combining data into one dataframe by burn_status

```{r}
##* I think I want to use this one, not the gb/db/ub, since there is such a small difference between the gb & db LWout values from trees
#by burned/unburned status
transb_comb_radtree <- avg_dt_transb_rad_wx %>%
  mutate(burn_status = "burned") %>%
  full_join(avg_dt_transb_treeLW_burned) %>%
  #recalculating NetRad, as I am not sure the calculations here are correct that are pulled from the weather station
  mutate(NR_MJd_wxs = (SWin_MJd - SWout_MJd) + (LWin_MJd - LWout_MJd)) %>%
  select(-datetime)
#answer is slightly different than weather-station calculated RN, use this value instead!
```

```{r}
#by gb/db/ub status
transb_comb_radtree_gb <- avg_dt_transb_rad_wx %>%
  mutate(burn_status = "green burn") %>%
  full_join(avg_dt_transb_treeLW_gb)

transb_comb_radtree_db <- avg_dt_transb_rad_wx %>%
  mutate(burn_status = "dead burn") %>%
  full_join(avg_dt_transb_treeLW_db)

#won't have data to work with for unburned plots comparison as I don't have drone imagery for this area yet
transb_comb_radtree_ub <- avg_dt_transb_rad_wx %>%
  mutate(burn_status = "unburned") %>%
  full_join(avg_dt_transb_treeLW_ub)
```

```{r}
#getting tree circumfirence max and min for all transitional albedo plots - this will help me ID what average circumference to use

##transitional
transb_treecircm_data <- albedoplots_treechar_alldata %>%
  #filtering for only transitional burned zone plots
  filter(PlotID %in% c("TLHM", "TLLM")) %>%
  select(PlotID, TreeNum, Species, DBH_cm, PreFire_Status) %>%
  mutate(DBH_m = DBH_cm / 100,
         circ_m = DBH_m * pi) %>%
  summarize(DBH_m_min = min(DBH_m),
    DBH_m_max = max(DBH_m),
    DBH_m_mean = mean(DBH_m),
    circ_m_min = min(circ_m),
    circ_m_max = max(circ_m),
    circ_m_mean = mean(circ_m)
  )

##persistent
persb_treecircm_data <- albedoplots_treechar_alldata %>%
  #filtering for only transitional burned zone plots
  filter(PlotID %in% c("PLHM", "PLLM")) %>%
  select(PlotID, TreeNum, Species, DBH_cm, PreFire_Status) %>%
  mutate(DBH_m = DBH_cm / 100,
         circ_m = DBH_m * pi) %>%
  summarize(DBH_m_min = min(DBH_m),
    DBH_m_max = max(DBH_m),
    DBH_m_mean = mean(DBH_m),
    circ_m_min = min(circ_m),
    circ_m_max = max(circ_m),
    circ_m_mean = mean(circ_m)
  )
```

```{r}
#setting values based on the min, max and mean circumference of the albedo plots - these will be used in later calculations
##transitional
t_min_circ_m <- 0.1979
t_max_circ_m <- 0.6158
t_mean_circ_m <- 0.4042

##persistent
p_min_circ_m <- 0.18845
p_max_circ_m <- 0.8954
p_mean_circ_m <- 0.4576

#setting constant for total plot area
##the same for both zones
total_plot_area_m2 = 35*35
```

Creating a dataframe to add in net tree LWout including all trees in plot area

```{r}
#there are 219 total burned trees in the transitional burned plot area
transb_comb_treeLWout <- avg_dt_transb_treeLW_burned %>%
  #adding in snow camera depths and treewell development
  inner_join(filtered_transb_snowcamera_data) %>%
  select(-c(datetime, zone, burn_status)) %>%
  crossing(transb_energytree_table) %>%
  select(-c(lat, long)) %>%
  mutate(min_circ_m = t_min_circ_m, max_circ_m = t_max_circ_m, mean_circ_m = t_mean_circ_m) %>%
  select(date, phase, zone, burn_status, tree_id, b_treetemp_C, b_tree_LWout_wperm2, b_tree_LWout_MJd, min_circ_m, max_circ_m, mean_circ_m, everything()) %>%
  mutate(min_area_m2 = min_circ_m * snowcam_max_depth_m, max_area_m2 = max_circ_m * snowcam_max_depth_m, mean_area_m2 = mean_circ_m * snowcam_max_depth_m)

#persistent
persb_comb_treeLWout <- avg_dt_persb_treeLW_burned %>%
  #adding in snow camera depths and treewell development
  inner_join(filtered_persb_snowcamera_data) %>%
  select(-c(datetime, zone, burn_status)) %>%
  crossing(transb_energytree_table) %>%
  select(-c(lat, long)) %>%
  mutate(min_circ_m = p_min_circ_m, max_circ_m = p_max_circ_m, mean_circ_m = p_mean_circ_m) %>%
  select(date, phase, zone, burn_status, tree_id, b_treetemp_C, b_tree_LWout_wperm2, b_tree_LWout_MJd, min_circ_m, max_circ_m, mean_circ_m, everything()) %>%
  mutate(min_area_m2 = min_circ_m * snowcam_max_depth_m, max_area_m2 = max_circ_m * snowcam_max_depth_m, mean_area_m2 = mean_circ_m * snowcam_max_depth_m)
```

```{r}
#starting a new dataframe to continue the work above
new_transb_comb_treeLWout <- transb_comb_treeLWout %>%
  #next step is to create a NEW tree_LWout_MJd that is multiplied by the area and olf MJ/day values in the dataframe.
  #calculating min MJ/day
  mutate(min_tree_LWout_MJd = (b_tree_LWout_wperm2*min_area_m2) * (86400/1e6)) %>%
  #calculating max MJ/day
  mutate(max_tree_LWout_MJd = (b_tree_LWout_wperm2*max_area_m2) * (86400/1e6)) %>%
  #calculating meam MJ/day
  mutate(mean_tree_LWout_MJd = (b_tree_LWout_wperm2*mean_area_m2) * (86400/1e6))

#results dataframe
results_transb_comb_treeLWout <- new_transb_comb_treeLWout %>%
  select(date, phase, zone, burn_status, tree_id, b_treetemp_C, b_tree_LWout_wperm2, min_tree_LWout_MJd, max_tree_LWout_MJd, mean_tree_LWout_MJd, min_circ_m, max_circ_m, mean_circ_m, min_area_m2, max_area_m2, mean_area_m2) %>%
  group_by(date, phase, zone) %>%
  summarize(total_min_tree_LWout_MJd = sum(min_tree_LWout_MJd), total_max_tree_LWout_MJd = sum(max_tree_LWout_MJd), total_mean_tree_LWout_MJd = sum(mean_tree_LWout_MJd), total_min_area_m2 = sum(min_area_m2), total_max_area_m2 = sum(max_area_m2), total_mean_area_m2 = sum(mean_area_m2))
```

```{r}
#calculating weather station total area based on tree-impacted area 
#mean dataframe
mean_dt_transb_radtree_comb<- avg_dt_transb_rad_wx %>%
  inner_join(results_transb_comb_treeLWout) %>%
  #creating a net radiation weather station parameter
  mutate(NR_MJd = SWin_MJd - SWout_MJd + LWin_MJd - LWout_MJd) %>%
  select(date, phase, zone, burn_status, SnowDepth_m, SWin_MJd, SWout_MJd, SWnet_MJd, SWalbedo_Avg, LWin_MJd, LWout_MJd, LWnet_MJd, NR_MJd, total_mean_tree_LWout_MJd, total_mean_area_m2) %>%
  rename(total_mean_tree_area_m2 = total_mean_area_m2) %>%
  #calculating the area of the weather station region's impacts 
  mutate(total_mean_wx_area_m2 = 1125-total_mean_tree_area_m2) %>%
  #calculating the net outgoing rad for the weather station data and removing the m2 unit by multiplying by the area that this weather station data is applied to
  mutate(mean_wx_NRin_MJd = (SWin_MJd + LWin_MJd) * total_mean_wx_area_m2, mean_wx_NRout_MJd = (SWout_MJd + LWout_MJd) * total_mean_wx_area_m2, mean_wx_netSW_MJd = (SWin_MJd - SWout_MJd) * total_mean_wx_area_m2, mean_wx_netLW_MJd = (LWin_MJd - LWout_MJd) * total_mean_wx_area_m2) %>%
  #calcuating the total net mean radiation for LWout (tree + weather station data, and SW)
  mutate(total_mean_netLW_MJd = mean_wx_netLW_MJd + total_mean_tree_LWout_MJd, total_mean_net_rad = ((SWin_MJd * total_mean_wx_area_m2)-(SWout_MJd * total_mean_wx_area_m2)) + ((LWin_MJd*total_mean_wx_area_m2)-(LWout_MJd*total_mean_wx_area_m2)) + total_mean_tree_LWout_MJd)
  
mean_dt_transb_radtree_comb <- mean_dt_transb_radtree_comb %>%
  rename(wx_NR_MJdm2 = NR_MJd)
```

```{r}
#creating a dataframe that gives me the fraction of the total net LW that the treeLWis
frac_mean_treeLWout_data <- mean_dt_transb_radtree_comb %>%
  select(date, phase, zone, burn_status, total_mean_netLW_MJd, total_mean_tree_LWout_MJd) %>%
  mutate(fraction_treeLWout_oftotal_netLW = total_mean_tree_LWout_MJd/total_mean_netLW_MJd) %>%
  #getting a monthly average fraction
  mutate(month = month(date)) %>%
  group_by(month) %>%
  summarize(monthly_frac_treeLWout = mean(fraction_treeLWout_oftotal_netLW)) %>%
  mutate(monthly_perc_treeLWout = monthly_frac_treeLWout*100) 
```

Equations used above for NetSW, NetLW, NetIncoming and NetOutgoing:

-   NetSW = SWin - SWout

-   NetLW = LWin - LWout

-   NetIncoming = SWin + LWin

-   NetOutgoing = SWout + LWout + LWout_tree

-   TotalNetRad = (SWin -SWout) + (LWin - LWout) + LWout_tree)

\*\* The above fraction values make me thing that I did the calculations wrong. As for month 4 it says that the treeLWout is 248 % of the monthly net LW... this is definitely wrong!

Min & Max dataframes

```{r}

#min dataframe
min_dt_transb_radtree_comb <- avg_dt_transb_rad_wx %>%
  inner_join(results_transb_comb_treeLWout) %>%
  #creating a net radiation weather station parameter
  mutate(NR_MJd = SWin_MJd - SWout_MJd + LWin_MJd - LWout_MJd) %>%
  select(date, phase, zone, burn_status, SnowDepth_m, SWin_MJd, SWout_MJd, SWnet_MJd, SWalbedo_Avg, LWin_MJd, LWout_MJd, LWnet_MJd, NR_MJd, total_min_tree_LWout_MJd, total_min_area_m2) %>%
  rename(total_min_tree_area_m2 = total_min_area_m2) %>%
  #calculating the area of the weather station region's impacts 
  mutate(total_min_wx_area_m2 = 1125-total_min_tree_area_m2) %>%
  #calculating the net outgoing rad for the weather station data and removing the m2 unit by multiplying by the area that this weather station data is applied to
  mutate(min_wx_NRin_MJd = (SWin_MJd + LWin_MJd) * total_min_wx_area_m2, min_wx_NRout_MJd = (SWout_MJd + LWout_MJd) * total_min_wx_area_m2, min_wx_netSW_MJd = (SWin_MJd - SWout_MJd) * total_min_wx_area_m2, min_wx_netLW_MJd = (LWin_MJd - LWout_MJd) * total_min_wx_area_m2) %>%
  #calcuating the total net mean radiation for LWout (tree + weather station data, and SW)
  mutate(total_min_netLW_MJd = min_wx_netLW_MJd + total_min_tree_LWout_MJd, total_min_net_rad = ((SWin_MJd * total_min_wx_area_m2)-(SWout_MJd * total_min_wx_area_m2)) + ((LWin_MJd*total_min_wx_area_m2)-((LWout_MJd*total_min_wx_area_m2))+total_min_tree_LWout_MJd))
  
min_dt_transb_radtree_comb <- min_dt_transb_radtree_comb %>%
  rename(wx_NR_MJdm2 = NR_MJd)

#max dataframe
max_dt_transb_radtree_comb <- avg_dt_transb_rad_wx %>%
  inner_join(results_transb_comb_treeLWout) %>%
  #creating a net radiation weather station parameter
  mutate(NR_MJd = SWin_MJd - SWout_MJd + LWin_MJd - LWout_MJd) %>%
  select(date, phase, zone, burn_status, SnowDepth_m, SWin_MJd, SWout_MJd, SWnet_MJd, SWalbedo_Avg, LWin_MJd, LWout_MJd, LWnet_MJd, NR_MJd, total_max_tree_LWout_MJd, total_max_area_m2) %>%
  rename(total_max_tree_area_m2 = total_max_area_m2) %>%
  #calculating the area of the weather station region's impacts 
  mutate(total_max_wx_area_m2 = 1125-total_max_tree_area_m2) %>%
  #calculating the net outgoing rad for the weather station data and removing the m2 unit by multiplying by the area that this weather station data is applied to
  mutate(max_wx_NRin_MJd = (SWin_MJd + LWin_MJd) * total_max_wx_area_m2, max_wx_NRout_MJd = (SWout_MJd + LWout_MJd) * total_max_wx_area_m2, max_wx_netSW_MJd = (SWin_MJd - SWout_MJd) * total_max_wx_area_m2, max_wx_netLW_MJd = (LWin_MJd - LWout_MJd) * total_max_wx_area_m2) %>%
  #calcuating the total net mean radiation for LWout (tree + weather station data, and SW)
  mutate(total_max_netLW_MJd = max_wx_netLW_MJd + total_max_tree_LWout_MJd, total_max_net_rad = ((SWin_MJd * total_max_wx_area_m2)-(SWout_MJd * total_max_wx_area_m2)) + ((LWin_MJd*total_max_wx_area_m2)-((LWout_MJd*total_max_wx_area_m2))+total_max_tree_LWout_MJd))
  
max_dt_transb_radtree_comb <- max_dt_transb_radtree_comb %>%
  rename(wx_NR_MJdm2 = NR_MJd)
```

## Calcs - adding in all trees to LWout data

```{r}
#dataframes seperates by burn_status

gb_transb_energytree_table <- transb_energytree_table %>%
  filter(burn_status == "gb")
#155 gb trees

db_transb_energy_treetabl <- transb_energytree_table %>%
  filter(burn_status == "db")
#64 db trees
```

## Plotting

```{r}
color_values_MJd <- c(
  "SWin_MJd" = "#D95F02",
  "SWout_MJd" = "#E6AB02",
  "LWout_MJd" = "#66A61E",
  "LWin_MJd" = "#2e5e39",
  "gb_tree_LWout_MJd" = "#7570B3",
  "db_tree_LWout_MJd" = "#2166AC")
# will need to include an unburned color later on if I include unburned data in these plot comparisons!

color_values_wperm2 <- c(
  "SWin_wperm2" = "#D95F02",
  "SWout_wperm2" = "#E6AB02",
  "LWout_wperm2" = "#66A61E",
  "LWin_wperm2" = "#2e5e39",
  "gb_tree_LWout_MJd" = "#7570B3",
  "db_tree_LWout_MJd" = "#2166AC")

# Define line types
line_types <- c(
  "Weather Station" = "solid",
  "Tree Temperature Sensors" = "dashed"
)

#changing labels of values in plots for the legend
color_labels <- c(
  "SWin_Avg" = "Shortwave In (Avg)",
  "SWout_Avg" = "Shortwave Out (Avg)",
  "LWin_Avg" = "Longwave In (Avg)",
  "LWout_Avg" = "Longwave Out (Avg)",
  "tree_LWout_avg_wperm2" = "Tree LW Out (Avg)"  # New label for the specific line
)
```

```{r}
#MJ/day plot
gb_combined_day_rad_wx_plot_MJd <- ggplot(data = transb_comb_radtree_gb) + 
  geom_line(aes(x = date, y = SWin_MJd, color = "SWin_MJd", linetype = "Weather Station"), linewidth = 0.6, alpha = 0.9) +
  geom_line(aes(x = date, y = SWout_MJd, color = "SWout_MJd", linetype = "Weather Station"), linewidth = 0.6, alpha = 0.8) +
  geom_line(aes(x = date, y = LWin_MJd, color = "LWin_MJd", linetype = "Weather Station"), linewidth = 0.7, alpha = 0.9) +
  geom_line(aes(x = date, y = LWout_MJd, color = "LWout_MJd", linetype = "Weather Station"), linewidth = 0.7) +
  geom_line(aes(x = date, y = gb_tree_LWout_MJd, color = "gb_tree_LWout_MJd", linetype = "Tree Temperature Sensors")) +
  facet_wrap(~ zone + burn_status, scales = "free_y", dir = "h") +  # Facet by zone and phase
  labs(
    #title = "Transitional Unburned",
    x = "Date",
    y = "Radiation components (MJ/day)",
    color = "Variable", 
    linetype = "Data Source"
    ) +
  theme_bw() +  # Use a minimal theme for a clean look
  scale_color_manual(values = color_values_MJd, labels = color_labels) + 
  scale_linetype_manual(values = line_types)

gb_combined_day_rad_wx_plot_MJd
```

```{r}
#W/m2 plot
gb_combined_day_rad_wx_plot_Wperm2 <- ggplot(data = transb_comb_radtree_gb) + 
  geom_line(aes(x = date, y = SWin_wperm2, color = "SWin_wperm2", linetype = "Weather Station"), linewidth = 0.6, alpha = 0.9) +
  geom_line(aes(x = date, y = SWout_wperm2, color = "SWout_wperm2", linetype = "Weather Station"), linewidth = 0.6, alpha = 0.8) +
  geom_line(aes(x = date, y = LWin_wperm2, color = "LWin_wperm2", linetype = "Weather Station"), linewidth = 0.7, alpha = 0.9) +
  geom_line(aes(x = date, y = LWout_wperm2, color = "LWout_wperm2", linetype = "Weather Station"), linewidth = 0.7) +
  geom_line(aes(x = date, y = gb_tree_LWout_wperm2, color = "gb_tree_LWout_wperm2", linetype = "Tree Temperature Sensors")) +
  facet_wrap(~ zone + burn_status, scales = "free_y", dir = "h") +  # Facet by zone and phase
  labs(
    #title = "Transitional Unburned",
    x = "Date",
    y = "Radiation components (W/m2)",
    color = "Variable", 
    linetype = "Data Source"
    ) +
  theme_bw() +  # Use a minimal theme for a clean look
  scale_color_manual(values = color_values_wperm2, labels = color_labels) +
  scale_linetype_manual(values = line_types)

combined_day_rad_wx_plot_Wperm2
```

\*\* interpretation of difference of MJperday and Wperm2 plots - the Wperm2 plot is showing second-timeframe data, not daily data, which means that the tree temps will be more equal in value to what the weather station is showing. The MJperday plot is showing a daily value for all the variables - once I add all the individual tree values together, perhaps the line for tree_LWout will increase a bit above zero?

Net Radiation Plots - by burn_status

-   the following graph is not really helpful yet, since I have not included all the tree_LWout values in the total net radiation value, that's why the tree_LWout values are plotted as higher than net rad from weather station

-   Need to finish calculations, then this plot can be used!

```{r}
#green burn net radiaiton from WX station and tree RLout
gb_netrad_plot <- ggplot() + 
  geom_col(data = transb_comb_radtree_gb, aes(x = date, y = NR_MJd, fill = "Net Radiation"), position = "stack") +  # Add fill aesthetic to legend
  geom_line(data = transb_comb_radtree_gb, aes(x = date, y = gb_tree_LWout_MJd, color = "Green burned LWout")) +
  geom_line(data = transb_comb_radtree_db, aes(x = date, y = db_tree_LWout_MJd, color = "Dead burned LWout")) +
  facet_wrap(~zone) +
  labs(
    x = "Date",
    y = "Radiation Component (MJ/day)") +
    scale_fill_manual(name = "Weather Station Data", values = "#2166AC") +
  scale_color_manual(
    name = "Tree Temp Sensor Data", 
    values = c("Green burned LWout" = "#1B7837",
               "Dead burned LWout" = "#D95F02")) +
  theme_bw()

gb_netrad_plot
```

```{r}
## only need this plot if I am seperating the net radiation plots by burned status, but the above plot now has the GB and DB data on it
#dead burn net radiaiton from WX station and tree RLout
db_netrad_plot <- ggplot(data = transb_comb_radtree_db) + 
  geom_col(aes(x = date, y = NR_MJd, fill = "Net Radiation (MJ/d)"), position = "stack") +  # Add fill aesthetic to legend
  geom_line(aes(x = date, y = db_tree_LWout_MJd, color = "Dead burned LWout (MJ/d)")) +
  facet_wrap(~zone + burn_status) +
  labs(
    x = "Date",
    y = "Radiation Component (MJ/day)") +
    scale_fill_manual(name = "Weather Station Data", values = "#2166AC") +                         # Custom fill color
  scale_color_manual(name = "Tree Temp Sensor Data", values = "#D95F02") +
  theme_bw()

db_netrad_plot
```

Plotting net SW and LW to see if this matched wyatts data?

```{r}
netrad_plot <- ggplot(data = transb_comb_radtree_data) +
  geom_col(aes(x = date, y = SWnet_wperm2, fill = "SWnet_wperm2"), position = "stack") +
  geom_col(aes(x = date, y = LWnet_wperm2, fill = "LWnet_wperm2"), position = "stack") +
   labs(x = "Date", y = "Net Radiation (W/m²)", fill = "Radiation Type") +
  scale_fill_manual(values = c("SWnet_wperm2" = "orange", "LWnet_wperm2" = "blue")) +  # Custom colors
  theme_bw()

netrad_plot
```

\*creating a bar plot for radiation and a

Looking at Tree LWout Burn Status Differences

```{r}
tree_LWout_data <- ggplot() +
  geom_line(data = avg_dt_transb_treeLW_gb, aes(x = date, y = tree_LWout_MJd), color = "green") +
    geom_line(data = avg_dt_transb_treeLW_db, aes(x = date, y = tree_LWout_MJd), color = "red") +
    geom_line(data = avg_dt_transb_treeLW_ub, aes(x = date, y = tree_LWout_MJd), color = "blue")

tree_LWout_data
```

## New Net Rad Plots - from 2024.09.18

```{r}
#use final_dt_transb_radtree_comb_data for plotting only Net Radiation values

##mean values for tree LWout data
mean_NR_plot <- ggplot() + 
  geom_line(data = mean_dt_transb_radtree_comb, aes(x = date, y = total_mean_netLW_MJd, color = "Net Longwave Radiation of total plot area")) +  
  geom_line(data = mean_dt_transb_radtree_comb, aes(x = date, y = total_mean_tree_LWout_MJd, color = "Total burned trees LWout")) +
  geom_point(data = transb_treewell_dates, aes(x = date, y = mean_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  
  facet_wrap(~zone + burn_status) +
  
  labs(
    title = "Mean Values",
    x = "Date",
    y = "Radiation Component (MJ/day)"
  ) +
  scale_color_manual(name = "Radiation Data", 
                     values = c("Net Longwave Radiation of total plot area" = "#2166AC",
                                "Total burned trees LWout" = "#D95F02"),
                     labels = c("Net Longwave Radiation of total plot area",
                                "Total burned trees LWout")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()

mean_NR_plot

min_NR_plot <- ggplot() + 
  geom_line(data = final_dt_transb_radtree_comb_data, aes(x = date, y = total_min_NRl_MJd, color = "Net Longwave Radiation of total plot area")) +  
  geom_line(data = final_dt_transb_radtree_comb_data, aes(x = date, y = total_min_tree_LWout_MJd, color = "Total burned trees LWout")) +
  geom_point(data = transb_treewell_dates, aes(x = date, y = total_min_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  
  facet_wrap(~zone + burn_status) +
  
  labs(
    title = "Minimum Values",
    x = "Date",
    y = "Radiation Component (MJ/day)"
  ) +
  scale_color_manual(name = "Radiation Data", 
                     values = c("Net Longwave Radiation of total plot area" = "#2166AC",
                                "Total burned trees LWout" = "#D95F02"),
                     labels = c("Net Longwave Radiation of total plot area",
                                "Total burned trees LWout")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()

min_NR_plot

max_NR_plot <- ggplot() + 
  geom_line(data = final_dt_transb_radtree_comb_data, aes(x = date, y = total_max_NRl_MJd, color = "Net Longwave Radiation of total plot area")) +  
  geom_line(data = final_dt_transb_radtree_comb_data, aes(x = date, y = total_max_tree_LWout_MJd, color = "Total burned trees LWout")) +
  geom_point(data = transb_treewell_dates, aes(x = date, y = total_max_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  
  facet_wrap(~zone + burn_status) +
  
  labs(
    title = "Max Values",
    x = "Date",
    y = "Radiation Component (MJ/day)"
  ) +
  scale_color_manual(name = "Radiation Data", 
                     values = c("Net Longwave Radiation of total plot area" = "#2166AC",
                                "Total burned trees LWout" = "#D95F02"),
                     labels = c("Net Longwave Radiation of total plot area",
                                "Total burned trees LWout")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()


max_NR_plot
```

Arranging plots into one png

```{r}
combined_NR_plots <- ggarrange(min_NR_plot, max_NR_plot, mean_NR_plot, nrow = 1, ncol = 3, common.legend = TRUE, legend = "right")

combined_NR_plots
```

Plots above seem to have very large values for total RN, which is likely because I've multiplied that value by the area of the plot... maybe I don't need to multiply the weather station area?

Below plot is the version with a line instead of a dot to denote when treewells developed

```{r}
max_NR_plot <- ggplot() + 
  geom_line(data = final_dt_transb_radtree_comb_data, aes(x = date, y = total_max_NRl_MJd, color = "Net Longwave Radiation of total plot area")) +  
  geom_line(data = final_dt_transb_radtree_comb_data, aes(x = date, y = total_max_tree_LWout_MJd, color = "Total burned trees LWout")) +
  geom_segment(data = transb_treewell_dates, aes(x = date, xend = date, y = -Inf, yend = Inf), color = "black", linetype = "solid", alpha = 0.4) +
  facet_wrap(~zone + burn_status) +
  labs(
    title = "Mean Values",
    x = "Date",
    y = "Radiation Component (MJ/day)") +
  scale_color_manual(name = "Radiation Data", 
                     values = c("Net Longwave Radiation of total plot area" = "#2166AC",
                                "Total burned trees LWout" = "#D95F02")) +
  theme_bw()


max_NR_plot
```

Newest Plots - as of EOD 2024.09.18

### Mean Radiation Data Plots - Bar versions

```{r}
#using individual dataframes for mean, min and max values

mean_NetLW_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = mean_dt_transb_radtree_comb, aes(x = date, y = total_mean_netLW_MJd), fill = "#1B7837", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = mean_dt_transb_radtree_comb, aes(x = date, y = total_mean_tree_LWout_MJd, color = "Total burned trees LWout")) +
  
  # Point plot for treewell development dates
  geom_point(data = transb_treewell_dates, aes(x = date, y = total_mean_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  facet_wrap(~zone + burn_status) +
  labs(
    #title = "Mean Values",
    x = "Date",
    y = "Net LW Rad (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout" = "#D95F02"),
                     labels = c("Total burned trees LWout")) +
  #scale_fill_manual(name = "Radiation Data", 
                     #values = c("Net Longwave Radiation of total plot area" = "#1B7837"),
                    # labels = c("Net Longwave Radiation of total plot area")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()


mean_NetLW_plot
```

```{r}
#mean net SW plot
mean_NetSW_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = mean_dt_transb_radtree_comb, aes(x = date, y = mean_wx_netSW_MJd), fill = "#2166AC", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = mean_dt_transb_radtree_comb, aes(x = date, y = total_mean_tree_LWout_MJd, color = "Total burned trees LWout")) +
  # Point plot for treewell development dates
  geom_point(data = transb_treewell_dates, aes(x = date, y = total_mean_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  facet_wrap(~zone + burn_status) +
  labs(
    #title = "Mean Values",
    x = "Date",
    y = "Net SW Rad (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout" = "#D95F02"),
                     labels = c("Total burned trees LWout")) +
  #scale_fill_manual(name = "Radiation Data", 
                     #values = c("Net Shortwave Radiation of total plot area" = "#2166AC"),
                     #labels = c("Net Shortwave Radiation of total plot area")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()

mean_NetSW_plot
```

```{r}
mean_NetRad_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = mean_dt_transb_radtree_comb, aes(x = date, y = total_mean_net_rad), fill = "#666666", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = mean_dt_transb_radtree_comb, aes(x = date, y = total_mean_tree_LWout_MJd, color = "Total burned trees LWout")) +
  # Point plot for treewell development dates
  geom_point(data = transb_treewell_dates, aes(x = date, y = total_mean_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  facet_wrap(~zone + burn_status) +
  labs(
    #title = "Mean Data Values",
    x = "Date",
    y = "Total Net Radiation (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout" = "#D95F02"),
                     labels = c("Total burned trees LWout")) +
  #scale_fill_manual(name = "Radiation Data", 
                     #values = c("Total Net Radiation of plot area" = "#666666"),
                     #labels = c("Total Net Radiation of plot area")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()

mean_NetRad_plot
```

```{r}
#combining and saving NetSW, NetLW and NetRad plots
combined_mean_NR_plots <- ggarrange(mean_NetSW_plot, mean_NetLW_plot, mean_NetRad_plot, nrow = 3, ncol = 1, common.legend = TRUE, legend = "right") %>%
  annotate_figure(combined_NR_plots, top = text_grob("Mean Data Values", 
               color = "black", size = 14))

combined_mean_NR_plots
```

I don't think I'll need the following plots, but not sure yet

```{r}
#total net Incoming radiation
mean_NetIn_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = mean_dt_transb_radtree_comb, aes(x = date, y = mean_wx_NRin_MJd, fill = "Total Net Incoming Radiation of plot area"), position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = mean_dt_transb_radtree_comb, aes(x = date, y = total_mean_tree_LWout_MJd, color = "Total burned trees LWout")) +
  # Point plot for treewell development dates
  geom_point(data = transb_treewell_dates, aes(x = date, y = total_mean_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  facet_wrap(~zone + burn_status) +
  labs(
    title = "Mean Values",
    x = "Date",
    y = "Radiation Component (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout" = "#D95F02"),
                     labels = c("Total burned trees LWout")) +
  scale_fill_manual(name = "Radiation Data", 
                     values = c("Total Net Incoming Radiation of plot area" = "#2166AC"),
                     labels = c("Total Net Incoming Radiation of plot area")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()

mean_NetIn_plot
```

```{r}
#total net Incoming radiation
mean_NetOut_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = mean_dt_transb_radtree_comb, aes(x = date, y = mean_wx_NRout_MJd, fill = "Total Net Outgoing Radiation of plot area"), position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = mean_dt_transb_radtree_comb, aes(x = date, y = total_mean_tree_LWout_MJd, color = "Total burned trees LWout")) +
  # Point plot for treewell development dates
  geom_point(data = transb_treewell_dates, aes(x = date, y = total_mean_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  facet_wrap(~zone + burn_status) +
  labs(
    title = "Mean Values",
    x = "Date",
    y = "Radiation Component (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout" = "#D95F02"),
                     labels = c("Total burned trees LWout")) +
  scale_fill_manual(name = "Radiation Data", 
                     values = c("Total Net Outgoing Radiation of plot area" = "#1B7837"),
                     labels = c("Total Net Outgoing Radiation of plot area")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()

mean_NetOut_plot
```

```{r}
#arranging mean plots and exporting

mean_combined_plots <- ggarrange()
```

### Min Radiation Data Plots - Bar versions

```{r}
min_NetLW_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = min_dt_transb_radtree_comb, aes(x = date, y = total_min_netLW_MJd), fill = "#1B7837", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = min_dt_transb_radtree_comb, aes(x = date, y = total_min_tree_LWout_MJd, color = "Total burned trees LWout")) +
  
  # Point plot for treewell development dates
  geom_point(data = transb_treewell_dates, aes(x = date, y = total_min_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  facet_wrap(~zone + burn_status) +
  labs(
    #title = "Mean Values",
    x = "Date",
    y = "Net LW Rad (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout" = "#D95F02"),
                     labels = c("Total burned trees LWout")) +
  #scale_fill_manual(name = "Radiation Data", 
                     #values = c("Net Longwave Radiation of total plot area" = "#1B7837"),
                    # labels = c("Net Longwave Radiation of total plot area")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()


min_NetLW_plot
```

```{r}
#min net SW plot
min_NetSW_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = min_dt_transb_radtree_comb, aes(x = date, y = min_wx_netSW_MJd), fill = "#2166AC", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = min_dt_transb_radtree_comb, aes(x = date, y = total_min_tree_LWout_MJd, color = "Total burned trees LWout")) +
  # Point plot for treewell development dates
  geom_point(data = transb_treewell_dates, aes(x = date, y = total_min_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  facet_wrap(~zone + burn_status) +
  labs(
    #title = "Mean Values",
    x = "Date",
    y = "Net SW Rad (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout" = "#D95F02"),
                     labels = c("Total burned trees LWout")) +
  #scale_fill_manual(name = "Radiation Data", 
                     #values = c("Net Shortwave Radiation of total plot area" = "#2166AC"),
                     #labels = c("Net Shortwave Radiation of total plot area")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()

min_NetSW_plot
```

```{r}
min_NetRad_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = min_dt_transb_radtree_comb, aes(x = date, y = total_min_net_rad), fill = "#666666", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = min_dt_transb_radtree_comb, aes(x = date, y = total_min_tree_LWout_MJd, color = "Total burned trees LWout")) +
  # Point plot for treewell development dates
  geom_point(data = transb_treewell_dates, aes(x = date, y = total_min_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  facet_wrap(~zone + burn_status) +
  labs(
    #title = "Mean Data Values",
    x = "Date",
    y = "Total Net Radiation (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout" = "#D95F02"),
                     labels = c("Total burned trees LWout")) +
  #scale_fill_manual(name = "Radiation Data", 
                     #values = c("Total Net Radiation of plot area" = "#666666"),
                     #labels = c("Total Net Radiation of plot area")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()

min_NetRad_plot
```

```{r}
#combining and saving NetSW, NetLW and NetRad plots
combined_min_NR_plots <- ggarrange(min_NetSW_plot, min_NetLW_plot, min_NetRad_plot, nrow = 3, ncol = 1, common.legend = TRUE, legend = "right") %>%
  annotate_figure(combined_NR_plots, top = text_grob("Minimum Data Values", 
               color = "black", size = 14))

combined_min_NR_plots
```

### Max Radiation Data Plots - Bar versions

```{r}
max_NetLW_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = max_dt_transb_radtree_comb, aes(x = date, y = total_max_netLW_MJd), fill = "#1B7837", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = max_dt_transb_radtree_comb, aes(x = date, y = total_max_tree_LWout_MJd, color = "Total burned trees LWout")) +
  
  # Point plot for treewell development dates
  geom_point(data = transb_treewell_dates, aes(x = date, y = total_max_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  facet_wrap(~zone + burn_status) +
  labs(
    #title = "Mean Values",
    x = "Date",
    y = "Net LW Rad (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout" = "#D95F02"),
                     labels = c("Total burned trees LWout")) +
  #scale_fill_manual(name = "Radiation Data", 
                     #values = c("Net Longwave Radiation of total plot area" = "#1B7837"),
                    # labels = c("Net Longwave Radiation of total plot area")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()


max_NetLW_plot
```

```{r}
#max net SW plot
max_NetSW_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = max_dt_transb_radtree_comb, aes(x = date, y = max_wx_netSW_MJd), fill = "#2166AC", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = max_dt_transb_radtree_comb, aes(x = date, y = total_max_tree_LWout_MJd, color = "Total burned trees LWout")) +
  # Point plot for treewell development dates
  geom_point(data = transb_treewell_dates, aes(x = date, y = total_max_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  facet_wrap(~zone + burn_status) +
  labs(
    #title = "Mean Values",
    x = "Date",
    y = "Net SW Rad (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout" = "#D95F02"),
                     labels = c("Total burned trees LWout")) +
  #scale_fill_manual(name = "Radiation Data", 
                     #values = c("Net Shortwave Radiation of total plot area" = "#2166AC"),
                     #labels = c("Net Shortwave Radiation of total plot area")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()

min_NetSW_plot
```

```{r}
max_NetRad_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = max_dt_transb_radtree_comb, aes(x = date, y = total_max_net_rad), fill = "#666666", position = "stack", alpha = 0.8) +
  # Line plot for Total burned trees LWout
  geom_line(data = max_dt_transb_radtree_comb, aes(x = date, y = total_max_tree_LWout_MJd, color = "Total burned trees LWout")) +
  # Point plot for treewell development dates
  geom_point(data = transb_treewell_dates, aes(x = date, y = total_max_tree_LWout_MJd, shape = "Dates that treewells developed"), fill = "black", size = 1) + 
  facet_wrap(~zone + burn_status) +
  labs(
    #title = "Mean Data Values",
    x = "Date",
    y = "Total Net Radiation (MJ/day)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("Total burned trees LWout" = "#D95F02"),
                     labels = c("Total burned trees LWout")) +
  #scale_fill_manual(name = "Radiation Data", 
                     #values = c("Total Net Radiation of plot area" = "#666666"),
                     #labels = c("Total Net Radiation of plot area")) +
  scale_shape_manual(name = "Treewell Data", 
                     values = c("Dates that treewells developed" = 21)) +
  theme_bw()

min_NetRad_plot
```

```{r}
#combining and saving NetSW, NetLW and NetRad plots
combined_max_NR_plots <- ggarrange(max_NetSW_plot, max_NetLW_plot, max_NetRad_plot, nrow = 3, ncol = 1, common.legend = TRUE, legend = "right") %>%
  annotate_figure(combined_NR_plots, top = text_grob("Maximum Data Values", 
               color = "black", size = 14))

combined_max_NR_plots
```

\*\* next steps - need to pull in persistent data and do the same data wrangling for that data, then plot

# Persistent Data

## Calling in Data

```{r}
persb_energytree_table <- read_csv("nsf/drone_imagery/pers_b_energy_tree_table.csv") %>%
  mutate(zone = "persistent") %>%
  rename(burn_status = burn_statu) %>%
  #adding a tree_id column
  mutate(tree_id = row_number()) %>%
  #selecting columns I want
  select(tree_id, zone, burn_status, lat, long)

#this is the csv that has tree diameters for albedo plots on it, use this to choose an average circumference
albedoplots_treechar_alldata <- read_csv("nsf/albedo/albedoplots_treechar_alldata.csv")

#this is the csv that has camera snow depths and if tree wells appeared or not from 105E_transb_snowcamera
persb_snowcamera_data <- read_csv("nsf/camera_snowdepths/2024_persb_lp_highmort_east_snowdepths.csv") %>%
  rename(snowcam_max_depth_cm = "max_depth_cm") %>%
  mutate(date = as.Date(date))

persb_wx_hourly <- read_csv("nsf/pers_burned/pers_burned_wx_hourly_r.csv") %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")), datetime = force_tz(datetime, tz = 'MST'))
```

```{r}

#seperating by burned/unburned
##burned
avg_dt_persb_treeLW_burned <- read_csv("nsf/105E_trans_burned/day_avg_filtered_treeLWout_data_bub.csv") %>%
  filter(zone == "persistent", phase == "day", burn_status == "burned") %>%
  rename(b_tree_LWout_MJd = tree_LWout_MJperd, b_treetemp_C = temp, b_tree_LWout_wperm2 = tree_LWout_wperm2)

##unburned
avg_dt_persb_treeLW_unburned <- read_csv("nsf/105E_trans_burned/day_avg_filtered_treeLWout_data_bub.csv") %>%
  filter(zone == "persistent", phase == "day", burn_status == "unburned") %>%
  rename(ub_tree_LWout_MJd = tree_LWout_MJperd, ub_treetemp_C = temp, ub_tree_LWout_wperm2 = tree_LWout_wperm2)

#seperating by tree burn status - gb/db/ub - this dataframe includes all burn status types
avg_dt_transb_treeLW_allstatuses <- read_csv("nsf/105E_trans_burned/day_avg_filtered_treeLWout_data_gbdbub.csv")

##green burned dataframe
avg_dt_persb_treeLW_gb <- avg_dt_transb_treeLW_allstatuses %>%
  #filtering out only the correct burned status, daytime data, & transitional zone
  filter(zone == "persistent", phase == "day", burn_status == "green burn") %>%
  rename(gb_tree_LWout_MJd = tree_LWout_MJperd, gb_treetemp_C = temp_C, gb_tree_LWout_wperm2 = tree_LWout_wperm2, gb_tree_LWout_Jperd = tree_LWout_Jperd) %>%
  #removing double ID first column that appeared for some reason?
  select(-1)

##dead burned dataframe
avg_dt_persb_treeLW_db <- avg_dt_transb_treeLW_allstatuses %>%
  #filtering out only the correct burned status, daytime data, & transitional zone
  filter(zone == "persistent", phase == "day", burn_status == "dead burn") %>%
  rename(db_tree_LWout_MJd = tree_LWout_MJperd, db_treetemp_C = temp_C, db_tree_LWout_wperm2 = tree_LWout_wperm2, db_tree_LWout_Jperd = tree_LWout_Jperd) %>%
  #removing double ID first column that appeared for some reason?
  select(-1)

##unburned dataframe
avg_dt_persb_treeLW_ub <- avg_dt_transb_treeLW_allstatuses %>%
  #filtering out only the correct burned status, daytime data, & transitional zone
  filter(zone == "persistent", phase == "day", burn_status == "unburned") %>%
  rename(ub_tree_LWout_MJd = tree_LWout_MJperd, ub_treetemp_C = temp_C, ub_tree_LWout_wperm2 = tree_LWout_wperm2, ub_tree_LWout_Jperd = tree_LWout_Jperd) %>%
  #removing double ID first column that appeared for some reason?
  select(-1)
```

Filtering Wx Persistent Data

```{r}
filtered_persb_rad_wx <- persb_wx_hourly %>%
  filter(datetime >= as.POSIXct("2024-02-02 00:00:00") & datetime <= as.POSIXct("2024-05-25 00:00:00")) %>%
   # Adding in date, time, and phase columns
  mutate(
    date = as.Date(datetime),
    time = format(datetime, "%H:%M:%S"),
    time_hms = hms::as_hms(time),  # Convert to hms object for phase calculation
    phase = case_when(
      time_hms >= hms::as_hms("08:00:00") & time_hms < hms::as_hms("17:00:00") ~ "day",
      time_hms < hms::as_hms("08:00:00") | time_hms >= hms::as_hms("17:00:00") ~ "night",
      TRUE ~ NA_character_)) %>%
      select(datetime, date, time, phase, SnowDepth_m, AirTC_Avg, SWin_Avg, SWout_Avg, SWalbedo_Avg, LWin_Avg, LWout_Avg, SWnet_Avg, LWnet_Avg, NR_Avg)
```

Data Wrangling

```{r}
#calculations for radiation conversions from W/m2 to MJ/day
## create a daily average dataframe
avg_dt_persb_rad_wx<- filtered_persb_rad_wx %>%
  group_by(date, phase) %>%
  summarize(across(everything(), mean, na.rm = TRUE)) %>%
  select(-c(datetime, time)) %>%
  group_by(date, phase) %>%
  # Convert mean radiation to MJ/day - assuming constent for m2 value
  mutate(SWin_MJd = (SWin_Avg/ 1e6) * 86400, SWout_MJd = (SWout_Avg/ 1e6) * 86400, LWin_MJd = (LWin_Avg/ 1e6) * 86400, LWout_MJd = (LWout_Avg/ 1e6) * 86400, SWnet_MJd = (SWnet_Avg / 1e6) * 86400, LWnet_MJd = (LWnet_Avg/ 1e6) * 86400, NR_MJd = (NR_Avg / 1e6) * 86400) %>%
  rename(SWin_wperm2 = SWin_Avg, SWout_wperm2 = SWout_Avg, SWnet_wperm2 = SWnet_Avg, LWin_wperm2 = LWin_Avg, LWout_wperm2 = LWout_Avg, LWnet_wperm2 = LWnet_Avg, NR_wperm2 = NR_Avg) %>%
  mutate(zone = "persistent", burn_status = "burned") %>%
  #filtering out only daytime values
  filter(phase == "day") %>%
  #reordering so the like values are next to each other
  select(date, phase, zone, burn_status, SnowDepth_m, AirTC_Avg, SWin_wperm2, SWin_MJd, SWout_wperm2, SWout_MJd, SWnet_wperm2, SWnet_MJd, SWalbedo_Avg, LWin_wperm2, LWin_MJd, LWout_wperm2, LWout_MJd, LWnet_wperm2, LWnet_MJd, NR_wperm2, NR_MJd) %>%
  #setting decimal number
   mutate(across(SnowDepth_m:last_col(), ~ round(., 4)))
```

```{r}
##* I think I want to use this one, not the gb/db/ub, since there is such a small difference between the gb & db LWout values from trees
#by burned/unburned status
persb_comb_radtree <- avg_dt_persb_rad_wx %>%
  mutate(burn_status = "burned") %>%
  full_join(avg_dt_persb_treeLW_burned) %>%
  #recalculating NetRad, as I am not sure the calculations here are correct that are pulled from the weather station
  mutate(NR_MJd_wxs = (SWin_MJd - SWout_MJd) + (LWin_MJd - LWout_MJd)) %>%
  select(-datetime)
#answer is slightly different than weather-station calculated RN, use this value instead!

```
