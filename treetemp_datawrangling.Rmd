---
title: "treetemp_datawrangling"
author: "Erika Lee"
date: "2024-06-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Data Wrangling

```{r}
library(tidyverse)
library(lterdatasampler)
library(dplyr)
library(ggplot2)
library(readr)
library(readxl)
library(lubridate)
library(plotly)
library(openxlsx)
library(plotly)
library(rstatix)
library(htmlwidgets)
library(RColorBrewer)
library(patchwork)

setwd("/Volumes/wcnr-network/Research/Kampf/Private/field_data")
```

### Calling in data

```{r}
#calling in tree temp data from n-drive
## burned
pers_b_aspects <- read_excel("nsf/105E_pers_burned/105E_pers_b_aspects.xlsx") %>%
  mutate(datetime = ymd_hms(datetime))

trans_b_aspects <- read_excel("nsf/105E_trans_burned/105E_trans_b_aspects.xlsx") %>%
  mutate(datetime = ymd_hms(datetime))

#pers_n_gb_temp <- read_excel("nsf/105E_pers_burned/pers_n_gb_temp.xlsx")

#pers_n_db_temp <- read_excel("nsf/105E_pers_burned/pers_n_db_temp.xlsx")

#pers_s_gb_temp <- read_excel("nsf/105E_pers_burned/pers_s_gb_temp.xlsx")

#pers_s_db_temp <- read_excel("nsf/105E_pers_burned/pers_s_db_temp.xlsx")

#trans_n_gb_temp <- read_excel("nsf/105E_trans_burned/trans_n_gb_temp.xlsx")

#trans_n_db_temp <- read_excel("nsf/105E_trans_burned/trans_n_db_temp.xlsx")

#trans_s_gb_temp <- read_excel("nsf/105E_trans_burned/trans_s_gb_temp.xlsx")

#trans_s_db_temp <- read_excel("nsf/105E_trans_burned/trans_s_db_temp.xlsx")

##unburned
pers_ub_aspects <- read_excel("nsf/105E_pers_unburned/105E_pers_ub_aspects.xlsx") %>%
  mutate(datetime = ymd_hms(datetime))

trans_ub_aspects <- read_excel("nsf/105E_trans_unburned/105E_trans_ub_aspects.xlsx") %>%
  mutate(datetime = ymd_hms(datetime))
```

```{r}
#manipulating trans unburned weather station data - ONLY run if you add new data to the trans_unburned composite excel sheet

transub_wx_15min <- read_excel("nsf/trans_unburned/trans_ub_wx_composite.xlsx") %>%
  #convert 5 min timestep to 15 minute timestep
  # Ensure the timestamp column is in datetime format
  mutate(TIMESTAMP = ymd_hms(TIMESTAMP)) %>%
  # Create a new column for 15-minute intervals
  mutate(interval = floor_date(TIMESTAMP, unit = "15 minutes")) %>%
  # Group by the 15-minute interval
  group_by(interval) %>%
  # Calculate the mean for all other columns
summarize(across(where(is.numeric), mean, na.rm = TRUE), .groups = 'drop') %>%  # Rename 'interval' to 'datetime' and remove the original 'datetime' column
  rename(datetime = interval) %>%
  #renaming columns to match trans/pers burned
  rename(Batt_volt = BattV_Avg) %>%
  rename(AirTC_Avg = AirTemp_Avg) %>%
  rename(RH = RH_Avg) %>%
  rename(WS_ms_Avg = WindSpeed) %>%
  rename(SnowDepth_m = SnowDepth_Avg) %>%
  select(datetime, RECORD, Batt_volt, SnowDepth_m, AirTC_Avg, WS_ms_Avg, WindDir, RH, SWin_Avg, SWout_Avg, SWalbedo_Avg, LWin_Avg, LWout_Avg, SWnet_Avg, LWnet_Avg, NR_Avg, everything() )
  
#writing the 15min trans_ub weather to the n-drive
write.xlsx(transub_wx_15min, "nsf/trans_unburned/trans_unburned_wx_15min_r.xlsx")
```

```{r}
#calling in weather station data from n-drive
##persistent zone
persb_wx_15min <- read_excel("nsf/pers_burned/pers_burned_wx_15min_r.xlsx")

persub_wx_15min <- read_excel("nsf/pers_unburned/pers_unburned_wx_15min_composite.xlsx")

##transitional
transb_wx_15min <- read_excel("nsf/trans_burned/trans_burned_wx_15min_r.xlsx")

transub_wx_15min <- read_excel("nsf/trans_unburned/trans_ub_wx_15min_r.xlsx")
```

### Renaming weather dataframe columns so they match

```{r}
#matching the transitional and persistent weather station headers
transb_wx_15min <- transb_wx_15min %>%
  rename(AirTC_Avg = AirT_C) %>%
  rename(RH = RH_percent) %>%
  rename(WS_ms_Avg = `WS_m/s`) %>%
  rename(WindDir = WindDir_deg) %>%
  rename(NR_Avg = RN_Avg) %>%
  rename(SWalbedo_Avg = SW_albedo) %>%
  #reordering dataframe
  select(datetime, RECORD, Batt_volt, SnowDepth_m, AirTC_Avg, WS_ms_Avg, WindDir, RH, SWin_Avg, SWout_Avg, SWalbedo_Avg, LWin_Avg, LWout_Avg, SWnet_Avg, LWnet_Avg, NR_Avg, everything() )

write.xlsx(transb_wx_15min, "nsf/trans_burned/trans_burned_wx_15min_r.xlsx")

#reordering persistent weather station data
##pers burned
persb_wx_15min <- persb_wx_15min %>%
  rename(Batt_volt = BattV_Min) %>%
  #timestamp column is UTC time
  rename(SnowDepth_m = DBTCDT_Avg) %>%
  #applying offset to snow depth column for the pers_burned zone
  mutate(SnowDepth_m = (SnowDepth_m-0.03)) %>%
  select(datetime,TIMESTAMP, RECORD, Batt_volt, SnowDepth_m, AirTC_Avg, WS_ms_Avg, WindDir, RH, SWin_Avg, SWout_Avg, SWalbedo_Avg, LWin_Avg, LWout_Avg, SWnet_Avg, LWnet_Avg, NR_Avg, everything())

write.xlsx(persb_wx_15min, "nsf/pers_burned/pers_burned_wx_15min_r.xlsx")

##pers unburned
persub_wx_15min <- persub_wx_15min %>%
  rename(Batt_volt = BattV_Min) %>%
  rename(SnowDepth_m = DBTCDT_Avg) %>%
  #creating an RH average column to match pers burned and trans burned dataframes
  mutate(RH = mean(c(RH_Min, RH_Max))) %>%
  #changing timestamp column from UTC to MST
  mutate(datetime = with_tz(TIMESTAMP, "America/Denver")) %>%
  filter(datetime >= ymd_hms("2023-12-07 00:00:00", tz = 'MST')) %>%
  select(datetime,TIMESTAMP, RECORD, Batt_volt, SnowDepth_m, AirTC_Avg, WS_ms_Avg, WindDir, RH, SWin_Avg, SWout_Avg, SWalbedo_Avg, LWin_Avg, LWout_Avg, SWnet_Avg, LWnet_Avg, NR_Avg, everything())

##writing edited persistent unburned dataframe to n-drive
write.xlsx(persub_wx_15min, "nsf/pers_unburned/pers_unburned_wx_15min_r.xlsx")
```

### Setting consistent timeframe

```{r}
#setting a consistent timeframe for all tree temp data for all burned/unburned zones
##has to start at 2024-02-02 due to errors in data at transitional burned site

#tree temp dataframes
start_time <- ymd_hms("2024-02-02 00:00:00")
end_time <- ymd_hms("2024-05-24 00:00:00")

filtered_pers_b_aspects <- pers_b_aspects %>%
  filter(datetime >= start_time & datetime <= end_time)

filtered_pers_ub_aspects <- pers_ub_aspects %>%
  filter(datetime >= start_time & datetime <= end_time)

filtered_trans_b_aspects <- trans_b_aspects %>%
  filter(datetime >= start_time & datetime <= end_time)

filtered_trans_ub_aspects <- trans_ub_aspects %>%
  filter(datetime >= start_time & datetime <= end_time)
```

```{r}
#setting consistent timeframe for weather data
#filtered weather dataframes
filtered_persb_wx_15min <- persb_wx_15min %>%
  filter(datetime >= start_time & datetime <= end_time) %>%
  #removed UTM column
  select(-TIMESTAMP)

filtered_persub_wx_15min <- persub_wx_15min %>%
  filter(datetime >= start_time & datetime <= end_time) %>%
  #removed UTM column
  select(-TIMESTAMP)
  
filtered_transb_wx_15min <- transb_wx_15min %>%
  filter(datetime >= start_time & datetime <= end_time)

filtered_transun_wx_15min <- transub_wx_15min %>%
  filter(datetime >= start_time & datetime <= end_time)
```

# Tree Temp Comparison

```{r}
#adding in a burn status column to the aspect dataframes
filtered_pers_b_aspects <- filtered_pers_b_aspects %>%
  mutate(burn_status = case_when(
    startsWith(tree_name, "gb") ~ "green burn",
    startsWith(tree_name, "db") ~ "dead burn",
    TRUE ~ NA_character_  # Optional: handle other cases if needed
  )) %>%
  #adding a zone column
  mutate(zone = "persistent")

filtered_pers_ub_aspects <- filtered_pers_ub_aspects %>%
  mutate(burn_status = case_when(
    startsWith(tree_name, "ub") ~ "alive",
    TRUE ~ NA_character_  # Optional: handle other cases if needed
  )) %>%
  #adding a zone column
  mutate(zone = "persistent")

filtered_trans_b_aspects <- filtered_trans_b_aspects %>%
  mutate(burn_status = case_when(
    startsWith(tree_name, "gb") ~ "green burn",
    startsWith(tree_name, "db") ~ "dead burn",
    TRUE ~ NA_character_  # Optional: handle other cases if needed
  )) %>%
  #adding a zone column
  mutate(zone = "transitional")

filtered_trans_ub_aspects <- filtered_trans_ub_aspects %>%
  mutate(burn_status = case_when(
    startsWith(tree_name, "ub") ~ "alive",
    TRUE ~ NA_character_  # Optional: handle other cases if needed
  )) %>%
  mutate(zone = "transitional")
```

## Differencing Dead burn and Green burn trees

### Persistent Zone

```{r}
#creating a dataframe with green burn temp minus dead burn temp for the same aspects
##north aspect
persb_north_diff_data <- filtered_pers_b_aspects %>%
  # Filter for north aspect
  filter(aspect == 'north') %>%
  # Filter out gb_w tree
  filter(tree_name != 'gb_w') %>%
  # Calculate differences by datetime
  group_by(datetime) %>%
  summarise(
    gb_e_minus_db_s = mean(temp[tree_name == 'gb_e']) - mean(temp[tree_name == 'db_s']),
    gb_s_minus_db_s = mean(temp[tree_name == 'gb_s']) - mean(temp[tree_name == 'db_s']),
    gb_e_minus_db_n = mean(temp[tree_name == 'gb_e']) - mean(temp[tree_name == 'db_n']),
    gb_s_minus_db_n = mean(temp[tree_name == 'gb_s']) - mean(temp[tree_name == 'db_n'])
  ) %>%
  ungroup()

# Reshape data to long format
persb_north_diff_long <- persb_north_diff_data %>%
  pivot_longer(cols = starts_with("gb"), names_to = "comparison", values_to = "difference") %>%
  #adding in a zone and a burn status for later dataframe combinations
  mutate(burn_status = "burned") %>%
  mutate(zone = "persistent") %>%
  mutate(aspect = "north")

# Plotting the boxplots
persb_north_diff_plot <- ggplot(persb_north_diff_long, aes(x = comparison, y = difference, fill = comparison)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "North Aspect",
       x = "Comparison",
       y = "Temperature Difference (°C)",
       fill = "Tree Comparison")

print(persb_north_diff_plot)
```

```{r}
##south aspect
persb_south_diff_data <- filtered_pers_b_aspects %>%
  # Filter for north aspect
  filter(aspect == 'south') %>%
  # Filter out gb_w tree
  filter(tree_name != 'gb_w') %>%
  # Calculate differences by datetime
  group_by(datetime) %>%
  summarise(
    gb_e_minus_db_s = mean(temp[tree_name == 'gb_e']) - mean(temp[tree_name == 'db_s']),
    gb_s_minus_db_s = mean(temp[tree_name == 'gb_s']) - mean(temp[tree_name == 'db_s']),
    gb_e_minus_db_n = mean(temp[tree_name == 'gb_e']) - mean(temp[tree_name == 'db_n']),
    gb_s_minus_db_n = mean(temp[tree_name == 'gb_s']) - mean(temp[tree_name == 'db_n'])
  ) %>%
  ungroup()

# Reshape data to long format
persb_south_diff_long <- persb_south_diff_data %>%
  pivot_longer(cols = starts_with("gb"), names_to = "comparison", values_to = "difference") %>%
  #adding in a zone and a burn status for later dataframe combinations
  mutate(burn_status = "burned") %>%
  mutate(zone = "persistent") %>%
  mutate(aspect = "south")

# Plotting the boxplots
persb_south_diff_plot <- ggplot(persb_south_diff_long, aes(x = comparison, y = difference, fill = comparison)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "South Aspect",
       x = "Comparison",
       y = "Temperature Difference (°C)",
       fill = "Tree Comparison")

print(persb_south_diff_plot)
```

```{r}
#combinging north and south plots
persb_combined_aspectdiff_treetemp_plots <- persb_north_diff_plot + persb_south_diff_plot + plot_layout(nrow = 2) + plot_annotation(title = "Persistent Zone, Green & Dead Burn Tree Temp Difference")

persb_combined_aspectdiff_treetemp_plots 

#saving combined plot
ggsave("persb_combined_aspectdiff_treetemp_plots.png", plot = persb_combined_aspectdiff_treetemp_plots , width = 8, height = 10, dpi = 300, bg = "white")

```

##IDEA - may want to cut the nightly temps and just analyze during the day?

### Transitional Zone

```{r}
#creating a dataframe with green burn temp minus dead burn temp for the same aspects
##north aspect
transb_north_diff_data <- filtered_trans_b_aspects %>%
  # Filter for north aspect
  filter(aspect == 'north') %>%
  # Calculate differences by datetime
  group_by(datetime) %>%
  summarise(
    gb_n_minus_db_s = mean(temp[tree_name == 'gb_n']) - mean(temp[tree_name == 'db_s']),
    gb_s_minus_db_s = mean(temp[tree_name == 'gb_s']) - mean(temp[tree_name == 'db_s']),
    gb_n_minus_db_n = mean(temp[tree_name == 'gb_n']) - mean(temp[tree_name == 'db_n']),
    gb_s_minus_db_n = mean(temp[tree_name == 'gb_s']) - mean(temp[tree_name == 'db_n'])
  ) %>%
  ungroup()

# Reshape data to long format
transb_north_diff_long <- transb_north_diff_data %>%
  pivot_longer(cols = starts_with("gb"), names_to = "comparison", values_to = "difference") %>%
  #adding in a zone and a burn status for later dataframe combinations
  mutate(burn_status = "burned") %>%
  mutate(zone = "transitional") %>%
  mutate(aspect = "north")

# Plotting the boxplots
transb_north_diff_plot <- ggplot(transb_north_diff_long, aes(x = comparison, y = difference, fill = comparison)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "North Aspect",
       x = "Comparison",
       y = "Temperature Difference (°C)",
       fill = "Tree Comparison")

print(transb_north_diff_plot)
```

```{r}
##south aspect
transb_south_diff_data <- filtered_trans_b_aspects %>%
  # Filter for north aspect
  filter(aspect == 'south') %>%
  # Calculate differences by datetime
  group_by(datetime) %>%
  summarise(
    gb_n_minus_db_s = mean(temp[tree_name == 'gb_n']) - mean(temp[tree_name == 'db_s']),
    gb_s_minus_db_s = mean(temp[tree_name == 'gb_s']) - mean(temp[tree_name == 'db_s']),
    gb_n_minus_db_n = mean(temp[tree_name == 'gb_n']) - mean(temp[tree_name == 'db_n']),
    gb_s_minus_db_n = mean(temp[tree_name == 'gb_s']) - mean(temp[tree_name == 'db_n'])
  ) %>%
  ungroup()

# Reshape data to long format
transb_south_diff_long <- transb_south_diff_data %>%
  pivot_longer(cols = starts_with("gb"), names_to = "comparison", values_to = "difference") %>%
  #adding in a zone and a burn status for later dataframe combinations
  mutate(burn_status = "burned") %>%
  mutate(zone = "transitional") %>%
  mutate(aspect = "south")

# Plotting the boxplots
transb_south_diff_plot <- ggplot(transb_south_diff_long, aes(x = comparison, y = difference, fill = comparison)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "South Aspect",
       x = "Comparison",
       y = "Temperature Difference (°C)",
       fill = "Tree Comparison")

print(transb_south_diff_plot)
```

```{r}
#combinging north and south plots
transb_combined_aspectdiff_treetemp_plots <- transb_north_diff_plot + transb_south_diff_plot + plot_layout(nrow = 2) + plot_annotation(title = "Transitional Zone, Green & Dead Burn Tree Temp Difference")

transb_combined_aspectdiff_treetemp_plots 

#saving combined plot
ggsave("transb_combined_aspectdiff_treetemp_plots.png", plot = transb_combined_aspectdiff_treetemp_plots , width = 8, height = 10, dpi = 300, bg = "white")
```

```{r}
#creating a combined dataframe for the db-gb comparisons
full_dbgb_comparisons_data <- bind_rows(persb_north_diff_long, persb_south_diff_long, transb_north_diff_long, transb_south_diff_long)
```

## Differencing by Individual Tree Aspect

### Persistent Zone

```{r}
#creating a dataframe for each tree
persb_gb_e_diff_data <- filtered_pers_b_aspects %>%
  # Filter for gb_e tree
  filter(tree_name == 'gb_e') %>%
  # Calculate differences by datetime
  group_by(datetime) %>%
  summarise(
    south_minus_north = mean(temp[aspect == 'south']) - mean(temp[aspect == 'north'])) %>%
  ungroup() %>%
  pivot_longer(cols = starts_with("south"), names_to = "comparison", values_to = "difference") %>%
  mutate(treename = 'gb_e')

persb_gb_s_diff_data <- filtered_pers_b_aspects %>%
  # Filter for gb_e tree
  filter(tree_name == 'gb_s') %>%
  # Calculate differences by datetime
  group_by(datetime) %>%
  summarise(
    south_minus_north = mean(temp[aspect == 'south']) - mean(temp[aspect == 'north'])) %>%
  ungroup() %>%
  pivot_longer(cols = starts_with("south"), names_to = "comparison", values_to = "difference") %>%
  mutate(treename = 'gb_s')

persb_db_n_diff_data <- filtered_pers_b_aspects %>%
  # Filter for gb_e tree
  filter(tree_name == 'db_n') %>%
  # Calculate differences by datetime
  group_by(datetime) %>%
  summarise(
    south_minus_north = mean(temp[aspect == 'south']) - mean(temp[aspect == 'north'])) %>%
  ungroup() %>%
  pivot_longer(cols = starts_with("south"), names_to = "comparison", values_to = "difference") %>%
  mutate(treename = 'db_n')

persb_db_s_diff_data <- filtered_pers_b_aspects %>%
  # Filter for gb_e tree
  filter(tree_name == 'db_s') %>%
  # Calculate differences by datetime
  group_by(datetime) %>%
  summarise(
    south_minus_north = mean(temp[aspect == 'south']) - mean(temp[aspect == 'north'])) %>%
  ungroup() %>%
  pivot_longer(cols = starts_with("south"), names_to = "comparison", values_to = "difference") %>%
  mutate(treename = 'db_s')

#creating a combined new dataframe
persb_gbdb_combined_data <- bind_rows(persb_gb_e_diff_data, persb_gb_s_diff_data, persb_db_n_diff_data, persb_db_s_diff_data)
```

```{r}
#plotting persistent north-south tree boxplots
persb_gbdb_diff_plot <- ggplot(persb_gbdb_combined_data, aes(x = comparison, y = difference, fill = treename)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Persistent Zone",
       x = "Comparison",
       y = "Temperature Difference (°C)",
       fill = "Tree Name")

print(persb_gbdb_diff_plot)
```

### Transitional Zone

```{r}
#creating a dataframe for each tree
transb_gb_n_diff_data <- filtered_trans_b_aspects %>%
  # Filter for gb_e tree
  filter(tree_name == 'gb_n') %>%
  # Calculate differences by datetime
  group_by(datetime) %>%
  summarise(
    south_minus_north = mean(temp[aspect == 'south']) - mean(temp[aspect == 'north'])) %>%
  ungroup() %>%
  pivot_longer(cols = starts_with("south"), names_to = "comparison", values_to = "difference") %>%
  mutate(treename = 'gb_n')

transb_gb_s_diff_data <- filtered_trans_b_aspects %>%
  # Filter for gb_e tree
  filter(tree_name == 'gb_s') %>%
  # Calculate differences by datetime
  group_by(datetime) %>%
  summarise(
    south_minus_north = mean(temp[aspect == 'south']) - mean(temp[aspect == 'north'])) %>%
  ungroup() %>%
  pivot_longer(cols = starts_with("south"), names_to = "comparison", values_to = "difference") %>%
  mutate(treename = 'gb_s')

transb_db_n_diff_data <- filtered_trans_b_aspects %>%
  # Filter for gb_e tree
  filter(tree_name == 'db_n') %>%
  # Calculate differences by datetime
  group_by(datetime) %>%
  summarise(
    south_minus_north = mean(temp[aspect == 'south']) - mean(temp[aspect == 'north'])) %>%
  ungroup() %>%
  pivot_longer(cols = starts_with("south"), names_to = "comparison", values_to = "difference") %>%
  mutate(treename = 'db_n')

transb_db_s_diff_data <- filtered_trans_b_aspects %>%
  # Filter for gb_e tree
  filter(tree_name == 'db_s') %>%
  # Calculate differences by datetime
  group_by(datetime) %>%
  summarise(
    south_minus_north = mean(temp[aspect == 'south']) - mean(temp[aspect == 'north'])) %>%
  ungroup() %>%
  pivot_longer(cols = starts_with("south"), names_to = "comparison", values_to = "difference") %>%
  mutate(treename = 'db_s')

#creating a combined new dataframe
transb_gbdb_combined_data <- bind_rows(transb_gb_n_diff_data, transb_gb_s_diff_data, transb_db_n_diff_data, transb_db_s_diff_data)
```

```{r}
#plotting transitional north-south tree boxplots
transb_gbdb_diff_plot <- ggplot(transb_gbdb_combined_data, aes(x = comparison, y = difference, fill = treename)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Transitional Zone",
       x = "Comparison",
       y = "Temperature Difference (°C)",
       fill = "Tree Name")

print(transb_gbdb_diff_plot)
```

```{r}
#combinging north and south plots
combined_bytree_aspect_treetemp_plots <- persb_gbdb_diff_plot + transb_gbdb_diff_plot + plot_layout(nrow = 1) + plot_annotation(title = "Temperature Differences by Tree - south minus north aspect")

combined_bytree_aspect_treetemp_plots

#saving combined plot
ggsave("combined_bytree_aspect_treetemp_plots.png", plot = combined_bytree_aspect_treetemp_plots , width = 10, height = 6, dpi = 300, bg = "white")
```

```{r}
#creating a full dataframe for both pers and transitional data for later plotting of the south-north comparison

##individually editing pers and trans combined data before combining both dataframes
# Add new column 'burn_status' based on conditions, and new column 'zone' based on location
persb_gbdb_combined_data <- persb_gbdb_combined_data %>%
  mutate(burn_status = case_when(
    startsWith(treename, "gb") ~ "green_burned",
    startsWith(treename, "db") ~ "dead_burned",
    TRUE ~ NA_character_  # Handle other cases if needed
  )) %>%
  mutate(zone = "persistent")

transb_gbdb_combined_data <- transb_gbdb_combined_data %>%
  mutate(burn_status = case_when(
    startsWith(treename, "gb") ~ "green_burned",
    startsWith(treename, "db") ~ "dead_burned",
    TRUE ~ NA_character_  # Handle other cases if needed
  )) %>%
  mutate(zone = "transitional")

#creating a full combined dataset
full_southnorth_comparison_data <- bind_rows(persb_gbdb_combined_data, transb_gbdb_combined_data)
```

**Interpretation of box plots**

-   Consistent Boxes: Similar boxes indicate that the general trend and variability within the middle 50% of the data are consistent across different aspects.

-   Many Outliers: The numerous outliers highlight that there are frequent instances of temperature differences that are much higher or lower than the typical range. This could point to specific factors or conditions that cause these deviations.

# Cutting timeframe

## Creating day-only dataframes

```{r}
#persistent daytime dataframes
dt_pers_b_aspects <- filtered_pers_b_aspects %>%
  filter(hour(datetime) >= 6 & hour(datetime) <= 21)

dt_pers_ub_aspects <- filtered_pers_ub_aspects %>%
  filter(hour(datetime) >= 6 & hour(datetime) <= 21)

#transitional daytime dataframes
dt_trans_b_aspects <- filtered_trans_b_aspects %>%
  filter(hour(datetime) >= 6 & hour(datetime) <= 21)

dt_trans_ub_aspects <- filtered_trans_ub_aspects %>%
  filter(hour(datetime) >= 6 & hour(datetime) <= 21)
```

## Plotting daytime DB/GB differencing

### Persistent Zone

```{r}
#manipulating the dataset to only be hours between 6 am and 9 pm MST
dt_persb_north_diff_long <- persb_north_diff_long %>%
  filter(hour(datetime) >= 6 & hour(datetime) <= 21)

dt_persb_south_diff_long <- persb_south_diff_long %>%
  filter(hour(datetime) >= 6 & hour(datetime) <= 21)

#plotting
dt_persb_north_diff_plot <- ggplot(dt_persb_north_diff_long, aes(x = comparison, y = difference, fill = comparison)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Daytime North Aspect",
       x = "Comparison",
       y = "Temperature Difference (°C)",
       fill = "Tree Comparison")

print(dt_persb_north_diff_plot)

dt_persb_south_diff_plot <- ggplot(dt_persb_south_diff_long, aes(x = comparison, y = difference, fill = comparison)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Daytime South Aspect",
       x = "Comparison",
       y = "Temperature Difference (°C)",
       fill = "Tree Comparison")

print(dt_persb_south_diff_plot)
```

## Plotting daytime aspect differencing

### Persistent Zone

```{r}
#creating new dataframe with only daytime hours
dt_persb_gbdb_combined_data <- persb_gbdb_combined_data %>%
  filter(hour(datetime) >= 6 & hour(datetime) <= 21)

#plotting
dt_persb_gbdb_diff_plot <- ggplot(dt_persb_gbdb_combined_data, aes(x = comparison, y = difference, fill = treename)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Daytime Persistent Zone",
       x = "Comparison",
       y = "Temperature Difference (°C)",
       fill = "Tree Name")

print(dt_persb_gbdb_diff_plot)
```

Transitional Zone

```{r}
#creating new dataframe with only daytime hours
dt_transb_gbdb_combined_data <- transb_gbdb_combined_data %>%
  filter(hour(datetime) >= 6 & hour(datetime) <= 21)

#plotting
dt_transb_gbdb_diff_plot <- ggplot(dt_transb_gbdb_combined_data, aes(x = comparison, y = difference, fill = treename)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Daytime Transitional Zone",
       x = "Comparison",
       y = "Temperature Difference (°C)",
       fill = "Tree Name")

print(dt_transb_gbdb_diff_plot)
```
