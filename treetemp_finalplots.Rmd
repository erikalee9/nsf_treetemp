---
title: "treetemp_finalplots"
output: html_document
date: "2024-10-25"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(lterdatasampler)
library(dplyr)
library(ggplot2)
library(readr)
library(readxl)
library(lubridate)
library(plotly)
library(openxlsx)
library(plotly)
library(rstatix)
library(htmlwidgets)
library(RColorBrewer)
library(patchwork)
library(ggpubr)
library(suncalc)
library(ggpattern)

setwd("/Volumes/wcnr-network/Research/Kampf/Private/field_data")
```

# Loading in Data

```{r}
#new full dataframes to load - including burned and unburned/ all burn_status types together
full_15min_ns <- read_csv("nsf/treetemp_data/full_15min_ns.csv") %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = force_tz(datetime, tz = 'MST')) %>%
  select(-1)

full_hourly_ns <- read_csv("nsf/treetemp_data/full_hourly_ns.csv") %>%
   mutate(datetime_hour = as.POSIXct(datetime_hour, format=("%Y-%m-%d %H:%M:%S")),
                               datetime_hour = force_tz(datetime_hour, tz = 'MST'))  %>%
  select(-1)

full_15min_gbdbub <- read_csv("nsf/treetemp_data/full_15min_gbdbub.csv") %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = force_tz(datetime, tz = 'MST'))  %>%
  select(-1)

full_hourly_gbdbub <- read_csv("nsf/treetemp_data/full_hourly_gbdbub.csv") %>%
  mutate(datetime_hour = as.POSIXct(datetime_hour, format=("%Y-%m-%d %H:%M:%S")),
                               datetime_hour = force_tz(datetime_hour, tz = 'MST'))  %>%
  select(-1)

full_hourly_gb <- read_csv("nsf/treetemp_data/full_hourly_gb.csv") %>%
  mutate(datetime_hour = as.POSIXct(datetime_hour, format=("%Y-%m-%d %H:%M:%S")),
                               datetime_hour = force_tz(datetime_hour, tz = 'MST'))  %>%
  select(-1)
```

```{r}
#weather station data for tree well/snow depth plots
transb_snowcamera_data <- read_csv("nsf/camera_snowdepths/2024_105E_transb_snowdepths.csv") %>%
  rename(snowcam_max_depth_cm = "maximum_depth(cm)") %>%
  mutate(date = as.Date(date)) %>%
  #adjusting the treewell developed column to just yes/no
  mutate(treewell_developed = case_when(
    treewell_developed == "maybe" ~ "yes",
    treewell_developed == "no snow" ~ "no",
    TRUE ~ treewell_developed  # keep other values unchanged
  )) %>%
  mutate(snowcam_max_depth_m = snowcam_max_depth_cm/100) %>%
  #filtering to timerange for these plots
  filter(date >= as.Date("2024-02-02") & date <= as.Date("2024-05-23")) %>%
  mutate(zone = "TSZ")

persb_snowcamera_data <- read_csv("nsf/camera_snowdepths/2024_persb_lp_highmort_east_snowdepths.csv") %>%
  rename(snowcam_max_depth_cm = "max_depth_cm") %>%
  mutate(date = as.Date(date)) %>%
  rename(treewell_developed = treewell_developement) %>%
  mutate(treewell_developed = case_when(
    treewell_developed == "maybe" ~ "yes",
    treewell_developed == "no snow" ~ "no",
    TRUE ~ treewell_developed  # keep other values unchanged
  )) %>%
  mutate(snowcam_max_depth_m = snowcam_max_depth_cm/100) %>%
  #filtering to timerange for these plots
  filter(date >= as.Date("2024-02-02") & date <= as.Date("2024-05-23")) %>%
  mutate(zone = "PSZ")
```

```{r}
#tree LWout and treeLWout cumulative datasets
full_15min_gbdbub_LWout <- read_csv("nsf/treetemp_data/full_15min_gbdbub_LWout.csv")

full_15min_ns_LWout <- read_csv("nsf/treetemp_data/full_15min_ns_LWout.csv")

cum_full_daily_LWout <- read_csv("nsf/treetemp_data/cum_full_daily_treeLWout.csv")

cum_dt_gbdbub_LWout <- read_csv("nsf/treetemp_data/cum_dt_gbdbub_LWout.csv")
```

Weather Data

```{r}
transb_wx_15min_r <- read_csv('nsf/trans_burned/trans_burned_wx_15min_r.csv') %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = force_tz(datetime, tz = 'MST'))

transub_wx_15min_r <- read_csv('nsf/trans_unburned/trans_unburned_wx_15min_r.csv') %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = force_tz(datetime, tz = 'MST'))

persb_wx_hourly_r <- read_csv('nsf/pers_burned/pers_burned_wx_hourly_r.csv') %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = force_tz(datetime, tz = 'MST'))

persub_wx_15min_r <- read_csv('nsf/pers_unburned/pers_unburned_wx_15min_r.csv') %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = force_tz(datetime, tz = 'MST'))

p_b_solar_times <- read_csv("nsf/treetemp_data/p_b_solar_times.csv")
```

```{r}
#filtered weather data to the datetime range that we need and added phase and NR_Avg_calcs
filtered_transb_wx_15min <- transb_wx_15min_r %>%
  mutate(day = as.Date.POSIXct(datetime, tz = "MST"),
    month = as.numeric(format(datetime, "%m")),
    datetime = with_tz(datetime, tzone = "MST")) %>%
  filter(datetime >= as.POSIXct("2024-02-02 00:15:00", tz = "MST") & 
         datetime <= as.POSIXct("2024-05-23 23:45:00", tz = "MST")) %>%
  inner_join(p_b_solar_times, by = "day") %>%
  #creating a phase column that parses by daily sunrise/sunset times
  mutate(
    phase = case_when(
      datetime >= sunrise & datetime < sunset ~ "day",
      datetime < sunrise ~ "night",
      datetime >= sunset ~ "night",
      TRUE ~ NA_character_)) %>%
  mutate(zone = "TSZ", burn_status = "burned") %>%
  filter(!is.nan(SWin_Avg)) %>%
  #adding in my own calculated NR_Avg column
  mutate(NR_Avg_new = (SWin_Avg - SWout_Avg) + (LWin_Avg - LWout_Avg)) %>%
  select(datetime, day, month, phase, zone, burn_status, NR_Avg_new, everything())
```

```{r}
filtered_transub_wx_15min <- transub_wx_15min_r %>%
  mutate(day = as.Date.POSIXct(datetime, tz = "MST"),
    month = as.numeric(format(datetime, "%m")),
    datetime = with_tz(datetime, tzone = "MST")) %>%
  filter(datetime >= as.POSIXct("2024-02-02 00:15:00", tz = "MST") & 
         datetime <= as.POSIXct("2024-05-23 23:45:00", tz = "MST")) %>%
  inner_join(p_b_solar_times, by = "day") %>%
  #creating a phase column that parses by daily sunrise/sunset times
  mutate(
    phase = case_when(
      datetime >= sunrise & datetime < sunset ~ "day",
      datetime < sunrise ~ "night",
      datetime >= sunset ~ "night",
      TRUE ~ NA_character_)) %>%
  mutate(zone = "TSZ", burn_status = "unburned") %>%
  #adding in my own calculated NR_Avg column
  mutate(NR_Avg_new = (SWin_Avg - SWout_Avg) + (LWin_Avg - LWout_Avg)) %>%
  select(datetime, day, month, phase, zone, burn_status, NR_Avg_new, everything())
```

```{r}
filtered_persb_wx_hourly <- persb_wx_hourly_r %>%
  mutate(day = as.Date.POSIXct(datetime, tz = "MST"),
    month = as.numeric(format(datetime, "%m")),
    datetime = with_tz(datetime, tzone = "MST")) %>%
  filter(datetime >= as.POSIXct("2024-02-02 00:15:00", tz = "MST") & 
         datetime <= as.POSIXct("2024-05-23 23:45:00", tz = "MST")) %>%
  inner_join(p_b_solar_times, by = "day") %>%
  #creating a phase column that parses by daily sunrise/sunset times
  mutate(
    phase = case_when(
      datetime >= sunrise & datetime < sunset ~ "day",
      datetime < sunrise ~ "night",
      datetime >= sunset ~ "night",
      TRUE ~ NA_character_)) %>%
  mutate(zone = "PSZ", burn_status = "burned") %>%
 #adding in my own calculated NR_Avg column
  mutate(NR_Avg_new = (SWin_Avg - SWout_Avg) + (LWin_Avg - LWout_Avg)) %>%
  select(datetime, day, month, phase, zone, burn_status, NR_Avg_new, everything())
```

```{r}
filtered_persub_wx_15min <- persub_wx_15min_r %>%
  mutate(day = as.Date.POSIXct(datetime, tz = "MST"),
    month = as.numeric(format(datetime, "%m")),
    datetime = with_tz(datetime, tzone = "MST")) %>%
  filter(datetime >= as.POSIXct("2024-02-02 00:15:00", tz = "MST") & 
         datetime <= as.POSIXct("2024-05-23 23:45:00", tz = "MST")) %>%
  inner_join(p_b_solar_times, by = "day") %>%
  #creating a phase column that parses by daily sunrise/sunset times
  mutate(
    phase = case_when(
      datetime >= sunrise & datetime < sunset ~ "day",
      datetime < sunrise ~ "night",
      datetime >= sunset ~ "night",
      TRUE ~ NA_character_)) %>%
  mutate(zone = "PSZ", burn_status = "unburned") %>%
  #adding in my own calculated NR_Avg column
  mutate(NR_Avg_new = (SWin_Avg - SWout_Avg) + (LWin_Avg - LWout_Avg)) %>%
  select(datetime, day, month, phase, zone, burn_status, NR_Avg_new, everything())
```

\
TotalNetRad = (SWin -SWout) + (LWin - LWout) + LWout_tree)

# Plotting

## Daytime vs Nighttime Tree Temp Plot - GB/DB/UB with aspects

```{r}
#creating dataframe for this that has renamed zones - mean daily value!!
dt_full_daily_gbdbub_plot_dataframe <- full_15min_gbdbub %>%
  #selecting data that we neex
  select(datetime, day, month, phase, zone, aspect, gb_temp, db_temp, ub_temp) %>%
  filter(phase == "day") %>%
  #summarizing for one daily value
  group_by(day, month, phase, zone, aspect) %>%
  summarize(gb_temp = mean(gb_temp), db_temp = mean(db_temp), ub_temp = mean(ub_temp))
  

nt_full_daily_gbdbub_plot_dataframe <- full_15min_gbdbub %>%
  #selecting data that we neex
  select(datetime, day, month, phase, zone, aspect, gb_temp, db_temp, ub_temp) %>%
  filter(phase == "night") %>%
  #summarizing for one daily value
  group_by(day, month, phase, zone, aspect) %>%
  summarize(gb_temp = mean(gb_temp), db_temp = mean(db_temp), ub_temp = mean(ub_temp))
```

```{r}
#daytime plot
dt_treetemp_daily_gbdbub_lineplot <- ggplot(data = dt_full_daily_gbdbub_plot_dataframe) +
  geom_line(aes(x = day, y = gb_temp, color = "green burn", linetype = aspect)) + 
  geom_line(aes(x = day, y = db_temp, color = "dead burn", linetype = aspect)) +
  geom_line(aes(x = day, y = ub_temp, color = "live", linetype = aspect), alpha = 0.8) +
  facet_wrap(~zone) +
  labs(title = "a) Day Temps", x = NULL, y = "Temperature (Â°C)") +
  scale_color_manual(
    name = "burn status",
    values = c("green burn" = "#1B7837", "dead burn" = "#D95F02", "live" = "#2166AC")
  ) +
  scale_linetype_manual(
    name = "aspect", 
    values = c("north" = "dashed", "south" = "solid"),
    labels = c("north" = "North", "south" = "South")
  ) +
  scale_y_continuous(limits = c(-20, 20)) +  # Set the y-axis limits here
  theme_bw()

dt_treetemp_daily_gbdbub_lineplot
```

```{r}
#daytime plot
nt_treetemp_daily_gbdbub_lineplot <- ggplot(data = nt_full_daily_gbdbub_plot_dataframe) +
  geom_line(aes(x = day, y = gb_temp, color = "green burn", linetype = aspect)) + 
  geom_line(aes(x = day, y = db_temp, color = "dead burn", linetype = aspect)) +
  geom_line(aes(x = day, y = ub_temp, color = "live", linetype = aspect), alpha = 0.8) +
  facet_wrap(~zone) +
  labs(title = "b) Night Temps", x = "Date", y = "Temperature (Â°C)") +
  scale_color_manual(
    name = "burn status",
    values = c("green burn" = "#1B7837", "dead burn" = "#D95F02", "live" = "#2166AC")
  ) +
  scale_linetype_manual(
    name = "aspect", 
    values = c("north" = "dashed", "south" = "solid"),
    labels = c("north" = "North", "south" = "South")
  ) +
  #setting y-axis to match that of the daytime axis
 scale_y_continuous(limits = c(-20, 20)) +  # Set the y-axis limits here
  theme_bw()

nt_treetemp_daily_gbdbub_lineplot
```

```{r}
#combining day and night plots
dtnt_treetemp_lineplot <- ggarrange(dt_treetemp_daily_gbdbub_lineplot, nt_treetemp_daily_gbdbub_lineplot, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")

dtnt_treetemp_lineplot
```

## GB Aspect/Char Pattern Comparison

```{r}
#dataframe
##march
march_dt_mean_gb_temps <- full_hourly_gb %>%
  filter(phase == "day", month == "3") %>%
  group_by(day, month, zone) %>%
  summarize(north_temp = mean(north_temp), south_temp = mean(south_temp), charred_temp = mean(charred_temp), uncharred_temp = mean(uncharred_temp)) %>%
  filter(day >= "2024-03-10" & day <= "2024-03-20")

##april
april_dt_mean_gb_temps <- full_hourly_gb %>%
  filter(phase == "day", month == "4") %>%
  group_by(day, month, zone) %>%
  summarize(north_temp = mean(north_temp), south_temp = mean(south_temp), charred_temp = mean(charred_temp), uncharred_temp = mean(uncharred_temp))  %>%
  filter(day >= "2024-04-05" & day <= "2024-04-15")
```

```{r}
march_dt_mean_gb_temp_plot <- ggplot(data = march_dt_mean_gb_temps) +
  geom_line(aes(x = day, y = north_temp, color = "north"), linewidth = 0.7, alpha = 0.8) + 
  geom_line(aes(x = day, y = south_temp, color = "south"), linewidth = 0.7) +
  geom_line(aes(x = day, y = charred_temp, color = "charred"), linewidth = 0.7) + 
  geom_line(aes(x = day, y = uncharred_temp, color = "uncharred"), linetype = "dashed", linewidth = 0.7) + 
  facet_wrap(~zone) +
  labs(title = "a) Accumulation", x = "Date", y = "Temperature (Â°C)") +
  scale_color_manual(
    name = "aspect",
    values = c("north" = "#2166AC", "south" = "#D95F02", "charred" = "grey15", "uncharred" = "grey30")
  ) +
  theme_bw()

march_dt_mean_gb_temp_plot
```

```{r}
april_dt_mean_gb_temp_plot <- ggplot(data = april_dt_mean_gb_temps) +
  geom_line(aes(x = day, y = north_temp, color = "north"), linewidth = 0.7, alpha = 0.8) + 
  geom_line(aes(x = day, y = south_temp, color = "south"), linewidth = 0.7) +
  geom_line(aes(x = day, y = charred_temp, color = "charred"), linewidth = 0.7) + 
  geom_line(aes(x = day, y = uncharred_temp, color = "uncharred"), linetype = "dashed", linewidth = 0.7) + 
  facet_wrap(~zone) +
  labs(title = "b) Ablation", x = "Date", y = "Temperature (Â°C)") +
  scale_color_manual(
    name = "aspect",
    values = c("north" = "#2166AC", "south" = "#D95F02", "charred" = "grey15", "uncharred" = "grey30")
  ) +
  theme_bw()

april_dt_mean_gb_temp_plot
```

```{r}
example_gb_temps_lineplot <- ggarrange(
  march_dt_mean_gb_temp_plot, 
  april_dt_mean_gb_temp_plot, 
  nrow = 2, 
  ncol = 1, 
  common.legend = TRUE,
  legend = "right")

example_gb_temps_lineplot
```

## Cumulative Tree LWout Plot

### Cumulative Burn Status LWout Line Plot

Data Wrangling

```{r}
#data wrangling 
p_accu_dr_gbdbub_LWout <- cum_dt_gbdbub_LWout %>%
  filter(zone == "PSZ")

t_accu_dr_gbdbub_LWout <- cum_dt_gbdbub_LWout %>%
  filter(zone == "TSZ")
```

Plotting

\*\* Use this plot!

```{r}
#persistent 
p_cum_dt_gbdbub_plot <- ggplot(data = p_accu_dr_gbdbub_LWout) +
  geom_line(aes(x = day, y = accu_daily_gb_LWout_MJperd, color = "green burn", linetype = aspect), linewidth = 0.6) +  
  geom_line(aes(x = day, y = accu_daily_db_LWout_MJperd, color = "dead burn", linetype = aspect), linewidth = 0.6) +
  geom_line(aes(x = day, y = accu_daily_ub_LWout_MJperd, color = "live", linetype = aspect), linewidth = 0.6) +
  facet_wrap(~aspect, dir = "h") +
  theme_bw() +
  labs(title = "a) PSZ", 
    x = NULL,
    y = "Daily Cumulative LWout (MJ)",
    color = "Burn Status", 
    linetype = "Aspect"
  ) +
  scale_color_manual(values = c("green burn" = "#1B7837", "dead burn" = "#D95F02", "live" = adjustcolor("#2166AC", alpha = 0.7))) +
  scale_linetype_manual(values = c("north" = "dashed", "south" = "solid"))

p_cum_dt_gbdbub_plot
```

```{r}
#transitional
t_cum_dt_gbdbub_plot <- ggplot(data = t_accu_dr_gbdbub_LWout) +
  geom_line(aes(x = day, y = accu_daily_gb_LWout_MJperd, color = "green burn", linetype = aspect), linewidth = 0.6) +  
  geom_line(aes(x = day, y = accu_daily_db_LWout_MJperd, color = "dead burn", linetype = aspect), linewidth = 0.6) +
  geom_line(aes(x = day, y = accu_daily_ub_LWout_MJperd, color = "live", linetype = aspect), linewidth = 0.6) +
  facet_wrap(~aspect, dir = "h") +
  theme_bw() +
  labs(title = "b) TSZ", 
    x = "Date",
    y = "Daily Cumulative LWout (MJ)",
    color = "Burn Status", 
    linetype = "Aspect"
  ) +
  scale_color_manual(values = c("green burn" = "#1B7837", "dead burn" = "#D95F02", "live" = adjustcolor("#2166AC", alpha = 0.7))) +
  scale_linetype_manual(values = c("north" = "dashed", "south" = "solid"))

t_cum_dt_gbdbub_plot
```

```{r}
cum_full_daily_treeLWout <- ggarrange(p_cum_dt_gbdbub_plot, t_cum_dt_gbdbub_plot, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")

cum_full_daily_treeLWout
```

### Snow Depth & Tree Well Plots

Making plots by zone / burned & unburned because then I can have snow depths at burned/unburned sites...

-   as of 2024-10-24, just starting with burned, cause I don't have unburned data loaded yet

```{r}
#filtered transb weather to get a daily average
transb_daily_wx <- transb_wx_15min_r %>%
  filter(
    hour(datetime) >= 8 & hour(datetime) <= 16
  ) %>%
  mutate(
    day = as.Date(datetime),
    month = month(datetime), 
    zone = "TSZ"
  ) %>%
  select(datetime, day, month, zone, SnowDepth_m, AirTC_Avg) %>%
  group_by(day, month, zone) %>%
  summarize(SnowDepth_m = mean(SnowDepth_m), AirTC_Avg = mean(AirTC_Avg))
```

```{r}
#filtered transb weather to get a daily average
persb_daily_wx <- persb_wx_hourly_r %>%
  filter(
    hour(datetime) >= 8 & hour(datetime) <= 16
  ) %>%
  mutate(
    day = as.Date(datetime),
    month = month(datetime), 
    zone = "PSZ"
  ) %>%
  select(datetime, day, month, zone, SnowDepth_m, AirTC_Avg) %>%
  group_by(day, month, zone) %>%
  summarize(SnowDepth_m = mean(SnowDepth_m), AirTC_Avg = mean(AirTC_Avg))
```

```{r}
#combining the above daily_dt_weather
daily_burned_dt_wx <- persb_daily_wx %>%
  full_join(transb_daily_wx)
```

\*\* Probably won't use the plot below

```{r}
p_b_snow_treewell_plot <- ggplot() +
  geom_line(data = p_full_dt_gbdbub_LWout, aes(x = day, y = gb_LWout_MJperd, color = "green burn"), linewidth = 0.8) +
 geom_line(data = p_full_dt_gbdbub_LWout, aes(x = day, y = db_LWout_MJperd, color = "dead burn"), linewidth = 0.8) +
  geom_line(data =p_full_dt_gbdbub_LWout, aes(x = day, y = ub_LWout_MJperd, color = "live"), linewidth = 0.8) +
  geom_line(data = persb_snowcamera_data, aes(x = date, y = snowcam_max_depth_m*10, color = "snow depth"), linewidth = 0.8) +
  geom_point(data = persb_treewell_dates, aes(x = date, y = snowcam_max_depth_m*10, 
             shape = "Dates that treewells developed"), 
             color = "black", fill = "black", size = 1.5) +
  facet_wrap(~zone + aspect) +
  labs(
    title = "Without Tree LWout in Net Rad",
    x = "Date",
    y = "Cumulative Radiation Component (MJ/d)"
  ) +
   scale_color_manual(
   values = c("dead burn" = "#D95F02", 
               "green burn" = "#1B7837", 
               "live" = "#2166AC", 
               "snow depth" = "black")) +
  scale_shape_manual(
    values = c("Dates that treewells developed" = 16)  # Set shape for points
  ) +
  # Primary y-axis and secondary y-axis for snow depth
  scale_y_continuous(
    labels = scales::label_number(accuracy = 1),
    sec.axis = sec_axis(~./10, name = "Snow Depth (m)")
  ) +
  # Remove legend titles
  guides(
    color = guide_legend(title = NULL),  
    linetype = guide_legend(title = NULL),
    shape = guide_legend(title = NULL)
  ) +
  theme_bw()

print(p_b_snow_treewell_plot)
```

Snow depth plot with tree temp + air temp!

```{r}
#creating daily average tree temp plot for dt only
full_dt_daily_gbdbub <- full_15min_gbdbub %>%
  filter(phase == "day", aspect == "south") %>%
  group_by(day, month, phase, zone, aspect) %>%
  summarize(gb_temp = mean(gb_temp), db_temp = mean(db_temp), ub_temp = mean(ub_temp))
```

```{r}
p_b_snow_treewell_plot_V2 <- ggplot() +
  geom_line(data = full_dt_daily_gbdbub, aes(x = day, y = gb_temp, color = "green burn"), linewidth = 0.8) +
 geom_line(data = full_dt_daily_gbdbub, aes(x = day, y = db_temp, color = "dead burn"), linewidth = 0.8) +
  geom_line(data =full_dt_daily_gbdbub, aes(x = day, y = ub_temp, color = "live"), linewidth = 0.8, alpha = 0.8) +
  #persistent snow depths + tree wells
  geom_line(data = persb_snowcamera_data, aes(x = date, y = snowcam_max_depth_m*15, color = "snow depth"), linewidth = 0.8) +
  geom_point(data = persb_treewell_dates, aes(x = date, y = snowcam_max_depth_m*15, 
             shape = "Dates that treewells developed"), 
             color = "black", fill = "black", size = 1.5) +
    #transitional snow depths + tree wells
  geom_line(data = transb_snowcamera_data, aes(x = date, y = snowcam_max_depth_m*15, color = "snow depth"), linewidth = 0.8) +
  geom_point(data = transb_treewell_dates, aes(x = date, y = snowcam_max_depth_m*15, 
             shape = "Dates that treewells developed"), 
             color = "black", fill = "black", size = 1.5) +
  #air temp
  geom_line(data = daily_burned_dt_wx, aes(x = day, y = AirTC_Avg, color = "air temp", linetype = "dasehd")) + 
  facet_wrap(~zone + aspect) +
  labs(
    title = "Without Tree LWout in Net Rad",
    x = "Date",
    y = "Cumulative Radiation Component (MJ/d)"
  ) +
  scale_color_manual(values = c("dead burn" = "#D95F02", 
               "green burn" = "#1B7837", 
               "live" = "#2166AC", 
               "snow depth" = "black", "air temp" = "red")) +
  scale_shape_manual(
    values = c("Dates that treewells developed" = 16)  # Set shape for points
  ) +
  # Primary y-axis and secondary y-axis for snow depth
  scale_y_continuous(
    labels = scales::label_number(accuracy = 1),
    sec.axis = sec_axis(~./15, name = "Snow Depth (m)")
  ) +
  # Remove legend titles
  guides(
    color = guide_legend(title = NULL),  
    linetype = guide_legend(title = NULL),
    shape = guide_legend(title = NULL)
  ) +
  theme_bw()

p_b_snow_treewell_plot_V2
```

```{r}
accu_dt_ns_LWout <- accu_full_daily_ns_LWout %>%
  filter(phase == "day") %>%
  mutate(zone = case_when(
    zone == "persistent" ~ "PSZ",
    zone == "transitional" ~ "TSZ",
    TRUE ~ zone  # Keep the original value if it's neither "persistent" nor "transitional"
  ))

cum_dt_daily_LWout <- cum_full_daily_LWout %>%
  filter(phase == "day")
```

```{r}
cum_dt_gbdbub_plot <- ggplot(data = cum_dt_daily_LWout) +
  geom_line(aes(x = day, y = accu_daily_gb_LWout_MJperd, color = "green burn", linetype = aspect), linewidth = 0.6) +  
  geom_line(aes(x = day, y = accu_daily_db_LWout_MJperd, color = "dead burn", linetype = aspect), linewidth = 0.6) +
  geom_line(aes(x = day, y = accu_daily_ub_LWout_MJperd, color = "live", linetype = aspect), linewidth = 0.6) +
  facet_wrap(~zone + aspect, dir = "h") +
  theme_bw() +
  labs(
    x = "Date",
    y = "Daily Cumulative LWout (MJ/day)",
    color = "Burn Status", 
    linetype = "Aspect"
  ) +
  scale_color_manual(values = c("green burn" = "#1B7837", "dead burn" = "#D95F02", "live" = adjustcolor("#2166AC", alpha = 0.7))) +
  scale_linetype_manual(values = c("north" = "dashed", "south" = "solid"))

cum_dt_gbdbub_plot
```

Net Rad, Snow Depth, Treewell, AirTemp Plots

```{r}
#creating mean dt average values for the weather station data
mean_dt_transb_wx <- filtered_transb_wx_15min %>%
  filter(phase == "day") %>%
  group_by(day, month, phase, zone, burn_status) %>%
  summarize(SnowDepth_m = mean(SnowDepth_m), AirTC_Avg = mean(AirTC_Avg), SWin_Avg = mean(SWin_Avg), SWout_Avg = mean(SWout_Avg), LWin_Avg = mean(LWin_Avg), LWout_Avg = mean(LWout_Avg), NR_Avg_wperm2 = mean(NR_Avg_new)) %>%
  #creating a MJ/day mean value column for NR
  mutate(NR_Avg_MJperd = (NR_Avg_wperm2 * 86400)/1000000)
```

```{r}
mean_dt_transub_wx <- filtered_transub_wx_15min %>%
  filter(phase == "day") %>%
  group_by(day, month, phase, zone, burn_status) %>%
  summarize(SnowDepth_m = mean(SnowDepth_m), AirTC_Avg = mean(AirTC_Avg), SWin_Avg = mean(SWin_Avg), SWout_Avg = mean(SWout_Avg), LWin_Avg = mean(LWin_Avg), LWout_Avg = mean(LWout_Avg), NR_Avg_wperm2 = mean(NR_Avg_new)) %>%
  #creating a MJ/day mean value column for NR
  mutate(NR_Avg_MJperd = (NR_Avg_wperm2 * 86400)/1000000)
```

```{r}
mean_dt_persb_wx <- filtered_persb_wx_hourly %>%
  filter(phase == "day") %>%
  group_by(day, month, phase, zone, burn_status) %>%
  summarize(SnowDepth_m = mean(SnowDepth_m), AirTC_Avg = mean(AirTC_Avg), SWin_Avg = mean(SWin_Avg), SWout_Avg = mean(SWout_Avg), LWin_Avg = mean(LWin_Avg), LWout_Avg = mean(LWout_Avg), NR_Avg_wperm2 = mean(NR_Avg_new)) %>%
  #creating a MJ/day mean value column for NR
  mutate(NR_Avg_MJperd = (NR_Avg_wperm2 * 86400)/1000000)
```

```{r}
mean_dt_persub_wx <- filtered_persub_wx_15min %>%
  filter(phase == "day") %>%
  group_by(day, month, phase, zone, burn_status) %>%
  summarize(SnowDepth_m = mean(SnowDepth_m), AirTC_Avg = mean(AirTC_Avg), SWin_Avg = mean(SWin_Avg), SWout_Avg = mean(SWout_Avg), LWin_Avg = mean(LWin_Avg), LWout_Avg = mean(LWout_Avg), NR_Avg_wperm2 = mean(NR_Avg_new)) %>%
#creating a MJ/day mean value column for NR
  mutate(NR_Avg_MJperd = (NR_Avg_wperm2 * 86400)/1000000)
```

```{r}
#creating dataframes for the a mean daily value of the gb and db tree LWout values for both zones
p_b_dt_mean_treeLWout <- full_15min_ns_LWout %>%
  mutate(zone = case_when(zone == "persistent" ~ "PSZ", zone == "transitional" ~ "TSZ")) %>%
  #making a column that includes the tree LWout in MJper day for both the north and south sides of the tree
  mutate(full_tree_LWout_MJperd = n_LWout_MJperd + s_LWout_MJperd) %>%
  #getting only daytime values
  filter(zone == "PSZ", phase == "day") %>%
  #filtering out only gb and db trees
  filter(burn_status %in% c("green burn", "dead burn")) %>%
  #geting daily value
  group_by(day, month, phase, zone) %>%
  summarize(full_tree_LWout_MJperd = mean(full_tree_LWout_MJperd)) %>%
  #adding in a burned burn status column for plots
  mutate(burn_status = "burned")
```

```{r}
t_b_dt_mean_treeLWout <- full_15min_ns_LWout %>%
  mutate(zone = case_when(zone == "persistent" ~ "PSZ", zone == "transitional" ~ "TSZ")) %>%
  #making a column that includes the tree LWout in MJper day for both the north and south sides of the tree
  mutate(full_tree_LWout_MJperd = n_LWout_MJperd + s_LWout_MJperd) %>%
  #getting only daytime values
  filter(zone == "TSZ", phase == "day") %>%
  #filtering out only gb and db trees
  filter(burn_status %in% c("green burn", "dead burn")) %>%
  #geting daily value
  group_by(day, month, phase, zone) %>%
  #getting daily average tree_LWout value
  summarize(full_tree_LWout_MJperd = mean(full_tree_LWout_MJperd)) %>%
  #adding in a burned burn status column for plots
  mutate(burn_status = "burned")
```

```{r}
#mean dataframes for a single averaged dt temp by burn_status for burned & unburned

##persistent
p_b_dt_avg_temp <- full_15min_ns %>%
  filter(burn_status %in% c("green burn", "dead burn"), zone == "persistent", phase == "day") %>%
  mutate(zone = "PSZ") %>%
  select(datetime, day, month, phase, zone, burn_status, ns_avg_temp) %>%
  group_by(day, month, phase, zone) %>%
  summarize(mean_temp = mean(ns_avg_temp))

##transitional
t_b_dt_avg_temp <- full_15min_ns %>%
  filter(burn_status %in% c("green burn", "dead burn"), zone == "transitional", phase == "day") %>%
  mutate(zone = "TSZ") %>%
  select(datetime, day, month, phase, zone, burn_status, ns_avg_temp) %>%
  group_by(day, month, phase, zone) %>%
  summarize(mean_temp = mean(ns_avg_temp))
```

```{r}
#creating a new dataframe with snow depths and treewell development, as well as tree_LWout so that I can put points on snowdepths instead of total treeLWout line in plots
persb_treewell_dates <- persb_snowcamera_data %>%
  select(zone, burn_status, date, conditions, treewell_developed, snowcam_max_depth_m) %>%
  rename(day = date) %>%
  inner_join(p_b_dt_avg_temp) %>%
  filter(treewell_developed == "yes")
```

```{r}
transb_treewell_dates <- transb_snowcamera_data %>%
  select(zone, date, conditions, treewell_developed, snowcam_max_depth_m) %>%
  rename(day = date) %>%
  inner_join(t_b_dt_avg_temp) %>%
  filter(treewell_developed == "yes")
```

Plotting

\*\* USING THIS PLOT!

```{r}
p_snowtreewell_NR_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = mean_dt_persb_wx, aes(x = day, y = NR_Avg_MJperd, fill = "net radiation"), position = "stack", alpha = 0.6) +
  #air temp line
  geom_line(data = mean_dt_persb_wx, aes(x = day, y = AirTC_Avg, color = "air temp"), linewidth = 0.8) +
  geom_line(data = p_b_dt_avg_temp, aes(x = day, y = mean_temp, color = "tree temp"), alpha = 0.8, linewidth = 0.8) +
  # Line plot for snow cam max depth on a secondary y-axis
  #transitional snow depths + tree wells
  geom_line(data = persb_snowcamera_data, aes(x = date, y = snowcam_max_depth_m*5, color = "snow depth"), linewidth = 0.8) +
  geom_point(data = persb_treewell_dates, aes(x = day, y = snowcam_max_depth_m*5, 
             shape = "dates that treewells developed"), 
             color = "black", fill = "black", size = 1.5) +
  facet_wrap(~burn_status) +
  labs(
    title = "a) PSZ",
    x = NULL,
    y = "Total Net Rad (MJ/day) & Temp (Â°C)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("air temp" = "#D95F02", "tree temp" = "#1B7837", "snow depth" = "#2166AC")) +
  scale_fill_manual(name = "Radiation Data", 
                    values = c("net radiation" = "#666666")) +
  scale_shape_manual(values = c("dates that treewells developed" = 21)) +
  guides(color = guide_legend(title = NULL),  # Remove title for color legend
         fill = guide_legend(title = NULL), #Remove fill legend
         shape = guide_legend(title = NULL)) +
  scale_x_date(
    limits = c(as.Date("2024-02-02"), as.Date("2024-05-23")), 
    expand = c(0.02, 0.02)  # Remove extra space on the x-axis
  ) +# Remove title for shape legend
  scale_y_continuous(
    limits = c(-18, 18),
    sec.axis = sec_axis(~./4, name = "Snow Depth (m)")  # Adjusting for the secondary axis
  ) +
  theme_bw() + 
  theme(
    plot.title = element_text(size = 13),      # Title size
    axis.title.x = element_text(size = 11),                   # X-axis title size
    axis.title.y = element_text(size = 11),                   # Y-axis title size
    axis.text = element_text(size = 11),                      # Axis text size
    legend.text = element_text(size = 12),                    # Legend text size
    legend.title = element_text(size = 12),                   # Legend title size
    strip.text = element_text(size = 12))

p_snowtreewell_NR_plot
```

```{r}
t_snowtreewell_NR_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = mean_dt_transb_wx, aes(x = day, y = NR_Avg_MJperd, fill = "net radiation"), position = "stack", alpha = 0.6) +
  #air temp line
  geom_line(data = mean_dt_transb_wx, aes(x = day, y = AirTC_Avg, color = "air temp"), linewidth = 0.8) +
  geom_line(data = t_b_dt_avg_temp, aes(x = day, y = mean_temp, color = "tree temp"), alpha = 0.8, linewidth = 0.8) +
  # Line plot for snow cam max depth on a secondary y-axis
  #transitional snow depths + tree wells
  geom_line(data = transb_snowcamera_data, aes(x = date, y = snowcam_max_depth_m*5, color = "daily max snow depth"), linewidth = 0.8) +
  geom_point(data = transb_treewell_dates, aes(x = day, y = snowcam_max_depth_m*5, 
             shape = "dates that treewells developed"), 
             color = "black", fill = "black", size = 1.5) +
  facet_wrap(~burn_status) +
  labs(
    title = "b) TSZ",
    x = "Date",
    y = "Total Net Rad (MJ/day) & Temp (Â°C)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("air temp" = "#D95F02", "tree temp" = "#1B7837", "daily max snow depth" = "#2166AC")) +
  scale_fill_manual(name = "Radiation Data", 
                    values = c("net radiation" = "#666666")) +
  scale_shape_manual(values = c("dates that treewells developed" = 21)) +
  guides(color = guide_legend(title = NULL),  # Remove title for color legend
         fill = guide_legend(title = NULL), #Remove fill legend
         shape = guide_legend(title = NULL)) +
  scale_x_date(
    limits = c(as.Date("2024-02-02"), as.Date("2024-05-23")), 
    expand = c(0.02, 0.02)  # Remove extra space on the x-axis
  ) +# Remove title for shape legend
  scale_y_continuous(
    limits = c(-18, 18),
    sec.axis = sec_axis(~./4, name = "Snow Depth (m)")  # Adjusting for the secondary axis
  ) +
  theme_bw() + 
  theme(
    plot.title = element_text(size = 13),      # Title size
    axis.title.x = element_text(size = 11),                   # X-axis title size
    axis.title.y = element_text(size = 11),                   # Y-axis title size
    axis.text = element_text(size = 11),                      # Axis text size
    legend.text = element_text(size = 12),                    # Legend text size
    legend.title = element_text(size = 12),                   # Legend title size
    strip.text = element_text(size = 12))

t_snowtreewell_NR_plot
```

\*\* 2024-11-7 - figure out why the above plots are now showing all negative NR, then fix this before exporting new plots!

```{r}
#combining above plots
comb_b_snowtreewell_NR_plots <- ggarrange(p_snowtreewell_NR_plot, t_snowtreewell_NR_plot, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")

comb_b_snowtreewell_NR_plots
```

Plotting the same graph but with tree LWout instead of total net radiation

-   this doesn't show the pattern as well as the NR plots do, so I probably won't use this...
-   \*\* keep working on this... all my radiation bars are now negative? as of 2024-10-29

```{r}
p_snowtreewell_treeLWout_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_line(data = p_b_dt_mean_treeLWout, aes(x = day, y = full_tree_LWout_MJperd, color = "tree LWout"), linewidth = 0.8) +
  #air temp line
  geom_line(data = mean_dt_persb_wx, aes(x = day, y = AirTC_Avg, color = "air temp"), linewidth = 0.8) +
  # Line plot for snow cam max depth on a secondary y-axis
  #transitional snow depths + tree wells
  geom_line(data = persb_snowcamera_data, aes(x = date, y = snowcam_max_depth_m*8, color = "daily max snow depth"), linewidth = 0.8) +
  geom_point(data = persb_treewell_dates, aes(x = date, y = snowcam_max_depth_m*8, 
             shape = "dates that treewells developed"), 
             color = "black", fill = "black", size = 1.5) +
  facet_wrap(~burn_status) +
  labs(
    title = "a) PSZ",
    x = NULL,
    y = "Radiation Component (MJ/day) & Air Temp (Â°C)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("air temp" = "#D95F02", "daily max snow depth" = "#2166AC", "tree LWout" = "#666666")) +
  #scale_fill_manual(name = "Radiation Data", 
                    #values = c("tree LWout" = "#666666")) +
  scale_shape_manual(values = c("dates that treewells developed" = 21)) +
  guides(color = guide_legend(title = NULL),  # Remove title for color legend
        # fill = guide_legend(title = NULL), #Remove fill legend
         shape = guide_legend(title = NULL)) +
  scale_x_date(
    #limits = c(as.Date("2024-02-02"), as.Date("2024-05-23")), 
   # expand = c(0.02, 0.02)  # Remove extra space on the x-axis
  ) +# Remove title for shape legend
  scale_y_continuous(
    limits = c(-18, 18),
    sec.axis = sec_axis(~./4, name = "Snow Depth (m)")  # Adjusting for the secondary axis
  ) +
  theme_bw() + 
  theme(
    plot.title = element_text(size = 13),      # Title size
    axis.title.x = element_text(size = 11),                   # X-axis title size
    axis.title.y = element_text(size = 11),                   # Y-axis title size
    axis.text = element_text(size = 11),                      # Axis text size
    legend.text = element_text(size = 12),                    # Legend text size
    legend.title = element_text(size = 12),                   # Legend title size
    strip.text = element_text(size = 12))

p_snowtreewell_treeLWout_plot
```
