---
title: "treetemp_finalplots"
output: html_document
date: "2024-10-25"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(lterdatasampler)
library(dplyr)
library(ggplot2)
library(readr)
library(readxl)
library(lubridate)
library(plotly)
library(openxlsx)
library(plotly)
library(rstatix)
library(htmlwidgets)
library(RColorBrewer)
library(patchwork)
library(ggpubr)
library(suncalc)
library(ggpattern)
library(hms)

setwd("/Volumes/wcnr-network/Research/Kampf/Private/field_data")
```

```{r}
#clear prior environment
rm(list = ls())
```

```{r}
#to display the colors
display.brewer.pal(n = 8, name = "Dark2")

#to get the hex number of the colors
brewer.pal(n = 8, name = "Dark2")
```

# Loading in Data

```{r}
p_b_solar_times <- read_csv("nsf/treetemp_data/p_b_solar_times.csv") %>%
  mutate(
    sunrise = as.POSIXct(sunrise, format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
    sunrise = with_tz(sunrise, tz = "MST")
  ) %>%
   mutate(
    sunset = as.POSIXct(sunset, format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
    sunset = with_tz(sunset, tz = "MST")
  )
```

```{r}
#new full dataframes to load - including burned and unburned/ all burn_status types together
full_15min_ns <- read_csv("nsf/treetemp_data/full_15min_ns.csv") %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = with_tz(datetime, tz = 'MST')) %>%
  mutate(day = as.Date(day, format = ("%Y-%m-%d"))) %>%
  inner_join(p_b_solar_times, by = "day") %>%
  #creating a phase column that parses by daily sunrise/sunset times
  mutate(
    phase = case_when(
      datetime >= sunrise & datetime < sunset ~ "day",
      datetime < sunrise ~ "night",
      datetime >= sunset ~ "night",
      TRUE ~ NA_character_)) %>%
  select(datetime, day, month, phase, zone, snow_phase, burn_status, north_temp, south_temp, solarNoon, sunrise, sunset, dawn, dusk)

full_hourly_ns <- read_csv("nsf/treetemp_data/full_hourly_ns.csv") %>%
   mutate(datetime_hour = as.POSIXct(datetime_hour, format=("%Y-%m-%d %H:%M:%S")),
                               datetime_hour = force_tz(datetime_hour, tz = 'MST')) %>%
  mutate(day = as.Date(day, format = ("%Y-%m-%d")))

full_15min_gbdbub <- read_csv("nsf/treetemp_data/full_15min_gbdbub.csv") %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = with_tz(datetime, tz = 'MST'), ,
    day = as.Date(datetime, tz= "MST")) %>%
  inner_join(p_b_solar_times, by = "day") %>%
  #creating a phase column that parses by daily sunrise/sunset times
  mutate(
    phase = case_when(
      datetime >= sunrise & datetime < sunset ~ "day",
      datetime < sunrise ~ "night",
      datetime >= sunset ~ "night",
      TRUE ~ NA_character_)) %>%
  select(datetime, day, month, phase, zone, snow_phase, aspect, gb_temp, db_temp, ub_temp, solarNoon, sunrise, sunset, dawn, dusk)

#don't need hourly dbgbub dataframe! Therefore I haven't update this code line to include phase, et. 

#full_hourly_gbdbub <- read_csv("nsf/treetemp_data/full_hourly_gbdbub.csv") %>%
 # mutate(datetime_hour = as.POSIXct(datetime_hour, format=("%Y-%m-%d %H:%M:%S")),
                     #          datetime_hour = force_tz(datetime_hour, tz = 'MST'))  %>%
 # select(-1)

full_hourly_gb <- read_csv("nsf/treetemp_data/full_hourly_gb.csv") %>%
  mutate(datetime_hour = as.POSIXct(datetime_hour, format=("%Y-%m-%d %H:%M:%S")),
                               datetime_hour = force_tz(datetime_hour, tz = 'MST'))
```

\*\* as of 2025-01-10 - new data for temp figures separated by burn status

```{r}
full_pers_gbdbub_data <- full_15min_gbdbub %>%
  filter(zone == "PSZ")

full_trans_gbdbub_data <- full_15min_gbdbub %>%
  filter(zone == "TSZ")
```

```{r}
#weather station data for tree well/snow depth plots
transb_snowcamera_data <- read_csv("nsf/camera_snowdepths/2024_105E_transb_snowdepths.csv") %>%
  rename(snowcam_max_depth_cm = "maximum_depth(cm)") %>%
  mutate(day = as.Date(date, format = "%Y-%m-%d")) %>%  # Update format if necessary
  # Adjusting the treewell developed column to just yes/no
  mutate(treewell_developed = case_when(
    treewell_developed == "maybe" ~ "yes",
    treewell_developed == "no snow" ~ "no",
    TRUE ~ treewell_developed  # Keep other values unchanged
  )) %>%
  mutate(snowcam_max_depth_m = snowcam_max_depth_cm / 100) %>%
  # Filtering to timerange for these plots
  filter(day >= as.Date("2024-02-02") & day < as.Date("2024-07-01")) %>%
  mutate(zone = "TSZ") %>%
  mutate(burn_status = "burned")

persb_snowcamera_data <- read_csv("nsf/camera_snowdepths/2024_persb_lp_high_east_snowdepths.csv") %>%
  rename(snowcam_max_depth_cm = "max_depth_cm") %>%
  mutate(day = as.Date(date)) %>%
  rename(treewell_developed = treewell_developement) %>%
  mutate(treewell_developed = case_when(
    treewell_developed == "maybe" ~ "yes",
    treewell_developed == "no snow" ~ "no",
    TRUE ~ treewell_developed  # keep other values unchanged
  )) %>%
  mutate(snowcam_max_depth_m = snowcam_max_depth_cm/100) %>%
  #filtering to timerange for these plots
  filter(day >= as.Date("2024-02-02") & day < as.Date("2024-07-01")) %>%
  mutate(zone = "PSZ") 
```

```{r}
#tree LWout and treeLWout cumulative datasets
full_15min_gbdbub_LWout <- read_csv("nsf/treetemp_data/full_15min_gbdbub_LWout.csv")

full_15min_ns_LWout <- read_csv("nsf/treetemp_data/full_15min_ns_LWout.csv")

cum_full_daily_LWout <- read_csv("nsf/treetemp_data/cum_full_daily_treeLWout.csv")

cum_full_daily_gbdbub_treeLWout <- read_csv("nsf/treetemp_data/cum_full_daily_gbdbub_treeLWout.csv")

cum_dt_gbdbub_LWout <- read_csv("nsf/treetemp_data/cum_full_daily_gbdbub_treeLWout.csv")
```

Weather Data

```{r}
transb_wx_15min_r <- read_csv('nsf/trans_burned/trans_burned_wx_15min_r.csv') %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = with_tz(datetime, tz = 'MST'))

transub_wx_15min_r <- read_csv('nsf/trans_unburned/trans_unburned_wx_15min_r.csv') %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = with_tz(datetime, tz = 'MST'))

persb_wx_hourly_r <- read_csv('nsf/pers_burned/pers_burned_wx_hourly_r.csv') %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = with_tz(datetime, tz = 'MST'))

#persub_wx_15min_r <- read_csv('nsf/pers_unburned/pers_unburned_wx_15min_r.csv') %>%
  #mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                       #        datetime = with_tz(datetime, tz = 'MST'))

#use hourly unburned and burned for PSZ
persub_wx_hourly_r <- read_csv('nsf/pers_unburned/pers_unburned_wx_hourly_r.csv') %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = with_tz(datetime, tz = 'MST'))
```

```{r}
#filtered weather data to the datetime range that we need and added phase and NR_Avg_calcs
filtered_transb_wx_15min <- transb_wx_15min_r %>%
  mutate(day = as.Date.POSIXct(datetime, tz = "MST"),
    month = as.numeric(format(datetime, "%m")),
    datetime = with_tz(datetime, tzone = "MST")) %>%
  filter(datetime >= as.POSIXct("2024-02-02 00:00:00", tz = "MST") & 
         datetime < as.POSIXct("2024-07-01 00:00:00", tz = "MST")) %>%
  inner_join(p_b_solar_times, by = "day") %>%
  #creating a phase column that parses by daily sunrise/sunset times
  mutate(
    phase = case_when(
      datetime >= sunrise & datetime < sunset ~ "day",
      datetime < sunrise ~ "night",
      datetime >= sunset ~ "night",
      TRUE ~ NA_character_)) %>%
  mutate(zone = "TSZ", burn_status = "burned") %>%
  filter(!is.nan(SWin_Avg)) %>%
  #adding in my own calculated NR_Avg column
  mutate(NR_Avg_new = (SWin_Avg - SWout_Avg) + (LWin_Avg - LWout_Avg)) %>%
  select(datetime, day, month, phase, zone, burn_status, NR_Avg_new, everything())
```

```{r}
filtered_transub_wx_15min <- transub_wx_15min_r %>%
  mutate(day = as.Date.POSIXct(datetime, tz = "MST"),
    month = as.numeric(format(datetime, "%m")),
    datetime = with_tz(datetime, tzone = "MST")) %>%
  filter(datetime >= as.POSIXct("2024-02-02 00:00:00", tz = "MST") & 
         datetime < as.POSIXct("2024-07-01 00:00:00", tz = "MST")) %>%
  inner_join(p_b_solar_times, by = "day") %>%
  #creating a phase column that parses by daily sunrise/sunset times
  mutate(
    phase = case_when(
      datetime >= sunrise & datetime < sunset ~ "day",
      datetime < sunrise ~ "night",
      datetime >= sunset ~ "night",
      TRUE ~ NA_character_)) %>%
  mutate(zone = "TSZ", burn_status = "unburned") %>%
  #adding in my own calculated NR_Avg column
  mutate(NR_Avg_new = (SWin_Avg - SWout_Avg) + (LWin_Avg - LWout_Avg)) %>%
  select(datetime, day, month, phase, zone, burn_status, NR_Avg_new, everything())
```

```{r}
filtered_persb_wx_hourly <- persb_wx_hourly_r %>%
  mutate(day = as.Date.POSIXct(datetime, tz = "MST"),
    month = as.numeric(format(datetime, "%m")),
    datetime = with_tz(datetime, tzone = "MST")) %>%
  filter(datetime >= as.POSIXct("2024-02-02 00:00:00", tz = "MST") & 
         datetime < as.POSIXct("2024-07-01 00:00:00", tz = "MST")) %>%
  inner_join(p_b_solar_times, by = "day") %>%
  #creating a phase column that parses by daily sunrise/sunset times
  mutate(
    phase = case_when(
      datetime >= sunrise & datetime < sunset ~ "day",
      datetime < sunrise ~ "night",
      datetime >= sunset ~ "night",
      TRUE ~ NA_character_)) %>%
  mutate(zone = "PSZ", burn_status = "burned") %>%
 #adding in my own calculated NR_Avg column
  mutate(NR_Avg_new = (SWin_Avg - SWout_Avg) + (LWin_Avg - LWout_Avg)) %>%
  select(datetime, day, month, phase, zone, burn_status, NR_Avg_new, everything())
```

```{r}
filtered_persub_wx_hourly <- persub_wx_hourly_r %>%
  mutate(day = as.Date.POSIXct(datetime, tz = "MST"),
    month = as.numeric(format(datetime, "%m")),
    datetime = with_tz(datetime, tzone = "MST")) %>%
  filter(datetime >= as.POSIXct("2024-02-02 00:00:00", tz = "MST") & 
         datetime < as.POSIXct("2024-07-01 00:00:00", tz = "MST")) %>%
  inner_join(p_b_solar_times, by = "day") %>%
  #creating a phase column that parses by daily sunrise/sunset times
  mutate(
    phase = case_when(
      datetime >= sunrise & datetime < sunset ~ "day",
      datetime < sunrise ~ "night",
      datetime >= sunset ~ "night",
      TRUE ~ NA_character_)) %>%
  mutate(zone = "PSZ", burn_status = "unburned") %>%
  #adding in my own calculated NR_Avg column
  mutate(NR_Avg_new = (SWin_Avg - SWout_Avg) + (LWin_Avg - LWout_Avg)) %>%
  select(datetime, day, month, phase, zone, burn_status, NR_Avg_new, everything())
```

Raw Aspect Data with all sensors included

```{r}
filtered_pers_b_aspects_r <- read_csv("nsf/treetemp_data/filtered_pers_b_aspects_r.csv") %>%
  select(-sensor_id) %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = force_tz(datetime, tz = 'MST')) %>%
  filter(datetime >= "2024-02-02 00:00:00" & datetime < "2024-07-01 00:00:00") %>%
  filter(tree_name != "gb_w", aspect != c("charred", "uncharred"))

filtered_pers_ub_aspects_r <- read_csv("nsf/treetemp_data/filtered_pers_ub_aspects_r.csv") %>%
  select(-sensor_id) %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = force_tz(datetime, tz = 'MST')) %>%
  filter(datetime >= "2024-02-02 00:00:00" & datetime < "2024-07-01 00:00:00")

filtered_trans_b_aspects_r <- read_csv("nsf/treetemp_data/filtered_trans_b_aspects_r.csv") %>%
  select(-sensor_id) %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = force_tz(datetime, tz = 'MST')) %>%
  filter(datetime >= "2024-02-02 00:00:00" & datetime < "2024-07-01 00:00:00") %>%
  filter(tree_name != "gb_w", aspect != c("charred", "uncharred"))

filtered_trans_ub_aspects_r <- read_csv("nsf/treetemp_data/filtered_trans_ub_aspects_r.csv") %>%
  select(-sensor_id) %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = force_tz(datetime, tz = 'MST')) %>%
  filter(datetime >= "2024-02-02 00:00:00" & datetime < "2024-07-01 00:00:00")
```

TotalNetRad = (SWin -SWout) + (LWin - LWout) + LWout_tree)

# Plotting

## Individual Sensor Comparison Line Plot

```{r}
#datawrangling to get a dataframe with all temperatures for burned and unburned data
full_pers_aspects <- rbind(filtered_pers_b_aspects_r, filtered_pers_ub_aspects_r)

full_trans_aspects <- rbind(filtered_trans_b_aspects_r, filtered_trans_ub_aspects_r)
```

PSZ

```{r}
PSZ_single_day_sensor_comp_gb <- full_pers_aspects %>%
  filter(burn_status == "green burn", datetime >= "2024-03-10 00:00:00" & datetime <= "2024-03-10 23:45:00")

PSZ_single_day_sensor_comp_db <- full_pers_aspects %>%
  filter(burn_status == "dead burn", datetime >= "2024-03-10 00:00:00" & datetime <= "2024-03-10 23:45:00")

PSZ_single_day_sensor_comp_live <- full_pers_aspects %>%
  filter(burn_status == "live", datetime >= "2024-03-10 00:00:00" & datetime <= "2024-03-10 23:45:00")
```

```{r}
PSZ_db_singlesensor_comp_plot <- ggplot(data = PSZ_single_day_sensor_comp_db) +
  geom_line(aes(x = datetime, y = temp, linetype = tree_name), color = "#D95F02", linewidth = 0.7) +
  scale_linetype_manual(
    name = "Tree Name",                 # Legend title
    values = c("db_n" = "dashed",       # Linetype mapping
               "db_s" = "solid"),
    labels = c("db_n" = "DB tree #1",    # Custom legend labels
               "db_s" = "DB tree #2")
  ) +
  facet_wrap(~aspect) +
  #sunrise time
  geom_vline(xintercept = as.numeric(as.POSIXct("2024-03-10 06:30:00")), 
             linetype = "solid",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8) + 
  #sunset time
  geom_vline(xintercept = as.numeric(as.POSIXct("2024-03-10 18:15:00")), 
             linetype = "dashed",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8) + 
  labs(title = "a) PSZ DB", x = NULL, y = "Temperature (°C)") +
  scale_y_continuous(limits = c(-15, 31)) +  # Set the y-axis limits here
  theme_bw()

PSZ_db_singlesensor_comp_plot
```

```{r}
PSZ_gb_singlesensor_comp_plot <- ggplot(data = PSZ_single_day_sensor_comp_gb) +
  geom_line(aes(x = datetime, y = temp, linetype = tree_name), color = "#1B7837", linewidth = 0.7) +
  scale_linetype_manual(
    name = "Tree Name",                 # Legend title
    values = c("gb_e" = "dashed",       # Linetype mapping
               "gb_s" = "solid"),
    labels = c("gb_e" = "GB tree #1",    # Custom legend labels
               "gb_s" = "GB tree #2")
  ) +
  facet_wrap(~aspect) +
  #sunrise time
  geom_vline(xintercept = as.numeric(as.POSIXct("2024-03-10 06:30:00")), 
             linetype = "solid",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8) + 
  #sunset time
  geom_vline(xintercept = as.numeric(as.POSIXct("2024-03-10 18:15:00")), 
             linetype = "dashed",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8) + 
  labs(title = "b) PSZ GB", x = NULL, y = "Temperature (°C)") +
   scale_y_continuous(limits = c(-15, 33)) +
  theme_bw()

PSZ_gb_singlesensor_comp_plot
```

```{r}
PSZ_live_singlesensor_comp_plot <- ggplot(data = PSZ_single_day_sensor_comp_live) +
  geom_line(aes(x = datetime, y = temp, linetype = tree_name), color = "#2166AC", linewidth = 0.7, alpha = 0.8) +
  scale_linetype_manual(
    name = "Tree Name",                 # Legend title
    values = c("ub_n" = "dashed",       # Linetype mapping
               "ub_s" = "solid"),
    labels = c("ub_n" = "live tree #1",    # Custom legend labels
               "ub_s" = "live tree #2")
  ) +
  facet_wrap(~aspect) +
  #sunrise time
  geom_vline(xintercept = as.numeric(as.POSIXct("2024-03-10 06:30:00")), 
             linetype = "solid",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8) + 
  #sunset time
  geom_vline(xintercept = as.numeric(as.POSIXct("2024-03-10 18:15:00")), 
             linetype = "dashed",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8) + 
  labs(title = "c) PSZ Live", x = "Date & Time (MST)", y = "Temperature (°C)") +
   scale_y_continuous(limits = c(-15, 33)) +
  theme_bw()

PSZ_live_singlesensor_comp_plot
```

```{r}
PSZ_comb_singlesensor_comp_lineplot <- ggarrange(PSZ_db_singlesensor_comp_plot, PSZ_gb_singlesensor_comp_plot, PSZ_live_singlesensor_comp_plot, nrow = 3, ncol = 1, legend = "right")

PSZ_comb_singlesensor_comp_lineplot
```

TSZ

```{r}
TSZ_single_day_sensor_comp_gb <- full_trans_aspects %>%
  filter(burn_status == "green burn", datetime >= "2024-03-10 00:00:00" & datetime <= "2024-03-10 23:45:00")

TSZ_single_day_sensor_comp_db <- full_trans_aspects %>%
  filter(burn_status == "dead burn", datetime >= "2024-03-10 00:00:00" & datetime <= "2024-03-10 23:45:00")

TSZ_single_day_sensor_comp_live <- full_trans_aspects %>%
  filter(burn_status == "live", datetime >= "2024-03-10 00:00:00" & datetime <= "2024-03-10 23:45:00")
```

```{r}
TSZ_db_singlesensor_comp_plot <- ggplot(data = TSZ_single_day_sensor_comp_db) +
  geom_line(aes(x = datetime, y = temp, linetype = tree_name), color = "#D95F02", linewidth = 0.7) +
  scale_linetype_manual(
    name = "Tree Name",                 # Legend title
    values = c("db_n" = "dashed",       # Linetype mapping
               "db_s" = "solid"),
    labels = c("db_n" = "DB tree #1",    # Custom legend labels
               "db_s" = "DB tree #2")
  ) +
  facet_wrap(~aspect) +
 #sunrise time
  geom_vline(xintercept = as.numeric(as.POSIXct("2024-03-10 06:30:00")), 
             linetype = "solid",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8) + 
  #sunset time
  geom_vline(xintercept = as.numeric(as.POSIXct("2024-03-10 18:15:00")), 
             linetype = "dashed",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8) + 
  labs(title = "d) TSZ DB", x = NULL, y = "Temperature (°C)") +
  scale_y_continuous(limits = c(-15, 33)) +
  theme_bw()

TSZ_db_singlesensor_comp_plot
```

```{r}
TSZ_gb_singlesensor_comp_plot <- ggplot(data = TSZ_single_day_sensor_comp_gb) +
  geom_line(aes(x = datetime, y = temp, linetype = tree_name), color = "#1B7837", linewidth = 0.7) +
  scale_linetype_manual(
    name = "Tree Name",                 # Legend title
    values = c("gb_n" = "dashed",       # Linetype mapping
               "gb_s" = "solid"),
    labels = c("gb_n" = "GB tree #1",    # Custom legend labels
               "gb_s" = "GB tree #2")
  ) +
  facet_wrap(~aspect) +
 #sunrise time
  geom_vline(xintercept = as.numeric(as.POSIXct("2024-03-10 06:30:00")), 
             linetype = "solid",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8) + 
  #sunset time
  geom_vline(xintercept = as.numeric(as.POSIXct("2024-03-10 18:15:00")), 
             linetype = "dashed",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8) + 
  labs(title = "e) TSZ GB", x = NULL, y = "Temperature (°C)") +
  scale_y_continuous(limits = c(-15, 33)) +
  theme_bw()

TSZ_gb_singlesensor_comp_plot
```

```{r}
TSZ_live_singlesensor_comp_plot <- ggplot(data = TSZ_single_day_sensor_comp_live) +
  geom_line(aes(x = datetime, y = temp, linetype = tree_name), color = "#2166AC", linewidth = 0.7, alpha = 0.8) +
  scale_linetype_manual(
    name = "Tree Name",                 # Legend title
    values = c("ub_w" = "dashed",       # Linetype mapping
               "ub_e" = "solid"),
    labels = c("ub_w" = "live tree #1",    # Custom legend labels
               "ub_e" = "live tree #2")
  ) +
  facet_wrap(~aspect) +
 #sunrise time
  geom_vline(xintercept = as.numeric(as.POSIXct("2024-03-10 06:30:00")), 
             linetype = "solid",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8) + 
  #sunset time
  geom_vline(xintercept = as.numeric(as.POSIXct("2024-03-10 18:15:00")), 
             linetype = "dashed",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8) + 
  labs(title = "f) TSZ Live", x = "Date & Time (MST)", y = "Temperature (°C)") +
  scale_y_continuous(limits = c(-15, 33)) +
  theme_bw()

TSZ_live_singlesensor_comp_plot
```

```{r}
TSZ_comb_singlesensor_comp_lineplot <- ggarrange(TSZ_db_singlesensor_comp_plot, TSZ_gb_singlesensor_comp_plot, TSZ_live_singlesensor_comp_plot, nrow = 3, ncol = 1, legend = "right")

TSZ_comb_singlesensor_comp_lineplot
```

```{r}
##Use this method of combining plots -> it solves the issue with repeated legends!
comb_db_singlesensor_lineplot<- ggarrange(PSZ_db_singlesensor_comp_plot, TSZ_db_singlesensor_comp_plot, ncol = 2, nrow = 1, common.legend = TRUE, legend = "right")

comb_db_singlesensor_lineplot

comb_gb_singlesensor_lineplot<- ggarrange(PSZ_gb_singlesensor_comp_plot, TSZ_gb_singlesensor_comp_plot, ncol = 2, nrow = 1, common.legend = TRUE, legend = "right")

comb_gb_singlesensor_lineplot

comb_live_singlesensor_lineplot<- ggarrange(PSZ_live_singlesensor_comp_plot, TSZ_live_singlesensor_comp_plot, ncol = 2, nrow = 1, common.legend = TRUE, legend = "right")

comb_live_singlesensor_lineplot
```

```{r}
#final combined single day plot

comb_singlesensor_lineplot <- ggarrange(comb_db_singlesensor_lineplot, comb_gb_singlesensor_lineplot, comb_live_singlesensor_lineplot, nrow = 3, ncol = 1, common.legend = TRUE, legend = "right")

comb_singlesensor_lineplot
```

## Daytime vs Nighttime Tree Temp Plot - GB/DB/UB with aspects

```{r}
#creating dataframe for this that has renamed zones - mean daily value!!
dt_full_daily_gbdbub_plot_dataframe <- full_15min_gbdbub %>%
  #selecting data that we need
  select(datetime, day, month, phase, zone, snow_phase, aspect, gb_temp, db_temp, ub_temp) %>%
  filter(phase == "day") %>%
  #summarizing for one daily value
  group_by(day, month, phase, zone, snow_phase, aspect) %>%
  summarize(gb_temp = mean(gb_temp), db_temp = mean(db_temp), ub_temp = mean(ub_temp))
  

nt_full_daily_gbdbub_plot_dataframe <- full_15min_gbdbub %>%
  #selecting data that we need
  select(datetime, day, month, phase, zone, snow_phase, aspect, gb_temp, db_temp, ub_temp) %>%
  filter(phase == "night") %>%
  #summarizing for one daily value
  group_by(day, month, phase, zone, snow_phase, aspect) %>%
  summarize(gb_temp = mean(gb_temp), db_temp = mean(db_temp), ub_temp = mean(ub_temp))
```

```{r}
stats_dtnt_byburnstatus <- full_15min_gbdbub %>%
  group_by(zone, phase) %>%
  summarize(mean_gb_temp = mean(gb_temp), mean_db_temp = mean(db_temp), mean_ub_temp = mean(ub_temp))
```

\*\* as of 2025-01-13 - use the below plots instead of above plots!

```{r}
#parsing by zone instead - South Aspect only!
#creating dataframe for this that has renamed zones - mean daily value!!
PSZ_s_dtnt_daily_gbdbub_plot_dataframe <- full_pers_gbdbub_data %>%
  filter(aspect == "south") %>%
  #selecting data that we need
  select(datetime, day, month, phase, zone, aspect, gb_temp, db_temp, ub_temp) %>%
  #summarizing for one daily value
  group_by(day, month, phase, zone, aspect) %>%
  summarize(gb_temp = mean(gb_temp), db_temp = mean(db_temp), ub_temp = mean(ub_temp))
  

TSZ_s_dtnt_daily_gbdbub_plot_dataframe <- full_trans_gbdbub_data %>%
  filter(aspect == "south") %>%
  #selecting data that we need
  select(datetime, day, month, phase, zone, aspect, gb_temp, db_temp, ub_temp) %>%
  #summarizing for one daily value
  group_by(day, month, phase, zone, aspect) %>%
  summarize(gb_temp = mean(gb_temp), db_temp = mean(db_temp), ub_temp = mean(ub_temp))

#North aspect only!
PSZ_n_dtnt_daily_gbdbub_plot_dataframe <- full_pers_gbdbub_data %>%
  filter(aspect == "north") %>%
  #selecting data that we need
  select(datetime, day, month, phase, zone, aspect, gb_temp, db_temp, ub_temp) %>%
  #summarizing for one daily value
  group_by(day, month, phase, zone, aspect) %>%
  summarize(gb_temp = mean(gb_temp), db_temp = mean(db_temp), ub_temp = mean(ub_temp))
  

TSZ_n_dtnt_daily_gbdbub_plot_dataframe <- full_trans_gbdbub_data %>%
  filter(aspect == "north") %>%
  #selecting data that we need
  select(datetime, day, month, phase, zone, aspect, gb_temp, db_temp, ub_temp) %>%
  #summarizing for one daily value
  group_by(day, month, phase, zone, aspect) %>%
  summarize(gb_temp = mean(gb_temp), db_temp = mean(db_temp), ub_temp = mean(ub_temp))

```

```{r}
#getting accumulation vs ablation stats
PSZ_meanminmax_stats <- full_pers_gbdbub_data %>%
  group_by(snow_phase, phase, aspect) %>%
  summarize(mean_temp = mean(c_across(c(gb_temp, db_temp, ub_temp)), na.rm = TRUE), max_temp = max(c_across(c(gb_temp, db_temp, ub_temp)), na.rm = TRUE), min_temp = min(c_across(c(gb_temp, db_temp, ub_temp)), na.rm = TRUE), temp_range = (max_temp - min_temp))
```

```{r}
TSZ_meanminmax_stats <- full_trans_gbdbub_data %>%
  group_by(snow_phase, phase, aspect) %>%
  summarize(mean_temp = mean(c_across(c(gb_temp, db_temp, ub_temp)), na.rm = TRUE), max_temp = max(c_across(c(gb_temp, db_temp, ub_temp)), na.rm = TRUE), min_temp = min(c_across(c(gb_temp, db_temp, ub_temp)), na.rm = TRUE), temp_range = (max_temp - min_temp))
```

South Aspect Only Plots!

```{r}
#daytime plot
PSZ_s_dtnt_treetemp_daily_gbdbub_lineplot <- ggplot(data = PSZ_s_dtnt_daily_gbdbub_plot_dataframe ) +
  geom_line(aes(x = day, y = gb_temp, color = "GB")) + 
  geom_line(aes(x = day, y = db_temp, color = "DB")) +
  geom_line(aes(x = day, y = ub_temp, color = "live"), alpha = 0.8) +
  #facet_wrap(~phase) +
  labs(title = "a) PSZ", x = NULL, y = "Temperature (°C)") +
  scale_color_manual(
    name = "burn status",
    values = c("GB" = "#1B7837", "DB" = "#D95F02", "live" = "#2166AC")
  ) +
  #scale_linetype_manual(
   # name = "aspect", 
   # values = c("north" = "dashed", "south" = "solid"),
   # labels = c("north" = "North", "south" = "South")
#  ) +
  scale_y_continuous(limits = c(-20, 28)) +  # Set the y-axis limits here
  theme_bw() + 
  #accumulation/ablation date destiction
 # geom_vline(xintercept = as.numeric(as.Date('2024-05-06')), 
          #   linetype = "solid",                # Dashed line
          #   color = "grey23",                      # Line color
          #   size = 0.4, alpha = 0.8) + 
  #snowfree date
  geom_vline(xintercept = as.numeric(as.Date('2024-06-05')), 
             linetype = "dashed",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8)

PSZ_s_dtnt_treetemp_daily_gbdbub_lineplot
```

```{r}
#TSZ plot 
TSZ_s_dtnt_treetemp_daily_gbdbub_lineplot <- ggplot(data = TSZ_s_dtnt_daily_gbdbub_plot_dataframe ) +
  geom_line(aes(x = day, y = gb_temp, color = "GB")) + 
  geom_line(aes(x = day, y = db_temp, color = "DB")) +
  geom_line(aes(x = day, y = ub_temp, color = "live"), alpha = 0.8) +
  facet_wrap(~phase) +
  labs(title = "b) TSZ", x = "Date", y = "Temperature (°C)") +
  scale_color_manual(
    name = "burn status",
    values = c("GB" = "#1B7837", "DB" = "#D95F02", "live" = "#2166AC")
  ) +
  #scale_linetype_manual(
   # name = "aspect", 
   # values = c("north" = "dashed", "south" = "solid"),
   # labels = c("north" = "North", "south" = "South")
 # ) +
  scale_y_continuous(limits = c(-20, 28)) +  # Set the y-axis limits here
  theme_bw() +
  #accumulation/ablation date destiction
 # geom_vline(xintercept = as.numeric(as.Date('2024-04-06')), 
          #   linetype = "solid",                # Dashed line
          #   color = "grey23",                      # Line color
          #   size = 0.4, alpha = 0.8) + 
  #snowfree date
  geom_vline(xintercept = as.numeric(as.Date('2024-05-25')), 
             linetype = "dashed",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8)

TSZ_s_dtnt_treetemp_daily_gbdbub_lineplot
```

```{r}
#combining day and night plots
final_s_dtnt_treetemp_lineplot <- ggarrange(
  PSZ_s_dtnt_treetemp_daily_gbdbub_lineplot, 
  TSZ_s_dtnt_treetemp_daily_gbdbub_lineplot, 
  nrow = 2, 
  ncol = 1, 
  common.legend = TRUE, 
  legend = "right"
)
print(final_s_dtnt_treetemp_lineplot)
```

North Aspect Only Plots!

```{r}
#daytime plot
PSZ_n_dtnt_treetemp_daily_gbdbub_lineplot <- ggplot(data = PSZ_n_dtnt_daily_gbdbub_plot_dataframe ) +
  geom_line(aes(x = day, y = gb_temp, color = "GB")) + 
  geom_line(aes(x = day, y = db_temp, color = "DB")) +
  geom_line(aes(x = day, y = ub_temp, color = "live"), alpha = 0.8) +
  facet_wrap(~phase) +
  labs(title = "a) PSZ", x = NULL, y = "Temperature (°C)") +
  scale_color_manual(
    name = "burn status",
    values = c("GB" = "#1B7837", "DB" = "#D95F02", "live" = "#2166AC")
  ) +
  #scale_linetype_manual(
   # name = "aspect", 
   # values = c("north" = "dashed", "south" = "solid"),
   # labels = c("north" = "North", "south" = "South")
#  ) +
  scale_y_continuous(limits = c(-20, 28)) +  # Set the y-axis limits here
  theme_bw() + 
  #accumulation/ablation date destiction
 # geom_vline(xintercept = as.numeric(as.Date('2024-05-06')), 
          #   linetype = "solid",                # Dashed line
          #   color = "grey23",                      # Line color
          #   size = 0.4, alpha = 0.8) + 
  #snowfree date
  geom_vline(xintercept = as.numeric(as.Date('2024-06-05')), 
             linetype = "dashed",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8)

PSZ_n_dtnt_treetemp_daily_gbdbub_lineplot
```

```{r}
#TSZ plot 
TSZ_n_dtnt_treetemp_daily_gbdbub_lineplot <- ggplot(data = TSZ_n_dtnt_daily_gbdbub_plot_dataframe ) +
  geom_line(aes(x = day, y = gb_temp, color = "GB")) + 
  geom_line(aes(x = day, y = db_temp, color = "DB")) +
  geom_line(aes(x = day, y = ub_temp, color = "live"), alpha = 0.8) +
  facet_wrap(~phase) +
  labs(title = "b) TSZ", x = "Date", y = "Temperature (°C)") +
  scale_color_manual(
    name = "burn status",
    values = c("GB" = "#1B7837", "DB" = "#D95F02", "live" = "#2166AC")
  ) +
  #scale_linetype_manual(
   # name = "aspect", 
   # values = c("north" = "dashed", "south" = "solid"),
   # labels = c("north" = "North", "south" = "South")
 # ) +
  scale_y_continuous(limits = c(-20, 28)) +  # Set the y-axis limits here
  theme_bw() +
  #accumulation/ablation date destiction
 # geom_vline(xintercept = as.numeric(as.Date('2024-04-06')), 
          #   linetype = "solid",                # Dashed line
          #   color = "grey23",                      # Line color
          #   size = 0.4, alpha = 0.8) + 
  #snowfree date
  geom_vline(xintercept = as.numeric(as.Date('2024-05-25')), 
             linetype = "dashed",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8)

TSZ_n_dtnt_treetemp_daily_gbdbub_lineplot
```

```{r}
#combining day and night plots
final_n_dtnt_treetemp_lineplot <- ggarrange(
  PSZ_n_dtnt_treetemp_daily_gbdbub_lineplot, 
  TSZ_n_dtnt_treetemp_daily_gbdbub_lineplot, 
  nrow = 2, 
  ncol = 1, 
  common.legend = TRUE, 
  legend = "right"
)
print(final_n_dtnt_treetemp_lineplot)
```

Box plot of the above data

```{r}
#making a new dataframe
dt_full_daily_gbdbub_boxplot_dataframe <- dt_full_daily_gbdbub_plot_dataframe %>%
  pivot_longer(cols = c(gb_temp, db_temp, ub_temp),   # Specify the columns to pivot
               names_to = "burn_status",              # New column for burn status
               values_to = "temperature") %>%
  mutate(burn_status = case_when(
    burn_status == "gb_temp" ~ "green burn",
    burn_status == "db_temp" ~ "dead burn",
    burn_status == "ub_temp" ~ "live",
    TRUE ~ burn_status  # This handles any unexpected values, if any
  )) %>%
  filter(!is.na(temperature))
```

```{r}
dt_t_treetemp_daily_gbdbub_boxplot <- ggplot(data = dt_full_daily_gbdbub_boxplot_dataframe) +
  geom_boxplot(aes(x = phase, y = temperature, fill = "burn_status", linetype = aspect), 
               position = position_dodge(width = 0.8)) +
  facet_wrap(~ zone + month) +
  labs(title = "a) Day Temps", x = "Day", y = "Temperature (°C)") +
  scale_fill_manual(
    name = "burn status",
    values = c("green burn" = "#1B7837", "dead burn" = "#D95F02", "live" = "#2166AC"),
    labels = c("green burn" = "Green Burn", "dead burn" = "Dead Burn", "live" = "Live")
  )

dt_t_treetemp_daily_gbdbub_boxplot
```

### DTNT Boxplots

```{r}
#PSZ boxplot dataframes
PSZ_dtnt_data <- full_pers_gbdbub_data %>%
  pivot_longer(
    cols = c(gb_temp, db_temp, ub_temp),  # Columns to reshape
    names_to = "burn_status",            # New column for burn status
    values_to = "temp"            # New column for temperature values
  ) %>%
 mutate(
    burn_status = case_when(
      burn_status == "gb_temp" ~ "GB",
      burn_status == "db_temp" ~ "DB",
      burn_status == "ub_temp" ~ "live",
      TRUE ~ burn_status  # Optional: Keep original value if no match
    )
  )

#TSZ
TSZ_dtnt_data_V2 <- full_trans_gbdbub_data %>%
  pivot_longer(
    cols = c(gb_temp, db_temp, ub_temp),  # Columns to reshape
    names_to = "burn_status",            # New column for burn status
    values_to = "temp"            # New column for temperature values
  ) %>%
 mutate(
    burn_status = case_when(
      burn_status == "gb_temp" ~ "GB",
      burn_status == "db_temp" ~ "DB",
      burn_status == "ub_temp" ~ "live",
      TRUE ~ burn_status  # Optional: Keep original value if no match
    )
  )
```

```{r}
PSZ_dtnt_data$snow_phase <- fct_relevel(PSZ_dtnt_data$snow_phase, "accumulation", "ablation")

#PSZ day/night boxplots
PSZ_dtnt_boxplot <- ggplot(data = PSZ_dtnt_data) + 
  geom_boxplot(aes(x = phase, y = temp, fill = burn_status)) +
  scale_fill_manual(
    name = "Burn Status",
    values = c("GB" = "#1B7837", "DB" = "#D95F02", "live" = adjustcolor("#2166AC", alpha.f = 0.8)), 
    labels = c("GB" = "GB", "DB" = "DB", "live" = "Live")
  ) +
  labs(
    title = "a) PSZ",
    x = NULL,
    y = "Temperature (°C)"
  ) +
  scale_alpha_manual(
    name = "Burn Status",
    values = c("GB" = 1, "DB" = 1, "live" = 0.5)  # Adjust alpha for "live"
  ) +
  #facet_wrap(~aspect) +
  scale_y_continuous(
    limits = c(-25, 40)  # Set y-axis limits from 0 to 30
  ) +
  theme_bw() +
  facet_wrap(~snow_phase)

PSZ_dtnt_boxplot
```

```{r}
TSZ_dtnt_data_V2$snow_phase <- fct_relevel(TSZ_dtnt_data_V2$snow_phase, "accumulation", "ablation")

#TSZ day/night boxplots
TSZ_dtnt_boxplot <- ggplot(data = TSZ_dtnt_data) + 
  geom_boxplot(aes(x = phase, y = temp, fill = burn_status)) +
  scale_fill_manual(
    name = "Burn Status",
    values = c("GB" = "#1B7837", "DB" = "#D95F02", "live" = adjustcolor("#2166AC", alpha.f = 0.8)), 
    labels = c("GB" = "GB", "DB" = "DB", "live" = "Live")
  ) +
  labs(
    title = "b) TSZ",
    x = NULL,
    y = "Temperature (°C)"
  ) +
  scale_alpha_manual(
    name = "Burn Status",
    values = c("GB" = 1, "DB" = 1, "live" = 0.5)  # Adjust alpha for "live"
  ) +
  #facet_wrap(~aspect) +
  scale_y_continuous(
    limits = c(-25, 40)  # Set y-axis limits from 0 to 30
  ) +
  theme_bw() +
  facet_wrap(~snow_phase)

TSZ_dtnt_boxplot
```

```{r}
comb_dtnt_boxplot <- ggarrange(PSZ_dtnt_boxplot,  TSZ_dtnt_boxplot, ncol = 1, nrow = 2, common.legend = TRUE, legend = "right")

comb_dtnt_boxplot
```

## GB Aspect/Char Pattern Comparison

Lineplot of Aspect-only Comparisons - as of 2025.01.27 \*\* USE THESE NS Boxplots instead of the ones below!

```{r}
#Use this!
pers_dt_ns_boxplot_data <- full_15min_ns %>%
  filter(zone == "PSZ", phase == "day") %>%
  pivot_longer(
    cols = c(north_temp, south_temp),  # Columns to reshape
    names_to = "aspect",              # New column for burn status
    values_to = "temp"                # New column for temperature values
  ) %>%
  mutate(
    aspect = case_when(
      aspect == "north_temp" ~ "north",
      aspect == "south_temp" ~ "south",
      TRUE ~ aspect  # Optional: Keep original value if no match
    ),
    aspect = factor(aspect, levels = c("north", "south")),  # Ensure 'north' comes before 'south'
    burn_status = case_when(
      burn_status == "live" ~ "live",
      burn_status == "green burn" ~ "GB",
      burn_status == "dead burn" ~ "DB",
      TRUE ~ burn_status  # Keep any other values unchanged
    ),
    burn_status = factor(burn_status, levels = c("live", "GB", "DB"))  # Ensure the desired order
  )

#nt dataframe
pers_nt_ns_boxplot_data <- full_15min_ns %>%
  filter(zone == "PSZ", phase == "night") %>%
  pivot_longer(
    cols = c(north_temp, south_temp),  # Columns to reshape
    names_to = "aspect",              # New column for burn status
    values_to = "temp"                # New column for temperature values
  ) %>%
  mutate(
    aspect = case_when(
      aspect == "north_temp" ~ "north",
      aspect == "south_temp" ~ "south",
      TRUE ~ aspect  # Optional: Keep original value if no match
    ),
    aspect = factor(aspect, levels = c("north", "south")),  # Ensure 'north' comes before 'south'
    burn_status = case_when(
      burn_status == "live" ~ "live",
      burn_status == "green burn" ~ "GB",
      burn_status == "dead burn" ~ "DB",
      TRUE ~ burn_status  # Keep any other values unchanged
    ),
    burn_status = factor(burn_status, levels = c("live", "GB", "DB"))  # Ensure the desired order
  )
```

```{r}
#use this!
trans_dt_ns_boxplot_data <- full_15min_ns %>%
  filter(zone == "TSZ", phase == "day") %>%
  pivot_longer(
    cols = c(north_temp, south_temp),  # Columns to reshape
    names_to = "aspect",              # New column for burn status
    values_to = "temp"                # New column for temperature values
  ) %>%
  mutate(
    aspect = case_when(
      aspect == "north_temp" ~ "north",
      aspect == "south_temp" ~ "south",
      TRUE ~ aspect  # Optional: Keep original value if no match
    ),
    aspect = factor(aspect, levels = c("north", "south")),  # Ensure 'north' comes before 'south'
    burn_status = case_when(
      burn_status == "live" ~ "live",
      burn_status == "green burn" ~ "GB",
      burn_status == "dead burn" ~ "DB",
      TRUE ~ burn_status  # Keep any other values unchanged
    ),
    burn_status = factor(burn_status, levels = c("live", "GB", "DB"))  # Ensure the desired order
  )

#nighttime dataframe
trans_nt_ns_boxplot_data <- full_15min_ns %>%
  filter(zone == "TSZ", phase == "night") %>%
  pivot_longer(
    cols = c(north_temp, south_temp),  # Columns to reshape
    names_to = "aspect",              # New column for burn status
    values_to = "temp"                # New column for temperature values
  ) %>%
  mutate(
    aspect = case_when(
      aspect == "north_temp" ~ "north",
      aspect == "south_temp" ~ "south",
      TRUE ~ aspect  # Optional: Keep original value if no match
    ),
    aspect = factor(aspect, levels = c("north", "south")),  # Ensure 'north' comes before 'south'
    burn_status = case_when(
      burn_status == "live" ~ "live",
      burn_status == "green burn" ~ "GB",
      burn_status == "dead burn" ~ "DB",
      TRUE ~ burn_status  # Keep any other values unchanged
    ),
    burn_status = factor(burn_status, levels = c("live", "GB", "DB"))  # Ensure the desired order
  )
```

```{r}
#use this!
pers_dt_ns_boxplot<- ggplot(pers_dt_ns_boxplot_data, aes(x = aspect, y = temp, fill = aspect)) +
  geom_boxplot() +
  facet_wrap(~ burn_status) +  # Facet by burn status
  scale_fill_manual(values = c(scales::alpha("#2166AC", 0.8), "#D95F02")) +  # Custom colors for north and south
  theme_bw() +
  labs(
    title = "a) PSZ",
    x = NULL,
    y = "Temperature (°C)"
  ) + 
   scale_y_continuous(
    limits = c(-25, 48))

pers_dt_ns_boxplot
```

```{r}
#use this!
trans_dt_ns_boxplot<- ggplot(trans_dt_ns_boxplot_data, aes(x = aspect, y = temp, fill = aspect)) +
  geom_boxplot() +
  facet_wrap(~ burn_status) +  # Facet by burn status
  scale_fill_manual(values = c(scales::alpha("#2166AC", 0.8), "#D95F02")) +  # Custom colors for north and south
  theme_bw() +
  labs(
    title = "b) TSZ",
    x = NULL,
    y = "Temperature (°C)"
  ) +
   scale_y_continuous(
    limits = c(-25, 48))

trans_dt_ns_boxplot
```

```{r}
#use this!
comb_dt_ns_boxplot_V2 <- ggarrange(pers_dt_ns_boxplot, trans_dt_ns_boxplot, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")

comb_dt_ns_boxplot_V2
```

Plotting NT to compare - not sure I am going to use the Nighttime boxplots?

```{r}
pers_nt_ns_boxplot<- ggplot(pers_nt_ns_boxplot_data, aes(x = aspect, y = temp, fill = aspect)) +
  geom_boxplot() +
  facet_wrap(~ burn_status) +  # Facet by burn status
  scale_fill_manual(values = c(scales::alpha("#2166AC", 0.8), "#D95F02")) +  # Custom colors for north and south
  theme_bw() +
  labs(
    title = "a) PSZ",
    x = NULL,
    y = "Temperature (°C)"
  ) + 
   scale_y_continuous(
    limits = c(-25, 48))

pers_nt_ns_boxplot
```

```{r}
trans_nt_ns_boxplot<- ggplot(trans_nt_ns_boxplot_data, aes(x = aspect, y = temp, fill = aspect)) +
  geom_boxplot() +
  facet_wrap(~ burn_status) +  # Facet by burn status
  scale_fill_manual(values = c(scales::alpha("#2166AC", 0.8), "#D95F02")) +  # Custom colors for north and south
  theme_bw() +
  labs(
    title = "a) PSZ",
    x = NULL,
    y = "Temperature (°C)"
  ) + 
   scale_y_continuous(
    limits = c(-25, 48))

trans_nt_ns_boxplot
```

```{r}
comb_nt_ns_boxplot_V2 <- ggarrange(pers_nt_ns_boxplot, trans_nt_ns_boxplot, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")

comb_nt_ns_boxplot_V2
```

### Aspect-only Comparisons

\*\* as of 2025.01.27 - don't use these ns boxplots!

```{r}
pers_dt_ns_boxplot_data <- full_15min_ns %>%
  filter(zone == "PSZ", phase == "day") %>%
  pivot_longer(
    cols = c(north_temp, south_temp),  # Columns to reshape
    names_to = "aspect",            # New column for burn status
    values_to = "temp"            # New column for temperature values
  ) %>%
 mutate(
    aspect = case_when(
      aspect == "north_temp" ~ "north",
      aspect == "south_temp" ~ "south",
      TRUE ~ aspect  # Optional: Keep original value if no match
    ))
```

```{r}
trans_dt_ns_boxplot_data <- full_15min_ns %>%
  filter(zone == "TSZ", phase == "day") %>%
 pivot_longer(
    cols = c(north_temp, south_temp),  # Columns to reshape
    names_to = "aspect",            # New column for burn status
    values_to = "temp"            # New column for temperature values
  ) %>%
 mutate(
    aspect = case_when(
      aspect == "north_temp" ~ "north",
      aspect == "south_temp" ~ "south",
      TRUE ~ aspect  # Optional: Keep original value if no match
    ))
```

Boxplots

```{r}
pers_dt_ns_boxplot_data$snow_phase <- fct_relevel(pers_dt_ns_boxplot_data$snow_phase, "accumulation", "ablation")

PSZ_ns_boxplot <- ggplot(data = pers_dt_ns_boxplot_data) + 
  geom_boxplot(aes(x = aspect, y = temp, fill = burn_status)) +
  scale_fill_manual(
    name = "Burn Status",
    values = c("green burn" = "#1B7837", "dead burn" = "#D95F02", "live" = adjustcolor("#2166AC", alpha.f = 0.8)),
               labels = c("green burn" = "GB", "dead burn" = "DB", "live" = "live"))+ # Corrected the parenthesis here
  labs(
    title = "a) PSZ",
    x = NULL,
    y = "Temperature (°C)"
  ) +
  theme_bw() +
  facet_wrap(~snow_phase) +
  scale_y_continuous(
    limits = c(-25, 48))

PSZ_ns_boxplot
```

```{r}
trans_dt_ns_boxplot_data$snow_phase <- fct_relevel(trans_dt_ns_boxplot_data$snow_phase, "accumulation", "ablation")

TSZ_ns_boxplot <- ggplot(data = trans_dt_ns_boxplot_data) + 
  geom_boxplot(aes(x = aspect, y = temp, fill = burn_status)) +
  scale_fill_manual(
    name = "Burn Status",
    values = c("green burn" = "#1B7837", "dead burn" = "#D95F02", "live" = adjustcolor("#2166AC", alpha.f = 0.8)),
               labels = c("green burn" = "GB", "dead burn" = "DB", "live" = "live"))+ # Corrected the parenthesis here
  labs(
    title = "b) TSZ",
    x = "Aspect",
    y = "Temperature (°C)"
  ) +
  theme_bw() +
  facet_wrap(~snow_phase) + 
  scale_y_continuous(
    limits = c(-25, 48))

TSZ_ns_boxplot
```

```{r}
#combined ns boxplot
comb_dt_ns_boxplot <- ggarrange(PSZ_ns_boxplot, TSZ_ns_boxplot, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")

comb_dt_ns_boxplot
```

Only Boxplotting by North/South, not by burn status, to see if this helps with interpretation?

```{r}
pers_dt_ns_allburnstatuses_boxplot_data <- pers_dt_ns_boxplot_data %>%
  group_by(datetime, day, month, phase, zone, snow_phase, aspect) %>%
  summarize(all_temp = mean(temp))

trans_dt_ns_allburnstatuses_boxplot_data <- trans_dt_ns_boxplot_data %>%
  group_by(datetime, day, month, phase, zone, snow_phase, aspect) %>%
  summarize(all_temp = mean(temp))
```

```{r}
pers_dt_ns_allburnstatuses_boxplot_data$snow_phase <- fct_relevel(pers_dt_ns_allburnstatuses_boxplot_data$snow_phase, "accumulation", "ablation")

pers_dt_ns_allburnstatuses_boxplot <- ggplot(data = pers_dt_ns_allburnstatuses_boxplot_data) + 
  geom_boxplot(aes(x = aspect, y = all_temp, fill = aspect)) +
  scale_fill_manual(
    name = "Aspect",
    values = c("north" = "#1B7837", "south" = "#D95F02")) + 
  labs(
    title = "a) PSZ",
    x = NULL,
    y = "Temperature (°C)"
  ) +
  theme_bw() +
  facet_wrap(~snow_phase) +
  scale_y_continuous(
    limits = c(-25, 48))

pers_dt_ns_allburnstatuses_boxplot
```

```{r}
trans_dt_ns_allburnstatuses_boxplot_data$snow_phase <- fct_relevel(trans_dt_ns_allburnstatuses_boxplot_data$snow_phase, "accumulation", "ablation")

trans_dt_ns_allburnstatuses_boxplot <- ggplot(data = trans_dt_ns_allburnstatuses_boxplot_data) + 
  geom_boxplot(aes(x = aspect, y = all_temp, fill = aspect)) +
  scale_fill_manual(
    name = "Aspect",
    values = c("north" = "#1B7837", "south" = "#D95F02")) + 
  labs(
    title = "b) TSZ",
    x = "Group",
    y = "Temperature (°C)"
  ) +
  theme_bw() +
  facet_wrap(~snow_phase) +
  scale_y_continuous(
    limits = c(-25, 48))

trans_dt_ns_allburnstatuses_boxplot
```

```{r}
#combined all temps ns boxplot
comb_ns_allburnstatuses_boxplot_V1 <- ggarrange(pers_dt_ns_allburnstatuses_boxplot, trans_dt_ns_allburnstatuses_boxplot, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")

comb_ns_allburnstatuses_boxplot_V1
```

Creating a daily mean temperature dataframe, then plotting for full timeframe

```{r}
#dataframe
##mean
dt_mean_gb <- full_hourly_gb %>%
  filter(phase == "day") %>%
  group_by(day, month, zone, snow_phase) %>%
  summarize(north_temp = mean(north_temp), south_temp = mean(south_temp), charred_temp = mean(charred_temp), uncharred_temp = mean(uncharred_temp))

dt_min_gb <- full_hourly_gb %>%
  filter(phase == "day") %>%
  group_by(day, month, zone) %>%
  summarize(north_temp = min(north_temp), south_temp = min(south_temp), charred_temp = min(charred_temp), uncharred_temp = min(uncharred_temp))

dt_max_gb <- full_hourly_gb %>%
  filter(phase == "day") %>%
  group_by(day, month, zone) %>%
  summarize(north_temp = max(north_temp), south_temp = max(south_temp), charred_temp = max(charred_temp), uncharred_temp = max(uncharred_temp))
```

```{r}
#making a zone-specific dataframe
pers_dt_mean_gb <- dt_mean_gb %>%
  filter(zone == "PSZ")

trans_dt_mean_gb <- dt_mean_gb %>%
  filter(zone == "TSZ")

pers_dt_min_gb <- dt_min_gb %>%
  filter(zone == "PSZ")

trans_dt_min_gb <- dt_min_gb %>%
  filter(zone == "TSZ")

pers_dt_max_gb <- dt_max_gb %>%
  filter(zone == "PSZ")

trans_dt_max_gb <- dt_max_gb %>%
  filter(zone == "TSZ")

pers_dt_gb <- full_hourly_gb %>%
  filter(zone == "PSZ", phase == "day") %>%
  select(-burn_status)

trans_dt_gb <- full_hourly_gb %>%
  filter(zone == "TSZ", phase == "day") %>%
  select(-burn_status)
```

```{r}
full_mean_gb_temp_plot <- ggplot(data = dt_mean_gb) +
  geom_line(aes(x = day, y = north_temp, color = "north"), linewidth = 0.7, alpha = 0.8) + 
  geom_line(aes(x = day, y = south_temp, color = "south"), linewidth = 0.7) +
  geom_line(aes(x = day, y = charred_temp, color = "charred"), linewidth = 0.7) + 
  geom_line(aes(x = day, y = uncharred_temp, color = "uncharred"), linetype = "dashed", linewidth = 0.7) + 
  facet_wrap(~zone, dir = "v") +
  labs(#title = "b) Ablation", 
       x = "Date", y = "Mean Temperature (°C)") +
  scale_color_manual(
    name = "aspect",
    values = c("north" = "#2166AC", "south" = "#D95F02", "charred" = "grey15", "uncharred" = "grey30")
  ) +
  theme_bw()

full_mean_gb_temp_plot
```

```{r}
full_min_gb_temp_plot <- ggplot(data = dt_min_gb) +
  geom_line(aes(x = day, y = north_temp, color = "north"), linewidth = 0.7, alpha = 0.8) + 
  geom_line(aes(x = day, y = south_temp, color = "south"), linewidth = 0.7) +
  geom_line(aes(x = day, y = charred_temp, color = "charred"), linewidth = 0.7) + 
  geom_line(aes(x = day, y = uncharred_temp, color = "uncharred"), linetype = "dashed", linewidth = 0.7) + 
  facet_wrap(~zone, dir = "v") +
  labs(#title = "b) Ablation", 
       x = "Date", y = "Minimum Temperature (°C)") +
  scale_color_manual(
    name = "aspect",
    values = c("north" = "#2166AC", "south" = "#D95F02", "charred" = "grey15", "uncharred" = "grey30")
  ) +
  theme_bw()

full_min_gb_temp_plot
```

```{r}
full_max_gb_temp_plot <- ggplot(data = dt_max_gb) +
  geom_line(aes(x = day, y = north_temp, color = "north"), linewidth = 0.7, alpha = 0.8) + 
  geom_line(aes(x = day, y = south_temp, color = "south"), linewidth = 0.7) +
  geom_line(aes(x = day, y = charred_temp, color = "charred"), linewidth = 0.7) + 
  geom_line(aes(x = day, y = uncharred_temp, color = "uncharred"), linetype = "dashed", linewidth = 0.7) + 
  facet_wrap(~zone, dir = "v") +
  labs(#title = "b) Ablation", 
       x = "Date", y = "Minimum Temperature (°C)") +
  scale_color_manual(
    name = "aspect",
    values = c("north" = "#2166AC", "south" = "#D95F02", "charred" = "grey15", "uncharred" = "grey30")
  ) +
  theme_bw()

full_max_gb_temp_plot
```

```{r}
##MEAN TEMP PLOTS
#PSZ
PSZ_mean_gb_temp_plot <- ggplot(data = pers_dt_mean_gb) +
  geom_line(aes(x = day, y = north_temp, color = "north"), linewidth = 0.5, alpha = 0.8) +
  geom_line(aes(x = day, y = south_temp, color = "south"), linewidth = 0.5) +
  geom_line(aes(x = day, y = charred_temp, color = "charred"), linewidth = 0.5) + 
  geom_line(aes(x = day, y = uncharred_temp, color = "uncharred"), linewidth = 0.5, linetype = "dashed") + 
  labs(title = "a) PSZ", x = NULL, y = "Mean Temperature (°C)") +
  scale_color_manual(
    name = "aspect",
    values = c("north" = "#2166AC", "south" = "#D95F02", "charred" = "#1B7837", "uncharred" = "grey30")
  ) +
  theme_bw() +
  geom_vline(xintercept = as.numeric(as.Date('2024-05-06')), 
             linetype = "solid",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8) + 
  #snowfree date
  geom_vline(xintercept = as.numeric(as.Date('2024-06-05')), 
             linetype = "dashed",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8)

PSZ_mean_gb_temp_plot
```

```{r}
##MEAN TEMP PLOTS
#TSZ
TSZ_mean_gb_temp_plot <- ggplot(data = trans_dt_mean_gb) +
  geom_line(aes(x = day, y = north_temp, color = "north"), linewidth = 0.5, alpha = 0.8) + 
  geom_line(aes(x = day, y = south_temp, color = "south"), linewidth = 0.5) +
  geom_line(aes(x = day, y = charred_temp, color = "charred"), linewidth = 0.5) + 
  geom_line(aes(x = day, y = uncharred_temp, color = "uncharred"), linewidth = 0.5, linetype = "dashed") + 
  labs(title = "b) PSZ", x = NULL, y = "Mean Temperature (°C)") +
  scale_color_manual(
    name = "aspect",
    values = c("north" = "#2166AC", "south" = "#D95F02", "charred" = "#1B7837", "uncharred" = "grey30")
  ) +
  theme_bw()+
  #accumulation/ablation date destiction
  geom_vline(xintercept = as.numeric(as.Date('2024-04-06')), 
             linetype = "solid",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8) + 
  #snowfree date
  geom_vline(xintercept = as.numeric(as.Date('2024-05-25')), 
             linetype = "dashed",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8)

TSZ_mean_gb_temp_plot
```

```{r}
#combined mean temp plots
comb_mean_gb_temp_byzone <- ggarrange(PSZ_mean_gb_temp_plot, TSZ_mean_gb_temp_plot, nrow =2, ncol = 1, common.legend = TRUE, legend = "right")

comb_mean_gb_temp_byzone
```

```{r}
##MIN TEMP PLOTS
#PSZ
PSZ_min_gb_temp_plot <- ggplot(data = pers_dt_min_gb) +
  geom_line(aes(x = day, y = north_temp, color = "north"), linewidth = 0.7, alpha = 0.8) + 
  geom_line(aes(x = day, y = south_temp, color = "south"), linewidth = 0.7) +
  geom_line(aes(x = day, y = charred_temp, color = "charred"), linewidth = 0.7) + 
  geom_line(aes(x = day, y = uncharred_temp, color = "uncharred"), linetype = "dashed", linewidth = 0.7) + 
  labs(#title = "a) PSZ", 
       x = NULL, y = "Minimum Temperature (°C)") +
  scale_color_manual(
    name = "aspect",
    values = c("north" = "#2166AC", "south" = "#D95F02", "charred" = "grey15", "uncharred" = "grey30")
  ) +
  theme_bw()

PSZ_min_gb_temp_plot

#TSZ
TSZ_min_gb_temp_plot <- ggplot(data = trans_dt_min_gb) +
  geom_line(aes(x = day, y = north_temp, color = "north"), linewidth = 0.7, alpha = 0.8) + 
  geom_line(aes(x = day, y = south_temp, color = "south"), linewidth = 0.7) +
  geom_line(aes(x = day, y = charred_temp, color = "charred"), linewidth = 0.7) + 
  geom_line(aes(x = day, y = uncharred_temp, color = "uncharred"), linetype = "dashed", linewidth = 0.7) + 
  labs(#title = "b) TSZ", 
       x = NULL, y = "Minimum Temperature (°C)") +
  scale_color_manual(
    name = "aspect",
    values = c("north" = "#2166AC", "south" = "#D95F02", "charred" = "grey15", "uncharred" = "grey30")
  ) +
  theme_bw()

TSZ_min_gb_temp_plot
```

```{r}
##MAX TEMP PLOTS
#PSZ
PSZ_max_gb_temp_plot <- ggplot(data = pers_dt_max_gb) +
  geom_line(aes(x = day, y = north_temp, color = "north"), linewidth = 0.7, alpha = 0.8) + 
  geom_line(aes(x = day, y = south_temp, color = "south"), linewidth = 0.7) +
  geom_line(aes(x = day, y = charred_temp, color = "charred"), linewidth = 0.7) + 
  geom_line(aes(x = day, y = uncharred_temp, color = "uncharred"), linetype = "dashed", linewidth = 0.7) + 
  labs(#title = "a) PSZ", 
       x = "Date", y = "Maximum Temperature (°C)") +
  scale_color_manual(
    name = "aspect",
    values = c("north" = "#2166AC", "south" = "#D95F02", "charred" = "grey15", "uncharred" = "grey30")
  ) +
  theme_bw()

PSZ_max_gb_temp_plot

#TSZ
TSZ_max_gb_temp_plot <- ggplot(data = trans_dt_max_gb) +
  geom_line(aes(x = day, y = north_temp, color = "north"), linewidth = 0.7, alpha = 0.8) + 
  geom_line(aes(x = day, y = south_temp, color = "south"), linewidth = 0.7) +
  geom_line(aes(x = day, y = charred_temp, color = "charred"), linewidth = 0.7) + 
  geom_line(aes(x = day, y = uncharred_temp, color = "uncharred"), linetype = "dashed", linewidth = 0.7) + 
  labs(#title = "b) TSZ", 
       x = "Date", y = "Maximum Temperature (°C)") +
  scale_color_manual(
    name = "aspect",
    values = c("north" = "#2166AC", "south" = "#D95F02", "charred" = "grey15", "uncharred" = "grey30")
  ) +
  theme_bw()

TSZ_max_gb_temp_plot
```

```{r}
#combined by zone and mean, min, max values 

pers_meanminmax_gb_temp_plot <- ggarrange(PSZ_mean_gb_temp_plot, PSZ_min_gb_temp_plot, PSZ_max_gb_temp_plot, nrow = 3, ncol = 1, common.legend = TRUE, legend = "none")

pers_meanminmax_gb_temp_plot

trans_meanminmax_gb_temp_plot <- ggarrange(TSZ_mean_gb_temp_plot, TSZ_min_gb_temp_plot, TSZ_max_gb_temp_plot, nrow = 3, ncol = 1, common.legend = TRUE, legend = "none")

trans_meanminmax_gb_temp_plot
```

```{r}
#combined mean, min max by zone plot
comb_meanminmax_gb_temp_byzone <- ggarrange(pers_meanminmax_gb_temp_plot, trans_meanminmax_gb_temp_plot, nrow =1, ncol = 2, common.legend = TRUE, legend = "right")

comb_meanminmax_gb_temp_byzone
```

```{r}
comb_gb_lineplot <- ggarrange(PSZ_mean_gb_temp_plot, TSZ_mean_gb_temp_plot, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")

comb_gb_lineplot
```

\*\* Not sure if I need to use the above mean/min/max plots, but if so I'll export later.

### GB Char Comparison Boxplots

```{r}
pers_gb_boxplot_data <- pers_dt_gb %>%
  pivot_longer(
    cols = c(north_temp, south_temp, charred_temp, uncharred_temp),  # Columns to reshape
    names_to = "burn_status",            # New column for burn status
    values_to = "temp"            # New column for temperature values
  ) %>%
 mutate(
    burn_status = case_when(
      burn_status == "north_temp" ~ "north",
      burn_status == "south_temp" ~ "south",
      burn_status == "charred_temp" ~ "charred",
      burn_status == "uncharred_temp" ~ "uncharred",
      TRUE ~ burn_status  # Optional: Keep original value if no match
    ))
```

```{r}
trans_gb_boxplot_data <- trans_dt_gb %>%
  pivot_longer(
    cols = c(north_temp, south_temp, charred_temp, uncharred_temp),  # Columns to reshape
    names_to = "burn_status",            # New column for burn status
    values_to = "temp"            # New column for temperature values
  ) %>%
 mutate(
    burn_status = case_when(
      burn_status == "north_temp" ~ "north",
      burn_status == "south_temp" ~ "south",
      burn_status == "charred_temp" ~ "charred",
      burn_status == "uncharred_temp" ~ "uncharred",
      TRUE ~ burn_status  # Optional: Keep original value if no match
    ))
```

```{r}
pers_gb_boxplot_data$snow_phase <- fct_relevel(pers_gb_boxplot_data$snow_phase, "accumulation", "ablation")

PSZ_gb_boxplot <- ggplot(data = pers_gb_boxplot_data) + 
  geom_boxplot(aes(x = burn_status, y = temp, fill = burn_status)) +
  scale_fill_manual(
    name = "Char Pattern / Aspect",
    values = c("north" = "#1B7837", "south" = "#D95F02", 
               "uncharred" = adjustcolor("#2166AC", alpha.f = 0.8), "charred" = adjustcolor("grey23", alpha.f = 0.8))
  ) +  # Corrected the parenthesis here
  labs(
    title = "a) PSZ",
    x = NULL,
    y = "Temperature (°C)"
  ) +
  theme_bw() +
  facet_wrap(~snow_phase)

PSZ_gb_boxplot
```

```{r}
trans_gb_boxplot_data$snow_phase <- fct_relevel(trans_gb_boxplot_data$snow_phase, "accumulation", "ablation")

TSZ_gb_boxplot <- ggplot(data = trans_gb_boxplot_data) + 
  geom_boxplot(aes(x = burn_status, y = temp, fill = burn_status)) +
  scale_fill_manual(
    name = "Char Pattern / Aspect",
    values = c("north" = "#1B7837", "south" = "#D95F02", 
               "uncharred" = adjustcolor("#2166AC", alpha.f = 0.8), "charred" = adjustcolor("grey23", alpha.f = 0.8))
  ) +  # Corrected the parenthesis here
  labs(
    title = "b) TSZ",
    x = "Group",
    y = "Temperature (°C)"
  ) +
  theme_bw() +
  facet_wrap(~snow_phase)

TSZ_gb_boxplot
```

```{r}
comb_charpattern_boxplot <- ggarrange(PSZ_gb_boxplot, TSZ_gb_boxplot, ncol = 1, nrow = 2, common.legend = TRUE, legend = "right")

comb_charpattern_boxplot
```

Month separated plots

```{r}
#Persistent
pers_feb_dt_mean_gb_plot <- ggplot(pers_feb_dt_mean_gb) +
  geom_line(aes(x = day, y = north_temp, color = "north"), linewidth = 0.7, alpha = 0.8) + 
  geom_line(aes(x = day, y = south_temp, color = "south"), linewidth = 0.7) +
  geom_line(aes(x = day, y = charred_temp, color = "charred"), linewidth = 0.7) + 
  geom_line(aes(x = day, y = uncharred_temp, color = "uncharred"), linetype = "dashed", linewidth = 0.7) + 
  facet_wrap(~ month) +
  labs(title = "a) PSZ", x = NULL, y = "Temperature (°C)") +
  scale_color_manual(
    name = "aspect",
    values = c("north" = "#2166AC", "south" = "#D95F02", "charred" = "grey15", "uncharred" = "grey30")
  ) +
  ylim(-10, 20) +  # Set the y-axis limits
  theme_bw()

pers_feb_dt_mean_gb_plot

pers_march_dt_mean_gb_plot <- ggplot(pers_march_dt_mean_gb) +
  geom_line(aes(x = day, y = north_temp, color = "north"), linewidth = 0.7, alpha = 0.8) + 
  geom_line(aes(x = day, y = south_temp, color = "south"), linewidth = 0.7) +
  geom_line(aes(x = day, y = charred_temp, color = "charred"), linewidth = 0.7) + 
  geom_line(aes(x = day, y = uncharred_temp, color = "uncharred"), linetype = "dashed", linewidth = 0.7) + 
  facet_wrap(~ month) +
  labs(title = " ", x = NULL, y = NULL) +
  scale_color_manual(
    name = "aspect",
    values = c("north" = "#2166AC", "south" = "#D95F02", "charred" = "grey15", "uncharred" = "grey30")
  ) +
  ylim(-10, 20) +  # Set the y-axis limits
  theme_bw()

pers_march_dt_mean_gb_plot

pers_april_dt_mean_gb_plot <- ggplot(pers_april_dt_mean_gb) +
  geom_line(aes(x = day, y = north_temp, color = "north"), linewidth = 0.7, alpha = 0.8) + 
  geom_line(aes(x = day, y = south_temp, color = "south"), linewidth = 0.7) +
  geom_line(aes(x = day, y = charred_temp, color = "charred"), linewidth = 0.7) + 
  geom_line(aes(x = day, y = uncharred_temp, color = "uncharred"), linetype = "dashed", linewidth = 0.7) + 
  facet_wrap(~ month) +
  labs(title = " ", x = NULL, y = NULL) +
  scale_color_manual(
    name = "aspect",
    values = c("north" = "#2166AC", "south" = "#D95F02", "charred" = "grey15", "uncharred" = "grey30")
  ) +
  ylim(-10, 20) +  # Set the y-axis limits
  theme_bw()

pers_april_dt_mean_gb_plot

pers_may_dt_mean_gb_plot <- ggplot(pers_may_dt_mean_gb) +
  geom_line(aes(x = day, y = north_temp, color = "north"), linewidth = 0.7, alpha = 0.8) + 
  geom_line(aes(x = day, y = south_temp, color = "south"), linewidth = 0.7) +
  geom_line(aes(x = day, y = charred_temp, color = "charred"), linewidth = 0.7) + 
  geom_line(aes(x = day, y = uncharred_temp, color = "uncharred"), linetype = "dashed", linewidth = 0.7) + 
  facet_wrap(~ month) +
  labs(title = " ", x = NULL, y = NULL) +
  scale_color_manual(
    name = "aspect",
    values = c("north" = "#2166AC", "south" = "#D95F02", "charred" = "grey15", "uncharred" = "grey30")
  ) +
  ylim(-10, 20) +  # Set the y-axis limits
  theme_bw()

pers_may_dt_mean_gb_plot
```

```{r}
#combining the persistent plots 
PSZ_gb_lineplot_bymonth <- ggarrange(pers_feb_dt_mean_gb_plot, pers_march_dt_mean_gb_plot, pers_april_dt_mean_gb_plot, pers_may_dt_mean_gb_plot, nrow = 1, ncol = 4, common.legend = TRUE, legend = "right")

PSZ_gb_lineplot_bymonth
```

```{r}
#Transitional
trans_feb_dt_mean_gb_plot <- ggplot(trans_feb_dt_mean_gb) +
  geom_line(aes(x = day, y = north_temp, color = "north"), linewidth = 0.7, alpha = 0.8) + 
  geom_line(aes(x = day, y = south_temp, color = "south"), linewidth = 0.7) +
  geom_line(aes(x = day, y = charred_temp, color = "charred"), linewidth = 0.7) + 
  geom_line(aes(x = day, y = uncharred_temp, color = "uncharred"), linetype = "dashed", linewidth = 0.7) + 
  facet_wrap(~ month) +
  labs(title = "b) TSZ", x = NULL, y = "Temperature (°C)") +
  scale_color_manual(
    name = "aspect",
    values = c("north" = "#2166AC", "south" = "#D95F02", "charred" = "grey15", "uncharred" = "grey30")
  ) +
  ylim(-10, 21) +  # Set the y-axis limits
  theme_bw()

trans_feb_dt_mean_gb_plot

trans_march_dt_mean_gb_plot <- ggplot(trans_march_dt_mean_gb) +
  geom_line(aes(x = day, y = north_temp, color = "north"), linewidth = 0.7, alpha = 0.8) + 
  geom_line(aes(x = day, y = south_temp, color = "south"), linewidth = 0.7) +
  geom_line(aes(x = day, y = charred_temp, color = "charred"), linewidth = 0.7) + 
  geom_line(aes(x = day, y = uncharred_temp, color = "uncharred"), linetype = "dashed", linewidth = 0.7) + 
  facet_wrap(~ month) +
  labs(title = " ", x = NULL, y = NULL) +
  scale_color_manual(
    name = "aspect",
    values = c("north" = "#2166AC", "south" = "#D95F02", "charred" = "grey15", "uncharred" = "grey30")
  ) +
  ylim(-10, 21) +  # Set the y-axis limits
  theme_bw()

trans_march_dt_mean_gb_plot

trans_april_dt_mean_gb_plot <- ggplot(trans_april_dt_mean_gb) +
  geom_line(aes(x = day, y = north_temp, color = "north"), linewidth = 0.7, alpha = 0.8) + 
  geom_line(aes(x = day, y = south_temp, color = "south"), linewidth = 0.7) +
  geom_line(aes(x = day, y = charred_temp, color = "charred"), linewidth = 0.7) + 
  geom_line(aes(x = day, y = uncharred_temp, color = "uncharred"), linetype = "dashed", linewidth = 0.7) + 
  facet_wrap(~ month) +
  labs(title = " ", x = NULL, y = NULL) +
  scale_color_manual(
    name = "aspect",
    values = c("north" = "#2166AC", "south" = "#D95F02", "charred" = "grey15", "uncharred" = "grey30")
  ) +
  ylim(-10, 21) +  # Set the y-axis limits
  theme_bw()

trans_april_dt_mean_gb_plot

trans_may_dt_mean_gb_plot <- ggplot(trans_may_dt_mean_gb) +
  geom_line(aes(x = day, y = north_temp, color = "north"), linewidth = 0.7, alpha = 0.8) + 
  geom_line(aes(x = day, y = south_temp, color = "south"), linewidth = 0.7) +
  geom_line(aes(x = day, y = charred_temp, color = "charred"), linewidth = 0.7) + 
  geom_line(aes(x = day, y = uncharred_temp, color = "uncharred"), linetype = "dashed", linewidth = 0.7) + 
  facet_wrap(~ month) +
  labs(title = " ", x = NULL, y = NULL) +
  scale_color_manual(
    name = "aspect",
    values = c("north" = "#2166AC", "south" = "#D95F02", "charred" = "grey15", "uncharred" = "grey30")
  ) +
  ylim(-10, 21) +  # Set the y-axis limits
  theme_bw()

trans_may_dt_mean_gb_plot
```

```{r}
#combining the persistent plots 
TSZ_gb_lineplot_bymonth <- ggarrange(trans_feb_dt_mean_gb_plot, trans_march_dt_mean_gb_plot, trans_april_dt_mean_gb_plot, trans_may_dt_mean_gb_plot, nrow = 1, ncol = 4, common.legend = TRUE, legend = "right")

# Add "Date" text below the x-axis for the entire figure
TSZ_gb_lineplot_bymonth <- annotate_figure(
  TSZ_gb_lineplot_bymonth,
  bottom = text_grob("Date", size = 11)
)

TSZ_gb_lineplot_bymonth
```

```{r}
# Arrange plots with a common legend
comb_gb_lineplot_bymonth <- ggarrange(
  PSZ_gb_lineplot_bymonth, 
  TSZ_gb_lineplot_bymonth, 
  nrow = 2, ncol = 1, 
  common.legend = TRUE, 
  legend = "top")

comb_gb_lineplot_bymonth
```

## Simple Stats Calcs

### DTNT Stats

```{r}
stats_gbdbub <- full_15min_gbdbub %>%
  group_by(zone, phase, snow_phase) %>%
  summarize(
    mean_gb_temp = mean(gb_temp, na.rm = TRUE), 
    mean_db_temp = mean(db_temp, na.rm = TRUE), 
    mean_ub_temp = mean(ub_temp, na.rm = TRUE)
  )
```

### NS Stats

### GB DB UB Stats

```{r}
stats_gbdbub_dtnt <- full_15min_gbdbub %>%
  group_by(zone, phase, snow_phase) %>%
  summarize(
    mean_gb_temp = mean(gb_temp, na.rm = TRUE), 
    mean_db_temp = mean(db_temp, na.rm = TRUE), 
    mean_ub_temp = mean(ub_temp, na.rm = TRUE), 
    min_gb_temp = min(gb_temp, na.rm = TRUE), 
    min_db_temp = min(db_temp, na.rm = TRUE),
    min_ub_temp = min(ub_temp, na.rm = TRUE), 
    max_gb_temp = max(gb_temp, na.rm = TRUE), 
    max_db_temp = max(db_temp, na.rm = TRUE),
    max_ub_temp = max(ub_temp, na.rm = TRUE),
  )

write_csv(stats_gbdbub_dtnt, "nsf/treetemp_data/stats_gbdbub_dtnt_simple.csv")
```

```{r}
#total range of temperatures for GB, DB and live trees, not accounting for day/night phase

stats_totaltemprange_gbdbub <- full_15min_gbdbub %>%
  group_by(zone, phase, aspect) %>%
  filter(phase == "day") %>%
  summarize(
    mean_gb_temp = mean(gb_temp, na.rm = TRUE), 
    mean_db_temp = mean(db_temp, na.rm = TRUE), 
    mean_ub_temp = mean(ub_temp, na.rm = TRUE),
    min_gb_temp = min(gb_temp, na.rm = TRUE), 
    min_db_temp = min(db_temp, na.rm = TRUE), 
    min_ub_temp = min(ub_temp, na.rm = TRUE),
    max_gb_temp = max(gb_temp, na.rm = TRUE), 
    max_db_temp = max(db_temp, na.rm = TRUE), 
    max_ub_temp = max(ub_temp, na.rm = TRUE),
    gb_temp_range = (max_gb_temp - min_gb_temp), 
    db_temp_range = (max_db_temp - min_db_temp),
    ub_temp_range = (max_ub_temp - min_ub_temp),
  )

stats_totalmax_gbdbub <- full_15min_gbdbub %>%
  group_by(phase, snow_phase) %>%
  summarize(
    min_gb_temp = min(gb_temp, na.rm = TRUE), 
    min_db_temp = min(db_temp, na.rm = TRUE), 
    min_ub_temp = min(ub_temp, na.rm = TRUE),
    max_gb_temp = max(gb_temp, na.rm = TRUE), 
    max_db_temp = max(db_temp, na.rm = TRUE), 
    max_ub_temp = max(ub_temp, na.rm = TRUE))
```

```{r}
stats_totaltemprange_ns<- full_15min_ns %>%
  group_by(zone, phase, snow_phase, burn_status) %>%
  filter(phase == "day") %>%
  summarize(
    mean_north_temp = mean(north_temp, na.rm = TRUE), 
    mean_south_temp = mean(south_temp, na.rm = TRUE), 
    min_north_temp = min(north_temp, na.rm = TRUE), 
    min_south_temp = min(south_temp, na.rm = TRUE),
    max_north_temp = max(north_temp, na.rm = TRUE), 
    max_south_temp = max(south_temp, na.rm = TRUE),
    north_temp_range = (max_north_temp - min_north_temp), 
    south_temp_range = (max_south_temp - min_south_temp)
  ) %>%
  mutate(
    min_aspect_range = abs(min_north_temp - min_south_temp), # Range of minimum temperatures
    mean_aspect_range = abs(mean_north_temp - mean_south_temp), # Range of mean temperatures
    max_aspect_range = abs(max_north_temp - max_south_temp) # Range of maximum temperatures
  )
```

```{r}
#GB Stats only
stats_gb_charpattern <- full_hourly_gb %>%
  group_by(zone, phase, snow_phase) %>%
  filter(phase == "day") %>%
  summarize(
    mean_charred_temp = mean(charred_temp, na.rm = TRUE), 
    mean_uncharred_temp = mean(uncharred_temp, na.rm = TRUE),
    mean_north_temp = mean(north_temp, na.rm = TRUE),
    mean_south_temp = mean(south_temp, na.rm = TRUE),
    min_charred_temp = min(charred_temp, na.rm = TRUE), 
    min_uncharred_temp = min(uncharred_temp, na.rm = TRUE),
    min_north_temp = min(north_temp, na.rm = TRUE),
    min_south_temp = min(south_temp, na.rm = TRUE),
    max_charred_temp = max(charred_temp, na.rm = TRUE), 
    max_uncharred_temp = max(uncharred_temp, na.rm = TRUE),
    max_north_temp = max(north_temp, na.rm = TRUE),
    max_south_temp = max(south_temp, na.rm = TRUE)) %>%
  mutate(
    overall_min_temp = pmap_dbl(
      list(min_charred_temp, min_uncharred_temp, min_north_temp, min_south_temp),
      ~ min(c(...), na.rm = TRUE)
    )
  ) %>%
  mutate(
    overall_max_temp = pmap_dbl(
      list(max_charred_temp, max_uncharred_temp, max_north_temp, max_south_temp),
      ~ max(c(...), na.rm = TRUE)
    )
  )
```

## Cumulative Tree LWout Plot

### Cumulative Burn Status LWout Line Plot

Data Wrangling

```{r}
#data wrangling 
p_accu_dr_gbdbub_LWout <- cum_full_daily_gbdbub_treeLWout %>%
  filter(zone == "PSZ") %>%
  mutate(day = as.Date(day, format = "%Y-%m-%d"))

t_accu_dr_gbdbub_LWout <- cum_full_daily_gbdbub_treeLWout %>%
  filter(zone == "TSZ") %>%
  mutate(day = as.Date(day, format = "%Y-%m-%d"))
```

Plotting

\*\* Use this plot!

```{r}
#persistent 
p_cum_dt_gbdbub_plot <- ggplot(data = p_accu_dr_gbdbub_LWout) +
  geom_line(aes(x = day, y = accu_daily_gb_LWout_MJperd, color = "green burn", linetype = aspect), linewidth = 0.6) +  
  geom_line(aes(x = day, y = accu_daily_db_LWout_MJperd, color = "dead burn", linetype = aspect), linewidth = 0.6) +
  geom_line(aes(x = day, y = accu_daily_ub_LWout_MJperd, color = "live", linetype = aspect), linewidth = 0.6) +
  facet_wrap(~aspect, dir = "h") +
  theme_bw() +
  labs(title = "a) PSZ", 
    x = NULL,
    y = "Daily Cumulative LWout (MJ)",
    color = "Burn Status", 
    linetype = "Aspect"
  ) +
  scale_color_manual(values = c("green burn" = "#1B7837", "dead burn" = "#D95F02", "live" = adjustcolor("#2166AC", alpha = 0.7))) +
  scale_linetype_manual(values = c("north" = "dashed", "south" = "solid")) + 
  #accumulation/ablation date destiction
  geom_vline(xintercept = as.numeric(as.Date('2024-05-06')), 
             linetype = "solid",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8) + 
  #snowfree date
  geom_vline(xintercept = as.numeric(as.Date('2024-06-05')), 
             linetype = "dashed",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8) + 
  scale_y_continuous(limits = c(0, 2000))

p_cum_dt_gbdbub_plot
```

```{r}
#transitional
t_cum_dt_gbdbub_plot <- ggplot(data = t_accu_dr_gbdbub_LWout) +
  geom_line(aes(x = day, y = accu_daily_gb_LWout_MJperd, color = "green burn", linetype = aspect), linewidth = 0.6) +  
  geom_line(aes(x = day, y = accu_daily_db_LWout_MJperd, color = "dead burn", linetype = aspect), linewidth = 0.6) +
  geom_line(aes(x = day, y = accu_daily_ub_LWout_MJperd, color = "live", linetype = aspect), linewidth = 0.6) +
  facet_wrap(~aspect, dir = "h") +
  theme_bw() +
  labs(title = "b) TSZ", 
    x = "Date",
    y = "Daily Cumulative LWout (MJ)",
    color = "Burn Status", 
    linetype = "Aspect"
  ) +
  scale_color_manual(values = c("green burn" = "#1B7837", "dead burn" = "#D95F02", "live" = adjustcolor("#2166AC", alpha = 0.7))) +
  scale_linetype_manual(values = c("north" = "dashed", "south" = "solid")) + 
  #accumulation/ablation date destiction
  geom_vline(xintercept = as.numeric(as.Date('2024-04-06')), 
             linetype = "solid",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8) + 
  #snowfree date
  geom_vline(xintercept = as.numeric(as.Date('2024-05-25')), 
             linetype = "dashed",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8) + 
  scale_y_continuous(limits = c(0, 2000))

t_cum_dt_gbdbub_plot
```

```{r}
cum_full_daily_treeLWout <- ggarrange(p_cum_dt_gbdbub_plot, t_cum_dt_gbdbub_plot, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")

cum_full_daily_treeLWout
```

Mean cumulative LWout values for all zones

```{r}
total_cum_TSZ <- t_accu_dr_gbdbub_LWout %>%
  summarise(sum_gb_LWout = max(accu_daily_gb_LWout_MJperd), sum_db_LWout = max(accu_daily_db_LWout_MJperd), sum_ub_LWout = max(accu_daily_ub_LWout_MJperd))
```

```{r}
total_cum_PSZ <- p_accu_dr_gbdbub_LWout %>%
  summarise(sum_gb_LWout = max(accu_daily_gb_LWout_MJperd), sum_db_LWout = max(accu_daily_db_LWout_MJperd), sum_ub_LWout = max(accu_daily_ub_LWout_MJperd))
```

### Snow Depth & Tree Well Plots

Making plots by zone / burned & unburned because then I can have snow depths at burned/unburned sites...

-   as of 2024-10-24, just starting with burned, cause I don't have unburned data loaded yet

```{r}
#filtered transb weather to get a daily average
transb_daily_wx <- transb_wx_15min_r %>%
  filter(
    hour(datetime) >= 8 & hour(datetime) <= 16
  ) %>%
  mutate(
    day = as.Date(datetime),
    month = month(datetime), 
    zone = "TSZ"
  ) %>%
  select(datetime, day, month, zone, SnowDepth_m, AirTC_Avg) %>%
  group_by(day, month, zone) %>%
  summarize(SnowDepth_m = mean(SnowDepth_m), AirTC_Avg = mean(AirTC_Avg))
```

```{r}
#filtered transb weather to get a daily average
persb_daily_wx <- persb_wx_hourly_r %>%
  filter(
    hour(datetime) >= 8 & hour(datetime) <= 16
  ) %>%
  mutate(
    day = as.Date(datetime),
    month = month(datetime), 
    zone = "PSZ"
  ) %>%
  select(datetime, day, month, zone, SnowDepth_m, AirTC_Avg) %>%
  group_by(day, month, zone) %>%
  summarize(SnowDepth_m = mean(SnowDepth_m), AirTC_Avg = mean(AirTC_Avg))
```

```{r}
#combining the above daily_dt_weather
daily_burned_dt_wx <- persb_daily_wx %>%
  full_join(transb_daily_wx)
```

\*\* Probably won't use the plot below

```{r}
p_b_snow_treewell_plot <- ggplot() +
  geom_line(data = p_full_dt_gbdbub_LWout, aes(x = day, y = gb_LWout_MJperd, color = "green burn"), linewidth = 0.8) +
 geom_line(data = p_full_dt_gbdbub_LWout, aes(x = day, y = db_LWout_MJperd, color = "dead burn"), linewidth = 0.8) +
  geom_line(data =p_full_dt_gbdbub_LWout, aes(x = day, y = ub_LWout_MJperd, color = "live"), linewidth = 0.8) +
  geom_line(data = persb_snowcamera_data, aes(x = date, y = snowcam_max_depth_m*10, color = "snow depth"), linewidth = 0.8) +
  geom_point(data = persb_treewell_dates, aes(x = date, y = snowcam_max_depth_m*10, 
             shape = "Dates that treewells developed"), 
             color = "black", fill = "black", size = 1.5) +
  facet_wrap(~zone + aspect) +
  labs(
    title = "Without Tree LWout in Net Rad",
    x = "Date",
    y = "Cumulative Radiation Component (MJ/d)"
  ) +
   scale_color_manual(
   values = c("dead burn" = "#D95F02", 
               "green burn" = "#1B7837", 
               "live" = "#2166AC", 
               "snow depth" = "black")) +
  scale_shape_manual(
    values = c("Dates that treewells developed" = 16)  # Set shape for points
  ) +
  # Primary y-axis and secondary y-axis for snow depth
  scale_y_continuous(
    labels = scales::label_number(accuracy = 1),
    sec.axis = sec_axis(~./10, name = "Snow Depth (m)")
  ) +
  # Remove legend titles
  guides(
    color = guide_legend(title = NULL),  
    linetype = guide_legend(title = NULL),
    shape = guide_legend(title = NULL)
  ) +
  theme_bw()

print(p_b_snow_treewell_plot)
```

Snow depth plot with tree temp + air temp!

```{r}
#creating daily average tree temp plot for dt only
full_dt_daily_gbdbub <- full_15min_gbdbub %>%
  filter(phase == "day", aspect == "south") %>%
  group_by(day, month, phase, zone, aspect) %>%
  summarize(gb_temp = mean(gb_temp), db_temp = mean(db_temp), ub_temp = mean(ub_temp))
```

```{r}
p_b_snow_treewell_plot_V2 <- ggplot() +
  geom_line(data = full_dt_daily_gbdbub, aes(x = day, y = gb_temp, color = "green burn"), linewidth = 0.8) +
 geom_line(data = full_dt_daily_gbdbub, aes(x = day, y = db_temp, color = "dead burn"), linewidth = 0.8) +
  geom_line(data =full_dt_daily_gbdbub, aes(x = day, y = ub_temp, color = "live"), linewidth = 0.8, alpha = 0.8) +
  #persistent snow depths + tree wells
  geom_line(data = persb_snowcamera_data, aes(x = date, y = snowcam_max_depth_m*15, color = "snow depth"), linewidth = 0.8) +
  geom_point(data = persb_treewell_dates, aes(x = day, y = snowcam_max_depth_m*15, 
             shape = "Dates that treewells developed"), 
             color = "black", fill = "black", size = 1.5) +
    #transitional snow depths + tree wells
  geom_line(data = transb_snowcamera_data, aes(x = date, y = snowcam_max_depth_m*15, color = "snow depth"), linewidth = 0.8) +
  geom_point(data = transb_treewell_dates, aes(x = day, y = snowcam_max_depth_m*15, 
             shape = "Dates that treewells developed"), 
             color = "black", fill = "black", size = 1.5) +
  #air temp
  geom_line(data = daily_burned_dt_wx, aes(x = day, y = AirTC_Avg, color = "air temp", linetype = "dasehd")) + 
  facet_wrap(~zone + aspect) +
  labs(
    title = "Without Tree LWout in Net Rad",
    x = "Date",
    y = "Cumulative Radiation Component (MJ/d)"
  ) +
  scale_color_manual(values = c("dead burn" = "#D95F02", 
               "green burn" = "#1B7837", 
               "live" = "#2166AC", 
               "snow depth" = "black", "air temp" = "red")) +
  scale_shape_manual(
    values = c("Dates that treewells developed" = 16)  # Set shape for points
  ) +
  # Primary y-axis and secondary y-axis for snow depth
  scale_y_continuous(
    labels = scales::label_number(accuracy = 1),
    sec.axis = sec_axis(~./15, name = "Snow Depth (m)")
  ) +
  # Remove legend titles
  guides(
    color = guide_legend(title = NULL),  
    linetype = guide_legend(title = NULL),
    shape = guide_legend(title = NULL)
  ) +
  theme_bw()

p_b_snow_treewell_plot_V2
```

```{r}
accu_dt_ns_LWout <- accu_full_daily_ns_LWout %>%
  filter(phase == "day") %>%
  mutate(zone = case_when(
    zone == "persistent" ~ "PSZ",
    zone == "transitional" ~ "TSZ",
    TRUE ~ zone  # Keep the original value if it's neither "persistent" nor "transitional"
  ))

cum_dt_daily_LWout <- cum_full_daily_LWout %>%
  filter(phase == "day")
```

```{r}
cum_dt_gbdbub_plot <- ggplot(data = cum_dt_daily_LWout) +
  geom_line(aes(x = day, y = accu_daily_gb_LWout_MJperd, color = "green burn", linetype = aspect), linewidth = 0.6) +  
  geom_line(aes(x = day, y = accu_daily_db_LWout_MJperd, color = "dead burn", linetype = aspect), linewidth = 0.6) +
  geom_line(aes(x = day, y = accu_daily_ub_LWout_MJperd, color = "live", linetype = aspect), linewidth = 0.6) +
  facet_wrap(~zone + aspect, dir = "h") +
  theme_bw() +
  labs(
    x = "Date",
    y = "Daily Cumulative LWout (MJ/day)",
    color = "Burn Status", 
    linetype = "Aspect"
  ) +
  scale_color_manual(values = c("green burn" = "#1B7837", "dead burn" = "#D95F02", "live" = adjustcolor("#2166AC", alpha = 0.7))) +
  scale_linetype_manual(values = c("north" = "dashed", "south" = "solid"))

cum_dt_gbdbub_plot
```

#### Net Rad, Snow Depth, Treewell, AirTemp Plots

```{r}
#creating mean dt average values for the weather station data
mean_dt_transb_wx <- filtered_transb_wx_15min %>%
  filter(phase == "day") %>%
  group_by(day, month, phase, zone, burn_status) %>%
  summarize(SnowDepth_m = mean(SnowDepth_m), AirTC_Avg = mean(AirTC_Avg), SWin_Avg = mean(SWin_Avg), SWout_Avg = mean(SWout_Avg), LWin_Avg = mean(LWin_Avg), LWout_Avg = mean(LWout_Avg), NR_Avg_wperm2 = mean(NR_Avg_new)) %>%
  #creating a MJ/day mean value column for NR
  mutate(NR_Avg_MJperd = (NR_Avg_wperm2 * 86400)/1000000) %>%
  #adding in a netSW and netLW column for plotting that is converted to MJperd
  mutate(Net_SW_MJperd = ((SWin_Avg - SWout_Avg)* 86400)/1000000, Net_LW_MJperd = ((LWin_Avg - LWout_Avg)* 86400)/1000000)
```

```{r}
#creating mean nt average values for the weather station data
mean_nt_transb_wx <- filtered_transb_wx_15min %>%
  filter(phase == "night") %>%
  group_by(day, month, phase, zone, burn_status) %>%
  summarize(SnowDepth_m = mean(SnowDepth_m), AirTC_Avg = mean(AirTC_Avg), SWin_Avg = mean(SWin_Avg), SWout_Avg = mean(SWout_Avg), LWin_Avg = mean(LWin_Avg), LWout_Avg = mean(LWout_Avg), NR_Avg_wperm2 = mean(NR_Avg_new)) %>%
  #creating a MJ/day mean value column for NR
  mutate(NR_Avg_MJperd = (NR_Avg_wperm2 * 86400)/1000000)
```

```{r}
## doing a maximum weather version
max_dt_transb_wx <- filtered_transb_wx_15min %>%
  filter(phase == "day") %>%
  group_by(day, month, phase, zone, burn_status) %>%
  summarize(SnowDepth_m = mean(SnowDepth_m), AirTC_Avg = max(AirTC_Avg), SWin_Avg = max(SWin_Avg), SWout_Avg = max(SWout_Avg), LWin_Avg = max(LWin_Avg), LWout_Avg = max(LWout_Avg), NR_Avg_wperm2 = max(NR_Avg_new)) %>%
  #creating a MJ/day mean value column for NR
  mutate(NR_Avg_MJperd = (NR_Avg_wperm2 * 86400)/1000000) %>%
  #adding in a netSW and netLW column for plotting that is converted to MJperd
  mutate(Net_SW_MJperd = ((SWin_Avg - SWout_Avg)* 86400)/1000000, Net_LW_MJperd = ((LWin_Avg - LWout_Avg)* 86400)/1000000)
```

```{r}
mean_dt_transub_wx <- filtered_transub_wx_15min %>%
  #filter(phase == "day") %>%
  group_by(day, month, phase, zone, burn_status) %>%
  summarize(SnowDepth_m = mean(SnowDepth_m), AirTC_Avg = mean(AirTC_Avg), SWin_Avg = mean(SWin_Avg), SWout_Avg = mean(SWout_Avg), LWin_Avg = mean(LWin_Avg), LWout_Avg = mean(LWout_Avg), NR_Avg_wperm2 = mean(NR_Avg_new)) %>%
  #creating a MJ/day mean value column for NR
  mutate(NR_Avg_MJperd = (NR_Avg_wperm2 * 86400)/1000000) %>%
  #adding in a netSW and netLW column for plotting that is converted to MJperd
  mutate(Net_SW_MJperd = ((SWin_Avg - SWout_Avg)* 86400)/1000000, Net_LW_MJperd = ((LWin_Avg - LWout_Avg)* 86400)/1000000)
```

```{r}
mean_dt_persb_wx <- filtered_persb_wx_hourly %>%
  filter(phase == "day") %>%
  group_by(day, month, phase, zone, burn_status) %>%
  summarize(SnowDepth_m = mean(SnowDepth_m), AirTC_Avg = mean(AirTC_Avg), SWin_Avg = mean(SWin_Avg), SWout_Avg = mean(SWout_Avg), LWin_Avg = mean(LWin_Avg), LWout_Avg = mean(LWout_Avg), NR_Avg_wperm2 = mean(NR_Avg_new)) %>%
  #creating a MJ/day mean value column for NR
  mutate(NR_Avg_MJperd = (NR_Avg_wperm2 * 86400)/1000000) %>%
  #adding in a netSW and netLW column for plotting that is converted to MJperd
  mutate(Net_SW_MJperd = ((SWin_Avg - SWout_Avg)* 86400)/1000000, Net_LW_MJperd = ((LWin_Avg - LWout_Avg)* 86400)/1000000)
```

```{r}
mean_dt_persub_wx <- filtered_persub_wx_hourly %>%
  filter(phase == "day") %>%
  group_by(day, month, phase, zone, burn_status) %>%
  summarize(SnowDepth_m = mean(SnowDepth_m), AirTC_Avg = mean(AirTC_Avg), SWin_Avg = mean(SWin_Avg), SWout_Avg = mean(SWout_Avg), LWin_Avg = mean(LWin_Avg), LWout_Avg = mean(LWout_Avg), NR_Avg_wperm2 = mean(NR_Avg_new)) %>%
#creating a MJ/day mean value column for NR
  mutate(NR_Avg_MJperd = (NR_Avg_wperm2 * 86400)/1000000) %>%
  #adding in a netSW and netLW column for plotting that is converted to MJperd
  mutate(Net_SW_MJperd = ((SWin_Avg - SWout_Avg)* 86400)/1000000, Net_LW_MJperd = ((LWin_Avg - LWout_Avg)* 86400)/1000000) 
```

```{r}
#creating dataframes for the a mean daily value of the gb and db tree LWout values for both zones
p_b_dt_mean_treeLWout <- full_15min_ns_LWout%>%
  inner_join(p_b_solar_times, by = "day") %>%
  #making sunrise/sunset columns correct timezone
   mutate(
    sunrise = as.POSIXct(sunrise, format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
    sunrise = with_tz(sunrise, tz = "MST")
  ) %>%
   mutate(
    sunset = as.POSIXct(sunset, format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
    sunset = with_tz(sunset, tz = "MST")
  ) %>%
  mutate(
    phase = case_when(
      datetime >= sunrise & datetime < sunset ~ "day",
      datetime < sunrise ~ "night",
      datetime >= sunset ~ "night",
      TRUE ~ NA_character_)) %>%
  #making a column that includes the tree LWout in MJper day for both the north and south sides of the tree
  mutate(full_tree_LWout_MJperd = n_LWout_MJperd + s_LWout_MJperd) %>%
  #getting only daytime values
  filter(zone == "PSZ", phase == "day") %>%
  #filtering out only gb and db trees
  filter(burn_status %in% c("green burn", "dead burn")) %>%
  #geting daily value
  group_by(day, month, phase, zone) %>%
  summarize(full_tree_LWout_MJperd = mean(full_tree_LWout_MJperd)) %>%
  #adding in a burned burn status column for plots
  mutate(burn_status = "burned")
```

```{r}
t_b_dt_mean_treeLWout <- full_15min_ns_LWout %>%
  inner_join(p_b_solar_times, by = "day") %>%
  #making sunrise/sunset columns correct timezone
   mutate(
    sunrise = as.POSIXct(sunrise, format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
    sunrise = with_tz(sunrise, tz = "MST")
  ) %>%
   mutate(
    sunset = as.POSIXct(sunset, format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
    sunset = with_tz(sunset, tz = "MST")
  ) %>%
  mutate(
    phase = case_when(
      datetime >= sunrise & datetime < sunset ~ "day",
      datetime < sunrise ~ "night",
      datetime >= sunset ~ "night",
      TRUE ~ NA_character_)) %>%
  #making a column that includes the tree LWout in MJper day for both the north and south sides of the tree
  mutate(full_tree_LWout_MJperd = n_LWout_MJperd + s_LWout_MJperd) %>%
  #getting only daytime values
  filter(zone == "TSZ", phase == "day") %>%
  #filtering out only gb and db trees
  filter(burn_status %in% c("green burn", "dead burn")) %>%
  #geting daily value
  group_by(day, month, phase, zone) %>%
  #getting daily average tree_LWout value
  summarize(full_tree_LWout_MJperd = mean(full_tree_LWout_MJperd)) %>%
  #adding in a burned burn status column for plots
  mutate(burn_status = "burned")
```

```{r}
#mean dataframes for a single averaged dt temp by burn_status for burned & unburned

##persistent
p_b_dt_avg_temp <- full_15min_ns %>%
  inner_join(p_b_solar_times, by = "day") %>%
  #making sunrise/sunset columns correct timezone
   mutate(
    sunrise = as.POSIXct(sunrise, format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
    sunrise = with_tz(sunrise, tz = "MST")
  ) %>%
   mutate(
    sunset = as.POSIXct(sunset, format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
    sunset = with_tz(sunset, tz = "MST")
  ) %>%
  mutate(
    phase = case_when(
      datetime >= sunrise & datetime < sunset ~ "day",
      datetime < sunrise ~ "night",
      datetime >= sunset ~ "night",
      TRUE ~ NA_character_)) %>%
  filter(burn_status %in% c("green burn", "dead burn"), zone == "PSZ", phase == "day") %>%
  select(datetime, day, month, phase, zone, burn_status, ns_avg_temp) %>%
  group_by(day, month, phase, zone) %>%
  summarize(mean_temp = mean(ns_avg_temp))

##transitional
t_b_dt_avg_temp <- full_15min_ns %>%
  inner_join(p_b_solar_times, by = "day") %>%
  #making sunrise/sunset columns correct timezone
   mutate(
    sunrise = as.POSIXct(sunrise, format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
    sunrise = with_tz(sunrise, tz = "MST")
  ) %>%
   mutate(
    sunset = as.POSIXct(sunset, format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
    sunset = with_tz(sunset, tz = "MST")
  ) %>%
  mutate(
    phase = case_when(
      datetime >= sunrise & datetime < sunset ~ "day",
      datetime < sunrise ~ "night",
      datetime >= sunset ~ "night",
      TRUE ~ NA_character_)) %>%
  filter(burn_status %in% c("green burn", "dead burn"), zone == "TSZ", phase == "day") %>%
  select(datetime, day, month, phase, zone, burn_status, ns_avg_temp) %>%
  group_by(day, month, phase, zone) %>%
  summarize(mean_temp = mean(ns_avg_temp))
```

```{r}
#creating a new dataframe with snow depths and treewell development, as well as tree_LWout so that I can put points on snowdepths instead of total treeLWout line in plots
persb_treewell_dates <- persb_snowcamera_data %>%
  select(zone, burn_status, date, conditions, treewell_developed, snowcam_max_depth_m) %>%
  rename(day = date) %>%
  inner_join(p_b_dt_avg_temp) %>%
  filter(treewell_developed == "yes")
```

```{r}
transb_treewell_dates <- transb_snowcamera_data %>%
  select(zone, date, conditions, treewell_developed, snowcam_max_depth_m) %>%
  rename(day = date) %>%
  inner_join(t_b_dt_avg_temp) %>%
  filter(treewell_developed == "yes")
```

Plotting

\*\* USING THIS PLOT!

```{r}
p_snowtreewell_NR_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = mean_dt_persb_wx, aes(x = day, y = NR_Avg_MJperd, fill = "net radiation"), alpha = 0.4) +
  #air temp line
  geom_line(data = mean_dt_persb_wx, aes(x = day, y = AirTC_Avg, color = "air temp"), linewidth = 0.8) +
  geom_line(data = p_b_dt_avg_temp, aes(x = day, y = mean_temp, color = "tree temp"), alpha = 0.8, linewidth = 0.8) +
  # Line plot for snow cam max depth on a secondary y-axis
  #transitional snow depths + tree wells
  geom_line(data = persb_snowcamera_data, aes(x = date, y = snowcam_max_depth_m*15, color = "snow depth"), alpha = 0.8, linewidth = 0.8) +
  geom_point(data = persb_treewell_dates, aes(x = day, y = snowcam_max_depth_m*15, 
             shape = "dates that wells developed"), 
             color = "black", fill = "black", size = 1.5) +
  #facet_wrap(~burn_status) +
  #geom_line(data = p_b_dt_mean_treeLWout, aes(x = day, y = full_tree_LWout_MJperd, color = "tree LWout"), alpha = 0.8, linewidth = 0.8) +
  labs(
    title = "a) PSZ",
    x = NULL,
    y = "Total Net Rad (MJ/day) & Temp (°C)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("air temp" = "#D95F02", "tree temp" = "#1B7837", "snow depth" = "#2166AC", "tree LWout"= "black")) +
  scale_fill_manual(name = "Radiation Data", 
                    values = c("net radiation" = "#666666")) +
  scale_shape_manual(values = c("dates that wells developed" = 21)) +
  guides(color = guide_legend(title = NULL),  # Remove title for color legend
         fill = guide_legend(title = NULL), #Remove fill legend
         shape = guide_legend(title = NULL)) +
  scale_x_date(
    limits = c(as.Date("2024-02-02"), as.Date("2024-07-01")), 
    expand = c(0.02, 0.02)  # Remove extra space on the x-axis
  ) +# Remove title for shape legend
  scale_y_continuous(
    limits = c(-15, 38),
    sec.axis = sec_axis(~./15, name = "Snow Depth (m)")  # Adjusting for the secondary axis
  ) +
  theme_bw() + 
  theme(
    plot.title = element_text(size = 13),      # Title size
    axis.title.x = element_text(size = 11),                   # X-axis title size
    axis.title.y = element_text(size = 11),                   # Y-axis title size
    axis.text = element_text(size = 11),                      # Axis text size
    legend.text = element_text(size = 12),                    # Legend text size
    legend.title = element_text(size = 12),                   # Legend title size
    strip.text = element_text(size = 12)) + 
  #accumulation/ablation date destiction
  geom_vline(xintercept = as.numeric(as.Date('2024-05-06')), 
             linetype = "solid",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8) + 
  #snowfree date
  geom_vline(xintercept = as.numeric(as.Date('2024-06-05')), 
             linetype = "dashed",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8)

p_snowtreewell_NR_plot
```

```{r}
t_snowtreewell_NR_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_col(data = mean_dt_transb_wx, aes(x = day, y = NR_Avg_MJperd, fill = "net radiation"), alpha = 0.4) +
  #air temp line
  geom_line(data = mean_dt_transb_wx, aes(x = day, y = AirTC_Avg, color = "air temp"), linewidth = 0.8) +
  geom_line(data = t_b_dt_avg_temp, aes(x = day, y = mean_temp, color = "tree temp"), alpha = 0.8, linewidth = 0.8) +
  # Line plot for snow cam max depth on a secondary y-axis
  #transitional snow depths + tree wells
  geom_line(data = transb_snowcamera_data, aes(x = date, y = snowcam_max_depth_m*15, color = "daily max snow depth"), linewidth = 0.8, alpha = 0.8) +
  geom_point(data = transb_treewell_dates, aes(x = day, y = snowcam_max_depth_m*15, 
             shape = "dates that wells developed"), 
             color = "black", fill = "black", size = 1.5) +
  #facet_wrap(~burn_status) +
  labs(
    title = "b) TSZ",
    x = "Date",
    y = "Total Net Rad (MJ/day) & Temp (°C)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("air temp" = "#D95F02", "tree temp" = "#1B7837", "daily max snow depth" = "#2166AC")) +
  scale_fill_manual(name = "Radiation Data", 
                    values = c("net radiation" = "#666666")) +
  scale_shape_manual(values = c("dates that wells developed" = 21)) +
  guides(color = guide_legend(title = NULL),  # Remove title for color legend
         fill = guide_legend(title = NULL), #Remove fill legend
         shape = guide_legend(title = NULL)) +
  scale_x_date(
    limits = c(as.Date("2024-02-02"), as.Date("2024-07-01")), 
    expand = c(0.02, 0.02)  # Remove extra space on the x-axis
  ) +# Remove title for shape legend
  scale_y_continuous(
    limits = c(-15, 38),
    sec.axis = sec_axis(~./15, name = "Snow Depth (m)")  # Adjusting for the secondary axis
  ) +
  theme_bw() + 
  theme(
    plot.title = element_text(size = 13),      # Title size
    axis.title.x = element_text(size = 11),                   # X-axis title size
    axis.title.y = element_text(size = 11),                   # Y-axis title size
    axis.text = element_text(size = 11),                      # Axis text size
    legend.text = element_text(size = 12),                    # Legend text size
    legend.title = element_text(size = 12),                   # Legend title size
    strip.text = element_text(size = 12)) + 
   #accumulation/ablation date destiction
  geom_vline(xintercept = as.numeric(as.Date('2024-04-06')), 
             linetype = "solid",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8) + 
  #snowfree date
  geom_vline(xintercept = as.numeric(as.Date('2024-05-25')), 
             linetype = "dashed",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8)

t_snowtreewell_NR_plot
```

```{r}
#combining above plots
comb_b_snowtreewell_NR_plots <- ggarrange(p_snowtreewell_NR_plot, t_snowtreewell_NR_plot, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")

comb_b_snowtreewell_NR_plots
```

\*\* as of 2025-01-14 - need to add an unburned comparison to the above plots!

SW/LW Plots

\*\* as of 2025-01-16 - not sure I am going to use the SW/LW plots below.

```{r}
p_rad_plot <- ggplot() + 
  #Net SW
  geom_col(data = mean_dt_persb_wx, aes(x = day, y = Net_SW_MJperd, fill = "net SW"), alpha = 0.7, position = position_dodge(width = 0.5)) +
  #Total Net Rad
  geom_col(data = mean_dt_persb_wx, aes(x = day, y = NR_Avg_MJperd, fill = "net radiation"), alpha = 0.7, position = position_dodge(width = 0.5)) +
  #Net LW
  geom_col(data = mean_dt_persb_wx, aes(x = day, y = Net_LW_MJperd, fill = "net LW"), alpha = 0.7, position = position_dodge(width = 0.5)) +
  geom_line(data = p_b_dt_mean_treeLWout, aes(x = day, y = full_tree_LWout_MJperd, color = "tree LWout"), alpha = 0.8, linewidth = 0.8) +
  facet_wrap(~burn_status) +
  labs(
    title = "a) PSZ",
    x = NULL,
    y = "Total Net Rad (MJ/day) & Temp (°C)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Tree Sensor Data", 
                     values = c("tree LWout" = "black")) +
  scale_fill_manual(name = "Weather Station Data", 
                    values = c("net radiation" ="#666666", "net SW" ="#D95F02", "net LW" ="#2166AC")) +
  guides(color = guide_legend(title = NULL),  # Remove title for color legend
         fill = guide_legend(title = NULL), #Remove fill legend
         shape = guide_legend(title = NULL)) +
  scale_x_date(
    limits = c(as.Date("2024-02-02"), as.Date("2024-07-01")), 
    expand = c(0.02, 0.02)  # Remove extra space on the x-axis
  ) +# Remove title for shape legend
  #scale_y_continuous(
 #   limits = c(-15, 38),
  #  sec.axis = sec_axis(~./15, name = "Snow Depth (m)")  # Adjusting for the secondary axis
 # ) +
  theme_bw() + 
  theme(
    plot.title = element_text(size = 13),      # Title size
    axis.title.x = element_text(size = 11),                   # X-axis title size
    axis.title.y = element_text(size = 11),                   # Y-axis title size
    axis.text = element_text(size = 11),                      # Axis text size
    legend.text = element_text(size = 12),                    # Legend text size
    legend.title = element_text(size = 12),                   # Legend title size
    strip.text = element_text(size = 12)) + 
  #accumulation/ablation date destiction
  geom_vline(xintercept = as.numeric(as.Date('2024-05-06')), 
             linetype = "solid",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8) + 
  #snowfree date
  geom_vline(xintercept = as.numeric(as.Date('2024-06-05')), 
             linetype = "dashed",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8)

p_rad_plot
```

```{r}
#combined radiation and snow depth/tree temp data
comb_persb_rad_treewell_plot <- ggarrange(p_snowtreewell_NR_plot, p_rad_plot, ncol = 1, nrow = 2, common.legend = FALSE)

comb_persb_rad_treewell_plot
```

Plotting the same graph but with tree LWout instead of total net radiation

-   this doesn't show the pattern as well as the NR plots do, so I probably won't use this...
-   \*\* keep working on this... all my radiation bars are now negative? as of 2024-10-29

```{r}
p_snowtreewell_treeLWout_plot <- ggplot() + 
  # Column plot for Net Longwave Radiation of total plot area
  geom_line(data = p_b_dt_mean_treeLWout, aes(x = day, y = full_tree_LWout_MJperd, color = "tree LWout"), linewidth = 0.8) +
  #air temp line
  geom_line(data = mean_dt_persb_wx, aes(x = day, y = AirTC_Avg, color = "air temp"), linewidth = 0.8) +
  # Line plot for snow cam max depth on a secondary y-axis
  #transitional snow depths + tree wells
  geom_line(data = persb_snowcamera_data, aes(x = date, y = snowcam_max_depth_m*8, color = "daily max snow depth"), linewidth = 0.8) +
  geom_point(data = persb_treewell_dates, aes(x = day, y = snowcam_max_depth_m*8, 
             shape = "dates that treewells developed"), 
             color = "black", fill = "black", size = 1.5) +
  facet_wrap(~burn_status) +
  labs(
    title = "a) PSZ",
    x = NULL,
    y = "Radiation Component (MJ/day) & Air Temp (°C)"
  ) +
  # Customizing colors and shapes
  scale_color_manual(name = "Radiation Data", 
                     values = c("air temp" = "#D95F02", "daily max snow depth" = "#2166AC", "tree LWout" = "#666666")) +
  #scale_fill_manual(name = "Radiation Data", 
                    #values = c("tree LWout" = "#666666")) +
  scale_shape_manual(values = c("dates that treewells developed" = 21)) +
  guides(color = guide_legend(title = NULL),  # Remove title for color legend
        # fill = guide_legend(title = NULL), #Remove fill legend
         shape = guide_legend(title = NULL)) +
  scale_x_date(
    #limits = c(as.Date("2024-02-02"), as.Date("2024-05-23")), 
   # expand = c(0.02, 0.02)  # Remove extra space on the x-axis
  ) +# Remove title for shape legend
  scale_y_continuous(
    limits = c(-18, 18),
    sec.axis = sec_axis(~./4, name = "Snow Depth (m)")  # Adjusting for the secondary axis
  ) +
  theme_bw() + 
  theme(
    plot.title = element_text(size = 13),      # Title size
    axis.title.x = element_text(size = 11),                   # X-axis title size
    axis.title.y = element_text(size = 11),                   # Y-axis title size
    axis.text = element_text(size = 11),                      # Axis text size
    legend.text = element_text(size = 12),                    # Legend text size
    legend.title = element_text(size = 12),                   # Legend title size
    strip.text = element_text(size = 12))

p_rad_plot
```

Air Temp Compared to Tree Temp

\*\* Not using these, but just wanted to see what the correlations were

```{r}
# making a joined dataset with daily mean weather and tree temps

#pers_b
pers_b_dt_mean_alldata <- mean_dt_persb_wx %>%
  left_join(p_b_dt_avg_temp) %>%
  rename(mean_tree_temp = mean_temp)
#trans_b
trans_b_dt_mean_alldata <- mean_dt_transb_wx %>%
  left_join(t_b_dt_avg_temp) %>%
  rename(mean_tree_temp = mean_temp)

#combined_burned dataframe
```

```{r}
##tree/air temp
# getting R^2 for the following comparisons
persb_treeair_lm_fit <- lm(mean_tree_temp ~ AirTC_Avg, data = pers_b_dt_mean_alldata)

# Extract the R^2 value
persb_treeair_r_squared <- summary(persb_treeair_lm_fit)$r.squared
```

```{r}
##tree/air temp
# getting R^2 for the following comparisons
transb_treeair_lm_fit <- lm(mean_tree_temp ~ AirTC_Avg, data = trans_b_dt_mean_alldata)

# Extract the R^2 value
transb_treeair_r_squared <- summary(transb_treeair_lm_fit)$r.squared
```

```{r}
#plotting comparisons & correlations
persb_dt_mean_treeair_comp <- ggplot(data = pers_b_dt_mean_alldata) +
  geom_point(aes(x = AirTC_Avg, y = mean_tree_temp, color = zone)) + 
  geom_smooth(aes(x = AirTC_Avg, y = mean_tree_temp), method = 'lm', se = TRUE, color = "grey") + 
  scale_color_manual(values = c(
    "PSZ" = "#2166AC",
    "TSZ" = "#D95F02")) +
  theme(legend.position = "right") +
  labs(title = "Air Temp vs Tree Surface Temp", 
       x = "Air Temp (°C)", 
       y = "Tree Surface Temp (°C)") +
  theme_bw() +
  #adding r^2 value to plot
  annotate("text", x = Inf, y = Inf, label = paste("R² =", round(persb_treeair_r_squared , 3)), 
           hjust = 1.1, vjust = 2, size = 5, color = "black")

persb_dt_mean_treeair_comp
```

```{r}
transb_dt_mean_treeair_comp <- ggplot(data = trans_b_dt_mean_alldata) +
  geom_point(aes(x = AirTC_Avg, y = mean_tree_temp, color = zone)) + 
  geom_smooth(aes(x = AirTC_Avg, y = mean_tree_temp), method = 'lm', se = TRUE, color = "grey") + 
  scale_color_manual(values = c(
    "PSZ" = "#2166AC",
    "TSZ" = "#D95F02")) +
  theme(legend.position = "right") +
  labs(title = "Air Temp vs Tree Surface Temp", 
       x = "Air Temp (°C)", 
       y = "Tree Surface Temp (°C)") +
  theme_bw() +
  #adding r^2 value to plot
  annotate("text", x = Inf, y = Inf, label = paste("R² =", round(transb_treeair_r_squared , 3)), 
           hjust = 1.1, vjust = 2, size = 5, color = "black")

transb_dt_mean_treeair_comp
```

Comparing tree surface temp to NR_Avg

```{r}
##tree/air temp
# getting R^2 for the following comparisons
persb_treetempNR_lm_fit <- lm(mean_tree_temp ~ LWout_Avg, data = pers_b_dt_mean_alldata)

# Extract the R^2 value
persb_treetempNR_r_squared <- summary(persb_treetempNR_lm_fit)$r.squared
```

## MAD/MRD Calcs

Data Wrangling

```{r}
pers_b_diff_results <- filtered_pers_b_aspects_r %>%
  group_by(burn_status, aspect) %>%
  summarise(
    mean_avg_diff = mean(abs(diff(temp))), # Average absolute difference
    mean_rel_diff = mean(abs(diff(temp)) / mean(temp, na.rm = TRUE)) # Relative difference
  )

pers_ub_diff_results <- filtered_pers_ub_aspects_r %>%
  group_by(burn_status, aspect) %>%
  summarise(
    mean_avg_diff = mean(abs(diff(temp))), # Average absolute difference
    mean_rel_diff = mean(abs(diff(temp)) / mean(temp, na.rm = TRUE)) # Relative difference
  )
```

```{r}
trans_b_diff_results <- filtered_pers_b_aspects_r %>%
  group_by(burn_status, aspect) %>%
  summarise(
    mean_avg_diff = mean(abs(diff(temp))), # Average absolute difference
    mean_rel_diff = mean(abs(diff(temp)) / mean(temp, na.rm = TRUE)) # Relative difference
  )

trans_ub_diff_results <- filtered_pers_ub_aspects_r %>%
  group_by(burn_status, aspect) %>%
  summarise(
    mean_avg_diff = mean(abs(diff(temp))), # Average absolute difference
    mean_rel_diff = mean(abs(diff(temp)) / mean(temp, na.rm = TRUE)) # Relative difference
  )
```

Now doing stas as north vs south

```{r}
#creating a dataframe with individual tree temps by north and south aspect
persb_n_aspects <- filtered_pers_b_aspects_r %>%
  filter(aspect == "north") %>%
  pivot_wider(names_from = aspect, values_from = temp)

persb_s_aspects <- filtered_pers_b_aspects_r %>%
  filter(aspect == "south") %>%
  pivot_wider(names_from = aspect, values_from = temp)

persb_ns_aspects <- persb_n_aspects %>%
  inner_join(persb_s_aspects, by= c("datetime", "day", "month", "phase", "zone", "snow_phase", "burn_status", "tree_name")) %>%
  select(datetime, day, month, phase, zone, snow_phase, burn_status, tree_name, north, south) %>%
  rename(north_temp = "north", south_temp = "south")
```

```{r}
transb_n_aspects <- filtered_trans_b_aspects_r %>%
  filter(aspect == "north") %>%
  pivot_wider(names_from = aspect, values_from = temp)

transb_s_aspects <- filtered_trans_b_aspects_r %>%
  filter(aspect == "south") %>%
  pivot_wider(names_from = aspect, values_from = temp)

transb_ns_aspects <- transb_n_aspects %>%
  inner_join(transb_s_aspects, by= c("datetime", "day", "month", "phase", "zone", "snow_phase", "burn_status", "tree_name")) %>%
  select(datetime, day, month, phase, zone, snow_phase, burn_status, tree_name, north, south) %>%
  rename(north_temp = "north", south_temp = "south")
```

```{r}
persub_n_aspects <- filtered_pers_ub_aspects_r %>%
  filter(aspect == "north") %>%
  pivot_wider(names_from = aspect, values_from = temp)

persub_s_aspects <- filtered_pers_ub_aspects_r %>%
  filter(aspect == "south") %>%
  pivot_wider(names_from = aspect, values_from = temp)

persub_ns_aspects <- persub_n_aspects %>%
  inner_join(persub_s_aspects, by= c("datetime", "day", "month", "phase", "zone", "snow_phase", "burn_status", "tree_name")) %>%
  select(datetime, day, month, phase, zone, snow_phase, burn_status, tree_name, north, south) %>%
  rename(north_temp = "north", south_temp = "south")
```

```{r}
transub_n_aspects <- filtered_trans_ub_aspects_r %>%
  filter(aspect == "north") %>%
  pivot_wider(names_from = aspect, values_from = temp)

transub_s_aspects <- filtered_trans_ub_aspects_r %>%
  filter(aspect == "south") %>%
  pivot_wider(names_from = aspect, values_from = temp)

transub_ns_aspects <- transub_n_aspects %>%
  inner_join(transub_s_aspects, by= c("datetime", "day", "month", "phase", "zone", "snow_phase", "burn_status", "tree_name")) %>%
  select(datetime, day, month, phase, zone, snow_phase, burn_status, tree_name, north, south) %>%
  rename(north_temp = "north", south_temp = "south")
```

```{r}
pers_b_ns_diff_results <- persb_ns_aspects %>%
  group_by(burn_status) %>%
  #adding this in so that I can fix any issues with differenced data that is close to 0 for the MRD column - it's only removing one observation
  filter((north_temp + south_temp) != 0) %>%
  summarise(
    mean_avg_diff = mean(abs(north_temp - south_temp), na.rm = TRUE),
    mean_relative_diff = mean(abs(north_temp - south_temp) / ((north_temp + south_temp) / 2), na.rm = TRUE))

pers_ub_ns_diff_results <- persub_ns_aspects %>%
  group_by(burn_status) %>%
  summarise(
    mean_avg_diff = mean(abs(north_temp - south_temp), na.rm = TRUE),
    mean_relative_diff = mean(abs(north_temp - south_temp) / ((north_temp + south_temp) / 2), na.rm = TRUE))
```

```{r}
trans_b_ns_diff_results <- transb_ns_aspects %>%
  group_by(burn_status) %>%
  summarise(
    mean_avg_diff = mean(abs(north_temp - south_temp), na.rm = TRUE),
    mean_relative_diff = mean(abs(north_temp - south_temp) / ((north_temp + south_temp) / 2), na.rm = TRUE))

trans_ub_ns_diff_results <- transub_ns_aspects %>%
  group_by(burn_status) %>%
  #adding this in so that I can fix any issues with differenced data that is close to 0 for the MRD column - it's only removing two observations
  filter((north_temp + south_temp) != 0) %>%
  summarise(
    mean_avg_diff = mean(abs(north_temp - south_temp), na.rm = TRUE),
    mean_relative_diff = mean(abs(north_temp - south_temp) / ((north_temp + south_temp) / 2), na.rm = TRUE))
```

Now doing stas as gb vs db vs live

```{r}
pers_gb_aspects <- filtered_pers_b_aspects_r %>%
  filter(burn_status == "green burn") %>%
  pivot_wider(names_from = burn_status, values_from = temp) %>%
  rename(gb_temp = "green burn") %>%
  select("datetime", "day", "month", "phase", "zone", "snow_phase", "aspect", "tree_name", "gb_temp")

pers_db_aspects <- filtered_pers_b_aspects_r %>%
  filter(burn_status == "dead burn") %>%
  pivot_wider(names_from = burn_status, values_from = temp) %>%
  rename(db_temp = "dead burn") %>%
  select("datetime", "day", "month", "phase", "zone", "snow_phase", "aspect", "tree_name", "db_temp")

pers_ub_aspects <- filtered_pers_ub_aspects_r %>%
  filter(burn_status == "live") %>%
  pivot_wider(names_from = burn_status, values_from = temp) %>%
  rename(ub_temp = "live") %>%
  select("datetime", "day", "month", "phase", "zone", "snow_phase", "aspect", "tree_name", "ub_temp")

pers_gbdbub_aspects <- pers_gb_aspects %>%
  inner_join(pers_db_aspects,  by = c("datetime", "day", "month", "phase", "zone", "snow_phase", "aspect")) %>%
  inner_join(pers_ub_aspects, by = c("datetime", "day", "month", "phase", "zone", "snow_phase", "aspect"))
```

```{r}
#gb vs db
pers_gb_db_diff_results <- pers_gbdbub_aspects %>%
  group_by(aspect) %>%
  filter((gb_temp + db_temp) != 0) %>%
  summarise(
    mean_avg_diff = mean(abs(gb_temp - db_temp), na.rm = TRUE),
    mean_relative_diff = mean(abs(gb_temp - db_temp) / ((gb_temp + db_temp) / 2), na.rm = TRUE)
  )

# gb vs live
pers_gb_live_diff_results <- pers_gbdbub_aspects %>%
  group_by(aspect) %>%
  filter((gb_temp + ub_temp) != 0) %>%
  summarise(
    mean_avg_diff = mean(abs(gb_temp - ub_temp), na.rm = TRUE),
    mean_relative_diff = mean(abs(gb_temp - ub_temp) / ((gb_temp + ub_temp) / 2), na.rm = TRUE)
  )

# db vs live
pers_db_live_diff_results <- pers_gbdbub_aspects %>%
  group_by(aspect) %>%
  filter((db_temp + ub_temp) != 0) %>%
  summarise(
    mean_avg_diff = mean(abs(db_temp - ub_temp), na.rm = TRUE),
    mean_relative_diff = mean(abs(db_temp - ub_temp) / ((db_temp + ub_temp) / 2), na.rm = TRUE)
  )
```

```{r}
trans_gb_aspects <- filtered_trans_b_aspects_r %>%
  filter(burn_status == "green burn") %>%
  filter(aspect %in% c("north", "south")) %>%
  pivot_wider(names_from = burn_status, values_from = temp) %>%
  rename(gb_temp = "green burn") %>%
  select("datetime", "day", "month", "phase", "zone", "snow_phase", "aspect", "tree_name", "gb_temp")

trans_db_aspects <- filtered_trans_b_aspects_r %>%
  filter(burn_status == "dead burn") %>%
  pivot_wider(names_from = burn_status, values_from = temp) %>%
  rename(db_temp = "dead burn") %>%
  select("datetime", "day", "month", "phase", "zone", "snow_phase", "aspect", "tree_name", "db_temp")

trans_ub_aspects <- filtered_trans_ub_aspects_r %>%
  filter(burn_status == "live") %>%
  pivot_wider(names_from = burn_status, values_from = temp) %>%
  rename(ub_temp = "live") %>%
  select("datetime", "day", "month", "phase", "zone", "snow_phase", "aspect", "tree_name", "ub_temp")

trans_gbdbub_aspects <- trans_gb_aspects %>%
  inner_join(trans_db_aspects,  by = c("datetime", "day", "month", "phase", "zone", "snow_phase", "aspect")) %>%
  inner_join(trans_ub_aspects, by = c("datetime", "day", "month", "phase", "zone", "snow_phase", "aspect"))
```

```{r}
#gb vs db
trans_gb_db_diff_results <- trans_gbdbub_aspects %>%
  group_by(aspect) %>%
  filter((gb_temp + db_temp) != 0) %>%
  summarise(
    mean_avg_diff = mean(abs(gb_temp - db_temp), na.rm = TRUE),
    mean_relative_diff = mean(abs(gb_temp - db_temp) / ((gb_temp + db_temp) / 2), na.rm = TRUE)
  )

# gb vs live
trans_gb_live_diff_results <- trans_gbdbub_aspects %>%
  group_by(aspect) %>%
  filter((gb_temp + ub_temp) != 0) %>%
  summarise(
    mean_avg_diff = mean(abs(gb_temp - ub_temp), na.rm = TRUE),
    mean_relative_diff = mean(abs(gb_temp - ub_temp) / ((gb_temp + ub_temp) / 2), na.rm = TRUE)
  )

# db vs live
trans_db_live_diff_results <- trans_gbdbub_aspects %>%
  group_by(aspect) %>%
  filter((db_temp + ub_temp) != 0) %>%
  summarise(
    mean_avg_diff = mean(abs(db_temp - ub_temp), na.rm = TRUE),
    mean_relative_diff = mean(abs(db_temp - ub_temp) / ((db_temp + ub_temp) / 2), na.rm = TRUE)
  )
```

Day vs Night Temperatures

Day only and night only stats

```{r}
pers_b_dtnt_diff_results <- filtered_pers_b_aspects_r %>%
  group_by(burn_status, phase) %>%
  summarise(
    mean_avg_diff = mean(abs(diff(temp))), # Average absolute difference
    mean_rel_diff = mean(abs(diff(temp)) / mean(temp, na.rm = TRUE)) # Relative difference
  )

pers_ub_dtnt_diff_results <- filtered_pers_ub_aspects_r %>%
  group_by(burn_status, phase) %>%
  summarise(
    mean_avg_diff = mean(abs(diff(temp))), # Average absolute difference
    mean_rel_diff = mean(abs(diff(temp)) / mean(temp, na.rm = TRUE)) # Relative difference
  )
```

```{r}
trans_b_dtnt_diff_results <- filtered_trans_b_aspects_r %>%
  group_by(burn_status, phase) %>%
  summarise(
    mean_avg_diff = mean(abs(diff(temp))), # Average absolute difference
    mean_rel_diff = mean(abs(diff(temp)) / mean(temp, na.rm = TRUE)) # Relative difference
  )

trans_ub_dtnt_diff_results <- filtered_trans_ub_aspects_r %>%
  group_by(burn_status, phase) %>%
  summarise(
    mean_avg_diff = mean(abs(diff(temp))), # Average absolute difference
    mean_rel_diff = mean(abs(diff(temp)) / mean(temp, na.rm = TRUE)) # Relative difference
  )
```

Day vs Night stats

```{r}
#creating a dataframe with individual columns for day and night temps by date
persb_daytemp <- filtered_pers_b_aspects_r %>%
  filter(phase == "day") %>%
  rename(daydate = "day") %>%
  pivot_wider(names_from = phase, values_from = temp) %>%
  rename(daytemp = day)

persb_nighttemp <- filtered_pers_b_aspects_r %>%
  filter(phase == "night") %>%
  rename(daydate = "day") %>%
  pivot_wider(names_from = phase, values_from = temp) %>%
  rename(nighttemp = night)

persb_dtnt_aspects <- persb_daytemp %>%
  inner_join(persb_nighttemp, by= c("daydate", "month", "aspect", "zone", "snow_phase", "burn_status", "tree_name")) %>%
  select(daydate, month, aspect, zone, snow_phase, burn_status, tree_name, daytemp, nighttemp)
```

```{r}
persub_daytemp <- filtered_pers_ub_aspects_r %>%
  filter(phase == "day") %>%
  rename(daydate = "day") %>%
  pivot_wider(names_from = phase, values_from = temp) %>%
  rename(daytemp = day)

persub_nighttemp <- filtered_pers_ub_aspects_r %>%
  filter(phase == "night") %>%
  rename(daydate = "day") %>%
  pivot_wider(names_from = phase, values_from = temp) %>%
  rename(nighttemp = night)

persub_dtnt_aspects <- persub_daytemp %>%
  inner_join(persub_nighttemp, by= c("daydate", "month", "aspect", "zone", "snow_phase", "burn_status", "tree_name")) %>%
  select(daydate, month, aspect, zone, snow_phase, burn_status, tree_name, daytemp, nighttemp)
```

```{r}
pers_b_dtnt_comb_diff_results <- persb_dtnt_aspects %>%
  group_by(burn_status) %>%
  #adding this in so that I can fix any issues with differenced data that is close to 0 for the MRD column - it's only removing one observation
  filter((daytemp + nighttemp) != 0) %>%
  summarise(
    mean_avg_diff = mean(abs(daytemp - nighttemp), na.rm = TRUE),
    mean_relative_diff = mean(abs(daytemp - nighttemp) / ((daytemp + nighttemp) / 2), na.rm = TRUE))

pers_ub_dtnt_comb_diff_results <- persub_dtnt_aspects %>%
  group_by(burn_status) %>%
  #adding this in so that I can fix any issues with differenced data that is close to 0 for the MRD column - it's only removing one observation
  filter((daytemp + nighttemp) != 0) %>%
  summarise(
    mean_avg_diff = mean(abs(daytemp - nighttemp), na.rm = TRUE),
    mean_relative_diff = mean(abs(daytemp - nighttemp) / ((daytemp + nighttemp) / 2), na.rm = TRUE))
```

```{r}
transb_daytemp <- filtered_trans_b_aspects_r %>%
  filter(phase == "day") %>%
  rename(daydate = "day") %>%
  pivot_wider(names_from = phase, values_from = temp) %>%
  rename(daytemp = day)

transb_nighttemp <- filtered_trans_b_aspects_r %>%
  filter(phase == "night") %>%
  rename(daydate = "day") %>%
  pivot_wider(names_from = phase, values_from = temp) %>%
  rename(nighttemp = night)

transb_dtnt_aspects <- transb_daytemp %>%
  inner_join(transb_nighttemp, by= c("daydate", "month", "aspect", "zone", "snow_phase", "burn_status", "tree_name")) %>%
  select(daydate, month, aspect, zone, snow_phase, burn_status, tree_name, daytemp, nighttemp)
```

```{r}
transub_daytemp <- filtered_trans_ub_aspects_r %>%
  filter(phase == "day") %>%
  rename(daydate = "day") %>%
  pivot_wider(names_from = phase, values_from = temp) %>%
  rename(daytemp = day)

transub_nighttemp <- filtered_trans_ub_aspects_r %>%
  filter(phase == "night") %>%
  rename(daydate = "day") %>%
  pivot_wider(names_from = phase, values_from = temp) %>%
  rename(nighttemp = night)

transub_dtnt_aspects <- transub_daytemp %>%
  inner_join(transub_nighttemp, by= c("daydate", "month", "aspect", "zone", "snow_phase", "burn_status", "tree_name")) %>%
  select(daydate, month, aspect, zone, snow_phase, burn_status, tree_name, daytemp, nighttemp)
```

```{r}
trans_b_dtnt_comb_diff_results <- transb_dtnt_aspects %>%
  group_by(burn_status) %>%
  #adding this in so that I can fix any issues with differenced data that is close to 0 for the MRD column - it's only removing one observation
  filter((daytemp + nighttemp) != 0) %>%
  summarise(
    mean_avg_diff = mean(abs(daytemp - nighttemp), na.rm = TRUE),
    mean_relative_diff = mean(abs(daytemp - nighttemp) / ((daytemp + nighttemp) / 2), na.rm = TRUE))

trans_ub_dtnt_comb_diff_results <- transub_dtnt_aspects %>%
  group_by(burn_status) %>%
  #adding this in so that I can fix any issues with differenced data that is close to 0 for the MRD column - it's only removing one observation
  filter((daytemp + nighttemp) != 0) %>%
  summarise(
    mean_avg_diff = mean(abs(daytemp - nighttemp), na.rm = TRUE),
    mean_relative_diff = mean(abs(daytemp - nighttemp) / ((daytemp + nighttemp) / 2), na.rm = TRUE))
```

## Snow Depth Plots

Data Wrangling

```{r}
#creating unburned daily max snow depth dataframes from weather data because the camera data isn't great
trans_ub_daily_snowdepth_data_V1 <- filtered_transub_wx_15min %>%
  group_by(day, phase, zone, burn_status) %>%
  summarize(max_snowdepth_m = max(SnowDepth_m), mean_airtemp = mean(AirTC_Avg))

#this is the mean of day and night, to give proper mean daytime temps and maximum day and night snow depths! Use V2 for plotting
trans_ub_daily_snowdepth_data_V2 <- trans_ub_daily_snowdepth_data_V1 %>%
  group_by(day, zone, burn_status) %>%
  summarize(max_snowdepth_m = max(max_snowdepth_m), mean_airtemp = max(mean_airtemp))
```

```{r}
pers_ub_daily_snowdepth_data_V1 <- filtered_persub_wx_hourly %>%
  group_by(day, phase, zone, burn_status) %>%
  summarize(max_snowdepth_m = max(SnowDepth_m), mean_airtemp = mean(AirTC_Avg))

#this is the mean of day and night, to give proper mean daytime temps and maximum day and night snow depths! Use V2 for plotting
pers_ub_daily_snowdepth_data_V2 <- pers_ub_daily_snowdepth_data_V1 %>%
  group_by(day, zone, burn_status) %>%
  summarize(max_snowdepth_m = max(max_snowdepth_m), mean_airtemp = max(mean_airtemp))
```

```{r}
persb_wx_data <- filtered_persb_wx_hourly %>%
  group_by(day, phase, zone, burn_status) %>%
  summarize(mean_airtemp = mean(AirTC_Avg))

#use V2 version
persb_wx_data_V2 <- persb_wx_data %>%
  group_by(day, zone, burn_status) %>%
  summarize(mean_airtemp = max(mean_airtemp))
```

```{r}
transb_wx_data <- filtered_transb_wx_15min %>%
  group_by(day, phase, zone, burn_status) %>%
  summarize(mean_airtemp = mean(AirTC_Avg))

#use V2 version
transb_wx_data_V2 <- transb_wx_data %>%
  group_by(day, zone, burn_status) %>%
  summarize(mean_airtemp = max(mean_airtemp)) 
```

```{r}
#selecting correct columns for join
persb_snowcamera_data_V2 <- persb_snowcamera_data %>%
  select(day, zone, burn_status, snowcam_max_depth_m, treewell_developed) %>%
  rename(max_snowdepth_m = snowcam_max_depth_m) %>%
  left_join(persb_wx_data_V2, by = c("day", "zone", "burn_status"))

transb_snowcamera_data_V2 <- transb_snowcamera_data %>%
  select(day, zone, burn_status, snowcam_max_depth_m, treewell_developed) %>%
  rename(max_snowdepth_m = snowcam_max_depth_m)  %>%
  left_join(transb_wx_data_V2, by = c("day", "zone", "burn_status"))
```

```{r}
persb_treewell_dates <- persb_snowcamera_data_V2 %>%
  filter(treewell_developed == "yes")

transb_treewell_dates <- transb_snowcamera_data_V2 %>%
  filter(treewell_developed == "yes")
```

Plotting

\*\* need to add treewell development date points to burned dataframe below!

```{r}
scaling_factor <- 0.08
```

```{r}
PSZ_b_snowdepths_lineplot <- ggplot() + 
  # Burned snow depth
  geom_line(data = persb_snowcamera_data_V2, aes(x = day, y = max_snowdepth_m, color = "Max Daily Snow Depth"), 
            linetype = "solid", linewidth = 0.9) +
  # Burned wx station air temp
  geom_line(data = persb_snowcamera_data_V2, aes(x = day, y = mean_airtemp * scaling_factor, color = "Mean Daily Air Temp"), 
            linetype = "solid", linewidth = 0.7) + 
  #treewell dates
  geom_point(data = persb_treewell_dates, aes(x = day, y = max_snowdepth_m, shape = "Dates that treewells developed"), 
             color = "black", fill = "black", size = 1.5) +
  labs(
    title = "a) PSZ",
    x = NULL,
    y = "Snow Depth (m)",
    color = "Legend Title"  # Title of the legend
  ) +
  scale_y_continuous(
    name = "Snow Depth (m)",
    limits = c(-1, 2.4),
    sec.axis = sec_axis(~ . / scaling_factor, name = "Temperature (°C)")  # Secondary y-axis
  ) +
  scale_shape_manual(
    name = NULL,
    values = c("Dates that treewells developed" = 16)) + 
  scale_color_manual(
  name = NULL,
  values = c(
    "Max Daily Snow Depth" = alpha("#2166AC", 0.7),  # Assign blue to snow depth
    "Mean Daily Air Temp" = "#D95F02"               # Assign orange to air temp
  ),
  labels = c("Max Daily Snow Depth", "Mean Daily Air Temp")
) + 
  facet_wrap(~burn_status, nrow = 2, strip.position = "right") +  # Move labels to the left
  theme_bw() +
 #snowfree date
  geom_vline(xintercept = as.numeric(as.Date('2024-06-05')), 
             linetype = "dashed",                # Dashed line
             color = "grey23",                      # Line color
             size = 0.4, alpha = 0.8)

PSZ_b_snowdepths_lineplot
```

```{r}
PSZ_ub_snowdepths_lineplot <- ggplot(data = pers_ub_daily_snowdepth_data_V2) + 
  # Burned snow depth
  geom_line(aes(x = day, y = max_snowdepth_m, color = "Max Daily Snow Depth"), 
            linetype = "solid", linewidth = 0.9) +
  # Burned wx station air temp
  geom_line(aes(x = day, y = mean_airtemp * scaling_factor, color = "Mean Daily Air Temp"), 
            linetype = "solid", linewidth = 0.7) + 
  labs(x = "Date",
    y = "Snow Depth (m)",
    color = "Legend Title"  # Title of the legend
  ) +
  scale_y_continuous(
    name = "Snow Depth (m)",
    limits = c(-1, 2.4),
    sec.axis = sec_axis(~ . / scaling_factor, name = "Temperature (°C)")  # Secondary y-axis
  ) + 
  scale_color_manual(
  name = NULL,
  values = c(
    "Max Daily Snow Depth" = alpha("#2166AC", 0.7),  # Assign blue to snow depth
    "Mean Daily Air Temp" = "#D95F02"               # Assign orange to air temp
  ),
  labels = c("Max Daily Snow Depth", "Mean Daily Air Temp")
) + 
  facet_wrap(~burn_status, nrow = 2, strip.position = "right") + 
  # Move labels to the left
  theme_bw()

PSZ_ub_snowdepths_lineplot
```

```{r}
PSZ_comb_snowdepth_lineplot <- ggarrange(PSZ_b_snowdepths_lineplot, PSZ_ub_snowdepths_lineplot, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")

PSZ_comb_snowdepth_lineplot
```

```{r}
TSZ_b_snowdepths_lineplot <- ggplot() + 
  # Burned snow depth
  geom_line(data = transb_snowcamera_data_V2, aes(x = day, y = max_snowdepth_m, color = "Max Daily Snow Depth"), 
            linetype = "solid", linewidth = 0.9) +
  # Burned wx station air temp
  geom_line(data = transb_snowcamera_data_V2, aes(x = day, y = mean_airtemp * scaling_factor, color = "Mean Daily Air Temp"), 
            linetype = "solid", linewidth = 0.7) + 
  geom_point(data = transb_treewell_dates, aes(x = day, y = max_snowdepth_m, shape = "Dates that treewells developed"), 
             color = "black", fill = "black", size = 1.5) +
  labs(
    title = "b) TSZ",
    x = NULL,
    y = "Snow Depth (m)",
    color = "Legend Title"  # Title of the legend
  ) +
  scale_shape_manual(
    name = NULL,
    values = c("Dates that treewells developed" = 16)) + 
  scale_y_continuous(
    name = "Snow Depth (m)",
    limits = c(-1, 2.4),
    sec.axis = sec_axis(~ . / scaling_factor, name = "Temperature (°C)")  # Secondary y-axis
  ) +
  scale_color_manual(
  name = NULL,
  values = c(
    "Max Daily Snow Depth" = alpha("#2166AC", 0.7),  # Assign blue to snow depth
    "Mean Daily Air Temp" = "#D95F02"               # Assign orange to air temp
  ),
  labels = c("Max Daily Snow Depth", "Mean Daily Air Temp")
) +
  facet_wrap(~burn_status, nrow = 2, strip.position = "right") +  # Move labels to the left
  theme_bw()

TSZ_b_snowdepths_lineplot
```

```{r}
TSZ_ub_snowdepths_lineplot <- ggplot(data = trans_ub_daily_snowdepth_data_V2) + 
  # Burned snow depth
  geom_line(aes(x = day, y = max_snowdepth_m, color = "Max Daily Snow Depth"), 
            linetype = "solid", linewidth = 0.9) +
  # Burned wx station air temp
  geom_line(aes(x = day, y = mean_airtemp * scaling_factor, color = "Mean Daily Air Temp"), 
            linetype = "solid", linewidth = 0.7) + 
  labs(x = "Date",
    y = "Snow Depth (m)",
    color = "Legend Title"  # Title of the legend
  ) +
  scale_y_continuous(
    name = "Snow Depth (m)",
    limits = c(-1, 2.4),
    sec.axis = sec_axis(~ . / scaling_factor, name = "Temperature (°C)")  # Secondary y-axis
  ) +
  scale_color_manual(
  name = NULL,
  values = c(
    "Max Daily Snow Depth" = alpha("#2166AC", 0.7),  # Assign blue to snow depth
    "Mean Daily Air Temp" = "#D95F02"               # Assign orange to air temp
  ),
  labels = c("Max Daily Snow Depth", "Mean Daily Air Temp")
) +
  facet_wrap(~burn_status, nrow = 2, strip.position = "right") + 
  # Move labels to the left
  theme_bw()

TSZ_ub_snowdepths_lineplot
```

```{r}
TSZ_comb_snowdepth_lineplot <- ggarrange(TSZ_b_snowdepths_lineplot, TSZ_ub_snowdepths_lineplot, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")

TSZ_comb_snowdepth_lineplot
```

```{r}
#final combined plot
final_comb_snowdepth_lineplot <- ggarrange(PSZ_comb_snowdepth_lineplot, TSZ_comb_snowdepth_lineplot, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")

final_comb_snowdepth_lineplot
```
