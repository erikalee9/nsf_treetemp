---
title: "treetemp_RLout"
output: html_document
date: "2024-10-21"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#initial set up
library(tidyverse)
library(lterdatasampler)
library(dplyr)
library(ggplot2)
library(readr)
library(readxl)
library(lubridate)
library(plotly)
library(openxlsx)
library(plotly)
library(rstatix)
library(htmlwidgets)
library(RColorBrewer)
library(patchwork)
#packages for exporting csvs as tables
library(knitr)
library(kableExtra)
library(pagedown)
library(ggpubr)
library(ggpattern)

setwd("/Volumes/wcnr-network/Research/Kampf/Private/field_data")
```

# Loading Full Datasets

```{r}
#new full dataframes to load - including burned and unburned/ all burn_status types together
full_15min_ns <- read_csv("nsf/treetemp_data/full_15min_ns.csv") %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = force_tz(datetime, tz = 'MST')) %>%
  select(-1)

full_hourly_ns <- read_csv("nsf/treetemp_data/full_hourly_ns.csv") %>%
   mutate(datetime_hour = as.POSIXct(datetime_hour, format=("%Y-%m-%d %H:%M:%S")),
                               datetime_hour = force_tz(datetime_hour, tz = 'MST'))  %>%
  select(-1)

full_15min_gbdbub <- read_csv("nsf/treetemp_data/full_15min_gbdbub.csv") %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = force_tz(datetime, tz = 'MST'))  %>%
  select(-1)

full_hourly_gbdbub <- read_csv("nsf/treetemp_data/full_hourly_gbdbub.csv") %>%
  mutate(datetime_hour = as.POSIXct(datetime_hour, format=("%Y-%m-%d %H:%M:%S")),
                               datetime_hour = force_tz(datetime_hour, tz = 'MST'))  %>%
  select(-1)

full_hourly_gb <- read_csv("nsf/treetemp_data/full_hourly_gb.csv") %>%
  mutate(datetime_hour = as.POSIXct(datetime_hour, format=("%Y-%m-%d %H:%M:%S")),
                               datetime_hour = force_tz(datetime_hour, tz = 'MST'))  %>%
  select(-1)
```

Snow Camera Depth Data

```{r}
transb_snowcamera_data <- read_csv("nsf/camera_snowdepths/2024_105E_transb_snowdepths.csv") %>%
  rename(snowcam_max_depth_cm = "maximum_depth(cm)") %>%
  mutate(date = as.Date(date)) %>%
  #adjusting the treewell developed column to just yes/no
  mutate(treewell_developed = case_when(
    treewell_developed == "maybe" ~ "yes",
    treewell_developed == "no snow" ~ "no",
    TRUE ~ treewell_developed  # keep other values unchanged
  )) %>%
  mutate(snowcam_max_depth_m = snowcam_max_depth_cm/100) %>%
  #filtering to timerange for these plots
  filter(date >= as.Date("2024-02-02") & date <= as.Date("2024-05-23")) %>%
  mutate(zone = "TSZ")

persb_snowcamera_data <- read_csv("nsf/camera_snowdepths/2024_persb_lp_highmort_east_snowdepths.csv") %>%
  rename(snowcam_max_depth_cm = "max_depth_cm") %>%
  mutate(date = as.Date(date)) %>%
  rename(treewell_developed = treewell_developement) %>%
  mutate(treewell_developed = case_when(
    treewell_developed == "maybe" ~ "yes",
    treewell_developed == "no snow" ~ "no",
    TRUE ~ treewell_developed  # keep other values unchanged
  )) %>%
  mutate(snowcam_max_depth_m = snowcam_max_depth_cm/100) %>%
  #filtering to timerange for these plots
  filter(date >= as.Date("2024-02-02") & date <= as.Date("2024-05-23")) %>%
  mutate(zone = "PSZ")

persub_snowcamera_data_r <- read_csv("nsf/pers_unburned/pers_unburned_wx_15min_r.csv")

#editing the pers_ub_snowcamera_data 
persub_snowcamera_data <- persub_snowcamera_data_r %>%
  mutate(datetime_MST = as.POSIXct(datetime, tz = "MST")) %>%
  select(datetime_MST, AirTC_Avg, SnowDepth_m) %>%
  rename(datetime = datetime_MST, snowcam_max_depth_m = SnowDepth_m) %>%
  mutate(date = as.Date(datetime), zone = "PSZ") %>%
  filter(datetime >= as.Date("2024-02-02 00:15:00") & datetime <= as.Date("2024-05-23 00:00:00"))

transub_snowcamera_data <- read_csv("nsf/camera_snowdepths/2024_105E_transub_snowdepths.csv") %>%
  mutate(snowcam_max_depth_m = max_depth_cm/100) %>%
  #filtering to timerange for these plots
  filter(date >= as.Date("2024-02-02") & date <= as.Date("2024-05-23")) %>%
  mutate(zone = "TSZ")
```

```{r}
#datasets for only snowcamera depths, to join with below datasets
filtered_transb_snowcamdepths <- transb_snowcamera_data %>%
  select(date, snowcam_max_depth_m) %>%
  mutate(zone = "TSZ") %>%
  expand_grid(burn_status = c("green burn", "dead burn"))

filtered_persb_snowcamdepths <- persb_snowcamera_data %>%
  select(date, snowcam_max_depth_m) %>%
  mutate(zone = "PSZ") %>%
  expand_grid(burn_status = c("green burn", "dead burn"))

filtered_transub_snowcamdepths <- transub_snowcamera_data %>%
  select(date, snowcam_max_depth_m) %>%
  mutate(zone = "TSZ", burn_status = "live")

filtered_persub_snowcamdepths <- persub_snowcamera_data %>%
  #because I am pulling this data from the weather station, I have to calculate an average daily value for snow depth
  group_by(date) %>%
  summarize(snowcam_max_depth_m = mean(snowcam_max_depth_m)) %>%
  select(date, snowcam_max_depth_m) %>%
  mutate(zone = "PSZ", burn_status = "live")
```

```{r}
#making a combined snowcamera depths dataframe
full_snowcamdepths <- rbind(filtered_persb_snowcamdepths, filtered_transb_snowcamdepths, filtered_persub_snowcamdepths, filtered_transub_snowcamdepths) %>%
  rename(day = "date") %>%
  #making it so that there is never a zero in the snowdepth column, to see if this fixes my issues with NAs
  mutate(snowcam_max_depth_m = if_else(snowcam_max_depth_m == 0, 0.001, snowcam_max_depth_m))
```

Full Aspect Datasets, with all trees

```{r}
filtered_pers_b_aspects_r <- read_csv("nsf/treetemp_data/filtered_pers_b_aspects_r.csv") %>%
  select(-sensor_id) %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = force_tz(datetime, tz = 'MST')) %>%
  filter(datetime >= "2024-02-02 00:15:00") %>%
  select(-1)
  

filtered_pers_ub_aspects_r <- read_csv("nsf/treetemp_data/filtered_pers_ub_aspects_r.csv") %>%
  select(-sensor_id) %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = force_tz(datetime, tz = 'MST')) %>%
  filter(datetime >= "2024-02-02 00:15:00") %>%
  select(-1)

filtered_trans_b_aspects_r <- read_csv("nsf/treetemp_data/filtered_trans_b_aspects_r.csv") %>%
  select(-sensor_id) %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = force_tz(datetime, tz = 'MST')) %>%
  filter(datetime >= "2024-02-02 00:15:00") %>%
  select(-1)

filtered_trans_ub_aspects_r <- read_csv("nsf/treetemp_data/filtered_trans_ub_aspects_r.csv") %>%
  select(-sensor_id) %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = force_tz(datetime, tz = 'MST')) %>%
  filter(datetime >= "2024-02-02 00:15:00") %>%
  select(-1)
```

\*\* this next step is not really working... need to keep working on this

```{r}
#adding in snow depth to 15-minute datetime columns of above dataset
filtered_pers_b_aspects_r <- filtered_pers_b_aspects_r %>%
  full_join(filtered_persb_snowcamdepths, by = c("day" = "date"))
            
filtered_pers_ub_aspects_r <- filtered_pers_ub_aspects_r %>%
  full_join(filtered_persub_snowcamdepths, by = c("datetime" = "datetime"))

filtered_trans_b_aspects_r <- filtered_trans_b_aspects_r %>%
  full_join(filtered_transb_snowcamdepths, by = c("day" = "date"))

filtered_trans_ub_aspects_r <- filtered_trans_ub_aspects_r %>%
  full_join(filtered_transub_snowcamdepths, by = c("day" = "date"))
```

```{r}
#creating a combined dataset for these? 
filtered_all_aspects <- filtered_pers_b_aspects_r %>%
  full_join(filtered_pers_ub_aspects_r) %>%
  full_join(filtered_trans_b_aspects_r) %>%
  full_join(filtered_trans_ub_aspects_r)

#crearing a north/south only so that I can join the snow depths with other data for scenarios
filtered_ns_aspects <- filtered_all_aspects %>%
  filter(aspect %in% c("north", "south"))
```

# LWout Calculations

\*\* when applying the actual snow depths to these equations, it makes the m2 value be zero if there is no snow, which is not technically accurate. what to do about this?

## Setting Constants

```{r}
#pulling in dataframe that has tree circumference data by site
treecirc_data <- read_csv("nsf/treetemp_data/105E_treecirc_data.csv")
```

Constants

```{r}
# Constants
stefan_boltzmann_constant <- 5.67e-8
emissivity <- 0.97
#snowdepth and circumference are in meters
snowdepth <- 1
# circumference is taken from diameter at breast height 
p_db_circ <- 0.5576
p_gb_circ <- 0.4006
p_live_circ <- 0.5027
t_db_circ <- 0.5655
t_gb_circ <- 0.5812
t_live_circ <- 0.5341

#picking an average unit depth for snow depth of 1 meter
#constant for m2 - can adjust this if I want to change the snowdepth!
p_gb_m2 = snowdepth*p_gb_circ
p_db_m2 = snowdepth*p_db_circ
p_live_m2 = snowdepth*p_live_circ
t_gb_m2 = snowdepth*t_gb_circ
t_db_m2 = snowdepth*t_db_circ
t_live_m2 = snowdepth*t_live_circ
```

## LWout Calcs

Full Aspect Calculations

```{r}
#removing gb_w tree from persistent zone, and removing charred/uncharred temps, as this will just be N/S comparisons
filtered_all_ns_LWout <- filtered_all_aspects %>%
  #filtering out gb_w tree data
  filter(tree_name != "gb_w") %>%
  #filtering out charred/uncharred aspect
  filter(!aspect %in% c("charred", "uncharred")) %>%
  #adding in a Kelvin temp column
  rename(temp_C = temp) %>%
  mutate(temp_K = (temp_C + 273.15)) %>%
  #calculating LWout in Wperm^2 by burn_status
  mutate(LWout_wperm2 = emissivity * stefan_boltzmann_constant * (temp_K^4)) %>%
  # Define m2 based on zone
 mutate(tree_circ = case_when(
  zone == "PSZ" & burn_status == "green burn" ~ 0.4006,
  zone == "PSZ" & burn_status == "dead burn" ~ 0.5576,
  zone == "PSZ" & burn_status == "live" ~ 0.5027,
  zone == "TSZ" & burn_status == "green burn" ~ 0.5812,
  zone == "TSZ" & burn_status == "dead burn" ~ 0.5655,
  zone == "TSZ" & burn_status == "live" ~ 0.5341,
  TRUE ~ 0.5576
)) %>%
  #calcuating Watz (power) - dividing by 2 here so that the only half the value is applied to the north/south aspects!
  mutate(
    Watz = LWout_wperm2 * ((tree_circ*snowcam_max_depth_m)/2),
#converting from Wperm2 to MJ/day
    LWout_MJperd = Watz * 86400 / 1e6) %>%
  select(datetime, day, month, phase, zone, burn_status, aspect, tree_name, temp_C, temp_K, LWout_wperm2, tree_circ, snowcam_max_depth_m, Watz, LWout_MJperd, everything())
```

Full_15min_NS

```{r}
#full_15min_ns
##converting temps in OG dataset to K from C
full_15min_ns_K <- full_15min_ns %>%
  mutate(north_temp_k = (north_temp + 273.15), south_temp_k = (south_temp + 273.15), ns_avg_temp_k = (ns_avg_temp + 273.15)) %>%
  mutate(zone = case_when(
    zone == "persistent" ~ "PSZ",
    zone == "transitional" ~ "TSZ",
    TRUE ~ zone  # Retain original value if no match
  )) %>%
  left_join(full_snowcamdepths, by = c("day", "zone", "burn_status"))
```

```{r}
#LWout calcs
full_15min_ns_LWout <- full_15min_ns_K %>%
  mutate(
    # Calculate longwave radiation in Wperm^2
    n_LWout_wperm2 = emissivity * stefan_boltzmann_constant * (north_temp_k^4), s_LWout_wperm2 = emissivity * stefan_boltzmann_constant * (south_temp_k^4)
  ) %>%
  #setting a case_when to vary the circumference/snow depth measurement by tree burn status and zone
  mutate(tree_circ = case_when(
      burn_status == "green burn" & zone == "persistent" ~ 0.4006,   # Example value for burned in north zone
      burn_status == "dead burn" & zone == "persistent" ~ 0.5576,   # Example value for burned in south zone
      burn_status == "live" & zone == "persistent" ~ 0.5027,
      burn_status == "green burn" & zone == "transitional" ~ 0.5812,   # Example value for burned in north zone
      burn_status == "dead burn" & zone == "transitional" ~ 0.5655,   # Example value for burned in south zone
      burn_status == "live" & zone == "transitional" ~ 0.5341,
      TRUE ~ 0.4006  # Default value if neither of the conditions match
    ),
#calcuating Watz (power) - dividing tree circ/snowcam depths by 2 for the north/south aspect differences as we assume that the area is only 1/2 the tree by aspect
    n_W =  n_LWout_wperm2 * ((tree_circ*snowcam_max_depth_m)/2),
    s_W =  s_LWout_wperm2 * ((tree_circ*snowcam_max_depth_m)/2),
#converting from Wperm2 to MJ/day
    n_LWout_MJperd = n_W * 86400 / 1e6, 
s_LWout_MJperd = s_W * 86400 / 1e6) 
```

Full_Hourly_NS

```{r}
#full_15min_ns
full_hourly_ns_K <- full_hourly_ns %>%
  mutate(north_temp_k = (north_temp + 273.15), south_temp_k = (south_temp + 273.15), ns_avg_temp_k = (ns_avg_temp + 273.15)) %>%
  mutate(zone = case_when(
    zone == "persistent" ~ "PSZ",
    zone == "transitional" ~ "TSZ",
    TRUE ~ zone  # Retain original value if no match
  )) %>%
  left_join(full_snowcamdepths, by = c("day", "zone", "burn_status"))
```

```{r}
#LWout calcs
full_hourly_ns_LWout <- full_hourly_ns_K %>%
  mutate(
    # Calculate longwave radiation in Wperm^2
    n_LWout_wperm2 = emissivity * stefan_boltzmann_constant * (north_temp_k^4), s_LWout_wperm2 = emissivity * stefan_boltzmann_constant * (south_temp_k^4)
  ) %>%
  #setting a case_when to vary the circumference/snow depth measurement by tree burn status and zone
  mutate(tree_circ = case_when(
      burn_status == "green burn" & zone == "persistent" ~ 0.4006,   # Example value for burned in north zone
      burn_status == "dead burn" & zone == "persistent" ~ 0.5576,   # Example value for burned in south zone
      burn_status == "live" & zone == "persistent" ~ 0.5027,
      burn_status == "green burn" & zone == "transitional" ~ 0.5812,   # Example value for burned in north zone
      burn_status == "dead burn" & zone == "transitional" ~ 0.5655,   # Example value for burned in south zone
      burn_status == "live" & zone == "persistent" ~ 0.5341,
      TRUE ~ 0.4006  # Default value if neither of the conditions match
    ),
#calcuating Watz (power) - dividing tree circ/snow depths by 2 for the north/south aspect differences as we assume that the area is only 1/2 the tree by aspect
     n_W =  n_LWout_wperm2 * ((tree_circ*snowcam_max_depth_m)/2),
    s_W =  s_LWout_wperm2 * ((tree_circ*snowcam_max_depth_m)/2),
#converting from Wperm2 to MJ/day
    n_LWout_MJperd = n_W * 86400 / 1e6, 
s_LWout_MJperd = s_W * 86400 / 1e6)
```

Full 15min GBDBUB

```{r}
#making a different dataframe that has gb_snowdepth, db_snowdepth & ub_snowdepths - pivoted wide, not long
gbdbub_snowcamdepths <- full_snowcamdepths %>%
  pivot_wider(names_from = burn_status, values_from = snowcam_max_depth_m) %>%
  rename(gb_snowdepth_m = "green burn", db_snowdepth_m = "dead burn", live_snowdepth_m = "live")
```

```{r}
full_15min_gbdbub_K <- full_15min_gbdbub %>%
  mutate(gb_temp_k = (gb_temp + 273.15), db_temp_k = (db_temp + 273.15), ub_temp_k = (ub_temp + 273.15)) %>%
  mutate(zone = case_when(
    zone == "persistent" ~ "PSZ",
    zone == "transitional" ~ "TSZ",
    TRUE ~ zone  # Retain original value if no match
  )) %>%
  #adding snowdepths
  left_join(gbdbub_snowcamdepths, by = c("day", "zone"))
```

```{r}
#LWout calcs
full_15min_gbdbub_LWout <- full_15min_gbdbub_K %>%
  #calculating LWout in Wperm^2 by burn_status
  mutate(gb_LWout_wperm2 = emissivity * stefan_boltzmann_constant * (gb_temp_k^4), db_LWout_wperm2 = emissivity * stefan_boltzmann_constant * (db_temp_k^4), ub_LWout_wperm2 = emissivity * stefan_boltzmann_constant * (ub_temp_k^4)) %>%
  # Define m2 based on zone
    mutate(gb_tree_circ = case_when(zone == "persistent" ~ 0.4006,
zone == "transitional" ~ 0.5812, TRUE ~ 0.4006), db_tree_circ = case_when(zone == "persistent" ~ 0.5576, zone == "transitional" ~ 0.5655, TRUE ~ 0.5576), ub_tree_circ = case_when(zone == "persistent" ~ 0.5027, zone == "transitional" ~ 0.5341, TRUE ~ 0.5576)) %>%
  #calcuating Watz (power)
  mutate(
    gb_W = gb_LWout_wperm2 * ((gb_tree_circ*gb_snowdepth_m)/2),
    db_W =  db_LWout_wperm2 * ((db_tree_circ*db_snowdepth_m)/2),
    ub_W =  ub_LWout_wperm2 * ((ub_tree_circ*live_snowdepth_m)/2),
#converting from Wperm2 to MJ/day
    gb_LWout_MJperd = gb_W * 86400 / 1e6, 
db_LWout_MJperd = db_W * 86400 / 1e6, ub_LWout_MJperd = ub_W * 86400 / 1e6)
```

Full Hourly GB

```{r}
full_hourly_gb_K <- full_hourly_gb %>%
  mutate(north_temp_k = (north_temp + 273.15), south_temp_k = (south_temp + 273.15), charred_temp_k = (charred_temp + 273.15), uncharred_temp_k = (uncharred_temp + 273.15)) %>%
  mutate(zone = case_when(
    zone == "persistent" ~ "PSZ",
    zone == "transitional" ~ "TSZ",
    TRUE ~ zone  # Retain original value if no match
  )) %>%
  left_join(full_snowcamdepths, by = c("day", "zone", "burn_status"))
```

The following dataframe can be used for plotting comparison of GB-only aspect/char pattern comparisons

\*\* Don't need to use this - we'll address gb char pattern in another, earlier assessment.

```{r}
full_hourly_gb_LWout <- full_hourly_gb_K %>%
  mutate(
    # Calculate longwave radiation in Wperm^2
    n_LWout_wperm2 = emissivity * stefan_boltzmann_constant * (north_temp_k^4), s_LWout_wperm2 = emissivity * stefan_boltzmann_constant * (south_temp_k^4), c_LWout_wperm2 = emissivity * stefan_boltzmann_constant * (charred_temp_k^4), uc_LWout_wperm2 = emissivity * stefan_boltzmann_constant * (uncharred_temp_k^4)) %>%
  # Define tree_circ based on zone
    mutate(gb_tree_circ = case_when(zone == "persistent" ~ 0.4006,
zone == "transitional" ~ 0.5812, TRUE ~ 0.4006), 
#calcuating Watz (power)- dividing m2 by 2 for the north/south aspect differences as we assume that the area is only 1/2 the tree by aspect
    n_W =  n_LWout_wperm2 * ((gb_tree_circ*snowcam_max_depth_m)/2),
    s_W =  s_LWout_wperm2 * ((gb_tree_circ*snowcam_max_depth_m)/2),
c_W =  c_LWout_wperm2 * ((gb_tree_circ*snowcam_max_depth_m)/2),
uc_W =  uc_LWout_wperm2 * ((gb_tree_circ*snowcam_max_depth_m)/2),
#converting from Wperm2 to MJ/day
    n_LWout_MJperd = n_W * 86400 / 1e6, 
s_LWout_MJperd = s_W * 86400 / 1e6, c_LWout_MJperd = c_W * 86400 / 1e6, uc_LWout_MJperd = uc_W * 86400 / 1e6)
```

```{r}
#exporting above tree_LWout datasets to nsf/treetemp folder
write.csv(full_15min_gbdbub_LWout, "nsf/treetemp_data/full_15min_gbdbub_LWout.csv")

write.csv(full_15min_ns_LWout, "nsf/treetemp_data/full_15min_ns_LWout.csv")
```

# Daily Mean Datasets

-   taking the 15-minute datasets and making daily mean datasets with day/night phase means

-   Then doing an accumulation dataset for each day

```{r}
## use this dataset if I want to plot daily mean values!
full_daily_ns_LWout <- full_15min_ns_LWout %>%
  group_by(day, month, phase, zone, burn_status) %>%
  summarize(north_temp = mean(north_temp), south_temp = mean(south_temp), ns_avg_temp = mean(ns_avg_temp), n_LWout_wperm2 = mean(n_LWout_wperm2), s_LWout_wperm2 = mean(s_LWout_wperm2), n_LWout_MJperd = mean(n_LWout_MJperd), s_LWout_MJperd = mean(s_LWout_MJperd))
```

```{r}
#creating an accumulation dataframe
## use this dataset if I want to plot cumulative values!
accu_full_daily_ns_LWout <- full_daily_ns_LWout %>%
  group_by(zone, burn_status) %>%  # Group by zone and burn_status
  mutate(accu_daily_n_LWout_MJperd = cumsum(n_LWout_MJperd), accu_daily_s_LWout_MJperd = cumsum(s_LWout_MJperd)) %>%
  select(day, month, phase, zone, burn_status, accu_daily_n_LWout_MJperd, accu_daily_s_LWout_MJperd)
```

```{r}
#creating zone specific n_s dataframes from accumulation dataframe - DAY ONLY ASSESSMENT
accu_pers_dt_ns_LWout <- accu_full_daily_ns_LWout %>%
  filter(zone == "persistent", phase == "day")

accu_trans_dt_ns_LWout <- accu_full_daily_ns_LWout %>%
  filter(zone == "transitional", phase == "day")
```

```{r}
#pers plot
accum_pers_dt_ns_plot <- ggplot(data = accu_pers_dt_ns_LWout) +
  geom_line(aes(x = day, y = accu_daily_n_LWout_MJperd), color = "black") +
  geom_line(aes(x = day, y = accu_daily_s_LWout_MJperd), color = "red") +
  facet_wrap(~zone + burn_status + phase)

accum_pers_dt_ns_plot
```

```{r}
#trans plot
accum_trans_dt_ns_plot <- ggplot(data = accu_trans_dt_ns_LWout) +
  geom_line(aes(x = day, y = accu_daily_n_LWout_MJperd), color = "black") +
  geom_line(aes(x = day, y = accu_daily_s_LWout_MJperd), color = "red") +
  facet_wrap(~zone + burn_status + phase)

accum_trans_dt_ns_plot
```

```{r}
#full plot for daytime values that is only face-wrapped by burn_status and zone
## USE THIS DATAFRAME
accu_dt_ns_LWout <- accu_full_daily_ns_LWout %>%
  filter(phase == "day") %>%
  mutate(zone = case_when(
    zone == "persistent" ~ "PSZ",
    zone == "transitional" ~ "TSZ",
    TRUE ~ zone  # Keep the original value if it's neither "persistent" nor "transitional"
  ))
```

```{r}
##use this plot!
accu_dt_ns_plot <- ggplot(data = accu_dt_ns_LWout) +
  geom_line(aes(x = day, y = accu_daily_n_LWout_MJperd, color = "north"), alpha = 0.9) + 
  geom_line(aes(x = day, y = accu_daily_s_LWout_MJperd, color = "south")) +
  facet_wrap(~zone + burn_status) +
  theme_bw() +
  labs(
    #title = "Daily Accumulation Data by Burn Status & Zone",
    x = "Date",
    y = "Daily Accumulated LWout (MJ/day)",
    color = "Aspect"  # Legend title
  ) +
  scale_color_manual(values = c("north" = "gray25", "south" = "#D95F02"))

accu_dt_ns_plot
```

GBDBUB Dataframe

```{r}
## use this dataset if I want to plot daily mean values!
full_daily_gbdbub_LWout <- full_15min_gbdbub_LWout %>%
  group_by(day, month, phase, zone, aspect) %>%
  summarize(gb_temp = mean(gb_temp), db_temp = mean(db_temp), ub_temp = mean(ub_temp), gb_LWout_wperm2 = mean(gb_LWout_wperm2), db_LWout_wperm2 = mean(db_LWout_wperm2), ub_LWout_wperm2 = mean(ub_LWout_wperm2), gb_LWout_MJperd = mean(gb_LWout_MJperd), db_LWout_MJperd = mean(db_LWout_MJperd), ub_LWout_MJperd = mean(ub_LWout_MJperd))
```

```{r}
#accumulation dataframe
accu_full_daily_gbdbub_LWout <- full_daily_gbdbub_LWout %>%
  group_by(zone, aspect) %>%  # Group by zone and aspect
  mutate(accu_daily_gb_LWout_MJperd = cumsum(gb_LWout_MJperd), accu_daily_db_LWout_MJperd = cumsum(db_LWout_MJperd), accu_daily_ub_LWout_MJperd = cumsum(ub_LWout_MJperd)) %>%
  select(day, month, phase, zone, aspect, accu_daily_gb_LWout_MJperd, accu_daily_db_LWout_MJperd, accu_daily_ub_LWout_MJperd)

#use this dataframe for final plotting
accu_dt_gbdbub_LWout <- accu_full_daily_gbdbub_LWout %>%
  filter(phase == "day") %>%
  mutate(zone = case_when(
    zone == "persistent" ~ "PSZ",
    zone == "transitional" ~ "TSZ",
    TRUE ~ zone  # Keep the original value if it's neither "persistent" nor "transitional"
  ))

p_accu_dr_gbdbub_LWout <- accu_dt_gbdbub_LWout %>%
  filter(zone == "PSZ")

t_accu_dr_gbdbub_LWout <- accu_dt_gbdbub_LWout %>%
  filter(zone == "TSZ")
```

```{r}
#persistent 
p_cum_dt_gbdbub_plot <- ggplot(data = p_accu_dr_gbdbub_LWout) +
  geom_line(aes(x = day, y = accu_daily_gb_LWout_MJperd, color = "green burn", linetype = aspect), linewidth = 0.6) +  
  geom_line(aes(x = day, y = accu_daily_db_LWout_MJperd, color = "dead burn", linetype = aspect), linewidth = 0.6) +
  geom_line(aes(x = day, y = accu_daily_ub_LWout_MJperd, color = "live", linetype = aspect), linewidth = 0.6) +
  facet_wrap(~aspect, dir = "h") +
  theme_bw() +
  labs(title = "a) PSZ", 
    x = NULL,
    y = "Daily Cumulative LWout (MJ)",
    color = "Burn Status", 
    linetype = "Aspect"
  ) +
  scale_color_manual(values = c("green burn" = "#1B7837", "dead burn" = "#D95F02", "live" = adjustcolor("#2166AC", alpha = 0.7))) +
  scale_linetype_manual(values = c("north" = "dashed", "south" = "solid"))

p_cum_dt_gbdbub_plot
```

```{r}
#transitional
t_cum_dt_gbdbub_plot <- ggplot(data = t_accu_dr_gbdbub_LWout) +
  geom_line(aes(x = day, y = accu_daily_gb_LWout_MJperd, color = "green burn", linetype = aspect), linewidth = 0.6) +  
  geom_line(aes(x = day, y = accu_daily_db_LWout_MJperd, color = "dead burn", linetype = aspect), linewidth = 0.6) +
  geom_line(aes(x = day, y = accu_daily_ub_LWout_MJperd, color = "live", linetype = aspect), linewidth = 0.6) +
  facet_wrap(~aspect, dir = "h") +
  theme_bw() +
  labs(title = "b) TSZ", 
    x = "Date",
    y = "Daily Cumulative LWout (MJ)",
    color = "Burn Status", 
    linetype = "Aspect"
  ) +
  scale_color_manual(values = c("green burn" = "#1B7837", "dead burn" = "#D95F02", "live" = adjustcolor("#2166AC", alpha = 0.7))) +
  scale_linetype_manual(values = c("north" = "dashed", "south" = "solid"))

t_cum_dt_gbdbub_plot
```

```{r}
cum_full_daily_treeLWout <- ggarrange(p_cum_dt_gbdbub_plot, t_cum_dt_gbdbub_plot, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")

cum_full_daily_treeLWout
```

```{r}
#exporting accumulation data to use in other plots!
write.csv(accu_full_daily_ns_LWout, "nsf/treetemp_data/cum_full_daily_treeLWout.csv")
```

# Boxplots of Char Pattern Comparisons

## GB Trees

```{r}
#making a daytime dataframe 
full_hourly_gb_dt <- full_hourly_gb %>%
  filter(phase == "day") %>%
  rename(north = north_temp, south = south_temp, charred = charred_temp, uncharred = uncharred_temp) %>%
  pivot_longer(cols = c(north, south, charred, uncharred),
               names_to = "temp_type", values_to = "temperature") %>%
  select(datetime_hour, day, month, phase, zone, burn_status, temp_type, temperature)

#parsing into zone dataframes
pers_full_hourly_gb_dt <- full_hourly_gb_dt %>%
  filter(zone == "persistent") %>%
  mutate(zone = "PSZ")

trans_full_hourly_gb_dt <- full_hourly_gb_dt %>%
  filter(zone == "transitional") %>%
  mutate(zone = "TSZ")
```

```{r}
#PSZ
pers_dt_gb_aspect_comparison <- ggplot(pers_full_hourly_gb_dt) + 
  geom_boxplot(aes(x = temp_type, y = temperature, fill = temp_type)) + 
  facet_wrap(~ zone + month + phase, scales = "free") + 
  scale_fill_manual(
    values = c("north" = "green", "south" = "red", "charred" = "black", "uncharred" = "grey"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect of Temp Sensor", y = "Temperature (°C)") +
  theme_bw()

pers_dt_gb_aspect_comparison
```

```{r}
#TSZ
trans_dt_gb_aspect_comparison <- ggplot(trans_full_hourly_gb_dt) + 
  geom_boxplot(aes(x = temp_type, y = temperature, fill = temp_type)) + 
  facet_wrap(~ zone + month + phase, scales = "free") + 
  scale_fill_manual(
    values = c("north" = "green", "south" = "red", "charred" = "black", "uncharred" = "grey"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect of Temp Sensor", y = "Temperature (°C)") +
  theme_bw()

trans_dt_gb_aspect_comparison
```

\*\* could just do box plots of statistically significant comparisons and put p-values on them?

## GB Trees (N/S only)

```{r}
#making a daytime dataframe 
##gb
full_15min_gb_dt <- full_15min_gbdbub %>%
  filter(phase == "day") %>%
  select(datetime, day, month, phase, zone, aspect, gb_temp) %>%
  mutate(zone = case_when(
    zone == "persistent" ~ "PSZ", zone == "transitional" ~ "TSZ",
    TRUE ~ zone  # This line ensures other zones are preserved
  )) %>%
  mutate(burn_status = "green burn")

##db
full_15min_db_dt <- full_15min_gbdbub %>%
  filter(phase == "day") %>%
  select(datetime, day, month, phase, zone, aspect, db_temp) %>%
  mutate(zone = case_when(
    zone == "persistent" ~ "PSZ", zone == "transitional" ~ "TSZ",
    TRUE ~ zone  # This line ensures other zones are preserved
  )) %>%
  mutate(burn_status = "dead burn")

##db
full_15min_ub_dt <- full_15min_gbdbub %>%
  filter(phase == "day") %>%
  select(datetime, day, month, phase, zone, aspect, ub_temp) %>%
  mutate(zone = case_when(
    zone == "persistent" ~ "PSZ", zone == "transitional" ~ "TSZ",
    TRUE ~ zone  # This line ensures other zones are preserved
  )) %>%
  mutate(burn_status = "live")
```

```{r}

#parsing into zone dataframes
pers_full_15min_gb_dt <- full_15min_gb_dt %>%
  filter(zone == "PSZ")

#have to filter individually to add p-value to boxes
feb_pers_gb <- pers_full_15min_gb_dt %>%
  filter(month == "2")

march_pers_gb <- pers_full_15min_gb_dt %>%
  filter(month == "3")

april_pers_gb <- pers_full_15min_gb_dt %>%
  filter(month == "4")

may_pers_gb <- pers_full_15min_gb_dt %>%
  filter(month == "5")
  

trans_full_15min_gb_dt <- full_15min_gb_dt %>%
  filter(zone == "TSZ")

#have to filter individually to add p-value to boxes
feb_trans_gb <- trans_full_15min_gb_dt %>%
  filter(month == "2")

march_trans_gb <- trans_full_15min_gb_dt %>%
  filter(month == "3")

april_trans_gb <- trans_full_15min_gb_dt %>%
  filter(month == "4")

may_trans_gb <- trans_full_15min_gb_dt %>%
  filter(month == "5")
```

Combined Simple Plot with PSZ and TSZ on the same plots!

```{r}
#GB N/S Trees
# Create a combined variable for x-axis (interaction of zone and aspect)
full_15min_gb_dt$gb_interaction_zone_aspect <- interaction(full_15min_gb_dt$zone, full_15min_gb_dt$aspect)

# Create the plot
full_ns_boxplots_gb_inter <- ggplot(full_15min_gb_dt, 
                                  aes(x = gb_interaction_zone_aspect, y = gb_temp, fill = aspect, pattern = zone)) +
  geom_boxplot_pattern(
    aes(pattern = zone), 
    pattern_density = 0.3,  # Adjust density for stripes
    pattern_fill = NA,  # No fill for pattern
    color = "black"  # Outline color
  ) + 
  labs(title = "a) Green Burn", x = "Aspect and Zone", y = "Temperature (°C)") +
  scale_x_discrete(labels = c("PSZ-N", "TSZ-N", "PSZ-S", "TSZ-S")) +  # Custom labels
  facet_wrap(~month, nrow = 1) +
  theme_bw() +
  scale_fill_manual(values = c("north" = "#2166AC", "south" = "#D95F02")) +  # Solid fill colors
  scale_pattern_manual(values = c("PSZ" = NA, "TSZ" = "stripe")) +  # Solid for PSZ, stripes for TSZ
  guides(fill = guide_legend(title = "Aspect"), 
         pattern = guide_legend(title = "Zone")) # Separate legend titles

# Display the plot
full_ns_boxplots_gb_inter
```

```{r}
#DB N/S Trees
# Create a combined variable for x-axis (interaction of zone and aspect)
full_15min_db_dt$db_interaction_zone_aspect <- interaction(full_15min_db_dt$zone, full_15min_db_dt$aspect)

# Create the plot
full_ns_boxplots_db_inter <- ggplot(full_15min_db_dt, 
                                  aes(x = db_interaction_zone_aspect, y = db_temp, fill = aspect, pattern = zone)) +
  geom_boxplot_pattern(
    aes(pattern = zone), 
    pattern_density = 0.3,  # Adjust density for stripes
    pattern_fill = NA,  # No fill for pattern
    color = "black"  # Outline color
  ) + 
  labs(title = "b) Dead Burn", x = "Aspect and Zone", y = "Temperature (°C)") +
  scale_x_discrete(labels = c("PSZ-N", "TSZ-N", "PSZ-S", "TSZ-S")) +  # Custom labels
  facet_wrap(~month, nrow = 1) +
  theme_bw() +
  scale_fill_manual(values = c("north" = "#2166AC", "south" = "#D95F02")) +  # Solid fill colors
  scale_pattern_manual(values = c("PSZ" = NA, "TSZ" = "stripe")) +  # Solid for PSZ, stripes for TSZ
  guides(fill = guide_legend(title = "Aspect"), 
         pattern = guide_legend(title = "Zone")) # Separate legend titles

# Display the plot
full_ns_boxplots_db_inter
```

```{r}
#DB N/S Trees
# Create a combined variable for x-axis (interaction of zone and aspect)
full_15min_ub_dt$ub_interaction_zone_aspect <- interaction(full_15min_ub_dt$zone, full_15min_ub_dt$aspect)

# Create the plot
full_ns_boxplots_ub_inter <- ggplot(full_15min_ub_dt, 
                                  aes(x = ub_interaction_zone_aspect, y = ub_temp, fill = aspect, pattern = zone)) +
  geom_boxplot_pattern(
    aes(pattern = zone), 
    pattern_density = 0.3,  # Adjust density for stripes
    pattern_fill = NA,  # No fill for pattern
    color = "black"  # Outline color
  ) + 
  labs(title = "c) Live", x = "Aspect and Zone", y = "Temperature (°C)") +
  scale_x_discrete(labels = c("PSZ-N", "TSZ-N", "PSZ-S", "TSZ-S")) +  # Custom labels
  facet_wrap(~month, nrow = 1) +
  theme_bw() +
  scale_fill_manual(values = c("north" = "#2166AC", "south" = "#D95F02")) +  # Solid fill colors
  scale_pattern_manual(values = c("PSZ" = NA, "TSZ" = "stripe")) +  # Solid for PSZ, stripes for TSZ
  guides(fill = guide_legend(title = "Aspect"), 
         pattern = guide_legend(title = "Zone")) + # Separate legend titles
  scale_y_continuous(limits = c(0, 40))  # Force y-scale to go to 40

# Display the plot
full_ns_boxplots_ub_inter
```

```{r}
#combinging all of the above plots into one plot
#vertical stack version
gbdbub_full_ns_inter_plots <- ggarrange(full_ns_boxplots_gb_inter, full_ns_boxplots_db_inter, full_ns_boxplots_ub_inter, nrow = 1, ncol = 3, common.legend = TRUE, legend = "bottom")

gbdbub_full_ns_inter_plots
```

\*\* USE THE VERSION BELOW FOR COMBINED N/S PLOT, FACET WRAPPED BY MONTH!

```{r}
#horizontal stack version
gbdbub_full_ns_inter_plots_h <- ggarrange(full_ns_boxplots_gb_inter, full_ns_boxplots_db_inter, full_ns_boxplots_ub_inter, nrow = 3, ncol = 1, common.legend = TRUE, legend = "bottom")

gbdbub_full_ns_inter_plots_h
```

\*\* as of 2024-10-23 - don't have monthly zone p-values for green burned yet. Need to get these to finalize plots!

```{r}
#individual month plots
feb_pers_gb_plot <- ggplot(feb_pers_gb) + 
  geom_boxplot(aes(x = aspect, y = gb_temp, fill = aspect)) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  ylim(NA, 40) +
  theme_bw()

#adding p-value
feb_pers_gb_plot <- feb_pers_gb_plot + 
  annotate("text", x = 1, y = 35, label = "p = 0.01586", size = 3, color = "red3", fontface = "bold") + 
  theme(legend.position = "none") + 
  labs(x = NULL, y = NULL)

feb_pers_gb_plot
```

```{r}
#individual month plots
march_pers_gb_plot <- ggplot(march_pers_gb) + 
  geom_boxplot(aes(x = aspect, y = gb_temp, fill = aspect)) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  ylim(NA, 40) +
  theme_bw()

#adding p-value
march_pers_gb_plot <- march_pers_gb_plot + 
  annotate("text", x = 1, y = 35, label = "p = 0.01586", size = 3, color = "red3", fontface = "bold") + 
  theme(legend.position = "none") + 
  labs(x = NULL, y = NULL)

march_pers_gb_plot
```

```{r}
april_pers_gb_plot <- ggplot(april_pers_gb) + 
  geom_boxplot(aes(x = aspect, y = gb_temp, fill = aspect)) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  ylim(NA, 40) +
  theme_bw()

#adding p-value
april_pers_gb_plot <- april_pers_gb_plot + 
  annotate("text", x = 1, y = 35, label = "p = 0.01586", size = 3, color = "red3", fontface = "bold") + 
  theme(legend.position = "none") + 
  labs(x = NULL, y = NULL)

april_pers_gb_plot
```

```{r}
may_pers_gb_plot <- ggplot(may_pers_gb) + 
  geom_boxplot(aes(x = aspect, y = gb_temp, fill = aspect)) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  ylim(NA, 40) +
  theme_bw()

#adding p-value
may_pers_gb_plot <- may_pers_gb_plot + 
  annotate("text", x = 1, y = 35, label = "p = 0.01586", size = 3, color = "red3", fontface = "bold") + 
  theme(legend.position = "none") + 
  labs(x = NULL, y = NULL)

may_pers_gb_plot
```

```{r}
#combining individual month PSZ plots
full_pers_gb_plots <- ggarrange(feb_pers_gb_plot, march_pers_gb_plot, april_pers_gb_plot, may_pers_gb_plot, nrow = 1, ncol = 4)

full_pers_gb_plots
```

```{r}
#individual month plots
feb_trans_gb_plot <- ggplot(feb_trans_gb) + 
  geom_boxplot(aes(x = aspect, y = gb_temp, fill = aspect), alpha = 0.6) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  ylim(NA, 40) +
  theme_bw()

#adding p-value
feb_trans_gb_plot <- feb_trans_gb_plot + 
  annotate("text", x = 1, y = 35, label = "p = 0.01586", size = 3, color = "red3", fontface = "bold") + 
  theme(legend.position = "none") + 
  labs(x = NULL, y = NULL)

feb_trans_gb_plot
```

```{r}
march_trans_gb_plot <- ggplot(march_trans_gb) + 
  geom_boxplot(aes(x = aspect, y = gb_temp, fill = aspect), alpha = 0.6) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  ylim(NA, 40) +
  theme_bw()

#adding p-value
march_trans_gb_plot <- feb_trans_gb_plot + 
  annotate("text", x = 1, y = 35, label = "p = 0.01586", size = 3, color = "red3", fontface = "bold") + 
  theme(legend.position = "none") + 
  labs(x = NULL, y = NULL)

march_trans_gb_plot
```

```{r}
april_trans_gb_plot <- ggplot(april_trans_gb) + 
  geom_boxplot(aes(x = aspect, y = gb_temp, fill = aspect), alpha = 0.6) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  ylim(NA, 40) +
  theme_bw()

#adding p-value
april_trans_gb_plot <- april_trans_gb_plot + 
  annotate("text", x = 1, y = 35, label = "p = 0.01586", size = 3, color = "red3", fontface = "bold") + 
  theme(legend.position = "none") + 
  labs(x = NULL, y = NULL)

april_trans_gb_plot
```

```{r}
may_trans_gb_plot <- ggplot(may_trans_gb) + 
  geom_boxplot(aes(x = aspect, y = gb_temp, fill = aspect), alpha = 0.6) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  ylim(NA, 40) +
  theme_bw()

#adding p-value
may_trans_gb_plot <- may_trans_gb_plot + 
  annotate("text", x = 1, y = 35, label = "p = 0.01586", size = 3, color = "red3", fontface = "bold") + 
  theme(legend.position = "none") + 
  labs(x = NULL, y = NULL)

may_trans_gb_plot
```

```{r}
#combining individual month PSZ plots
full_trans_gb_plots <- ggarrange(feb_trans_gb_plot, march_trans_gb_plot, april_trans_gb_plot, may_trans_gb_plot, nrow = 1, ncol = 4)

full_trans_gb_plots
```

```{r}
full_gb_plots <- ggarrange(full_pers_gb_plots, full_trans_gb_plots, nrow = 2, ncol = 1)

#adjusting the labels so they are shared
full_gb_plots <- annotate_figure(full_gb_plots,
                                  left = textGrob("Temperature (°C)", gp = gpar(fontsize = 10), rot = 90),
                                  bottom = textGrob("Aspect", gp = gpar(fontsize = 10)))


full_gb_plots
```

## DB Trees

```{r}
#making a daytime dataframe 
full_15min_db_dt <- full_15min_gbdbub %>%
  filter(phase == "day") %>%
  select(datetime, day, month, phase, zone, aspect, db_temp) %>%
  mutate(zone = case_when(
    zone == "persistent" ~ "PSZ", zone == "transitional" ~ "TSZ",
    TRUE ~ zone  # This line ensures other zones are preserved
  )) %>%
  mutate(burn_status = "dead burn")

#parsing into zone dataframes
pers_full_15min_db_dt <- full_15min_db_dt %>%
  filter(zone == "PSZ")

#have to filter individually to add p-value to boxes
feb_pers_db <- pers_full_15min_db_dt %>%
  filter(month == "2")

march_pers_db <- pers_full_15min_db_dt %>%
  filter(month == "3")

april_pers_db <- pers_full_15min_db_dt %>%
  filter(month == "4")

may_pers_db <- pers_full_15min_db_dt %>%
  filter(month == "5")
  

trans_full_15min_db_dt <- full_15min_db_dt %>%
  filter(zone == "TSZ")

#have to filter individually to add p-value to boxes
feb_trans_db <- trans_full_15min_db_dt %>%
  filter(month == "2")

march_trans_db <- trans_full_15min_db_dt %>%
  filter(month == "3")

april_trans_db <- trans_full_15min_db_dt %>%
  filter(month == "4")

may_trans_db <- trans_full_15min_db_dt %>%
  filter(month == "5")
```

\*\* keep on working on the boxplot below! The data is stacking isntead of going next to each other. 2024-10-23

```{r}

full_15min_db_dt_plot <- ggplot(full_15min_db_dt) +
  # Solid boxplots for 'persistent' zone
  geom_boxplot(data = full_15min_db_dt[full_15min_db_dt$zone == "PSZ", ],
               aes(x = aspect, y = db_temp, fill = aspect),
               position = position_dodge(width = 0.8),  # Side-by-side
               width = 0.4) +  # Adjust width for better spacing
  # Patterned boxplots for 'transitional' zone
  geom_boxplot_pattern(data = full_15min_db_dt[full_15min_db_dt$zone == "TSZ", ],
                       aes(x = aspect, y = db_temp, fill = aspect, pattern = zone),
                       position = position_dodge(width = 0.8),  # Match the position
                       pattern = "stripe",
                       pattern_density = 0.1,
                       pattern_fill = NA,
                       width = 0.4) +  # Adjust width for better spacing
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  facet_wrap(~ burn_status + month) + 
  theme_bw() +
  theme(legend.position = "bottom")

# Print the final plot
print(full_15min_db_dt_plot)
```

```{r}
#PSZ
pers_dt_db_aspect_comparison <- ggplot(pers_full_15min_db_dt) + 
  geom_boxplot(aes(x = aspect, y = db_temp, fill = aspect)) + 
  facet_wrap(~ zone + burn_status + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  theme_bw()

pers_dt_db_aspect_comparison <- pers_dt_db_aspect_comparison + annotate("text", x = 5, y = 30, label = "p = 0.01586", size = 2, color = "black")

pers_dt_db_aspect_comparison
```

```{r}
#individual month plots
feb_pers_db_plot <- ggplot(feb_pers_db) + 
  geom_boxplot(aes(x = aspect, y = db_temp, fill = aspect)) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  ylim(NA, 40) +
  theme_bw()

#adding p-value
feb_pers_db_plot <- feb_pers_db_plot + 
  annotate("text", x = 1, y = 35, label = "p = 0.01586", size = 3, color = "red3", fontface = "bold") + 
  theme(legend.position = "none") + 
  labs(x = NULL, y = NULL)

feb_pers_db_plot
```

```{r}
#individual month plots
march_pers_db_plot <- ggplot(march_pers_db) + 
  geom_boxplot(aes(x = aspect, y = db_temp, fill = aspect)) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  ylim(NA, 40) +
  theme_bw()

#adding p-value
march_pers_db_plot <- march_pers_db_plot + 
  annotate("text", x = 1, y = 35, label = "p = 0.00683", size = 3, color = "red3", fontface = "bold") + 
  theme(legend.position = "none") + 
  labs(x = NULL, y = NULL)

march_pers_db_plot
```

```{r}
#individual month plots
april_pers_db_plot <- ggplot(april_pers_db) + 
  geom_boxplot(aes(x = aspect, y = db_temp, fill = aspect)) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  ylim(NA, 40) +
  theme_bw() + 
  theme(legend.position = "none")

#adding p-value
april_pers_db_plot <- april_pers_db_plot + 
  annotate("text", x = 1, y = 35, label = "p = 0.1671", size = 3, color = "black", fontface = "bold") + 
  labs(x = NULL, y = NULL)

april_pers_db_plot
```

```{r}
#individual month plots
may_pers_db_plot <- ggplot(may_pers_db) + 
  geom_boxplot(aes(x = aspect, y = db_temp, fill = aspect)) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  ylim(NA, 40) +
  theme_bw() +
  theme(legend.position = "none")

#adding p-value
may_pers_db_plot <- may_pers_db_plot + 
  annotate("text", x = 1, y = 35, label = "p = 0.5876", size = 3, color = "black", fontface = "bold") + 
  labs(x = NULL, y = NULL)

may_pers_db_plot
```

```{r}
#combining individual month PSZ plots
full_pers_db_plots <- ggarrange(feb_pers_db_plot, march_pers_db_plot, april_pers_db_plot, may_pers_db_plot, nrow = 1, ncol = 4)

full_pers_db_plots
```

```{r}
#TSZ
trans_dt_db_aspect_comparison <- ggplot(trans_full_15min_db_dt) + 
  geom_boxplot(aes(x = aspect, y = db_temp, fill = aspect)) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  theme_bw()

trans_dt_db_aspect_comparison
```

```{r}
#individual month plots
feb_trans_db_plot <- ggplot(feb_trans_db) + 
  geom_boxplot(aes(x = aspect, y = db_temp, fill = aspect), alpha = 0.6) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  ylim(NA, 40) +
  theme_bw()

#adding p-value
feb_trans_db_plot <- feb_trans_db_plot + 
  annotate("text", x = 1, y = 35, label = " p = 0.000004", size = 3, color = "red3", fontface = "bold") + 
  theme(legend.position = "none") + 
  labs(x = NULL, y = NULL)

feb_trans_db_plot
```

```{r}
## striped version
feb_trans_db_plot_striped <- ggplot(feb_trans_db) + 
  geom_boxplot_pattern(aes(x = aspect, y = db_temp, fill = aspect),
                       pattern = "stripe",  # Use "stripe" pattern
                       pattern_density = 0.1,  # Adjust density of stripes
                       pattern_fill = "white",  # Fill color for stripes
                       pattern_angle = 45) +  # Angle of the stripes
  facet_wrap(~ zone + burn_status + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  theme_bw()

feb_trans_db_plot_striped
```

```{r}
march_trans_db_plot <- ggplot(march_trans_db) + 
  geom_boxplot(aes(x = aspect, y = db_temp, fill = aspect), alpha = 0.6) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  ylim(NA, 40) +
  theme_bw()

#adding p-value
march_trans_db_plot <- march_trans_db_plot + 
  annotate("text", x = 1, y = 35, label = " p = 0.000001", size = 3, color = "red3", fontface = "bold") + 
  theme(legend.position = "none") + 
  labs(x = NULL, y = NULL)

march_trans_db_plot
```

```{r}
march_trans_db_plot_striped <- ggplot(march_trans_db) + 
  geom_boxplot_pattern(aes(x = aspect, y = db_temp, fill = aspect),
                       pattern = "stripe",  # Use "stripe" pattern
                       pattern_density = 0.1,  # Adjust density of stripes
                       pattern_fill = "white",  # Fill color for stripes
                       pattern_angle = 45) +  # Angle of the stripes
  facet_wrap(~ zone + burn_status + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  theme_bw()

march_trans_db_plot_striped
```

```{r}
april_trans_db_plot <- ggplot(april_trans_db) + 
  geom_boxplot(aes(x = aspect, y = db_temp, fill = aspect), alpha = 0.6) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  ylim(NA, 40) +
  theme_bw()

#adding p-value
april_trans_db_plot <- april_trans_db_plot + 
  annotate("text", x = 1, y = 35, label = " p = 0.000323", size = 3, color = "red3", fontface = "bold") + 
  theme(legend.position = "none") + 
  labs(x = NULL, y = NULL)

april_trans_db_plot
```

```{r}
#striped version
april_trans_db_plot_striped <- ggplot(april_trans_db) + 
  geom_boxplot_pattern(aes(x = aspect, y = db_temp, fill = aspect),
                       pattern = "stripe",  # Use "stripe" pattern
                       pattern_density = 0.1,  # Adjust density of stripes
                       pattern_fill = "white",  # Fill color for stripes
                       pattern_angle = 45) +  # Angle of the stripes
  facet_wrap(~ zone + burn_status + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  theme_bw()

april_trans_db_plot_striped
```

```{r}
may_trans_db_plot <- ggplot(may_trans_db) + 
  geom_boxplot(aes(x = aspect, y = db_temp, fill = aspect), alpha = 0.6) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  ylim(NA, 40) +
  theme_bw()

#adding p-value
may_trans_db_plot <- may_trans_db_plot + 
  annotate("text", x = 1, y = 35, label = "p = 0.5082", size = 3, color = "black", fontface = "bold") + 
  theme(legend.position = "none") +
  labs(x = NULL, y = NULL)

may_trans_db_plot
```

```{r}
may_trans_db_plot_striped <- ggplot(may_trans_db) + 
  geom_boxplot_pattern(aes(x = aspect, y = db_temp, fill = aspect),
                       pattern = "stripe",  # Use "stripe" pattern
                       pattern_density = 0.1,  # Adjust density of stripes
                       pattern_fill = "white",  # Fill color for stripes
                       pattern_angle = 45) +  # Angle of the stripes
  facet_wrap(~ zone + burn_status + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  theme_bw()

may_trans_db_plot_striped
```

```{r}
#combining individual month PSZ plots
full_trans_db_plots <- ggarrange(feb_trans_db_plot, march_trans_db_plot, april_trans_db_plot, may_trans_db_plot, 
                                  nrow = 1, ncol = 4)

# Display the plot
print(full_trans_db_plots)
```

```{r}
full_db_plots <- ggarrange(full_pers_db_plots, full_trans_db_plots, nrow = 2, ncol = 1)

#adjusting the labels so they are shared
full_db_plots <- annotate_figure(full_db_plots,
                                  left = textGrob("Temperature (°C)", gp = gpar(fontsize = 10), rot = 90),
                                  bottom = textGrob("Aspect", gp = gpar(fontsize = 10)))


full_db_plots
```

## Live Trees

```{r}
#making a daytime dataframe 
full_15min_ub_dt <- full_15min_gbdbub %>%
  filter(phase == "day") %>%
  select(datetime, day, month, phase, zone, aspect, ub_temp) %>%
  mutate(zone = case_when(
    zone == "persistent" ~ "PSZ", zone == "transitional" ~ "TSZ",
    TRUE ~ zone  # This line ensures other zones are preserved
  )) %>%
  mutate(burn_status = "live")

#parsing into zone dataframes
pers_full_15min_ub_dt <- full_15min_ub_dt %>%
  filter(zone == "PSZ")

#have to filter individually to add p-value to boxes
feb_pers_ub <- pers_full_15min_ub_dt %>%
  filter(month == "2")

march_pers_ub <- pers_full_15min_ub_dt %>%
  filter(month == "3")

april_pers_ub <- pers_full_15min_ub_dt %>%
  filter(month == "4")

may_pers_ub <- pers_full_15min_ub_dt %>%
  filter(month == "5")
  

trans_full_15min_ub_dt <- full_15min_ub_dt %>%
  filter(zone == "TSZ")

#have to filter individually to add p-value to boxes
feb_trans_ub <- trans_full_15min_ub_dt %>%
  filter(month == "2")

march_trans_ub <- trans_full_15min_ub_dt %>%
  filter(month == "3")

april_trans_ub <- trans_full_15min_ub_dt %>%
  filter(month == "4")

may_trans_ub <- trans_full_15min_ub_dt %>%
  filter(month == "5")
```

```{r}
#individual month plots
feb_pers_ub_plot <- ggplot(feb_pers_ub) + 
  geom_boxplot(aes(x = aspect, y = ub_temp, fill = aspect)) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  ylim(NA, 40) +
  theme_bw()

#adding p-value
feb_pers_ub_plot <- feb_pers_ub_plot + 
  annotate("text", x = 1, y = 35, label = "p = 0.000004", size = 3, color = "red3", fontface = "bold") + 
  theme(legend.position = "none") + 
  labs(x = NULL, y = NULL)

feb_pers_ub_plot
```

```{r}
march_pers_ub_plot <- ggplot(march_pers_ub) + 
  geom_boxplot(aes(x = aspect, y = ub_temp, fill = aspect)) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  ylim(NA, 40) +
  theme_bw()

#adding p-value
march_pers_ub_plot <- march_pers_ub_plot + 
  annotate("text", x = 1, y = 35, label = "p =0.0000007", size = 3, color = "red3", fontface = "bold") + 
  theme(legend.position = "none") + 
  labs(x = NULL, y = NULL)

march_pers_ub_plot
```

```{r}
april_pers_ub_plot <- ggplot(april_pers_ub) + 
  geom_boxplot(aes(x = aspect, y = ub_temp, fill = aspect)) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  ylim(NA, 40) +
  theme_bw()

#adding p-value
april_pers_ub_plot <- april_pers_ub_plot + 
  annotate("text", x = 1, y = 35, label = "p = 0.000323", size = 3, color = "red3", fontface = "bold") + 
  theme(legend.position = "none") + 
  labs(x = NULL, y = NULL)

april_pers_ub_plot
```

```{r}
may_pers_ub_plot <- ggplot(may_pers_ub) + 
  geom_boxplot(aes(x = aspect, y = ub_temp, fill = aspect)) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  ylim(NA, 40) +
  theme_bw()

#adding p-value
may_pers_ub_plot <- may_pers_ub_plot + 
  annotate("text", x = 1, y = 35, label = "p = 0.5082", size = 3, color = "black", fontface = "bold") + 
  theme(legend.position = "none") + 
  labs(x = NULL, y = NULL)

may_pers_ub_plot
```

```{r}
#combining individual month PSZ plots
full_pers_ub_plots <- ggarrange(feb_pers_ub_plot, march_pers_ub_plot, april_pers_ub_plot, may_pers_ub_plot, nrow = 1, ncol = 4)

full_pers_ub_plots
```

Transitional Zone

```{r}
feb_trans_ub_plot <- ggplot(feb_trans_ub) + 
  geom_boxplot(aes(x = aspect, y = ub_temp, fill = aspect), alpha = 0.6) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  ylim(NA, 40) +
  theme_bw()

#adding p-value
feb_trans_ub_plot <- feb_trans_ub_plot + 
  annotate("text", x = 1, y = 35, label = "p = 0.003518", size = 3, color = "red3", fontface = "bold") + 
  theme(legend.position = "none") + 
  labs(x = NULL, y = NULL)

feb_trans_ub_plot
```

```{r}
march_trans_ub_plot <- ggplot(march_trans_ub) + 
  geom_boxplot(aes(x = aspect, y = ub_temp, fill = aspect), alpha = 0.6) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  ylim(NA, 40) +
  theme_bw()

#adding p-value
march_trans_ub_plot <- march_trans_ub_plot + 
  annotate("text", x = 1, y = 35, label = "p = 0.000256", size = 3, color = "red3", fontface = "bold") + 
  theme(legend.position = "none") + 
  labs(x = NULL, y = NULL)

march_trans_ub_plot
```

```{r}
april_trans_ub_plot <- ggplot(april_trans_ub) + 
  geom_boxplot(aes(x = aspect, y = ub_temp, fill = aspect), alpha = 0.6) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  ylim(NA, 40) +
  theme_bw()

#adding p-value
april_trans_ub_plot <- april_trans_ub_plot + 
  annotate("text", x = 1, y = 35, label = "p = 0.000256", size = 3, color = "red3", fontface = "bold") + 
  theme(legend.position = "none") + 
  labs(x = NULL, y = NULL)

april_trans_ub_plot
```

```{r}
may_trans_ub_plot <- ggplot(may_trans_ub) + 
  geom_boxplot(aes(x = aspect, y = ub_temp, fill = aspect), alpha = 0.6) + 
  facet_wrap(~ zone + month) + 
  scale_fill_manual(
    values = c("north" = "#2166AC", "south" = "#D95F02"),
    name = "Aspect of Temp Sensor"  # Legend title
  ) + 
  labs(x = "Aspect", y = "Temperature (°C)") +
  ylim(NA, 40) +
  theme_bw()

#adding p-value
may_trans_ub_plot <- may_trans_ub_plot + 
  annotate("text", x = 1, y = 35, label = "p = 0.62080", size = 3, color = "black", fontface = "bold") + 
  theme(legend.position = "none") + 
  labs(x = NULL, y = NULL)

may_trans_ub_plot
```

```{r}
#combining individual month PSZ plots
full_trans_ub_plots <- ggarrange(feb_trans_ub_plot, march_trans_ub_plot, april_trans_ub_plot, may_trans_ub_plot, nrow = 1, ncol = 4)

full_trans_ub_plots
```

```{r}
#combining persistent and transitional zones
full_ub_plots <- ggarrange(full_pers_ub_plots, full_trans_ub_plots, nrow = 2, ncol = 1)

#adjusting the labels so they are shared
full_ub_plots <- annotate_figure(full_ub_plots,
                                  left = textGrob("Temperature (°C)", gp = gpar(fontsize = 10), rot = 90),
                                  bottom = textGrob("Aspect", gp = gpar(fontsize = 10)))

full_ub_plots
```

Full Combo

```{r}
gbdbub_combined_plot <- ggarrange(full_gb_plots, full_db_plots, full_ub_plots,
                            ncol = 1, nrow = 3,  # Stack in a single column
                            labels = c("a)", "b)", "c)"),  # Labeling the plots
                            font.label = list(size = 14, face = "bold"))

gbdbub_combined_plot
```

# LWout Scenarios

\*\* keep working on these scenarios!

1.  Apply T_tree to whole snow depth - snow depth is based on max snow depth from snow cameras at each burned/unburned site!

```{r}
#removing gb_w tree from persistent zone, and removing charred/uncharred temps, as this will just be N/S comparisons
full_sd_treeLWout <- filtered_all_aspects %>%
  #filtering out gb_w tree data
  filter(tree_name != "gb_w") %>%
  #filtering out charred/uncharred aspect
  filter(!aspect %in% c("charred", "uncharred")) %>%
  #adding in a Kelvin temp column
  rename(temp_C = temp) %>%
  mutate(temp_K = (temp_C + 273.15)) %>%
  #calculating LWout in Wperm^2 by burn_status
  mutate(LWout_wperm2 = emissivity * stefan_boltzmann_constant * (temp_K^4)) %>%
   # Define circ of each tree based on burn status
 mutate(tree_circ = case_when(
  zone == "PSZ" & burn_status == "green burn" ~ 0.4006,
  zone == "PSZ" & burn_status == "dead burn" ~ 0.5576,
  zone == "PSZ" & burn_status == "live" ~ 0.5027,
  zone == "TSZ" & burn_status == "green burn" ~ 0.5812,
  zone == "TSZ" & burn_status == "dead burn" ~ 0.5655,
  zone == "TSZ" & burn_status == "live" ~ 0.5341,
  TRUE ~ 0.5576
)) %>%
  #Defining m2
   mutate(m2 = snowcam_max_depth_m * tree_circ) %>%
  #calcuating Watz (power) - dividing by 2 here so that the only half the value is applied to the north/south aspects!
  mutate(
    Watz = LWout_wperm2 * (m2/2),
#converting from Wperm2 to MJ/day
    LWout_MJperd = Watz * 86400 / 1e6) %>%
  select(datetime, day, month, phase, zone, burn_status, aspect, tree_name, snowcam_max_depth_m, temp_C, temp_K, tree_circ, LWout_wperm2, m2, Watz, LWout_MJperd, everything())
```

1.  Linear to ground (GND = 0 C) - snow depth is based on max snow depth from snow cameras at each burned/unburned site!

    \*\* or should I just do a total of 1 meter for snow depth so I can capture the entire gradient at each site? Because trans_ub doesn't have much snowpack

```{r}
#create a separate snow depth based on snow depth from cameras

```

```{r}
# Constants
stefan_boltzmann_constant <- 5.67e-8
emissivity <- 0.97
#snowdepth and circumference are in meters
snowdepth <- 1
# circumference is taken from diameter at breast height 
p_db_circ <- 0.5576
p_gb_circ <- 0.4006
p_live_circ <- 0.5027
t_db_circ <- 0.5655
t_gb_circ <- 0.5812
t_live_circ <- 0.5341

#picking an average unit depth for snow depth of 1 meter
#constant for m2 - can adjust this if I want to change the snowdepth!
p_gb_m2 = snowdepth*p_gb_circ
p_db_m2 = snowdepth*p_db_circ
p_live_m2 = snowdepth*p_live_circ
t_gb_m2 = snowdepth*t_gb_circ
t_db_m2 = snowdepth*t_db_circ
t_live_m2 = snowdepth*t_live_circ
```

1.  Based on snow pit temperature gradient of snow?

```{r}
#loading in snow pit data to get snow temps
trans_b_transect_temps <- read_csv("nsf/nsf_snow_transects/transitional/trans_burned_transect_temps.csv") %>%
  mutate(date = as.Date(date, format=("%Y.%m.%d")))

trans_ub_transect_temps <- read_csv("nsf/nsf_snow_transects/transitional/trans_unburned_transect_temps.csv") %>%
  mutate(date = as.Date(date, format=("%Y.%m.%d")))
```

```{r}
#creating dataframes to use for temperature gradient
b_jan_tempg <- trans_b_transect_temps %>%
  filter(date == "2024-01-19") %>%
  #adding in a month column
  mutate(month = "1") %>%
  #getting mean temps of each pit per depth 
  group_by(date, month, depth_cm) %>%         # Group by depth
  summarize(mean_temp_c = mean(temp_c, na.rm = TRUE))

#creating dataframes to use for temperature gradient
ub_jan_tempg <- trans_ub_transect_temps %>%
  filter(date == "2024-01-19") %>%
  #adding in a month column
  mutate(month = "1") %>%
  #getting mean temps of each pit per depth 
  group_by(date, month, depth_cm) %>%         # Group by depth
  summarize(mean_temp_c = mean(temp_C, na.rm = TRUE))
```

```{r}
b_feb_tempg <- trans_b_transect_temps %>%
  filter(date == "2024-02-19") %>%
  #adding in a month column
  mutate(month = "2") %>%
  #getting mean temps of each pit per depth 
  group_by(date, month, depth_cm) %>%         # Group by depth
  summarize(mean_temp_c = mean(temp_c, na.rm = TRUE))

#creating dataframes to use for temperature gradient
ub_feb_tempg <- trans_ub_transect_temps %>%
  filter(date == "2024-02-19") %>%
  #adding in a month column
  mutate(month = "2") %>%
  #getting mean temps of each pit per depth 
  group_by(date, month, depth_cm) %>%         # Group by depth
  summarize(mean_temp_c = mean(temp_C, na.rm = TRUE))
```

```{r}
b_march_tempg <- trans_b_transect_temps %>%
  filter(date == "2024-03-20") %>%
  #adding in a month column
  mutate(month = "3") %>%
  #getting mean temps of each pit per depth 
  group_by(date, month, depth_cm) %>%         # Group by depth
  summarize(mean_temp_c = mean(temp_c, na.rm = TRUE))

ub_march_tempg <- trans_ub_transect_temps %>%
  filter(date == "2024-03-20") %>%
  #adding in a month column
  mutate(month = "3") %>%
  #getting mean temps of each pit per depth 
  group_by(date, month, depth_cm) %>%         # Group by depth
  summarize(mean_temp_c = mean(temp_C, na.rm = TRUE))
```

```{r}
b_april_tempg <- trans_b_transect_temps %>%
  filter(date == "2024-04-19") %>%
  #adding in a month column
  mutate(month = "4") %>%
  #getting mean temps of each pit per depth 
  group_by(date, month, depth_cm) %>%         # Group by depth
  summarize(mean_temp_c = mean(temp_c, na.rm = TRUE))

ub_april_tempg <- trans_ub_transect_temps %>%
  filter(date == "2024-04-19") %>%
  #adding in a month column
  mutate(month = "4") %>%
  #getting mean temps of each pit per depth 
  group_by(date, month, depth_cm) %>%         # Group by depth
  summarize(mean_temp_c = mean(temp_C, na.rm = TRUE))
```

```{r}
#combining the above averaged temps
##burned
t_b_tempg <- b_jan_tempg %>%
  full_join(b_feb_tempg) %>%
  full_join(b_march_tempg) %>%
  full_join(b_april_tempg)

t_ub_tempg <- ub_jan_tempg %>%
  full_join(ub_feb_tempg) %>%
  full_join(ub_march_tempg) %>%
  full_join(ub_april_tempg)
```

\*\* will need to get Dan's snowpit temps as well to apply these separately to the PSZ, as the snow depths will be significantly different between zones
