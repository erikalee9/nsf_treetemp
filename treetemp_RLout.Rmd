---
title: "treetemp_RLout"
output: html_document
date: "2024-10-21"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#initial set up
library(tidyverse)
library(lterdatasampler)
library(dplyr)
library(ggplot2)
library(readr)
library(readxl)
library(lubridate)
library(plotly)
library(openxlsx)
library(plotly)
library(rstatix)
library(htmlwidgets)
library(RColorBrewer)
library(patchwork)
#packages for exporting csvs as tables
library(knitr)
library(kableExtra)
library(pagedown)
library(ggpubr)
library(ggpattern)
library(patchwork)

setwd("/Volumes/wcnr-network/Research/Kampf/Private/field_data")
```

```{r}
#to clear prior environment
rm(list = ls())
```

# Loading Full Datasets

```{r}
p_b_solar_times <- read_csv("nsf/treetemp_data/p_b_solar_times.csv") %>%
  mutate(
    sunrise = as.POSIXct(sunrise, format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
    sunrise = with_tz(sunrise, tz = "MST")
  ) %>%
   mutate(
    sunset = as.POSIXct(sunset, format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
    sunset = with_tz(sunset, tz = "MST")
  )
```

```{r}
#new full dataframes to load - including burned and unburned/ all burn_status types together
full_15min_ns <- read_csv("nsf/treetemp_data/full_15min_ns.csv") %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = with_tz(datetime, tz = 'MST')) %>%
  mutate(day = as.Date(day, format = ("%Y-%m-%d"))) %>%
  #creating a phase column that parses by daily sunrise/sunset times
  inner_join(p_b_solar_times, by = "day") %>%
  mutate(
    phase = case_when(
      datetime >= sunrise & datetime < sunset ~ "day",
      datetime < sunrise ~ "night",
      datetime >= sunset ~ "night",
      TRUE ~ NA_character_)) %>%
  select(datetime, day, month, phase, zone, snow_phase, burn_status, north_temp, south_temp, ns_avg_temp, solarNoon, sunrise, sunset, dawn, dusk)

full_15min_gbdbub <- read_csv("nsf/treetemp_data/full_15min_gbdbub.csv") %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = with_tz(datetime, tz = 'MST')) %>%
  mutate(day = as.Date(day, format = ("%Y-%m-%d"))) %>%
  inner_join(p_b_solar_times, by = "day") %>%
  #creating a phase column that parses by daily sunrise/sunset times
  mutate(
    phase = case_when(
      datetime >= sunrise & datetime < sunset ~ "day",
      datetime < sunrise ~ "night",
      datetime >= sunset ~ "night",
      TRUE ~ NA_character_)) %>%
  select(datetime, day, month, phase, zone, snow_phase, aspect, gb_temp, db_temp, ub_temp, solarNoon, sunrise, sunset, dawn, dusk)

full_hourly_gbdbub <- read_csv("nsf/treetemp_data/full_hourly_gbdbub.csv") %>%
  mutate(datetime_hour = as.POSIXct(datetime_hour, format=("%Y-%m-%d %H:%M:%S")),
                               datetime_hour = with_tz(datetime_hour, tz = 'MST')) %>%
  mutate(day = as.Date(day, format = ("%Y-%m-%d")))

full_hourly_ns <- read_csv("nsf/treetemp_data/full_hourly_ns.csv") %>%
 mutate(
    datetime_hour = as.POSIXct(datetime_hour, format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
    datetime_hour = force_tz(datetime_hour, tz = "MST")
  ) %>%
  mutate(day = as.Date(day, format = "%Y-%m-%d"))

full_hourly_gb <- read_csv("nsf/treetemp_data/full_hourly_gb.csv") %>%
  mutate(
    datetime_hour = as.POSIXct(datetime_hour, format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
    datetime_hour = force_tz(datetime_hour, tz = "MST")
  ) %>%
  mutate(day = as.Date(day, format = "%Y-%m-%d"))
```

Snow Camera Depth Data

```{r}
transb_snowcamera_data <- read_csv("nsf/camera_snowdepths/2024_105E_transb_snowdepths.csv") %>%
  rename(snowcam_max_depth_cm = "maximum_depth(cm)") %>%
  mutate(date = as.Date(date)) %>%
  #adjusting the treewell developed column to just yes/no
  mutate(treewell_developed = case_when(
    treewell_developed == "maybe" ~ "yes",
    treewell_developed == "no snow" ~ "no",
    TRUE ~ treewell_developed  # keep other values unchanged
  )) %>%
  mutate(snowcam_max_depth_m = snowcam_max_depth_cm/100) %>%
  #filtering to timerange for these plots
  filter(date >= as.Date("2024-02-02") & date < as.Date("2024-07-01")) %>%
  mutate(zone = "TSZ")

persb_snowcamera_data <- read_csv("nsf/camera_snowdepths/2024_persb_lp_highmort_east_snowdepths.csv") %>%
  rename(snowcam_max_depth_cm = "max_depth_cm") %>%
  mutate(date = as.Date(date)) %>%
  rename(treewell_developed = treewell_developement) %>%
  mutate(treewell_developed = case_when(
    treewell_developed == "maybe" ~ "yes",
    treewell_developed == "no snow" ~ "no",
    TRUE ~ treewell_developed  # keep other values unchanged
  )) %>%
  mutate(snowcam_max_depth_m = snowcam_max_depth_cm/100) %>%
  #filtering to timerange for these plots
  filter(date >= as.Date("2024-02-02") & date < as.Date("2024-07-01")) %>%
  mutate(zone = "PSZ")

persub_snowcamera_data_r <- read_csv("nsf/pers_unburned/pers_unburned_wx_hourly_r.csv")

#editing the pers_ub_snowcamera_data 
persub_snowcamera_data <- persub_snowcamera_data_r %>%
  mutate(datetime_MST = as.POSIXct(datetime, tz = "MST")) %>%
  select(datetime_MST, AirTC_Avg, SnowDepth_m) %>%
  rename(datetime = datetime_MST, snowcam_max_depth_m = SnowDepth_m) %>%
  mutate(date = as.Date(datetime), zone = "PSZ") %>%
  # Expand to 15-minute intervals
  rowwise() %>%
  mutate(datetime_15min = list(seq(datetime, datetime + 45 * 60, by = "15 mins"))) %>%
  unnest(datetime_15min) %>%
  select(datetime = datetime_15min, AirTC_Avg, snowcam_max_depth_m, date, zone) %>%
  filter(datetime >= as.Date("2024-02-02 00:00:00") & datetime < as.Date("2024-07-01 00:00:00"))

transub_snowcamera_data <- read_csv("nsf/camera_snowdepths/2024_105E_transub_snowdepths.csv") %>%
  mutate(snowcam_max_depth_m = max_depth_cm/100) %>%
  #filtering to timerange for these plots
  filter(date >= as.Date("2024-02-02") & date < as.Date("2024-07-01")) %>%
  mutate(zone = "TSZ")
```

```{r}
#datasets for only snowcamera depths, to join with below datasets
filtered_transb_snowcamdepths <- transb_snowcamera_data %>%
  select(date, snowcam_max_depth_m) %>%
  mutate(zone = "TSZ") %>%
  expand_grid(burn_status = c("green burn", "dead burn")) %>%
  rename(day = date)

filtered_persb_snowcamdepths <- persb_snowcamera_data %>%
  select(date, snowcam_max_depth_m) %>%
  mutate(zone = "PSZ") %>%
  expand_grid(burn_status = c("green burn", "dead burn")) %>%
  rename(day = date)

filtered_transub_snowcamdepths <- transub_snowcamera_data %>%
  select(date, snowcam_max_depth_m) %>%
  mutate(zone = "TSZ", burn_status = "live") %>%
  rename(day = date)

filtered_persub_snowcamdepths <- persub_snowcamera_data %>%
  #because I am pulling this data from the weather station, I have to calculate an average daily value for snow depth
  group_by(date) %>%
  summarize(snowcam_max_depth_m = mean(snowcam_max_depth_m)) %>%
  select(date, snowcam_max_depth_m) %>%
  mutate(zone = "PSZ", burn_status = "live") %>%
  rename(day = date)
```

```{r}
#making a combined snowcamera depths dataframe
full_snowcamdepths <- rbind(filtered_persb_snowcamdepths, filtered_transb_snowcamdepths, filtered_persub_snowcamdepths, filtered_transub_snowcamdepths) %>%
  #making it so that there is never a zero in the snowdepth column, to see if this fixes my issues with NAs
  mutate(snowcam_max_depth_m = if_else(snowcam_max_depth_m == 0, 0.001, snowcam_max_depth_m))
```

Full Aspect Datasets, with all trees

```{r}
filtered_pers_b_aspects_r <- read_csv("nsf/treetemp_data/filtered_pers_b_aspects_r.csv") %>%
  select(-sensor_id) %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = force_tz(datetime, tz = 'MST')) %>%
  filter(datetime >= "2024-02-02 00:00:00")

filtered_pers_ub_aspects_r <- read_csv("nsf/treetemp_data/filtered_pers_ub_aspects_r.csv") %>%
  select(-sensor_id) %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = force_tz(datetime, tz = 'MST')) %>%
  filter(datetime >= "2024-02-02 00:00:00")

filtered_trans_b_aspects_r <- read_csv("nsf/treetemp_data/filtered_trans_b_aspects_r.csv") %>%
  select(-sensor_id) %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = force_tz(datetime, tz = 'MST')) %>%
  filter(datetime >= "2024-02-02 00:00:00")

filtered_trans_ub_aspects_r <- read_csv("nsf/treetemp_data/filtered_trans_ub_aspects_r.csv") %>%
  select(-sensor_id) %>%
  mutate(datetime = as.POSIXct(datetime, format=("%Y-%m-%d %H:%M:%S")),
                               datetime = force_tz(datetime, tz = 'MST')) %>%
  filter(datetime >= "2024-02-02 00:00:00")
```

```{r}
#adding in snow depth to 15-minute datetime columns of above dataset
filtered_pers_b_aspects_snowdepth <- filtered_pers_b_aspects_r %>%
  left_join(filtered_persb_snowcamdepths, by = c("day", "burn_status", "zone")) %>%
  replace_na(list(snowcam_max_depth_m = 0)) %>%
  mutate(snowcam_max_depth_m = if_else(snowcam_max_depth_m == 0, 0.001, snowcam_max_depth_m))

filtered_pers_ub_aspects_snowdepth <- filtered_pers_ub_aspects_r %>%
  left_join(filtered_persub_snowcamdepths, by = c("day", "burn_status", "zone")) %>%
  replace_na(list(snowcam_max_depth_m = 0)) %>%
  mutate(snowcam_max_depth_m = if_else(snowcam_max_depth_m == 0, 0.001, snowcam_max_depth_m))

filtered_trans_b_aspects_snowdepth <- filtered_trans_b_aspects_r %>%
  left_join(filtered_transb_snowcamdepths, by = c("day", "burn_status", "zone")) %>%
  replace_na(list(snowcam_max_depth_m = 0)) %>%
  mutate(snowcam_max_depth_m = if_else(snowcam_max_depth_m == 0, 0.001, snowcam_max_depth_m))

filtered_trans_ub_aspects_snowdepth <- filtered_trans_ub_aspects_r %>%
  left_join(filtered_transub_snowcamdepths, by = c("day", "burn_status", "zone")) %>%
  replace_na(list(snowcam_max_depth_m = 0)) %>%
  mutate(snowcam_max_depth_m = if_else(snowcam_max_depth_m == 0, 0.001, snowcam_max_depth_m))
```

```{r}
#creating a combined dataset for these? 
filtered_all_aspects_snowdepths <- rbind(filtered_pers_b_aspects_snowdepth, filtered_pers_ub_aspects_snowdepth, filtered_trans_b_aspects_snowdepth, filtered_trans_ub_aspects_snowdepth)

#crearing a north/south only so that I can join the snow depths with other data for scenarios
filtered_ns_aspects_snowdepths <- filtered_all_aspects_snowdepths %>%
  filter(aspect %in% c("north", "south"))
```

# LWout Calculations

\*\* when applying the actual snow depths to these equations, it makes the m2 value be zero if there is no snow, which is not technically accurate. what to do about this? I set any 0 value to 0.001, to keep consistent value for m2, is that okay?

## Setting Constants

```{r}
#pulling in dataframe that has tree circumference data by site
treecirc_data <- read_csv("nsf/treetemp_data/105E_treecirc_data.csv")
```

Constants

```{r}
# Constants
stefan_boltzmann_constant <- 5.67e-8
emissivity <- 0.97
#snowdepth and circumference are in meters
snowdepth <- 1
# circumference is taken from diameter at breast height 
p_db_circ <- 0.5576
p_gb_circ <- 0.4006
p_live_circ <- 0.5027
t_db_circ <- 0.5655
t_gb_circ <- 0.5812
t_live_circ <- 0.5341

#picking an average unit depth for snow depth of 1 meter
#constant for m2 - can adjust this if I want to change the snowdepth!
p_gb_m2 = snowdepth*p_gb_circ
p_db_m2 = snowdepth*p_db_circ
p_live_m2 = snowdepth*p_live_circ
t_gb_m2 = snowdepth*t_gb_circ
t_db_m2 = snowdepth*t_db_circ
t_live_m2 = snowdepth*t_live_circ
```

## LWout Calcs

Full Aspect Calculations

```{r}
#removing gb_w tree from persistent zone, and removing charred/uncharred temps, as this will just be N/S comparisons
filtered_all_ns_LWout <- filtered_all_aspects_snowdepths%>%
  #filtering out gb_w tree data
  filter(tree_name != "gb_w") %>%
  #filtering out charred/uncharred aspect
  filter(!aspect %in% c("charred", "uncharred")) %>%
  #adding in a Kelvin temp column
  rename(temp_C = temp) %>%
  mutate(temp_K = (temp_C + 273.15)) %>%
  #calculating LWout in Wperm^2 by burn_status
  mutate(LWout_wperm2 = emissivity * stefan_boltzmann_constant * (temp_K^4)) %>%
  # Define m2 based on zone
 mutate(tree_circ = case_when(
  zone == "PSZ" & burn_status == "green burn" ~ 0.4006,
  zone == "PSZ" & burn_status == "dead burn" ~ 0.5576,
  zone == "PSZ" & burn_status == "live" ~ 0.5027,
  zone == "TSZ" & burn_status == "green burn" ~ 0.5812,
  zone == "TSZ" & burn_status == "dead burn" ~ 0.5655,
  zone == "TSZ" & burn_status == "live" ~ 0.5341,
  TRUE ~ 0.5576
)) %>%
  #calcuating Watz (power) - dividing by 2 here so that the only half the value is applied to the north/south aspects!
  mutate(
    Watz = LWout_wperm2 * ((tree_circ*snowcam_max_depth_m)/2),
#converting from Wperm2 to MJ/day
    LWout_MJperd = Watz * 86400 / 1e6) %>%
  select(datetime, day, month, phase, zone, burn_status, aspect, tree_name, temp_C, temp_K, LWout_wperm2, tree_circ, snowcam_max_depth_m, Watz, LWout_MJperd, everything())
```

Full_15min_NS

```{r}
#combining snow depths with ns dataframe
full_15min_ns <- full_15min_ns %>%
   mutate(zone = case_when(
    zone == "persistent" ~ "PSZ",
    zone == "transitional" ~ "TSZ",
    TRUE ~ zone  # Keep other values unchanged
  )) %>%
  left_join(full_snowcamdepths, by = c("day", "zone", "burn_status"))
```

```{r}
#full_15min_ns
##converting temps in OG dataset to K from C
full_15min_ns_K <- full_15min_ns %>%
  mutate(north_temp_k = (north_temp + 273.15), south_temp_k = (south_temp + 273.15), ns_avg_temp_k = (ns_avg_temp + 273.15)) %>%
  mutate(zone = case_when(
    zone == "persistent" ~ "PSZ",
    zone == "transitional" ~ "TSZ",
    TRUE ~ zone  # Retain original value if no match
  ))
```

```{r}
#LWout calcs
full_15min_ns_LWout <- full_15min_ns_K %>%
  mutate(
    # Calculate longwave radiation in Wperm^2
    n_LWout_wperm2 = emissivity * stefan_boltzmann_constant * (north_temp_k^4), s_LWout_wperm2 = emissivity * stefan_boltzmann_constant * (south_temp_k^4)
  ) %>%
  #setting a case_when to vary the circumference/snow depth measurement by tree burn status and zone
  mutate(tree_circ = case_when(
      burn_status == "green burn" & zone == "PSZ" ~ 0.4006,   # Example value for burned in north zone
      burn_status == "dead burn" & zone == "PSZ" ~ 0.5576,   # Example value for burned in south zone
      burn_status == "live" & zone == "PSZ" ~ 0.5027,
      burn_status == "green burn" & zone == "TSZ" ~ 0.5812,   # Example value for burned in north zone
      burn_status == "dead burn" & zone == "TSZ" ~ 0.5655,   # Example value for burned in south zone
      burn_status == "live" & zone == "TSZ" ~ 0.5341,
      TRUE ~ 0.4006  # Default value if neither of the conditions match
    ),
#calcuating Watz (power) - dividing tree circ/snowcam depths by 2 for the north/south aspect differences as we assume that the area is only 1/2 the tree by aspect
    n_W =  n_LWout_wperm2 * ((tree_circ*snowcam_max_depth_m)/2),
    s_W =  s_LWout_wperm2 * ((tree_circ*snowcam_max_depth_m)/2),
#converting from Wperm2 to MJ/day
    n_LWout_MJperd = n_W * 86400 / 1e6, 
s_LWout_MJperd = s_W * 86400 / 1e6) 
```

Full_Hourly_NS

-   these have NAs for PSZ live data later in the season, not sure why but make sure to use 15minute time step instead of hourly

```{r}
#full_15min_ns
full_hourly_ns_K <- full_hourly_ns %>%
  mutate(north_temp_k = (north_temp + 273.15), south_temp_k = (south_temp + 273.15), ns_avg_temp_k = (ns_avg_temp + 273.15)) %>%
  mutate(zone = case_when(
    zone == "persistent" ~ "PSZ",
    zone == "transitional" ~ "TSZ",
    TRUE ~ zone  # Retain original value if no match
  )) %>%
  left_join(full_snowcamdepths, by = c("day", "zone", "burn_status"))
```

```{r}
#LWout calcs
full_hourly_ns_LWout <- full_hourly_ns_K %>%
  mutate(
    # Calculate longwave radiation in Wperm^2
    n_LWout_wperm2 = emissivity * stefan_boltzmann_constant * (north_temp_k^4), s_LWout_wperm2 = emissivity * stefan_boltzmann_constant * (south_temp_k^4)
  ) %>%
  #setting a case_when to vary the circumference/snow depth measurement by tree burn status and zone
  mutate(tree_circ = case_when(
      burn_status == "green burn" & zone == "PSZ" ~ 0.4006,   # Example value for burned in north zone
      burn_status == "dead burn" & zone == "PSZ" ~ 0.5576,   # Example value for burned in south zone
      burn_status == "live" & zone == "PSZ" ~ 0.5027,
      burn_status == "green burn" & zone == "TSZ" ~ 0.5812,   # Example value for burned in north zone
      burn_status == "dead burn" & zone == "TSZ" ~ 0.5655,   # Example value for burned in south zone
      burn_status == "live" & zone == "TSZ" ~ 0.5341,
      TRUE ~ 0.4006  # Default value if neither of the conditions match
    ),
#calcuating Watz (power) - dividing tree circ/snow depths by 2 for the north/south aspect differences as we assume that the area is only 1/2 the tree by aspect
     n_W =  n_LWout_wperm2 * ((tree_circ*snowcam_max_depth_m)/2),
    s_W =  s_LWout_wperm2 * ((tree_circ*snowcam_max_depth_m)/2),
#converting from Wperm2 to MJ/day
    n_LWout_MJperd = n_W * 86400 / 1e6, 
s_LWout_MJperd = s_W * 86400 / 1e6)
```

Full 15min GBDBUB

```{r}
#making a different dataframe that has gb_snowdepth, db_snowdepth & ub_snowdepths - pivoted wide, not long
gbdbub_snowcamdepths <- full_snowcamdepths %>%
  pivot_wider(names_from = burn_status, values_from = snowcam_max_depth_m) %>%
  rename(gb_snowdepth_m = "green burn", db_snowdepth_m = "dead burn", live_snowdepth_m = "live")
```

```{r}
full_15min_gbdbub_K <- full_15min_gbdbub %>%
  mutate(gb_temp_k = (gb_temp + 273.15), db_temp_k = (db_temp + 273.15), ub_temp_k = (ub_temp + 273.15)) %>%
  mutate(zone = case_when(
    zone == "persistent" ~ "PSZ",
    zone == "transitional" ~ "TSZ",
    TRUE ~ zone  # Retain original value if no match
  )) %>%
  #adding snowdepths
  left_join(gbdbub_snowcamdepths, by = c("day", "zone"))
```

```{r}
#LWout calcs
full_15min_gbdbub_LWout <- full_15min_gbdbub_K %>%
  #calculating LWout in Wperm^2 by burn_status
  mutate(gb_LWout_wperm2 = emissivity * stefan_boltzmann_constant * (gb_temp_k^4), db_LWout_wperm2 = emissivity * stefan_boltzmann_constant * (db_temp_k^4), ub_LWout_wperm2 = emissivity * stefan_boltzmann_constant * (ub_temp_k^4)) %>%
  # Define m2 based on zone
    mutate(gb_tree_circ = case_when(zone == "persistent" ~ 0.4006,
zone == "transitional" ~ 0.5812, TRUE ~ 0.4006), db_tree_circ = case_when(zone == "persistent" ~ 0.5576, zone == "transitional" ~ 0.5655, TRUE ~ 0.5576), ub_tree_circ = case_when(zone == "persistent" ~ 0.5027, zone == "transitional" ~ 0.5341, TRUE ~ 0.5576)) %>%
  #calcuating Watz (power)
  mutate(
    gb_W = gb_LWout_wperm2 * ((gb_tree_circ*gb_snowdepth_m)/2),
    db_W =  db_LWout_wperm2 * ((db_tree_circ*db_snowdepth_m)/2),
    ub_W =  ub_LWout_wperm2 * ((ub_tree_circ*live_snowdepth_m)/2),
#converting from Wperm2 to MJ/day
    gb_LWout_MJperd = gb_W * 86400 / 1e6, 
db_LWout_MJperd = db_W * 86400 / 1e6, ub_LWout_MJperd = ub_W * 86400 / 1e6)
```

Full Hourly GB

```{r}
full_hourly_gb_K <- full_hourly_gb %>%
  mutate(north_temp_k = (north_temp + 273.15), south_temp_k = (south_temp + 273.15), charred_temp_k = (charred_temp + 273.15), uncharred_temp_k = (uncharred_temp + 273.15)) %>%
  mutate(zone = case_when(
    zone == "persistent" ~ "PSZ",
    zone == "transitional" ~ "TSZ",
    TRUE ~ zone  # Retain original value if no match
  )) %>%
  left_join(full_snowcamdepths, by = c("day", "zone", "burn_status"))
```

Exporting above LWout dataframes

```{r}
#exporting above tree_LWout datasets to nsf/treetemp folder
write.csv(full_15min_gbdbub_LWout, "nsf/treetemp_data/full_15min_gbdbub_LWout.csv")

write.csv(full_15min_ns_LWout, "nsf/treetemp_data/full_15min_ns_LWout.csv")
```

\*\* use the above LWout dataframes when calculating stats!

# Daily Mean Datasets

-   taking the 15-minute datasets and making daily mean datasets with day/night phase means

-   Then doing an accumulation dataset for each day

```{r}
#adding in phase because it somehow disappeared from dataframe? 
p_b_solar_times <- read_csv("nsf/treetemp_data/p_b_solar_times.csv") %>%
  mutate(sunrise - as.POSIXct(sunrise, tz = "MST"))
```

```{r}
## use this dataset if I want to plot daily mean values!
full_daily_ns_LWout <- full_15min_ns_LWout %>%
  mutate(
    phase = case_when(
      datetime >= sunrise & datetime < sunset ~ "day",
      datetime < sunrise ~ "night",
      datetime >= sunset ~ "night",
      TRUE ~ NA_character_)) %>%
  group_by(day, month, phase, zone, burn_status) %>%
  summarize(north_temp = mean(north_temp), south_temp = mean(south_temp), ns_avg_temp = mean(ns_avg_temp), n_LWout_wperm2 = mean(n_LWout_wperm2), s_LWout_wperm2 = mean(s_LWout_wperm2), n_LWout_MJperd = mean(n_LWout_MJperd), s_LWout_MJperd = mean(s_LWout_MJperd))
```

```{r}
#creating an accumulation dataframe
## use this dataset if I want to plot cumulative values!
cum_full_daily_ns_LWout <- full_daily_ns_LWout %>%
  group_by(zone, burn_status) %>%  # Group by zone and burn_status
  mutate(accu_daily_n_LWout_MJperd = cumsum(n_LWout_MJperd), accu_daily_s_LWout_MJperd = cumsum(s_LWout_MJperd)) %>%
  select(day, month, phase, zone, burn_status, accu_daily_n_LWout_MJperd, accu_daily_s_LWout_MJperd)
```

```{r}
#exporting above data
write_csv(cum_full_daily_ns_LWout, "nsf/treetemp_data/cum_full_daily_ns_treeLWout.csv")

write_csv(full_daily_ns_LWout, "nsf/treetemp_data/full_daily_ns_treeLWout.csv")
```

```{r}
#creating zone specific n_s dataframes from accumulation dataframe - DAY ONLY ASSESSMENT
accu_pers_dt_ns_LWout <- accu_full_daily_ns_LWout %>%
  filter(zone == "PSZ", phase == "day")

accu_trans_dt_ns_LWout <- accu_full_daily_ns_LWout %>%
  filter(zone == "TSZ", phase == "day")
```

```{r}
#pers plot
accum_pers_dt_ns_plot <- ggplot(data = accu_pers_dt_ns_LWout) +
  geom_line(aes(x = day, y = accu_daily_n_LWout_MJperd), color = "black") +
  geom_line(aes(x = day, y = accu_daily_s_LWout_MJperd), color = "red") +
  facet_wrap(~zone + burn_status + phase)

accum_pers_dt_ns_plot
```

```{r}
#trans plot
accum_trans_dt_ns_plot <- ggplot(data = accu_trans_dt_ns_LWout) +
  geom_line(aes(x = day, y = accu_daily_n_LWout_MJperd), color = "black") +
  geom_line(aes(x = day, y = accu_daily_s_LWout_MJperd), color = "red") +
  facet_wrap(~zone + burn_status + phase)

accum_trans_dt_ns_plot
```

```{r}
#full plot for daytime values that is only face-wrapped by burn_status and zone
## USE THIS DATAFRAME
accu_pers_dt_ns_LWout <- accu_full_daily_ns_LWout %>%
  filter(phase == "day") %>%
  mutate(zone = case_when(
    zone == "persistent" ~ "PSZ",
    zone == "transitional" ~ "TSZ",
    TRUE ~ zone  # Keep the original value if it's neither "persistent" nor "transitional"
  ))
```

```{r}
##use this plot!
#persistent
accu_pers_dt_ns_plot <- ggplot(data = accu_pers_dt_ns_LWout) + 
  geom_line(aes(x = day, y = accu_daily_s_LWout_MJperd, color = "south")) +
  geom_line(aes(x = day, y = accu_daily_n_LWout_MJperd, color = "north"), linetype = "dashed", alpha = 0.9) + 
  facet_wrap(~burn_status) +
  theme_bw() +
  labs(
    title = "a) PSZ",
    x = NULL,
    y = "Daily Accumulated LWout (MJ)",
    color = "Aspect"  # Legend title
  ) +
  scale_color_manual(values = c("north" = "gray25", "south" = "#D95F02"))

accu_pers_dt_ns_plot
```

```{r}
#persistent
accu_trans_dt_ns_plot <- ggplot(data = accu_trans_dt_ns_LWout) + 
  geom_line(aes(x = day, y = accu_daily_s_LWout_MJperd, color = "south")) +
  geom_line(aes(x = day, y = accu_daily_n_LWout_MJperd, color = "north"), linetype = "dashed", alpha = 0.9) + 
  facet_wrap(~burn_status) +
  theme_bw() +
  labs(
    title = "b) TSZ",
    x = "Date",
    y = "Daily Cumulative LWout (MJ)",
    color = "Aspect"  # Legend title
  ) +
  scale_color_manual(values = c("north" = "gray25", "south" = "#D95F02"))

accu_trans_dt_ns_plot
```

```{r}
#combined final dataframe
accu_comb_dt_ns_plot <- ggarrange(accu_pers_dt_ns_LWout, accu_trans_dt_ns_LWout, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")
```

GBDBUB Dataframe

```{r}
## use this dataset if I want to plot daily mean values!
full_daily_gbdbub_LWout <- full_15min_gbdbub_LWout %>%
  inner_join(p_b_solar_times, by = "day") %>%
  #making sunrise/sunset columns correct timezone
   mutate(
    sunrise = as.POSIXct(sunrise, format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
    sunrise = with_tz(sunrise, tz = "MST")
  ) %>%
   mutate(
    sunset = as.POSIXct(sunset, format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
    sunset = with_tz(sunset, tz = "MST")
  ) %>%
  mutate(
    phase = case_when(
      datetime >= sunrise & datetime < sunset ~ "day",
      datetime < sunrise ~ "night",
      datetime >= sunset ~ "night",
      TRUE ~ NA_character_)) %>%
  group_by(day, month, phase, zone, aspect) %>%
  summarize(gb_temp = mean(gb_temp), db_temp = mean(db_temp), ub_temp = mean(ub_temp), gb_LWout_wperm2 = mean(gb_LWout_wperm2), db_LWout_wperm2 = mean(db_LWout_wperm2), ub_LWout_wperm2 = mean(ub_LWout_wperm2), gb_LWout_MJperd = mean(gb_LWout_MJperd), db_LWout_MJperd = mean(db_LWout_MJperd), ub_LWout_MJperd = mean(ub_LWout_MJperd)) %>%
  drop_na()
```

```{r}
#accumulation dataframe
cum_full_daily_gbdbub_LWout <- full_daily_gbdbub_LWout %>%
  group_by(zone, aspect) %>%  # Group by zone and aspect
  mutate(accu_daily_gb_LWout_MJperd = cumsum(gb_LWout_MJperd), accu_daily_db_LWout_MJperd = cumsum(db_LWout_MJperd), accu_daily_ub_LWout_MJperd = cumsum(ub_LWout_MJperd)) %>%
  select(day, month, phase, zone, aspect, accu_daily_gb_LWout_MJperd, accu_daily_db_LWout_MJperd, accu_daily_ub_LWout_MJperd)

#use this dataframe for final plotting
accu_dt_gbdbub_LWout <- accu_full_daily_gbdbub_LWout %>%
  filter(phase == "day") %>%
  mutate(zone = case_when(
    zone == "persistent" ~ "PSZ",
    zone == "transitional" ~ "TSZ",
    TRUE ~ zone  # Keep the original value if it's neither "persistent" nor "transitional"
  ))

p_accu_dt_gbdbub_LWout <- accu_dt_gbdbub_LWout %>%
  filter(zone == "PSZ")

t_accu_dt_gbdbub_LWout <- accu_dt_gbdbub_LWout %>%
  filter(zone == "TSZ")
```

```{r}
#exporting above dataframes 
#exporting above data
write_csv(cum_full_daily_gbdbub_LWout, "nsf/treetemp_data/cum_full_daily_gbdbub_treeLWout.csv")

write_csv(full_daily_gbdbub_LWout, "nsf/treetemp_data/full_daily_gbdbub_treeLWout.csv")
```

```{r}
#persistent 
p_cum_dt_gbdbub_plot <- ggplot(data = p_accu_dt_gbdbub_LWout) +
  geom_line(aes(x = day, y = accu_daily_gb_LWout_MJperd, color = "green burn", linetype = aspect), linewidth = 0.6) +  
  geom_line(aes(x = day, y = accu_daily_db_LWout_MJperd, color = "dead burn", linetype = aspect), linewidth = 0.6) +
  geom_line(aes(x = day, y = accu_daily_ub_LWout_MJperd, color = "live", linetype = aspect), linewidth = 0.6) +
  facet_wrap(~aspect, dir = "h") +
  theme_bw() +
  labs(title = "a) PSZ", 
    x = NULL,
    y = "Daily Cumulative LWout (MJ)",
    color = "Burn Status", 
    linetype = "Aspect"
  ) +
  scale_color_manual(values = c("green burn" = "#1B7837", "dead burn" = "#D95F02", "live" = adjustcolor("#2166AC", alpha = 0.7))) +
  scale_linetype_manual(values = c("north" = "dashed", "south" = "solid"))

p_cum_dt_gbdbub_plot
```

```{r}
#transitional
t_cum_dt_gbdbub_plot <- ggplot(data = t_accu_dt_gbdbub_LWout) +
  geom_line(aes(x = day, y = accu_daily_gb_LWout_MJperd, color = "green burn", linetype = aspect), linewidth = 0.6) +  
  geom_line(aes(x = day, y = accu_daily_db_LWout_MJperd, color = "dead burn", linetype = aspect), linewidth = 0.6) +
  geom_line(aes(x = day, y = accu_daily_ub_LWout_MJperd, color = "live", linetype = aspect), linewidth = 0.6) +
  facet_wrap(~aspect, dir = "h") +
  theme_bw() +
  labs(title = "b) TSZ", 
    x = "Date",
    y = "Daily Cumulative LWout (MJ)",
    color = "Burn Status", 
    linetype = "Aspect"
  ) +
  scale_color_manual(values = c("green burn" = "#1B7837", "dead burn" = "#D95F02", "live" = adjustcolor("#2166AC", alpha = 0.7))) +
  scale_linetype_manual(values = c("north" = "dashed", "south" = "solid"))

t_cum_dt_gbdbub_plot
```

```{r}
cum_full_daily_treeLWout <- ggarrange(p_cum_dt_gbdbub_plot, t_cum_dt_gbdbub_plot, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")

cum_full_daily_treeLWout
```

```{r}
#making a daytime dataframe 
##gb
full_15min_gb_dt <- full_15min_gbdbub %>%
  inner_join(p_b_solar_times, by = "day") %>%
  #making sunrise/sunset columns correct timezone
   mutate(
    sunrise = as.POSIXct(sunrise, format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
    sunrise = with_tz(sunrise, tz = "MST")
  ) %>%
   mutate(
    sunset = as.POSIXct(sunset, format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
    sunset = with_tz(sunset, tz = "MST")
  ) %>%
  mutate(
    phase = case_when(
      datetime >= sunrise & datetime < sunset ~ "day",
      datetime < sunrise ~ "night",
      datetime >= sunset ~ "night",
      TRUE ~ NA_character_)) %>%
  filter(phase == "day") %>%
  select(datetime, day, month, phase, zone, aspect, gb_temp) %>%
  mutate(zone = case_when(
    zone == "persistent" ~ "PSZ", zone == "transitional" ~ "TSZ",
    TRUE ~ zone  # This line ensures other zones are preserved
  )) %>%
  mutate(burn_status = "green burn")

##db
full_15min_db_dt <- full_15min_gbdbub %>%
  filter(phase == "day") %>%
  select(datetime, day, month, phase, zone, aspect, db_temp) %>%
  mutate(zone = case_when(
    zone == "persistent" ~ "PSZ", zone == "transitional" ~ "TSZ",
    TRUE ~ zone  # This line ensures other zones are preserved
  )) %>%
  mutate(burn_status = "dead burn")

##db
full_15min_ub_dt <- full_15min_gbdbub %>%
  filter(phase == "day") %>%
  select(datetime, day, month, phase, zone, aspect, ub_temp) %>%
  mutate(zone = case_when(
    zone == "persistent" ~ "PSZ", zone == "transitional" ~ "TSZ",
    TRUE ~ zone  # This line ensures other zones are preserved
  )) %>%
  mutate(burn_status = "live")
```

```{r}

#parsing into zone dataframes
pers_full_15min_gb_dt <- full_15min_gb_dt %>%
  filter(zone == "PSZ")

#have to filter individually to add p-value to boxes
feb_pers_gb <- pers_full_15min_gb_dt %>%
  filter(month == "2")

march_pers_gb <- pers_full_15min_gb_dt %>%
  filter(month == "3")

april_pers_gb <- pers_full_15min_gb_dt %>%
  filter(month == "4")

may_pers_gb <- pers_full_15min_gb_dt %>%
  filter(month == "5")
  

trans_full_15min_gb_dt <- full_15min_gb_dt %>%
  filter(zone == "TSZ")

#have to filter individually to add p-value to boxes
feb_trans_gb <- trans_full_15min_gb_dt %>%
  filter(month == "2")

march_trans_gb <- trans_full_15min_gb_dt %>%
  filter(month == "3")

april_trans_gb <- trans_full_15min_gb_dt %>%
  filter(month == "4")

may_trans_gb <- trans_full_15min_gb_dt %>%
  filter(month == "5")
```

Combined Simple Plot with PSZ and TSZ on the same plots!

```{r}
#GB N/S Trees
# Create a combined variable for x-axis (interaction of zone and aspect)
full_15min_gb_dt$gb_interaction_zone_aspect <- interaction(full_15min_gb_dt$zone, full_15min_gb_dt$aspect)

# Create the plot
full_ns_boxplots_gb_inter <- ggplot(full_15min_gb_dt, 
                                  aes(x = gb_interaction_zone_aspect, y = gb_temp, fill = aspect, pattern = zone)) +
  geom_boxplot_pattern(
    aes(pattern = zone), 
    pattern_density = 0.3,  # Adjust density for stripes
    pattern_fill = NA,  # No fill for pattern
    color = "black"  # Outline color
  ) + 
  labs(title = "a) Green Burn", x = "Aspect and Zone", y = "Temperature (째C)") +
  scale_x_discrete(labels = c("PSZ-N", "TSZ-N", "PSZ-S", "TSZ-S")) +  # Custom labels
  facet_wrap(~month, nrow = 1) +
  theme_bw() +
  scale_fill_manual(values = c("north" = "#2166AC", "south" = "#D95F02")) +  # Solid fill colors
  scale_pattern_manual(values = c("PSZ" = NA, "TSZ" = "stripe")) +  # Solid for PSZ, stripes for TSZ
  guides(fill = guide_legend(title = "Aspect"), 
         pattern = guide_legend(title = "Zone")) # Separate legend titles

# Display the plot
full_ns_boxplots_gb_inter
```

```{r}
#DB N/S Trees
# Create a combined variable for x-axis (interaction of zone and aspect)
full_15min_db_dt$db_interaction_zone_aspect <- interaction(full_15min_db_dt$zone, full_15min_db_dt$aspect)

# Create the plot
full_ns_boxplots_db_inter <- ggplot(full_15min_db_dt, 
                                  aes(x = db_interaction_zone_aspect, y = db_temp, fill = aspect, pattern = zone)) +
  geom_boxplot_pattern(
    aes(pattern = zone), 
    pattern_density = 0.3,  # Adjust density for stripes
    pattern_fill = NA,  # No fill for pattern
    color = "black"  # Outline color
  ) + 
  labs(title = "b) Dead Burn", x = "Aspect and Zone", y = "Temperature (째C)") +
  scale_x_discrete(labels = c("PSZ-N", "TSZ-N", "PSZ-S", "TSZ-S")) +  # Custom labels
  facet_wrap(~month, nrow = 1) +
  theme_bw() +
  scale_fill_manual(values = c("north" = "#2166AC", "south" = "#D95F02")) +  # Solid fill colors
  scale_pattern_manual(values = c("PSZ" = NA, "TSZ" = "stripe")) +  # Solid for PSZ, stripes for TSZ
  guides(fill = guide_legend(title = "Aspect"), 
         pattern = guide_legend(title = "Zone")) # Separate legend titles

# Display the plot
full_ns_boxplots_db_inter
```

```{r}
#DB N/S Trees
# Create a combined variable for x-axis (interaction of zone and aspect)
full_15min_ub_dt$ub_interaction_zone_aspect <- interaction(full_15min_ub_dt$zone, full_15min_ub_dt$aspect)

# Create the plot
full_ns_boxplots_ub_inter <- ggplot(full_15min_ub_dt, 
                                  aes(x = ub_interaction_zone_aspect, y = ub_temp, fill = aspect, pattern = zone)) +
  geom_boxplot_pattern(
    aes(pattern = zone), 
    pattern_density = 0.3,  # Adjust density for stripes
    pattern_fill = NA,  # No fill for pattern
    color = "black"  # Outline color
  ) + 
  labs(title = "c) Live", x = "Aspect and Zone", y = "Temperature (째C)") +
  scale_x_discrete(labels = c("PSZ-N", "TSZ-N", "PSZ-S", "TSZ-S")) +  # Custom labels
  facet_wrap(~month, nrow = 1) +
  theme_bw() +
  scale_fill_manual(values = c("north" = "#2166AC", "south" = "#D95F02")) +  # Solid fill colors
  scale_pattern_manual(values = c("PSZ" = NA, "TSZ" = "stripe")) +  # Solid for PSZ, stripes for TSZ
  guides(fill = guide_legend(title = "Aspect"), 
         pattern = guide_legend(title = "Zone")) + # Separate legend titles
  scale_y_continuous(limits = c(0, 40))  # Force y-scale to go to 40

# Display the plot
full_ns_boxplots_ub_inter
```

```{r}
#combinging all of the above plots into one plot
#vertical stack version
gbdbub_full_ns_inter_plots <- ggarrange(full_ns_boxplots_gb_inter, full_ns_boxplots_db_inter, full_ns_boxplots_ub_inter, nrow = 1, ncol = 3, common.legend = TRUE, legend = "bottom")

gbdbub_full_ns_inter_plots
```

# LWout Scenarios

\*\* keep working on these scenarios!

## Scenario 1

1.  Apply T_tree to whole snow depth - snow depth is based on max snow depth from snow cameras at each burned/unburned site!

```{r}
#removing gb_w tree from persistent zone, and removing charred/uncharred temps, as this will just be N/S comparisons
full_sd_treeLWout <- filtered_all_aspects_snowdepths %>%
  #filtering out gb_w tree data
  filter(tree_name != "gb_w") %>%
  #filtering out charred/uncharred aspect
  filter(!aspect %in% c("charred", "uncharred")) %>%
  #adding in a Kelvin temp column
  rename(temp_C = temp) %>%
  mutate(temp_K = (temp_C + 273.15)) %>%
  #calculating LWout in Wperm^2 by burn_status
  mutate(LWout_wperm2 = emissivity * stefan_boltzmann_constant * (temp_K^4)) %>%
   # Define circ of each tree based on burn status
 mutate(tree_circ = case_when(
  zone == "PSZ" & burn_status == "green burn" ~ 0.4006,
  zone == "PSZ" & burn_status == "dead burn" ~ 0.5576,
  zone == "PSZ" & burn_status == "live" ~ 0.5027,
  zone == "TSZ" & burn_status == "green burn" ~ 0.5812,
  zone == "TSZ" & burn_status == "dead burn" ~ 0.5655,
  zone == "TSZ" & burn_status == "live" ~ 0.5341,
  TRUE ~ 0.5576
)) %>%
  #Defining m2
   mutate(m2 = snowcam_max_depth_m * tree_circ) %>%
  #calcuating Watz (power) - dividing by 2 here so that the only half the value is applied to the north/south aspects!
  mutate(
    Watz = LWout_wperm2 * (m2/2),
#converting from Wperm2 to MJ/day
    LWout_MJperd = Watz * 86400 / 1e6) %>%
  select(datetime, day, month, phase, zone, burn_status, aspect, tree_name, snowcam_max_depth_m, temp_C, temp_K, tree_circ, LWout_wperm2, m2, Watz, LWout_MJperd, everything())
```

```{r}
#making a daily average dataset for full_sd_treeLWout_plot
daily_sd_treeLWout <- full_sd_treeLWout %>%
  group_by(day, month, phase, zone, burn_status, aspect) %>%
  summarize(snowcam_max_depth_m = mean(snowcam_max_depth_m), temp_C = mean(temp_C), temp_K = mean(temp_K), tree_circ = mean(tree_circ), LWout_wperm2 = mean(LWout_wperm2), LWout_MJperd = mean(LWout_MJperd))

PSZ_daily_sd_treeLWout <- daily_sd_treeLWout %>%
  filter(zone == "PSZ")

TSZ_daily_sd_treeLWout <- daily_sd_treeLWout %>%
  filter(zone == "TSZ")
```

```{r}
#plotting above LWout values

##full plot
daily_sd_treeLWout_plot <- ggplot(data = daily_sd_treeLWout) +
  geom_line(aes(x = day, y = LWout_MJperd, color = burn_status, linetype = aspect), linewidth = 0.7) + 
  facet_wrap(~zone + phase) +
  labs(x = NULL, y = "LWout (MJ/day)") +
  scale_color_manual(values = c("green burn" = "#1B7837", "dead burn" = "#D95F02", "live" = adjustcolor("#2166AC", alpha = 0.7))) +
  scale_linetype_manual(values = c("north" = "dashed", "south" = "solid")) +
  theme_bw()

daily_sd_treeLWout_plot
```

```{r}
#PSZ plot
PSZ_daily_sd_treeLWout_plot <- ggplot(data = PSZ_daily_sd_treeLWout) +
  geom_line(aes(x = day, y = LWout_MJperd, color = burn_status, linetype = aspect), linewidth = 0.7) + 
  facet_wrap(~ phase) +
  labs(title = "a) PSZ", x = NULL, y = "LWout (MJ/day)") +
  scale_color_manual(values = c("green burn" = "#1B7837", "dead burn" = "#D95F02", "live" = adjustcolor("#2166AC", alpha = 0.7))) +
  scale_linetype_manual(values = c("north" = "dashed", "south" = "solid")) +
  scale_y_continuous(limits = c(0, 15)) +
  theme_bw()

PSZ_daily_sd_treeLWout_plot
```

```{r}
#TSZ plot
TSZ_daily_sd_treeLWout_plot <- ggplot(data = TSZ_daily_sd_treeLWout) +
  geom_line(aes(x = day, y = LWout_MJperd, color = burn_status, linetype = aspect), linewidth = 0.7) + 
  facet_wrap(~ phase) +
  labs(title = "b) TSZ", x = "Day", y = "LWout (MJ/day)") +
  scale_color_manual(values = c("green burn" = "#1B7837", "dead burn" = "#D95F02", "live" = adjustcolor("#2166AC", alpha = 0.7))) +
  scale_linetype_manual(values = c("north" = "dashed", "south" = "solid")) +
  scale_y_continuous(limits = c(0, 15)) +
  theme_bw()

TSZ_daily_sd_treeLWout_plot
```

```{r}
#Combined Plot
comb_daily_sd_treeLWout_lineplot <- ggarrange(PSZ_daily_sd_treeLWout_plot, TSZ_daily_sd_treeLWout_plot, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")

comb_daily_sd_treeLWout_lineplot
```

Boxplots of the above comparisons

```{r}
PSZ_daily_sd_treeLWout_boxplot <- ggplot(data = PSZ_daily_sd_treeLWout) +
  geom_boxplot(aes(x = burn_status, y = LWout_MJperd, fill = burn_status)) + 
  facet_wrap(~ phase) +
  labs(title = "a) PSZ", x = NULL, y = "LWout (MJ/day)") +
  scale_fill_manual(values = c("green burn" = "#1B7837", "dead burn" = "#D95F02", "live" = adjustcolor("#2166AC", alpha = 0.7))) +
  scale_y_continuous(limits = c(0, 15)) +
  theme_bw()

PSZ_daily_sd_treeLWout_boxplot
```

```{r}
TSZ_daily_sd_treeLWout_boxplot <- ggplot(data = TSZ_daily_sd_treeLWout) +
  geom_boxplot(aes(x = burn_status, y = LWout_MJperd, fill = burn_status)) + 
  facet_wrap(~ phase) +
  labs(title = "b) TSZ", x = "Burn Status", y = "LWout (MJ/day)") +
  scale_fill_manual(values = c("green burn" = "#1B7837", "dead burn" = "#D95F02", "live" = adjustcolor("#2166AC", alpha = 0.7))) +
  scale_y_continuous(limits = c(0, 15)) +
  theme_bw()

TSZ_daily_sd_treeLWout_boxplot
```

```{r}
comb_daily_sd_treeLWout_boxplot <- ggarrange(PSZ_daily_sd_treeLWout_boxplot, TSZ_daily_sd_treeLWout_boxplot, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")

comb_daily_sd_treeLWout_boxplot
```

\*\* as of 2025-01-13 - the above plots don't really make sense, need to look at day/night parsing closely before plotting, as it looks more like thePSZ is plotting the day of both PSZ and TSZ?

\*\*might need to plot the above data differently depending on how the next scenario turns out

## Scenario 2

2.  Linear to ground (GND = 0 C) - snow depth is based on max snow depth from snow cameras at each burned/unburned site!

```{r}
full_sd_treeLWout_2 <- filtered_all_aspects_snowdepths %>%
  #filtering out gb_w tree data
  filter(tree_name != "gb_w") %>%
  #filtering out charred/uncharred aspect
  filter(!aspect %in% c("charred", "uncharred")) %>%
  #adding in a Kelvin temp column
  rename(temp_C_2 = temp) %>%
  mutate(temp_K_2 = (temp_C_2 + 273.15)) %>%
  #calculating LWout in Wperm^2 by burn_status
  mutate(LWout_wperm2_2m = emissivity * stefan_boltzmann_constant * (temp_K_2^4)) %>%
   # Define circ of each tree based on burn status
 mutate(tree_circ = case_when(
  zone == "PSZ" & burn_status == "green burn" ~ 0.4006,
  zone == "PSZ" & burn_status == "dead burn" ~ 0.5576,
  zone == "PSZ" & burn_status == "live" ~ 0.5027,
  zone == "TSZ" & burn_status == "green burn" ~ 0.5812,
  zone == "TSZ" & burn_status == "dead burn" ~ 0.5655,
  zone == "TSZ" & burn_status == "live" ~ 0.5341,
  TRUE ~ 0.5576
)) %>%
  #Defining m2
   mutate(m2 = snowcam_max_depth_m * tree_circ) %>%
  #calcuating Watz (power) - dividing by 2 here so that the only half the value is applied to the north/south aspects!
  mutate(
    Watz_2m = LWout_wperm2_2m * (m2/2),
#converting from Wperm2 to MJ/day
    LWout_MJperd_2m = Watz_2m * 86400 / 1e6) %>%
  # NOW creating a linear regression of temperatures and LWout values to be applied to the 1.5, 1, 0.5 and 0m heights on tree
  ## creating temp gradient
  mutate(
    temp_C_1_5 = temp_C_2 - (temp_C_2 / 2 * 0.5), # Linear decrease for 1.5m
    temp_C_1 = temp_C_2 - (temp_C_2 / 2 * 1),     # Linear decrease for 1m
    temp_C_0_5 = temp_C_2 - (temp_C_2 / 2 * 1.5), # Linear decrease for 0.5m
    temp_C_0 = 0                               # 0m temp is constant at 0째C
  ) %>%
  mutate(temp_K_1_5 = (temp_C_1_5 + 273.15),
         temp_K_1 = (temp_C_1 + 273.15),
         temp_K_0_5 = (temp_C_0_5 + 273.15),
         temp_K_0 = (temp_C_0 + 273.15)) %>%
  mutate(LWout_wperm2_1_5m = emissivity * stefan_boltzmann_constant * (temp_K_1_5^4), LWout_wperm2_1m = emissivity * stefan_boltzmann_constant * (temp_K_1^4), LWout_wperm2_0_5m = emissivity * stefan_boltzmann_constant * (temp_K_0_5^4), LWout_wperm2_0m = emissivity * stefan_boltzmann_constant * (temp_K_0^4)) %>%
  mutate(
    Watz_1_5m = LWout_wperm2_1_5m * (m2/2),
#converting from Wperm2 to MJ/day
    LWout_MJperd_1_5m = Watz_1_5m * 86400 / 1e6, Watz_1m = LWout_wperm2_1m * (m2/2),
#converting from Wperm2 to MJ/day
    LWout_MJperd_1m = Watz_1m * 86400 / 1e6, Watz_0_5m = LWout_wperm2_0_5m * (m2/2),
#converting from Wperm2 to MJ/day
    LWout_MJperd_0_5m = Watz_0_5m * 86400 / 1e6, Watz_0m = LWout_wperm2_0m * (m2/2),
#converting from Wperm2 to MJ/day
    LWout_MJperd_0m = Watz_0m * 86400 / 1e6)%>%
  select(datetime, day, month, phase, zone, burn_status, aspect, tree_name, snowcam_max_depth_m, temp_C_2, temp_C_1_5, temp_C_1, temp_C_0_5, temp_C_0, temp_K_2, temp_K_1_5, temp_K_1, temp_K_0_5, temp_K_0, tree_circ, LWout_wperm2_2m, LWout_wperm2_1_5m, LWout_wperm2_1m, LWout_wperm2_0_5m, LWout_wperm2_0m , m2, Watz_2m, Watz_1_5m, Watz_1m, Watz_0_5m, Watz_0m, LWout_MJperd_2m, LWout_MJperd_1_5m, LWout_MJperd_1m, LWout_MJperd_0_5m, LWout_MJperd_0m , everything())
```

```{r}
#making a daily average dataset for full_sd_treeLWout_plot
daily_sd_treeLWout_2 <- full_sd_treeLWout_2 %>%
  group_by(day, month, phase, zone, burn_status, aspect) %>%
  summarize(snowcam_max_depth_m = mean(snowcam_max_depth_m),
            temp_C_2 = mean(temp_C_2), 
            temp_C_1_5 = mean(temp_C_1_5), 
            temp_C_1 = mean(temp_C_1), 
            temp_C_0_5 = mean(temp_C_0_5),
            temp_C_0 = mean(temp_C_0),
            temp_K_2 = mean(temp_K_2),
            temp_K_1_5 = mean(temp_K_1_5),
            temp_K_1 = mean(temp_K_1),
            temp_K_0_5 = mean(temp_K_0_5),
            temp_K_0 = mean(temp_K_0),
            tree_circ = mean(tree_circ), 
            LWout_wperm2_2m = mean(LWout_wperm2_2m),
            LWout_wperm2_1_5m = mean(LWout_wperm2_1_5m),
            LWout_wperm2_1m = mean(LWout_wperm2_1m),
            LWout_wperm2_0_5m = mean(LWout_wperm2_0_5m),
            LWout_wperm2_0m = mean(LWout_wperm2_0m),
            LWout_MJperd_2m = mean(LWout_MJperd_2m),
            LWout_MJperd_1_5m = mean(LWout_MJperd_1_5m),
            LWout_MJperd_1m = mean(LWout_MJperd_1m),
            LWout_MJperd_0_5m = mean(LWout_MJperd_0_5m),
            LWout_MJperd_0m = mean(LWout_MJperd_0m))
```

```{r}
## use this dataframe to make zone datatables, then to graph!
daily_sd_treeLWout_long_2 <- daily_sd_treeLWout_2 %>%
  pivot_longer(
    cols = starts_with("LWout_"), # Select all LWout columns
    names_to = c("LWout_type", "depth"), # Create new columns for type and depth
    names_pattern = "LWout_(.*)_(.*)m", # Regex to split names (e.g., "MJperd", "wperm2" and depth)
    values_to = "LWout_value" # New column for values
  ) %>%
  filter(str_starts(LWout_type, "MJperd")) %>%
  rename(LWout_MJperd = LWout_value, sensor_depth = depth) %>%
  #editing the sensor depth column to accurately represent the 1.5 and 0.5 depths
  mutate(
    sensor_depth = case_when(
      sensor_depth == 5 & LWout_type == "MJperd_1" ~ 1.5,
      sensor_depth == 5 & LWout_type == "MJperd_0" ~ 0.5,
      TRUE ~ as.numeric(sensor_depth) # Explicitly convert to numeric
    )
  )
```

```{r}
PSZ_daily_sd_treeLWout_2 <- daily_sd_treeLWout_long_2 %>%
  filter(zone == "PSZ", phase == "day")

TSZ_daily_sd_treeLWout <- daily_sd_treeLWout_long_2 %>%
  filter(zone == "TSZ", phase == "day")
```

```{r}
#PSZ plot
PSZ_daily_sd_treeLWout_scenario2_plot <- ggplot(data = PSZ_daily_sd_treeLWout_2) +
  geom_line(aes(x = day, y = LWout_MJperd, color = burn_status, linetype = aspect), linewidth = 0.7) + 
  facet_wrap(~ sensor_depth) +
  labs(title = "a) PSZ", x = NULL, y = "LWout (MJ/day)") +
  scale_color_manual(values = c("green burn" = "#1B7837", "dead burn" = "#D95F02", "live" = adjustcolor("#2166AC", alpha = 0.7))) +
  scale_linetype_manual(values = c("north" = "dashed", "south" = "solid")) +
  #scale_y_continuous(limits = c(0, 15)) +
  theme_bw()

PSZ_daily_sd_treeLWout_scenario2_plot
```

```{r}
TSZ_daily_sd_treeLWout_scenario2_plot <- ggplot(data = TSZ_daily_sd_treeLWout_2) +
  geom_line(aes(x = day, y = LWout_MJperd, color = burn_status, linetype = aspect), linewidth = 0.7) + 
  facet_wrap(~ sensor_depth) +
  labs(title = "b) TSZ", x = "Date", y = "LWout (MJ/day)") +
  scale_color_manual(values = c("green burn" = "#1B7837", "dead burn" = "#D95F02", "live" = adjustcolor("#2166AC", alpha = 0.7))) +
  scale_linetype_manual(values = c("north" = "dashed", "south" = "solid")) +
  #scale_y_continuous(limits = c(0, 15)) +
  theme_bw()

TSZ_daily_sd_treeLWout_scenario2_plot
```

\*\* trying a different strategy for plotting to compare the depths visually better

```{r}
PSZ_daily_sd_treeLWout_2_gb <- PSZ_daily_sd_treeLWout_2 %>%
  filter(burn_status == "green burn")

PSZ_daily_sd_treeLWout_2_db <- PSZ_daily_sd_treeLWout_2 %>%
  filter(burn_status == "dead burn")

PSZ_daily_sd_treeLWout_2_live <- PSZ_daily_sd_treeLWout_2 %>%
  filter(burn_status == "live")
```

```{r}
TSZ_daily_sd_treeLWout_2_gb <- TSZ_daily_sd_treeLWout_2 %>%
  filter(burn_status == "green burn")

TSZ_daily_sd_treeLWout_2_db <- TSZ_daily_sd_treeLWout_2 %>%
  filter(burn_status == "dead burn")

TSZ_daily_sd_treeLWout_2_live <- TSZ_daily_sd_treeLWout_2 %>%
  filter(burn_status == "live")
```

```{r}
PSZ_daily_sd_GB_treeLWout_scenario2_plot <- ggplot(data = PSZ_daily_sd_treeLWout_2_gb) +
  geom_line(aes(
      x = day,
      y = LWout_MJperd,
      color = factor(sensor_depth, levels = c("2", "1.5", "1", "0.5", "0")), 
      linetype = aspect), linewidth = 0.7) +
 scale_color_manual(
    values = c(
      "2" = "#D95F02",    # Darkest color for 2m
      "1.5" = "orange",  # Dark gray
      "1" = "grey23",    # Medium gray
      "0.5" = "skyblue4",  # Light gray
      "0" = "#2166AC"     # Lightest color for 0m
    ),
      labels = c(
      "2" = "2 m",
      "1.5" = "1.5 m",
      "1" = "1 m",
      "0.5" = "0.5 m",
      "0" = "0 m (GND)"
    ), 
    name = "sensor depth"
  ) +
  theme_bw() + 
  labs(title = "a) PSZ GB", x = NULL, y = "LWout (MJ/day)") +
  scale_linetype_manual(values = c("north" = "dashed", "south" = "solid")) +
  scale_y_continuous(limits = c(0, 15)) +
  theme_bw() +
  facet_wrap(~aspect)

PSZ_daily_sd_GB_treeLWout_scenario2_plot
```

```{r}
PSZ_daily_sd_DB_treeLWout_scenario2_plot <- ggplot(data = PSZ_daily_sd_treeLWout_2_db) +
  geom_line(aes(
      x = day,
      y = LWout_MJperd,
      color = factor(sensor_depth, levels = c("2", "1.5", "1", "0.5", "0")), 
      linetype = aspect), linewidth = 0.7) +
 scale_color_manual(
    values = c(
      "2" = "#D95F02",    # Darkest color for 2m
      "1.5" = "orange",  # Dark gray
      "1" = "grey23",    # Medium gray
      "0.5" = "skyblue4",  # Light gray
      "0" = "#2166AC"     # Lightest color for 0m
    ),
      labels = c(
      "2" = "2 m",
      "1.5" = "1.5 m",
      "1" = "1 m",
      "0.5" = "0.5 m",
      "0" = "0 m (GND)"
    ), 
    name = "sensor depth"
  ) +
  theme_bw() + 
  labs(title = "b) PSZ DB", x = NULL, y = "LWout (MJ/day)") +
  scale_linetype_manual(values = c("north" = "dashed", "south" = "solid")) +
  scale_y_continuous(limits = c(0, 15)) +
  theme_bw() +
  facet_wrap(~aspect)

PSZ_daily_sd_DB_treeLWout_scenario2_plot
```

```{r}
PSZ_daily_sd_live_treeLWout_scenario2_plot <- ggplot(data = PSZ_daily_sd_treeLWout_2_live) +
  geom_line(aes(
      x = day,
      y = LWout_MJperd,
      color = factor(sensor_depth, levels = c("2", "1.5", "1", "0.5", "0")), 
      linetype = aspect), linewidth = 0.7) +
 scale_color_manual(
    values = c(
      "2" = "#D95F02",    # Darkest color for 2m
      "1.5" = "orange",  # Dark gray
      "1" = "grey23",    # Medium gray
      "0.5" = "skyblue4",  # Light gray
      "0" = "#2166AC"     # Lightest color for 0m
    ),
      labels = c(
      "2" = "2 m",
      "1.5" = "1.5 m",
      "1" = "1 m",
      "0.5" = "0.5 m",
      "0" = "0 m (GND)"
    ), 
    name = "sensor depth"
  ) +
  theme_bw() + 
  labs(title = "c) PSZ live", x = "Date", y = "LWout (MJ/day)") +
  scale_linetype_manual(values = c("north" = "dashed", "south" = "solid")) +
  scale_y_continuous(limits = c(0, 15)) +
  theme_bw() +
  facet_wrap(~aspect)

PSZ_daily_sd_live_treeLWout_scenario2_plot
```

```{r}
TSZ_daily_sd_GB_treeLWout_scenario2_plot <- ggplot(data = TSZ_daily_sd_treeLWout_2_gb) +
  geom_line(aes(
      x = day,
      y = LWout_MJperd,
      color = factor(sensor_depth, levels = c("2", "1.5", "1", "0.5", "0")), 
      linetype = aspect), linewidth = 0.7) +
 scale_color_manual(
    values = c(
      "2" = "#D95F02",    # Darkest color for 2m
      "1.5" = "orange",  # Dark gray
      "1" = "grey23",    # Medium gray
      "0.5" = "skyblue4",  # Light gray
      "0" = "#2166AC"     # Lightest color for 0m
    ),
      labels = c(
      "2" = "2 m",
      "1.5" = "1.5 m",
      "1" = "1 m",
      "0.5" = "0.5 m",
      "0" = "0 m (GND)"
    ), 
    name = "sensor depth"
  ) +
  theme_bw() + 
  labs(title = "d) TSZ GB", x = NULL, y = "LWout (MJ/day)") +
  scale_linetype_manual(values = c("north" = "dashed", "south" = "solid")) +
  scale_y_continuous(limits = c(0, 15)) +
  theme_bw() +
  facet_wrap(~aspect)

TSZ_daily_sd_GB_treeLWout_scenario2_plot
```

```{r}
TSZ_daily_sd_DB_treeLWout_scenario2_plot <- ggplot(data = TSZ_daily_sd_treeLWout_2_db) +
  geom_line(aes(
      x = day,
      y = LWout_MJperd,
      color = factor(sensor_depth, levels = c("2", "1.5", "1", "0.5", "0")), 
      linetype = aspect), linewidth = 0.7) +
 scale_color_manual(
    values = c(
      "2" = "#D95F02",    # Darkest color for 2m
      "1.5" = "orange",  # Dark gray
      "1" = "grey23",    # Medium gray
      "0.5" = "skyblue4",  # Light gray
      "0" = "#2166AC"     # Lightest color for 0m
    ),
      labels = c(
      "2" = "2 m",
      "1.5" = "1.5 m",
      "1" = "1 m",
      "0.5" = "0.5 m",
      "0" = "0 m (GND)"
    ), 
    name = "sensor depth"
  ) +
  theme_bw() + 
  labs(title = "e) TSZ DB", x = NULL, y = "LWout (MJ/day)") +
  scale_linetype_manual(values = c("north" = "dashed", "south" = "solid")) +
  scale_y_continuous(limits = c(0, 15)) +
  theme_bw() +
  facet_wrap(~aspect)

TSZ_daily_sd_DB_treeLWout_scenario2_plot
```

```{r}
TSZ_daily_sd_live_treeLWout_scenario2_plot <- ggplot(data = TSZ_daily_sd_treeLWout_2_live) +
  geom_line(aes(
      x = day,
      y = LWout_MJperd,
      color = factor(sensor_depth, levels = c("2", "1.5", "1", "0.5", "0")), 
      linetype = aspect), linewidth = 0.7) +
 scale_color_manual(
    values = c(
      "2" = "#D95F02",    # Darkest color for 2m
      "1.5" = "orange",  # Dark gray
      "1" = "grey23",    # Medium gray
      "0.5" = "skyblue4",  # Light gray
      "0" = "#2166AC"     # Lightest color for 0m
    ),
      labels = c(
      "2" = "2 m",
      "1.5" = "1.5 m",
      "1" = "1 m",
      "0.5" = "0.5 m",
      "0" = "0 m (GND)"
    ), 
    name = "sensor depth"
  ) +
  theme_bw() + 
  labs(title = "f) TSZ live", x = "Date", y = "LWout (MJ/day)") +
  scale_linetype_manual(values = c("north" = "dashed", "south" = "solid")) +
  scale_y_continuous(limits = c(0, 15)) +
  theme_bw() +
  facet_wrap(~aspect)

TSZ_daily_sd_live_treeLWout_scenario2_plot
```

```{r}
#PSZ vertical combination
PSZ_daily_sd_scenario2 <- ggarrange(PSZ_daily_sd_GB_treeLWout_scenario2_plot, PSZ_daily_sd_DB_treeLWout_scenario2_plot, PSZ_daily_sd_live_treeLWout_scenario2_plot, nrow = 3, ncol = 1, common.legend = TRUE, legend = "right")

PSZ_daily_sd_scenario2
```

```{r}
#TSZ vertical combination
TSZ_daily_sd_scenario2 <- ggarrange(TSZ_daily_sd_GB_treeLWout_scenario2_plot, TSZ_daily_sd_DB_treeLWout_scenario2_plot, TSZ_daily_sd_live_treeLWout_scenario2_plot, nrow = 3, ncol = 1, common.legend = TRUE, legend = "right")

TSZ_daily_sd_scenario2
```

```{r}
comb_daily_sd_treeLWout_lineplot_scenario2 <- ggarrange(PSZ_daily_sd_scenario2, TSZ_daily_sd_scenario2, nrow = 1, ncol = 2, common.legend = TRUE, legend = "right")

comb_daily_sd_treeLWout_lineplot_scenario2
```

Boxplot of Scenario 2

```{r}
PSZ_daily_sd_treeLWout_2_gb_boxplot <- ggplot(data = PSZ_daily_sd_treeLWout_2_gb) +
  geom_boxplot(aes(
      x = factor(sensor_depth, levels = c("2", "1.5", "1", "0.5", "0")), 
      y = LWout_MJperd, 
      fill = factor(sensor_depth, levels = c("2", "1.5", "1", "0.5", "0"))
    )) +
  scale_fill_manual(
    values = c(
      "2" = "#D95F02",    # Darkest color for 2m
      "1.5" = "orange",   # Dark gray
      "1" = "grey23",     # Medium gray
      "0.5" = "skyblue4", # Light gray
      "0" = "#2166AC"     # Lightest color for 0m
    ),
    labels = c(
      "2" = "2 m",
      "1.5" = "1.5 m",
      "1" = "1 m",
      "0.5" = "0.5 m",
      "0" = "0 m (GND)"
    ), 
    name = "Sensor Depth"
  ) +
  theme_bw() + 
  labs(title = "a) PSZ GB", x = NULL, y = "LWout (MJ/day)") +
  scale_y_continuous(limits = c(0, 15)) +
  facet_wrap(~aspect)

PSZ_daily_sd_treeLWout_2_gb_boxplot
```

```{r}
PSZ_daily_sd_treeLWout_2_db_boxplot <- ggplot(data = PSZ_daily_sd_treeLWout_2_db) +
  geom_boxplot(aes(
      x = factor(sensor_depth, levels = c("2", "1.5", "1", "0.5", "0")), 
      y = LWout_MJperd, 
      fill = factor(sensor_depth, levels = c("2", "1.5", "1", "0.5", "0"))
    )) +
  scale_fill_manual(
    values = c(
      "2" = "#D95F02",    # Darkest color for 2m
      "1.5" = "orange",   # Dark gray
      "1" = "grey23",     # Medium gray
      "0.5" = "skyblue4", # Light gray
      "0" = "#2166AC"     # Lightest color for 0m
    ),
    labels = c(
      "2" = "2 m",
      "1.5" = "1.5 m",
      "1" = "1 m",
      "0.5" = "0.5 m",
      "0" = "0 m (GND)"
    ), 
    name = "Sensor Depth"
  ) +
  theme_bw() + 
  labs(title = "b) PSZ DB", x = NULL, y = "LWout (MJ/day)") +
  scale_y_continuous(limits = c(0, 15)) +
  facet_wrap(~aspect)

PSZ_daily_sd_treeLWout_2_db_boxplot
```

```{r}
PSZ_daily_sd_treeLWout_2_live_boxplot <- ggplot(data = PSZ_daily_sd_treeLWout_2_live) +
  geom_boxplot(aes(
      x = factor(sensor_depth, levels = c("2", "1.5", "1", "0.5", "0")), 
      y = LWout_MJperd, 
      fill = factor(sensor_depth, levels = c("2", "1.5", "1", "0.5", "0"))
    )) +
  scale_fill_manual(
    values = c(
      "2" = "#D95F02",    # Darkest color for 2m
      "1.5" = "orange",   # Dark gray
      "1" = "grey23",     # Medium gray
      "0.5" = "skyblue4", # Light gray
      "0" = "#2166AC"     # Lightest color for 0m
    ),
    labels = c(
      "2" = "2 m",
      "1.5" = "1.5 m",
      "1" = "1 m",
      "0.5" = "0.5 m",
      "0" = "0 m (GND)"
    ), 
    name = "Sensor Depth"
  ) +
  theme_bw() + 
  labs(title = "c) PSZ live", x = "Sensor Depth", y = "LWout (MJ/day)") +
  scale_y_continuous(limits = c(0, 15)) +
  facet_wrap(~aspect)

PSZ_daily_sd_treeLWout_2_live_boxplot
```

```{r}
TSZ_daily_sd_treeLWout_2_gb_boxplot <- ggplot(data = TSZ_daily_sd_treeLWout_2_gb) +
  geom_boxplot(aes(
      x = factor(sensor_depth, levels = c("2", "1.5", "1", "0.5", "0")), 
      y = LWout_MJperd, 
      fill = factor(sensor_depth, levels = c("2", "1.5", "1", "0.5", "0"))
    )) +
  scale_fill_manual(
    values = c(
      "2" = "#D95F02",    # Darkest color for 2m
      "1.5" = "orange",   # Dark gray
      "1" = "grey23",     # Medium gray
      "0.5" = "skyblue4", # Light gray
      "0" = "#2166AC"     # Lightest color for 0m
    ),
    labels = c(
      "2" = "2 m",
      "1.5" = "1.5 m",
      "1" = "1 m",
      "0.5" = "0.5 m",
      "0" = "0 m (GND)"
    ), 
    name = "Sensor Depth"
  ) +
  theme_bw() + 
  labs(title = "d) TSZ GB", x = NULL, y = "LWout (MJ/day)") +
  scale_y_continuous(limits = c(0, 15)) +
  facet_wrap(~aspect)

TSZ_daily_sd_treeLWout_2_gb_boxplot
```

```{r}
TSZ_daily_sd_treeLWout_2_db_boxplot <- ggplot(data = TSZ_daily_sd_treeLWout_2_db) +
  geom_boxplot(aes(
      x = factor(sensor_depth, levels = c("2", "1.5", "1", "0.5", "0")), 
      y = LWout_MJperd, 
      fill = factor(sensor_depth, levels = c("2", "1.5", "1", "0.5", "0"))
    )) +
  scale_fill_manual(
    values = c(
      "2" = "#D95F02",    # Darkest color for 2m
      "1.5" = "orange",   # Dark gray
      "1" = "grey23",     # Medium gray
      "0.5" = "skyblue4", # Light gray
      "0" = "#2166AC"     # Lightest color for 0m
    ),
    labels = c(
      "2" = "2 m",
      "1.5" = "1.5 m",
      "1" = "1 m",
      "0.5" = "0.5 m",
      "0" = "0 m (GND)"
    ), 
    name = "Sensor Depth"
  ) +
  theme_bw() + 
  labs(title = "e) TSZ DB", x = NULL, y = "LWout (MJ/day)") +
  scale_y_continuous(limits = c(0, 15)) +
  facet_wrap(~aspect)

TSZ_daily_sd_treeLWout_2_db_boxplot
```

```{r}
TSZ_daily_sd_treeLWout_2_live_boxplot <- ggplot(data = TSZ_daily_sd_treeLWout_2_live) +
  geom_boxplot(aes(
      x = factor(sensor_depth, levels = c("2", "1.5", "1", "0.5", "0")), 
      y = LWout_MJperd, 
      fill = factor(sensor_depth, levels = c("2", "1.5", "1", "0.5", "0"))
    )) +
  scale_fill_manual(
    values = c(
      "2" = "#D95F02",    # Darkest color for 2m
      "1.5" = "orange",   # Dark gray
      "1" = "grey23",     # Medium gray
      "0.5" = "skyblue4", # Light gray
      "0" = "#2166AC"     # Lightest color for 0m
    ),
    labels = c(
      "2" = "2 m",
      "1.5" = "1.5 m",
      "1" = "1 m",
      "0.5" = "0.5 m",
      "0" = "0 m (GND)"
    ), 
    name = "Sensor Depth"
  ) +
  theme_bw() + 
  labs(title = "f) TSZ live", x = "Sensor Depth", y = "LWout (MJ/day)") +
  scale_y_continuous(limits = c(0, 15)) +
  facet_wrap(~aspect)

TSZ_daily_sd_treeLWout_2_live_boxplot
```

```{r}
PSZ_daily_sd_tree_LWout_2_comb_boxplot <- ggarrange(PSZ_daily_sd_treeLWout_2_gb_boxplot, PSZ_daily_sd_treeLWout_2_db_boxplot, PSZ_daily_sd_treeLWout_2_live_boxplot, nrow = 3, ncol = 1, common.legend = TRUE, legend = "right")

PSZ_daily_sd_tree_LWout_2_comb_boxplot
```

```{r}
TSZ_daily_sd_tree_LWout_2_comb_boxplot <- ggarrange(TSZ_daily_sd_treeLWout_2_gb_boxplot, TSZ_daily_sd_treeLWout_2_db_boxplot, TSZ_daily_sd_treeLWout_2_live_boxplot, nrow = 3, ncol = 1, common.legend = TRUE, legend = "right")

TSZ_daily_sd_tree_LWout_2_comb_boxplot
```

3.  Snow Pit Temp

    Based on snow pit temperature gradient of snow?

    \*\* SKIP THIS ONE FOR NOW!

```{r}
#loading in snow pit data to get snow temps
trans_b_transect_temps <- read_csv("nsf/nsf_snow_transects/transitional/trans_burned_transect_temps.csv") %>%
  mutate(date = as.Date(date, format=("%Y.%m.%d")))

trans_ub_transect_temps <- read_csv("nsf/nsf_snow_transects/transitional/trans_unburned_transect_temps.csv") %>%
  mutate(date = as.Date(date, format=("%Y.%m.%d")))
```

```{r}
#creating dataframes to use for temperature gradient
b_jan_tempg <- trans_b_transect_temps %>%
  filter(date == "2024-01-19") %>%
  #adding in a month column
  mutate(month = "1") %>%
  #getting mean temps of each pit per depth 
  group_by(date, month, depth_cm) %>%         # Group by depth
  summarize(mean_temp_c = mean(temp_c, na.rm = TRUE))

#creating dataframes to use for temperature gradient
ub_jan_tempg <- trans_ub_transect_temps %>%
  filter(date == "2024-01-19") %>%
  #adding in a month column
  mutate(month = "1") %>%
  #getting mean temps of each pit per depth 
  group_by(date, month, depth_cm) %>%         # Group by depth
  summarize(mean_temp_c = mean(temp_C, na.rm = TRUE))
```

```{r}
b_feb_tempg <- trans_b_transect_temps %>%
  filter(date == "2024-02-19") %>%
  #adding in a month column
  mutate(month = "2") %>%
  #getting mean temps of each pit per depth 
  group_by(date, month, depth_cm) %>%         # Group by depth
  summarize(mean_temp_c = mean(temp_c, na.rm = TRUE))

#creating dataframes to use for temperature gradient
ub_feb_tempg <- trans_ub_transect_temps %>%
  filter(date == "2024-02-19") %>%
  #adding in a month column
  mutate(month = "2") %>%
  #getting mean temps of each pit per depth 
  group_by(date, month, depth_cm) %>%         # Group by depth
  summarize(mean_temp_c = mean(temp_C, na.rm = TRUE))
```

```{r}
b_march_tempg <- trans_b_transect_temps %>%
  filter(date == "2024-03-20") %>%
  #adding in a month column
  mutate(month = "3") %>%
  #getting mean temps of each pit per depth 
  group_by(date, month, depth_cm) %>%         # Group by depth
  summarize(mean_temp_c = mean(temp_c, na.rm = TRUE))

ub_march_tempg <- trans_ub_transect_temps %>%
  filter(date == "2024-03-20") %>%
  #adding in a month column
  mutate(month = "3") %>%
  #getting mean temps of each pit per depth 
  group_by(date, month, depth_cm) %>%         # Group by depth
  summarize(mean_temp_c = mean(temp_C, na.rm = TRUE))
```

```{r}
b_april_tempg <- trans_b_transect_temps %>%
  filter(date == "2024-04-19") %>%
  #adding in a month column
  mutate(month = "4") %>%
  #getting mean temps of each pit per depth 
  group_by(date, month, depth_cm) %>%         # Group by depth
  summarize(mean_temp_c = mean(temp_c, na.rm = TRUE))

ub_april_tempg <- trans_ub_transect_temps %>%
  filter(date == "2024-04-19") %>%
  #adding in a month column
  mutate(month = "4") %>%
  #getting mean temps of each pit per depth 
  group_by(date, month, depth_cm) %>%         # Group by depth
  summarize(mean_temp_c = mean(temp_C, na.rm = TRUE))
```

```{r}
#combining the above averaged temps
##burned
t_b_tempg <- b_jan_tempg %>%
  full_join(b_feb_tempg) %>%
  full_join(b_march_tempg) %>%
  full_join(b_april_tempg)

t_ub_tempg <- ub_jan_tempg %>%
  full_join(ub_feb_tempg) %>%
  full_join(ub_march_tempg) %>%
  full_join(ub_april_tempg)
```

\*\* will need to get Dan's snowpit temps as well to apply these separately to the PSZ, as the snow depths will be significantly different between zones
